{"version":3,"file":"bundle.js","sources":["../../src/Keyword/Keyword.ts","../../src/umsaetze.ts","../../src/Sync/ArrayPlus.ts","../../src/Util/Number.ts","../../src/Sync/Row.ts","../../src/Sync/Table.ts","../../src/Expenses/ExpenseTable.ts","../../src/Category/CategoryView.ts","../../src/MonthSelect.ts","../../src/CollectionController.ts","../../src/AppView.ts","../../src/Expenses/Transaction.ts","../../src/Sync/ParseCSV.ts","../../src/Sync/Sync.ts","../../src/FakeJQueryXHR.ts","../../src/Expenses/Expenses.ts","../../src/Category/CategoryCount.ts","../../src/CatPage.ts","../../src/RecursiveArrayOfStrings.ts","../../src/Keyword/KeywordsView.ts","../../src/Category/CategoryCollection.ts","../../src/Keyword/CollectionArray.ts","../../src/Keyword/KeywordCollection.ts","../../src/Summary/SummaryLine.ts","../../src/Summary/SummaryView.ts","../../src/Util/SLTable.ts","../../src/History/HistoryView.ts","../../src/Workspace.ts","../../src/umsaetze.ts"],"sourcesContent":["\r\nexport default class Keyword {\r\n\r\n\tword: string;\r\n\r\n\tcategory: string;\r\n\r\n\tconstructor(attributes: Keyword) {\r\n\t\tif (!attributes.word) {\r\n\t\t\tthrow new Error('no word in keyword');\r\n\t\t}\r\n\t\tthis.word = attributes.word;\r\n\t\tif (!attributes.category) {\r\n\t\t\tthrow new Error('no word in keyword');\r\n\t\t}\r\n\t\tthis.category = attributes.category;\r\n\t}\r\n\r\n}\r\n","import Workspace from \"./Workspace\";\r\nconst _ = require('underscore');\r\nconst Backbone = require('backbone');\r\n\r\ninterface Window {\r\n\t__backboneAgent: any;\r\n}\r\ndeclare let window: Window;\r\n\r\nif (window.__backboneAgent) {\r\n\twindow.__backboneAgent.handleBackbone(Backbone);\r\n}\r\nconst $ = require('jquery');\r\n// const _ = require('underscore');\r\n\r\nexport function asyncLoop(arr: Array<any>, callback: Function, done?: Function) {\r\n\t(function loop(i) {\r\n\t\t//callback when the loop goes on\r\n\t\tcallback(arr[i], i, arr.length);\r\n\r\n\t\t//the condition\r\n\t\tif (i < arr.length) {\r\n\t\t\tsetTimeout(function() {\r\n\t\t\t\tloop(++i)\r\n\t\t\t}, 0); //rerun when condition is true\r\n\t\t} else {\r\n\t\t\tif (done) {\r\n\t\t\t\t//callback when the loop ends\r\n\t\t\t\tdone();\r\n\t\t\t}\r\n\t\t}\r\n\t}(0));                                         //start with 0\r\n}\r\n\r\nexport function debug(name, ...args) {\r\n\tconsole.warn(typeof name, \":\", ...args);\r\n}\r\n\r\nclass Umsaetze {\r\n\r\n\trouter: Workspace;\r\n\r\n\tconstructor() {\r\n\t\tthis.router = new Workspace();\r\n\t\t// console.log(ws);\r\n\r\n\t\tconst ok = Backbone.history.start({\r\n\t\t\troot: '/umsaetze/docs/web/'\r\n\t\t});\r\n\t\tconsole.log('history.start', ok);\r\n\t\tif (!ok) {\r\n\t\t\tconsole.log(Backbone.history.routes);\r\n\t\t}\r\n\r\n\t\tthis.inlineEdit();\r\n\t\tthis.tour();\r\n\t\tconsole.log('Umsaetze.constructor() done');\r\n\t}\r\n\r\n\tinlineEdit() {\r\n\t\t$(document).on('click', '.inlineEdit span', (event) => {\r\n\t\t\tlet span = $(event.target);\r\n\t\t\tlet container = span.parent();\r\n\t\t\tlet input = container.find('input').show();\r\n\t\t\tspan.hide();\r\n\t\t\tinput.focus().val(span.text().trim());\r\n\t\t\tinput.keyup((event) => {\r\n\t\t\t\tconsole.log(event.key);\r\n\t\t\t\tif (event.keyCode === 13) {\r\n\t\t\t\t\t$(event.target).blur();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tinput.blur((event) => {\r\n\t\t\t\tspan.html(input.val().trim());\r\n\t\t\t\tinput.hide();\r\n\t\t\t\tspan.show();\r\n\t\t\t\tlet callback = container.data('callback');\r\n\t\t\t\tif (typeof callback == 'function') {\r\n\t\t\t\t\tcallback(event, container, container.text().trim());\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n\ttour() {\r\n\t\tconst Tour = require('bootstrap-tour');\r\n\t\tlet tour = new Tour({\r\n\t\t\tsteps: [\r\n\t\t\t\t{\r\n\t\t\t\t\telement: \"#app\",\r\n\t\t\t\t\ttitle: \"Let me show you how it works\",\r\n\t\t\t\t\tcontent: \"Here you will see all your expenses in a selected month.\"\r\n\t\t\t\t},\r\n\t\t\t]});\r\n\r\n\t\tsetTimeout(() => {\r\n\t\t\t// Initialize the tour\r\n\t\t\t// tour.init();\r\n\t\t\t// Start the tour\r\n\t\t\t// tour.start();\r\n\t\t}, 5);\r\n\t}\r\n\r\n}\r\n\r\n$(function() {\r\n\tsetTimeout(() => {\r\n\t\tnew Umsaetze();\r\n\t}, 1*1000);\r\n});\r\n\r\n// only run this once\r\n// import ImportKeywords from './ImportKeywords';\r\n// let i = new ImportKeywords();\r\n","/// <reference path=\"../../typings/index.d.ts\" />\r\n\r\nconst _ = require('underscore');\r\nconst naturalSort = require('javascript-natural-sort');\r\n\r\nexport default class ArrayPlus extends Array<any> {\r\n\r\n\tlen: number;\r\n\r\n\tconstructor(rows?: Array<any>) {\r\n\t\tsuper();\r\n\t\tif (rows) {\r\n\t\t\t//console.log('ArrayPlus', rows.length);\r\n\t\t\trows.forEach((el, i) => {\r\n\t\t\t\tthis[i] = el;\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\t/**\r\n\t * @param callback\r\n\t */\r\n\tforEach(callback) {\r\n\t\t// super.forEach((row, i) => {\r\n\t\tlet sorted_keys = Object.keys(this).sort(naturalSort);\r\n\t\tfor (let i = 0; i < sorted_keys.length; i++) {\r\n\t\t\tlet key = sorted_keys[i];\r\n\t\t\tlet row = this[key];\r\n\t\t\tif (this.isNumeric(key)) {\r\n\t\t\t\tlet ok = callback(row, parseInt(key));\r\n\t\t\t\tif (ok === false) {\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tisNumeric(object) {\r\n\t\tlet stringObject = object && object.toString();\r\n\t\treturn !_.isArray(object) && (stringObject - parseFloat(stringObject) + 1) >= 0;\r\n\t}\r\n\r\n\tequals( array ) {\r\n\t\treturn this.length == array.length &&\r\n\t\t\tthis.every( function(this_i,i) { return this_i == array[i] } )\r\n\t}\r\n\r\n\tget length() {\r\n\t\tlet len = 0;\r\n\t\tfor (let i in this) {\r\n\t\t\tif (this.isNumeric(i)) {\r\n\t\t\t\tlen++;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn len;\r\n\t}\r\n\r\n\tset length(len) {\r\n\t\tthis.len = len;\r\n\t}\r\n\r\n\t/**\r\n\t * http://stackoverflow.com/questions/1053843/get-the-element-with-the-highest-occurrence-in-an-array\r\n\t * @param arr\r\n\t * @returns {T|_ChainSingle<T>|TModel}\r\n\t */\r\n\tmode() {\r\n\t\treturn this.sort((a,b) =>\r\n\t\t\tthis.filter(v => v.equals(a)).length\r\n\t\t\t- this.filter(v => v.equals(b)).length\r\n\t\t).pop();\r\n\t}\r\n\r\n}\r\n","const accounting = require('accounting-js');\r\nconst _ = require('underscore');\r\n\r\nexport function detectFloat(source: String) {\r\n\tif (_.isUndefined(source)) return NaN;\r\n\tlet float = accounting.unformat(source);\r\n\tlet posComma = source.indexOf(',');\r\n\tif (posComma > -1) {\r\n\t\tlet posDot = source.indexOf('.');\r\n\t\tif (posDot > -1 && posComma > posDot) {\r\n\t\t\tlet germanFloat = accounting.unformat(source, ',');\r\n\t\t\tif (Math.abs(germanFloat) > Math.abs(float)) {\r\n\t\t\t\tfloat = germanFloat;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\t// source = source.replace(/,/g, '.');\r\n\t\t\tfloat = accounting.unformat(source, ',');\r\n\t\t}\r\n\t}\r\n\treturn float;\r\n}\r\n\r\nexport interface Number {\r\n\tclamp(min: Number, max: Number): number;\r\n}\r\n\r\nNumber.prototype.clamp = function(min: number, max: number) {\r\n\treturn Math.min(Math.max(this, min), max);\r\n};\r\n","/// <reference path=\"../../typings/index.d.ts\" />\r\n\r\nimport ArrayPlus from \"./ArrayPlus\";\r\nimport Table from \"./Table\";\r\nconst _ = require('underscore');\r\nconst accounting = require('accounting-js');\r\n// const _isNumeric = require('underscore.isnumeric');\r\nrequire('../Util/String');\r\nimport {detectFloat} from \"../Util/Number\";\r\n\r\nexport default class Row extends ArrayPlus {\r\n\tdate: Date;\r\n\tamount: number;\r\n\tnote: string;\r\n\r\n\tconstructor(rawData?) {\r\n\t\tsuper(rawData);\r\n\t}\r\n\r\n\ttrim() {\r\n\t\tlet copy = new Row();\r\n\t\tthis.forEach((el, i) => {\r\n\t\t\tel = (el || '').trim();\r\n\t\t\tif (el.length) {\r\n\t\t\t\tcopy[i] = el;\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn copy;\r\n\t}\r\n\r\n\tgetRowTypes() {\r\n\t\tlet types = [];\r\n\t\tthis.forEach((el: any) => {\r\n\t\t\t// console.log('getRowTypes', el);\r\n\t\t\t// let float = parseFloat(el);\t// does not handle 1.000,12 well\r\n\t\t\tlet float = detectFloat(el);\r\n\r\n\t\t\tlet date = Date.parse(el);\r\n\t\t\tlet isDate = !!date && el.indexOf(',') == -1;\t// dates are without \",\"\r\n\t\t\tlet isEmpty = _.isNull(el)\r\n\t\t\t\t|| _.isUndefined(el)\r\n\t\t\t\t|| el == '';\r\n\t\t\tlet commas = 0;\r\n\t\t\tif (_.isString(el)) {\r\n\t\t\t\tcommas = el.split(',').length - 1;\r\n\t\t\t}\r\n\t\t\tlet elWithoutEUR = (el || '').replace('EUR', '').trim();\r\n\t\t\tlet onlyNumbers = /^[\\-,\\.\\d]+$/.test(elWithoutEUR);\r\n\t\t\tif (float && !isDate && commas == 1 && onlyNumbers) {\r\n\t\t\t\ttypes.push('number');\r\n\t\t\t} else if (isDate) {\r\n\t\t\t\ttypes.push('date');\r\n\t\t\t} else if (isEmpty) {\r\n\t\t\t\ttypes.push('null');\r\n\t\t\t} else {\r\n\t\t\t\ttypes.push('string');\r\n\t\t\t}\r\n\t\t});\r\n\t\t//Row.peek(this, types);\r\n\t\treturn new Row(types);\r\n\t}\r\n\r\n\tstatic peek(a, b, c?) {\r\n\t\tconsole.log('-- ', a.length, b.length, c ? c.length : '');\r\n\t\tlet maxLen = 50;\r\n\t\ta.forEach((aa: string, i: number) => {\r\n\t\t\taa = aa || '';\r\n\t\t\tlet bb = b[i] || '';\r\n\t\t\tlet cc = c ? c[i] || '' : '';\r\n\t\t\taa = Row.padTo(aa, maxLen);\r\n\t\t\tbb = Row.padTo(bb, maxLen);\r\n\t\t\tcc = Row.padTo(cc, maxLen);\r\n\t\t\tconsole.log(aa, '\\t', bb, '\\t', cc);\r\n\t\t});\r\n\t}\r\n\r\n\tstatic padTo(aa, maxLen: number) {\r\n\t\taa = aa.replace(/(?:\\r\\n|\\r|\\n)/g, ' ');\r\n\t\taa = aa.substr(0, maxLen);\r\n\t\tlet paddingLength = maxLen - aa.length;\r\n\t\tlet padding = ' '.repeat(paddingLength);\r\n\t\treturn aa + padding;\r\n\t}\r\n\r\n\tfilterByCommon(data: Table) {\r\n\t\tlet matchNumber = 0;\r\n\t\tlet filtered = data.filter((row: Row, i: number) => {\r\n\t\t\tlet rowTypes = row.getRowTypes();\r\n\t\t\tif (i+1 == 5) {\r\n\t\t\t\tRow.peek(row, rowTypes, this);\r\n\t\t\t}\r\n\t\t\tlet match = rowTypes.similar(this);\r\n\t\t\tlet matchPercent = rowTypes.similarPercent(this);\r\n\t\t\tconsole.log(i+1, match, '/', this.length, '=', matchPercent, '%', row.length);\r\n\t\t\t// let firstMatch100 = matchNumber == 0 && matchPercent == 100;\r\n\t\t\tlet restMatch80 = /*matchNumber &&*/ matchPercent >= 80;\r\n\t\t\tlet sameLength = row.length == this.length;\r\n\t\t\tlet bReturn = /*firstMatch100 ||*/ restMatch80 && sameLength;\r\n\t\t\tmatchNumber += bReturn ? 1 : 0;\r\n\t\t\treturn bReturn;\r\n\t\t});\r\n\t\treturn new Table(filtered);\r\n\t}\r\n\r\n\tgetHeaderFromTypes(dataRow: Row, rowNr: number) {\r\n\t\tlet header = new Row();\r\n\r\n\t\tlet strings = [];\r\n\t\tthis.forEach((el, i) => {\r\n\t\t\tif (el == 'date' && !header.date) {\r\n\t\t\t\theader.date = dataRow[i];\r\n\t\t\t} else if (el == 'number' && !header.amount) {\r\n\t\t\t\theader.amount = dataRow[i];\r\n\t\t\t} else if (el == 'string') {\r\n\t\t\t\tstrings.push(dataRow[i].trim());\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t// http://stackoverflow.com/questions/6521245/finding-longest-string-in-array\r\n\t\t//let longest = strings.reduce(function (a, b) { return a.length > b.length ? a : b; });\r\n\t\t//header.note = longest.trim();\r\n\t\theader.note = strings.join(' ');\r\n\r\n\t\tif (!rowNr) {\r\n\t\t\t// console.log(this, 'common');\r\n\t\t\t// console.log(strings, 'strings');\r\n\t\t\t// console.log(dataRow, 'dataRow');\r\n\t\t\t// console.log(header, 'header');\r\n\t\t}\r\n\r\n\t\treturn header;\r\n\t}\r\n\r\n\tsimilar(to: Array<string>) {\r\n\t\tlet theSame = 0;\r\n\t\tthis.forEach((el, i) => {\r\n\t\t\tlet bb = to[i];\r\n\t\t\ttheSame += el == bb ? 1 : 0;\r\n\t\t});\r\n\t\treturn theSame;\r\n\t}\r\n\r\n\tsimilarPercent(to: Array<string>) {\r\n\t\tlet similar = this.similar(to);\r\n\t\treturn similar / this.length * 100;\r\n\t}\r\n\r\n\ttoVanilla() {\r\n\t\treturn JSON.parse(JSON.stringify(this));\r\n\t}\r\n\r\n}\r\n","import Row from \"./Row\";\r\nimport ArrayPlus from \"./ArrayPlus\";\r\n\r\nconst _ = require('underscore');\r\n\r\nexport default class Table extends ArrayPlus {\r\n\r\n\tconstructor(rows?: Array<any>) {\r\n\t\tsuper();\r\n\t\tif (rows) {\r\n\t\t\t//console.log('ArrayPlus', rows.length);\r\n\t\t\trows.forEach((el, i) => {\r\n\t\t\t\tthis[i] = new Row(el);\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\tstatic fromText(text: string) {\r\n\t\tlet self = new Table();\r\n\t\tlet lines = self.tryBestSeparator(text);\r\n\t\tlines.forEach((row, i) => {\r\n\t\t\tself.push(row);\r\n\t\t});\r\n\t\treturn self;\r\n\t}\r\n\r\n\ttryBestSeparator(text: string) {\r\n\t\tlet linesC = Table.CSVToArray(text, ',');\r\n\t\tlet linesS = Table.CSVToArray(text, ';');\r\n\r\n\t\tlet colsC = [];\r\n\t\tlet colsS = [];\r\n\t\tfor (let i = 0; i < 100 && i < linesC.length && i < linesS.length; i++) {\r\n\t\t\tcolsC.push(linesC[i].length);\r\n\t\t\tcolsS.push(linesS[i].length);\r\n\t\t}\r\n\t\t// console.log(colsC, colsS);\r\n\t\tlet sumC = colsC.reduce(function (a, b) { return a + b; });\r\n\t\tlet sumS = colsS.reduce(function (a, b) { return a + b; });\r\n\t\tconsole.log(', => ', sumC, '; => ', sumS);\r\n\t\tlet lines;\r\n\t\tif (sumC > sumS) {\r\n\t\t\tlines = linesC;\r\n\t\t} else {\r\n\t\t\tlines = linesS;\r\n\t\t}\r\n\t\treturn lines;\r\n\t}\r\n\r\n\t/**\r\n\t * http://stackoverflow.com/questions/1293147/javascript-code-to-parse-csv-data\r\n\t * @param strData\r\n\t * @param strDelimiter\r\n\t * @returns {Array[]}\r\n\t * @constructor\r\n\t */\r\n\tstatic CSVToArray( strData, strDelimiter ) {\r\n\t\t// Check to see if the delimiter is defined. If not,\r\n\t\t// then default to comma.\r\n\t\tstrDelimiter = (strDelimiter || \",\");\r\n\r\n\t\t// Create a regular expression to parse the CSV values.\r\n\t\tlet objPattern = new RegExp(\r\n\t\t\t(\r\n\t\t\t\t// Delimiters.\r\n\t\t\t\t\"(\\\\\" + strDelimiter + \"|\\\\r?\\\\n|\\\\r|^)\" +\r\n\r\n\t\t\t\t// Quoted fields.\r\n\t\t\t\t\"(?:\\\"([^\\\"]*(?:\\\"\\\"[^\\\"]*)*)\\\"|\" +\r\n\r\n\t\t\t\t// Standard fields.\r\n\t\t\t\t\"([^\\\"\\\\\" + strDelimiter + \"\\\\r\\\\n]*))\"\r\n\t\t\t),\r\n\t\t\t\"gi\"\r\n\t\t);\r\n\r\n\r\n\t\t// Create an array to hold our data. Give the array\r\n\t\t// a default empty first row.\r\n\t\tlet arrData = [[]];\r\n\r\n\t\t// Create an array to hold our individual pattern\r\n\t\t// matching groups.\r\n\t\tlet arrMatches = null;\r\n\r\n\r\n\t\t// Keep looping over the regular expression matches\r\n\t\t// until we can no longer find a match.\r\n\t\twhile (arrMatches = objPattern.exec( strData )){\r\n\r\n\t\t\t// Get the delimiter that was found.\r\n\t\t\tlet strMatchedDelimiter = arrMatches[ 1 ];\r\n\r\n\t\t\t// Check to see if the given delimiter has a length\r\n\t\t\t// (is not the start of string) and if it matches\r\n\t\t\t// field delimiter. If id does not, then we know\r\n\t\t\t// that this delimiter is a row delimiter.\r\n\t\t\tif (\r\n\t\t\t\tstrMatchedDelimiter.length &&\r\n\t\t\t\tstrMatchedDelimiter !== strDelimiter\r\n\t\t\t){\r\n\r\n\t\t\t\t// Since we have reached a new row of data,\r\n\t\t\t\t// add an empty row to our data array.\r\n\t\t\t\tarrData.push( [] );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tlet strMatchedValue;\r\n\r\n\t\t\t// Now that we have our delimiter out of the way,\r\n\t\t\t// let's check to see which kind of value we\r\n\t\t\t// captured (quoted or unquoted).\r\n\t\t\tif (arrMatches[ 2 ]){\r\n\r\n\t\t\t\t// We found a quoted value. When we capture\r\n\t\t\t\t// this value, unescape any double quotes.\r\n\t\t\t\tstrMatchedValue = arrMatches[ 2 ].replace(\r\n\t\t\t\t\tnew RegExp( \"\\\"\\\"\", \"g\" ),\r\n\t\t\t\t\t\"\\\"\"\r\n\t\t\t\t);\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\t// We found a non-quoted value.\r\n\t\t\t\tstrMatchedValue = arrMatches[ 3 ];\r\n\r\n\t\t\t}\r\n\r\n\r\n\t\t\t// Now that we have our value string, let's add\r\n\t\t\t// it to the data array.\r\n\t\t\tarrData[ arrData.length - 1 ].push( strMatchedValue );\r\n\t\t}\r\n\r\n\t\t// Return the parsed data.\r\n\t\treturn( arrData );\r\n\t}\r\n\r\n\t/**\r\n\t * Remove empty lines from the bottom of the file.\r\n\t * This is required for analyzeCSV() to work.\r\n\t * @returns {Row[]}\r\n\t */\r\n\ttrim() {\r\n\t\tlet rev = this.reverse();\t// start at the bottom of the file\r\n\t\tlet startIndex = null;\r\n\t\trev.forEach((row, i) => {\r\n\t\t\t// first row with real data\r\n\t\t\tif (startIndex == null\r\n\t\t\t\t&& row.length && row[0] != '') {\r\n\t\t\t\tstartIndex = i;\r\n\t\t\t\tconsole.log('trim @', startIndex);\r\n\t\t\t}\r\n\t\t});\r\n\t\tlet data = rev.slice(startIndex);\r\n\t\t// console.log(data[0]);\r\n\t\tdata = data.reverse();\r\n\t\treturn new Table(data);\r\n\t}\r\n\r\n\t/**\r\n\t * Remove empty lines from anywhere in the file.\r\n\t * This prevents analyzeCSV() from working since it needs empty lines in the middle of the file.\r\n\t * @returns {Row[]}\r\n\t */\r\n\ttrimAll() {\r\n\t\tlet data = new Table();\r\n\t\tthis.forEach((row: Row, i) => {\r\n\t\t\tlet rowObj = new Row(row);\r\n\t\t\tlet rowTrimmed = rowObj.trim();\r\n\t\t\tif (rowTrimmed.length) {\r\n\t\t\t\tdata.push(rowObj);\t// original non trimmed row\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn data;\r\n\t}\r\n\r\n\tgetRowTypesForSomeRows() {\r\n\t\tlet typeSet = new Table();\r\n\t\tconsole.log('getRowTypesForSomeRows', this.length);\r\n\t\tlet iter = 0;\r\n\t\tthis.forEach((row0, i) => {\r\n\t\t\tlet row: Row = new Row(row0);\r\n\t\t\tlet types = row.getRowTypes();\r\n\t\t\t//console.log(i, row, types);\r\n\t\t\ttypeSet.push(types);\r\n\t\t\titer++;\r\n\t\t\tif (iter > 100) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn typeSet;\r\n\t}\r\n\r\n\tfilterMostlyNull() {\r\n\t\tlet notNull = this.filter((row) => {\r\n\t\t\tlet countNull = row.filter(type => {\r\n\t\t\t\treturn type == 'null';\r\n\t\t\t}).length;\r\n\t\t\t// console.log(countNull, row);\r\n\t\t\treturn countNull < row.length / 2;\r\n\t\t});\r\n\t\treturn new Table(notNull);\r\n\t}\r\n\r\n\ttoVanilla() {\r\n\t\tlet copy = [];\r\n\t\tthis.forEach(row => {\r\n\t\t\tcopy.push(row.toVanilla());\r\n\t\t});\r\n\t\treturn copy;\r\n\t}\r\n\r\n\ttoVanillaTable() {\r\n\t\tlet copy = [];\r\n\t\tthis.forEach(row => {\r\n\t\t\tcopy.push(Object.values(row.toVanilla()));\r\n\t\t});\r\n\t\treturn copy;\r\n\t}\r\n\r\n}\r\n","///<reference path=\"../../node_modules/backbone-typings/backbone.d.ts\"/>\r\n\r\nimport Expenses from \"./Expenses\";\r\nimport Transaction from \"./Transaction\";\r\nimport CategoryCollection from \"../Category/CategoryCollection\";\r\nimport KeywordCollection from \"../Keyword/KeywordCollection\";\r\nimport Keyword from \"../Keyword/Keyword\";\r\nimport {debug} from \"../umsaetze\";\r\nimport Table from \"../Sync/Table\";\r\nconst elapse = require('elapse');\r\nelapse.configure({\r\n\tdebug: true\r\n});\r\nconst Backbone = require('backbone');\r\nconst $ = require('jquery');\r\nconst _ = require('underscore');\r\nconst handlebars = require('handlebars');\r\n\r\nexport default class ExpenseTable extends Backbone.View<any> {\r\n\r\n\tmodel: Expenses;\r\n\r\n\t//collection: Expenses;\r\n\r\n\tcategoryList: CategoryCollection;\r\n\r\n\ttemplate = _.template($('#rowTemplate').html());\r\n\r\n\tkeywords: KeywordCollection;\r\n\r\n\tconstructor(options?) {\r\n\t\tsuper(options);\r\n\t\tconsole.log(this.keywords);\r\n\r\n\t\t// in case we started with Sync page the table is not visible\r\n\t\tif (!$('#expenseTable').length) {\r\n\t\t\tvar template = _.template($('#AppView').html());\r\n\t\t\t$('#app').html(template());\r\n\t\t}\r\n\r\n\t\tthis.setElement($('#expenseTable'));\r\n\r\n\t\t// slow re-rendering of the whole table when collection changes\r\n\t\t//this.listenTo(this.collection, 'update', this.render);\r\n\t\tthis.on(\"all\", debug(\"ExpenseTable\"));\r\n\t}\r\n\r\n\tsetCategoryList(list: CategoryCollection) {\r\n\t\tthis.categoryList = list;\r\n\t\tthis.listenTo(this.categoryList, 'change', this.render);\r\n\t}\r\n\r\n\trender(options?: any) {\r\n\t\tif (options && options.noRender) {\r\n\t\t\tconsole.log('ExpenseTable.noRender');\r\n\t\t\treturn;\r\n\t\t}\r\n\t\telapse.time('ExpenseTable.render');\r\n\t\tconsole.log('ExpenseTable.render()', this.model.size());\r\n\r\n\t\tlet table = this.getTransactionAttributesTable();\r\n\t\tlet rows = [];\r\n\t\ttable.forEach((attributes: Object) => {\r\n\t\t\trows.push(this.template(attributes));\r\n\t\t});\r\n\r\n\t\tconsole.log('rendering', rows.length, 'rows');\r\n\t\tthis.$el.html(rows.join('\\n'));\r\n\t\t//console.log(this.$el);\r\n\r\n\t\t$('#dateFrom').html(this.model.getDateFrom().toString('yyyy-MM-dd'));\r\n\t\t$('#dateTill').html(this.model.getDateTill().toString('yyyy-MM-dd'));\r\n\t\t$('#numRows').html(this.model.getVisibleCount().toString());\r\n\r\n\t\tthis.$el.on('change', 'select', this.newCategory.bind(this));\r\n\t\tthis.$el.on('mouseup', 'td.note', this.textSelectedEvent.bind(this));\r\n\t\tthis.$el.off('click', 'button.close').on('click', 'button.close', this.deleteRow.bind(this));\r\n\t\tthis.$el.on('click', 'input.checkedDone', this.onCheck.bind(this));\r\n\r\n\t\telapse.timeEnd('ExpenseTable.render');\r\n\t\treturn this;\r\n\t}\r\n\r\n\tgetTransactionAttributesTable() {\r\n\t\tlet visible = this.model.getVisible();\r\n\t\tlet table = new Table();\r\n\t\t_.each(visible, (transaction: Transaction) => {\r\n\t\t\tlet attributes = transaction.toJSON();\r\n\t\t\tattributes.sDate = transaction.getDate().toString('yyyy-MM-dd');\r\n\t\t\tattributes.cssClass = attributes.category == 'Default'\r\n\t\t\t\t? 'bg-warning' : '';\r\n\t\t\tattributes.categoryOptions = this.getCategoryOptions(transaction);\r\n\t\t\tattributes.background = this.categoryList.getColorFor(transaction.get('category'));\r\n\t\t\tattributes.checkedDone = transaction.get('done') ? 'checked' : '';\r\n\t\t\tattributes.amount = attributes.amount.toFixed(2);\r\n\r\n\t\t\ttable.push(attributes);\r\n\t\t});\r\n\t\t// sortBy only works with direct attributes (not Model)\r\n\t\ttable = _.sortBy(table, 'date');\r\n\t\treturn table;\r\n\t}\r\n\r\n\t/**\r\n\t * @deprecated - not working in Chrome\r\n\t * @param event\r\n\t */\r\n\topenSelect(event) {\r\n\t\t//console.log('openSelect', this, event);\r\n\t\tlet $select = $(event.target);\r\n\r\n\t\t//if ($select.find('option').length == 1) {\r\n\t\t{\r\n\t\t\tlet defVal = $select.find('option').html();\r\n\t\t\t$select.find('option').remove();\r\n\t\t\tlet options = this.categoryList.getOptions();\r\n\t\t\t//console.log(options);\r\n\t\t\t$.each(options, (key, value) => {\r\n\t\t\t\tif (value != defVal) {\r\n\t\t\t\t\t$select\r\n\t\t\t\t\t\t.append($(\"<option></option>\")\r\n\t\t\t\t\t\t\t.attr(\"value\", value)\r\n\t\t\t\t\t\t\t.text(value));\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\t$select.on('change', this.newCategory.bind(this));\r\n\t\t}\r\n\t}\r\n\r\n\tgetCategoryOptions(transaction: Transaction) {\r\n\t\tlet selected = transaction.get('category');\r\n\t\tlet sOptions = [];\r\n\t\tlet options = this.categoryList.getOptions();\r\n\t\t// console.log('options', options);\r\n\t\t$.each(options, (key, value) => {\r\n\t\t\tif (value == selected) {\r\n\t\t\t\tsOptions.push('<option selected>' + value + '</option>');\r\n\t\t\t} else {\r\n\t\t\t\tsOptions.push('<option>' + value + '</option>');\r\n\t\t\t}\r\n\t\t});\r\n\t\t// console.log('sOptions', sOptions);\r\n\t\treturn sOptions.join('\\n');\r\n\t}\r\n\r\n\tnewCategory(event) {\r\n\t\tconsole.log('newCategory');\r\n\t\tlet $select = $(event.target);\r\n\t\t//console.log('selected', $select.val());\r\n\t\tlet id = $select.closest('tr').attr('data-id');\r\n\t\t//console.log(id);\r\n\t\tlet transaction = <Transaction>this.model.get(id);\r\n\t\t// console.log(transaction);\r\n\t\tif (transaction) {\r\n\t\t\t// console.log('Transaction id=', id);\r\n\t\t\ttransaction.setCategory($select.val());\r\n\t\t\t// console.log(transaction.toJSON());\r\n\t\t\t//this.categoryList.trigger('change');\r\n\t\t} else {\r\n\t\t\tconsole.error('Transaction with id=', id, 'not found');\r\n\t\t}\r\n\t}\r\n\r\n\ttextSelectedEvent(event: MouseEvent) {\r\n\t\t// console.log('textSelectedEvent');\r\n\t\tlet text = ExpenseTable.getSelectedText().trim();\r\n\t\tif (text) {\r\n\t\t\t//console.log(text);\r\n\t\t\tlet $contextMenu = $('#contextMenu');\r\n\t\t\tif (!$contextMenu.length) {\r\n\t\t\t\tlet template = handlebars.compile($('#categoryMenu').html());\r\n\t\t\t\tlet menuHTML = template({\r\n\t\t\t\t\tcatlist: this.categoryList.getOptions(),\r\n\t\t\t\t});\r\n\t\t\t\t$('body').append(menuHTML);\r\n\t\t\t\t$contextMenu = $('#contextMenu');\t// after append\r\n\t\t\t\tconsole.log($contextMenu, event.clientX, event.clientY);\r\n\t\t\t}\r\n\t\t\tthis.openMenu($contextMenu, event.clientX, event.clientY, this.applyFilter.bind(this, text));\r\n\t\t}\r\n\t}\r\n\r\n\tstatic getSelectedText() {\r\n\t\tif (window.getSelection) {\r\n\t\t\treturn window.getSelection().toString();\r\n\t\t} else if (document.selection) {\r\n\t\t\treturn document.selection.createRange().text;\r\n\t\t}\r\n\t\treturn '';\r\n\t}\r\n\r\n\t/**\r\n\t * Opens a popup menu at the specified position\r\n\t * @param menuSelector\r\n\t * @param clientX\r\n\t * @param clientY\r\n\t * @param callback\r\n\t */\r\n\topenMenu(menuSelector, clientX, clientY, callback) {\r\n\t\tlet $menu = $(menuSelector)\r\n\t\t\t.show()\r\n\t\t\t.css({\r\n\t\t\t\tposition: \"absolute\",\r\n\t\t\t\tleft: this.getMenuPosition(clientX, 'width', 'scrollLeft', menuSelector),\r\n\t\t\t\ttop: this.getMenuPosition(clientY, 'height', 'scrollTop', menuSelector)\r\n\t\t\t})\r\n\t\t\t.off('click')\r\n\t\t\t.on('click', 'a', function (e) {\r\n\t\t\t\tlet $selectedMenu = $(e.target);\r\n\t\t\t\tif ($selectedMenu.length) {\r\n\t\t\t\t\t$menu.hide();\r\n\t\t\t\t\tcallback.call(this, $selectedMenu);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t//console.log($menu);\r\n\r\n\t\t// make sure menu closes on any click\r\n\t\t// since we use onmouseup we can't immediately close the popup\r\n\t\tsetTimeout(function () {\r\n\t\t\t$('body').click(function () {\r\n\t\t\t\t$(menuSelector).hide();\r\n\t\t\t\t$('body').off('click');\t// once\r\n\t\t\t});\r\n\t\t}, 0);\r\n\t}\r\n\r\n\tgetMenuPosition(mouse, direction, scrollDir, menuSelector) {\r\n\t\tlet win = $(window)[direction](),\r\n\t\t\tscroll = $(window)[scrollDir](),\r\n\t\t\tmenu = $(menuSelector)[direction](),\r\n\t\t\tposition = mouse + scroll;\r\n\r\n\t\t// opening menu would pass the side of the page\r\n\t\tif (mouse + menu > win && menu < mouse)\r\n\t\t\tposition -= menu;\r\n\r\n\t\treturn position;\r\n\t}\r\n\r\n\t/**\r\n\t * When clicking on the category item from the popup menu\r\n\t * @param text\r\n\t * @param menu\r\n\t */\r\n\tapplyFilter(text, menu) {\r\n\t\tlet scrollTop = document.body.scrollTop;\r\n\t\tconsole.log('scrollTop', scrollTop);\r\n\r\n\t\tlet categoryName = menu.text().trim();\r\n\t\tconsole.log(text, 'to be', categoryName);\r\n\t\tthis.keywords.add(new Keyword({\r\n\t\t\tword: text,\r\n\t\t\tcategory: categoryName,\r\n\t\t}));\r\n\t\tthis.model.setCategories(this.keywords);\r\n\t\tthis.render();\r\n\r\n\t\tsetTimeout(() => {\r\n\t\t\tconsole.log('Scrolling', scrollTop);\r\n\t\t\t$('body').scrollTop(scrollTop);\r\n\t\t}, 0);\r\n\t}\r\n\r\n\tdeleteRow(event) {\r\n\t\tlet button = $(event.target);\r\n\t\tlet dataID = button.closest('tr').attr('data-id');\r\n\t\tconsole.log('deleteRow', dataID);\r\n\t\tthis.model.remove(dataID);\r\n\t\tthis.model.saveAll();\r\n\t\tthis.render();\r\n\t}\r\n\r\n\tonCheck(event: MouseEvent) {\r\n\t\tlet checkbox = $(event.target);\r\n\t\tlet id = checkbox.closest('tr').attr('data-id');\r\n\t\tlet transaction = this.model.get(id);\r\n\t\t//console.log(checkbox, id, transaction);\r\n\t\tif (transaction) {\r\n\t\t\ttransaction.set('done', true);\r\n\t\t}\r\n\t}\r\n\r\n}\r\n","///<reference path=\"../../typings/index.d.ts\"/>\r\n///<reference path=\"../../node_modules/backbone-typings/backbone.d.ts\"/>\r\n\r\nimport CategoryCollection from \"./CategoryCollection\";\r\nimport CategoryCount from \"./CategoryCount\";\r\nimport Expenses from \"../Expenses/Expenses\";\r\nlet elapse = require('elapse');\r\nelapse.configure({\r\n\tdebug: true\r\n});\r\nconst Backbone = require('backbone');\r\nconst _ = require('underscore');\r\nconst $ = require('jquery');\r\nconst Chart = require('chart.js');\r\nimport {debug} from '../umsaetze';\r\n\r\nexport default class CategoryView extends Backbone.View<CategoryCollection> {\r\n\r\n\tmodel: CategoryCollection;\r\n\r\n\texpenses: Expenses;\r\n\r\n\ttemplate = _.template($('#categoryTemplate').html());\r\n\r\n\tmyPieChart;\r\n\r\n\tconstructor(options) {\r\n\t\tsuper(options);\r\n\t\tthis.setElement($('#categories'));\r\n\t\tthis.listenTo(this.model, 'change', this.render);\r\n\t\tthis.$el.on('click', 'a.filterByCategory', this.filterByCategory.bind(this));\r\n\t\tthis.on(\"all\", debug(\"CategoryView\"));\r\n\t}\r\n\r\n\tsetExpenses(expenses) {\r\n\t\tthis.expenses = expenses;\r\n\t\tthis.listenTo(this.expenses, 'change', this.recalculate);\r\n\t}\r\n\r\n\trecalculate() {\r\n\t\tconsole.warn('CategoryView.recalculate');\r\n\t\tthis.model.getCategoriesFromExpenses();\r\n\t\t// should call render?\r\n\t}\r\n\r\n\trender() {\r\n\t\telapse.time('CategoryView.render');\r\n\t\tlet categoryCount = this.model.toJSON();\r\n\r\n\t\t// remove income from %\r\n\t\tlet incomeRow = _.findWhere(categoryCount, {\r\n\t\t\tcatName: 'Income',\r\n\t\t});\r\n\t\tcategoryCount = _.without(categoryCount, incomeRow);\r\n\r\n\t\tlet sum: number = <number>_.reduce(categoryCount,\r\n\t\t\t(memo, item: CategoryCount) => {\r\n\t\t\t\t// only expenses\r\n\t\t\t\treturn memo + Math.abs(item.amount);\r\n\t\t\t}, 0);\r\n\t\t//console.log('sum', sum);\r\n\r\n\t\tcategoryCount = _.sortBy(categoryCount, (el: CategoryCount) => {\r\n\t\t\treturn Math.abs(el.amount);\r\n\t\t}).reverse();\r\n\r\n\t\tlet content = [];\r\n\t\t_.each(categoryCount, (catCount: CategoryCount) => {\r\n\t\t\tlet width = Math.round(\r\n\t\t\t\t100 * Math.abs(catCount.amount) / Math.abs(sum)\r\n\t\t\t\t) + '%';\r\n\t\t\t//console.log(catCount.catName, width, catCount.count, catCount.amount);\r\n\t\t\tcontent.push(this.template(\r\n\t\t\t\t_.extend(catCount, {\r\n\t\t\t\t\twidth: width,\r\n\t\t\t\t\tamount: Math.round(catCount.amount),\r\n\t\t\t\t\tsign: catCount.amount >= 0 ? 'positive' : 'negative',\r\n\t\t\t\t})\r\n\t\t\t));\r\n\t\t});\r\n\t\tthis.$('#catElements').html(content.join('\\n'));\r\n\t\tif (!incomeRow) {\r\n\t\t\tincomeRow = { amount: 0 };\r\n\t\t}\r\n\t\tthis.$('.income').html(incomeRow.amount.toFixed(2));\r\n\t\tthis.$('.total').html(sum.toFixed(2));\r\n\r\n\t\tthis.showPieChart(Math.abs(sum));\r\n\r\n\t\telapse.timeEnd('CategoryView.render');\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/**\r\n\t * @deprecated\r\n\t * @private\r\n\t */\r\n\t_change() {\r\n\t\tconsole.log('CategoryView changed', this.model.size());\r\n\t\tif (this.model) {\r\n\t\t\t//console.log('Calling CategoryCollection.change()');\r\n\t\t\t//this.model.change();\t// called automagically\r\n\t\t\tthis.render();\r\n\t\t} else {\r\n\t\t\tconsole.error('Not rendering since this.model is undefined');\r\n\t\t}\r\n\t}\r\n\r\n\tshowPieChart(sum) {\r\n\t\tlet labels = [];\r\n\t\tlet colors = [];\r\n\t\tlet dataSet1 = [];\r\n\t\tthis.model.comparator = function (el: CategoryCount) {\r\n\t\t\treturn -Math.abs(el.getAmount());\r\n\t\t};\r\n\t\tthis.model.sort();\r\n\r\n\t\tlet rest = 0;\r\n\t\tthis.model.each((cat: CategoryCount) => {\r\n\t\t\tif (cat.getName() != 'Income') {\r\n\t\t\t\tlet amount = Math.abs(cat.getAmount());\r\n\t\t\t\tlet perCent = 100 * amount / sum;\r\n\t\t\t\tif (perCent > 3) {\r\n\t\t\t\t\tlabels.push(cat.get('catName'));\r\n\t\t\t\t\tdataSet1.push(amount);\r\n\t\t\t\t\tcolors.push(cat.get('color'));\r\n\t\t\t\t} else {\r\n\t\t\t\t\trest += amount;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t\tlabels.push('Rest');\r\n\t\tdataSet1.push(rest.toFixed(2));\r\n\r\n\t\tlet data = {\r\n\t\t\tlabels: labels,\r\n\t\t\tdatasets: [\r\n\t\t\t\t{\r\n\t\t\t\t\tdata: dataSet1,\r\n\t\t\t\t\tbackgroundColor: colors,\r\n\t\t\t\t\thoverBackgroundColor: colors,\r\n\t\t\t\t}\r\n\t\t\t]\r\n\t\t};\r\n\t\tif (this.myPieChart) {\r\n\t\t\tthis.myPieChart.destroy();\r\n\t\t}\r\n\t\tthis.myPieChart = new Chart(document.getElementById('pieChart'), {\r\n\t\t\ttype: 'pie',\r\n\t\t\tdata: data,\r\n\t\t\toptions: {\r\n\t\t\t\tlegend: {\r\n\t\t\t\t\tdisplay: false,\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tfilterByCategory(event: MouseEvent) {\r\n\t\tevent.preventDefault();\r\n\t\tlet link = $(event.target);\r\n\t\tlet id = link.attr('data-id');\r\n\t\tconsole.log('filterByCategory', id);\r\n\t\tlet cat = this.model.get(id);\r\n\t\t//console.log(cat);\r\n\t\t//this.expenses.filterByMonth();\r\n\t\tif (cat) {\r\n\t\t\tthis.expenses.setAllVisible();\r\n\t\t\tthis.expenses.filterByMonth();\r\n\t\t\tthis.expenses.filterByCategory(cat);\r\n\t\t} else {\r\n\t\t\tthis.expenses.setAllVisible();\r\n\t\t\tthis.expenses.filterByMonth();\r\n\t\t}\r\n\t\tthis.expenses.trigger('change');\t// slow!\r\n\t}\r\n\r\n\thide() {\r\n\t\tthis.$el.hide();\r\n\t\t$('#pieChart').hide();\r\n\t}\r\n\r\n\tshow() {\r\n\t\tthis.$el.show();\r\n\t\t$('#pieChart').show();\r\n\t}\r\n\r\n}\r\n","///<reference path=\"../node_modules/backbone-typings/backbone.d.ts\"/>\r\n///<reference path=\"../typings/index.d.ts\"/>\r\n\r\nimport Backbone = require('backbone');\r\nimport Expenses from \"./Expenses/Expenses\";\r\nimport LocalStorage = Backbone.LocalStorage;\r\nimport ExpensesMock from \"../test/helper/ExpensesMock\";\r\nconst $ = require('jquery');\r\nrequire('datejs');\r\nconst _ = require('underscore');\r\nimport {detectFloat} from \"./Util/Number\";\r\nimport {Number} from \"./Util/Number\";\r\n\r\nexport default class MonthSelect extends Backbone.View<any> {\r\n\r\n\t$el = $('#MonthSelect');\r\n\r\n\tyearSelect: JQuery = this.$('select');\r\n\r\n\tmonthOptions: JQuery = this.$('button');\r\n\r\n\tselectedYear = parseInt(this.yearSelect.val()) || new Date().getFullYear();\r\n\r\n\tselectedMonth = 'Feb';\r\n\r\n\tearliest = new Date();\r\n\r\n\tlatest = new Date();\r\n\r\n\t//localStorage: Backbone.LocalStorage;\r\n\r\n\tstatic instance: MonthSelect;\r\n\r\n\tstorageProvider: Storage;\r\n\r\n\t/**\r\n\t * http://stackoverflow.com/questions/1643320/get-month-name-from-date\r\n\t * @type {[string,string,string,string,string,string,string,string,string,string,string,string]}\r\n\t */\r\n\tmonthNames = [\r\n\t\t\"January\", \"February\", \"March\",\r\n\t\t\"April\", \"May\", \"June\",\r\n\t\t\"July\", \"August\", \"September\",\r\n\t\t\"October\", \"November\", \"December\"\r\n\t];\r\n\r\n\tconstructor() {\r\n\t\tsuper();\r\n\r\n\t\tif (!this.storageProvider) {\r\n\t\t\tthis.storageProvider = window.localStorage;\r\n\t\t}\r\n\r\n\t\t// console.log(this.yearSelect);\r\n\t\t// console.log(this.monthOptions);\r\n\r\n\t\t// this is a problem for HistoryView because it switches to page type\r\n\t\t// this.monthOptions.on('click', this.clickOnMonthAndNavigate.bind(this));\r\n\t\tthis.monthOptions.on('click', this.clickOnMonth.bind(this));\r\n\r\n\t\tthis.yearSelect.on('change', this.changeYear.bind(this));\r\n\t\t//this.localStorage = new Backbone.LocalStorage('MonthSelect');\r\n\t\tlet year = this.storageProvider.getItem('MonthSelect.year');\r\n\t\tif (year) {\r\n\t\t\tthis.selectedYear = parseInt(year);\r\n\t\t}\r\n\t\tlet month = this.storageProvider.getItem('MonthSelect.month');\r\n\t\tif (month) {\r\n\t\t\tthis.selectedMonth = month;\r\n\t\t}\r\n\t\t//console.log('MonthSelect', this.selectedYear, this.selectedMonth);\r\n\t}\r\n\r\n\tstatic getInstance() {\r\n\t\tif (!MonthSelect.instance) {\r\n\t\t\tMonthSelect.instance = new MonthSelect();\r\n\t\t}\r\n\t\treturn MonthSelect.instance;\r\n\t}\r\n\r\n\trender() {\r\n\t\t//console.time('MonthSelect.render');\r\n\t\tthis.earliest.moveToFirstDayOfMonth();\r\n\t\tlet selectedDate = this.getSelected();\r\n\r\n\t\t// year\r\n\t\tlet options = [];\r\n\t\tlet minYear = this.earliest.getFullYear();\r\n\t\tlet maxYear = this.latest.getFullYear();\r\n\t\t// console.log('minYear', minYear, 'maxYear', maxYear);\r\n\t\tfor (let y = minYear; y <= maxYear; y++) {\r\n\t\t\tlet selected = selectedDate.getFullYear() == y ? 'selected' : '';\r\n\t\t\toptions.push('<option '+selected+'>'+y+'</option>');\r\n\t\t}\r\n\t\tthis.yearSelect.html(options.join(\"\\n\"));\r\n\r\n\t\t// month\r\n\t\tthis.monthOptions.each((i, button) => {\r\n\t\t\tlet monthNumber = i+1;\r\n\t\t\t//console.log(button);\r\n\t\t\tlet sDate = this.selectedYear+'-'+monthNumber+'-01';\r\n\t\t\tlet firstOfMonth = new Date(sDate);\r\n\t\t\tlet $button = $(button);\r\n\t\t\tlet isAfter = firstOfMonth.isAfter(this.earliest);\r\n\t\t\tlet isBefore = firstOfMonth.isBefore(this.latest);\r\n\t\t\tif (isAfter && isBefore) {\r\n\t\t\t\t$button.removeAttr('disabled');\r\n\t\t\t} else {\r\n\t\t\t\t$button.attr('disabled', 'disabled');\r\n\t\t\t}\r\n\t\t\tlet equals = firstOfMonth.equals(selectedDate);\r\n\t\t\tif (equals) {\r\n\t\t\t\t$button.addClass('btn-success').removeClass('btn-default');\r\n\t\t\t} else {\r\n\t\t\t\t$button.removeClass('btn-success').addClass('btn-default');\r\n\t\t\t}\r\n\t\t\t//console.log(sDate, firstOfMonth, isAfter, isBefore, equals);\r\n\t\t});\r\n\t\t//console.timeEnd('MonthSelect.render');\r\n\t\treturn this;\r\n\t}\r\n\r\n\tshow() {\r\n\t\t//console.log('MonthSelect.show');\r\n\t\tthis.$el.show();\r\n\t\tthis.render();\t// required as data may have changed (all disabled bug)\r\n\t}\r\n\r\n\thide() {\r\n\t\tconsole.error('MonthSelect.hide');\r\n\t\tthis.$el.hide();\r\n\t}\r\n\r\n\tgetMonthIndex() {\r\n\t\tlet result = Date.getMonthNumberFromName(this.selectedMonth) + 1;\r\n\t\t//console.log('getMonthIndex', this.selectedMonth, '=>', result);\r\n\t\treturn result;\r\n\t}\r\n\r\n\tgetMonthIndexFor(monthName: string) {\r\n\t\tlet result = Date.getMonthNumberFromName(monthName) + 1;\r\n\t\t//console.log('getMonthIndex', monthName, result);\r\n\t\treturn result;\r\n\t}\r\n\r\n\tgetMonthNameFor(index) {\r\n\t\treturn this.getShortMonthNameFor(index);\r\n\t}\r\n\r\n\tchangeYear(event) {\r\n\t\t// this.selectedYear = this.yearSelect.val();\t// don't set yet - URL will do\r\n\t\tBackbone.history.navigate('#/' + this.yearSelect.val() + '/' + this.getMonthIndex());\r\n\t}\r\n\r\n\tclickOnMonthAndNavigate(event) {\r\n\t\tthis.monthOptions.removeClass('btn-success').addClass('btn-default');\r\n\t\tlet $button = $(event.target);\r\n\t\t$button.removeClass('btn-default');\r\n\t\t$button.addClass('btn-success');\r\n\t\t//this.selectedMonth = $button.text();\t// don't set yet - URL will do\r\n\t\tlet monthIndex = this.getMonthIndexFor($button.text());\r\n\t\tBackbone.history.navigate('#/' + this.selectedYear + '/' + monthIndex);\r\n\t}\r\n\r\n\tclickOnMonth(event) {\r\n\t\tthis.monthOptions.removeClass('btn-success').addClass('btn-default');\r\n\t\tlet $button = $(event.target);\r\n\t\t$button.removeClass('btn-default');\r\n\t\t$button.addClass('btn-success');\r\n\t\tthis.selectedMonth = $button.text();\r\n\t\tthis.storageProvider.setItem('MonthSelect.month', this.selectedMonth);\r\n\r\n\t\tthis.trigger('MonthSelect:change');\r\n\t}\r\n\r\n\tsetYear(year) {\r\n\t\t// if (this.selectedYear == year) return;\r\n\t\tconsole.log('setYear', year);\r\n\t\tthis.selectedYear = year;\r\n\t\t//console.log(this.selectedYear);\r\n\t\tthis.storageProvider.setItem('MonthSelect.year', this.selectedYear+'');\r\n\t\tthis.render();\t\t// repaint months as available or not\r\n\t\tthis.trigger('MonthSelect:change');\r\n\t}\r\n\r\n\tsetMonth(month: number) {\r\n\t\tlet monthName = this.getMonthNameFor(month);\r\n\t\t// if (this.selectedMonth == monthName) {\r\n\t\t// \tconsole.warn('same month', this.selectedMonth, monthName);\r\n\t\t// \treturn;\r\n\t\t// }\r\n\t\tconsole.log('setMonth', month);\r\n\t\tthis.selectedMonth = monthName;\r\n\t\tthis.storageProvider.setItem('MonthSelect.month', this.selectedMonth);\r\n\t\tthis.trigger('MonthSelect:change');\r\n\t}\r\n\r\n\tsetYearMonth(year: number, month: number) {\r\n\t\tconsole.log('setYearMonth', year, month);\r\n\r\n\t\tthis.selectedYear = year;\r\n\t\t//console.log(this.selectedYear);\r\n\t\tthis.storageProvider.setItem('MonthSelect.year', this.selectedYear);\r\n\r\n\t\tlet monthName = this.getMonthNameFor(month);\r\n\t\tthis.selectedMonth = monthName;\r\n\t\tthis.storageProvider.setItem('MonthSelect.month', this.selectedMonth);\r\n\r\n\t\tthis.render();\t\t// repaint months as available or not\r\n\t\tthis.trigger('MonthSelect:change');\r\n\t}\r\n\r\n\ttrigger(what) {\r\n\t\tconsole.warn(what);\r\n\t\tsuper.trigger(what);\r\n\t}\r\n\r\n\t/**\r\n\t * @public\r\n\t * @returns Date\r\n\t */\r\n\tgetSelected() {\r\n\t\tlet sSelectedDate = this.selectedYear+'-'+this.getMonthIndex()+'-01';\r\n\t\tlet selectedDate = new Date(sSelectedDate);\r\n\t\t//console.log('selectedDate', sSelectedDate, selectedDate);\r\n\t\treturn selectedDate;\r\n\t}\r\n\r\n\t/**\r\n\t * @deprecated\r\n\t * @returns {string|string|string|string|string|string|string|string|string|string|string|string}\r\n\t */\r\n\tgetMonthName() {\r\n\t\tthrow new Error('getMonthName called when selectedMonth is a string already');\r\n\t\treturn this.monthNames[this.selectedMonth];\r\n\t}\r\n\r\n\t/**\r\n\t * @deprecated\r\n\t * @returns {string}\r\n\t */\r\n\tgetShortMonthName() {\r\n\t\treturn this.getMonthName().substr(0, 3);\r\n\t}\r\n\r\n\tgetShortMonthNameFor(index) {\r\n\t\treturn this.monthNames[index-1].substr(0, 3);\r\n\t}\r\n\r\n\tupdate(collection: Expenses|ExpensesMock) {\r\n\t\tthis.earliest = collection.getEarliest();\r\n\t\tthis.latest = collection.getLatest();\r\n\t\t// console.log('MonthSelect.update',\r\n\t\t// \tthis.earliest.toString('yyyy-MM-dd'),\r\n\t\t// \tthis.latest.toString('yyyy-MM-dd'));\r\n\r\n\t\tthis.selectedYear = this.selectedYear.clamp(\r\n\t\t\tthis.earliest.getFullYear(),\r\n\t\t\tthis.latest.getFullYear()\r\n\t\t);\r\n\t\tlet selectedMonthIndex = this.getMonthIndex().clamp(\r\n\t\t\tthis.earliest.getMonth(),\r\n\t\t\tthis.latest.getMonth()\r\n\t\t);\r\n\t\tthis.selectedMonth = this.getShortMonthNameFor(selectedMonthIndex);\r\n\r\n\t\tthis.show();\r\n\t}\r\n\r\n}\r\n\r\n","const Backbone = require('backbone');\r\nconsole.log(Backbone);\r\nimport Expenses from \"./Expenses/Expenses\";\r\nimport CollectionArray from \"./Keyword/CollectionArray\";\r\nimport EventsHash = Backbone.EventsHash;\r\nconst _ = require('underscore');\r\n\r\nexport class CollectionController<T extends Expenses|CollectionArray> implements Backbone.Events {\r\n\r\n\t// Regular expression used to split event strings.\r\n\teventSplitter = /\\s+/;\r\n\r\n\t_listenId = _.uniqueId('l');\r\n\r\n\t_listeningTo = {};\r\n\r\n\t_events = {};\r\n\r\n\t_listeners = {};\r\n\r\n\t// Iterates over the standard `event, callback` (as well as the fancy multiple\r\n\t// space-separated events `\"change blur\", callback` and jQuery-style event\r\n\t// maps `{event: callback}`).\r\n\teventsApi(iteratee, events, name, callback, opts) {\r\n\t\tlet i = 0, names;\r\n\t\tif (name && typeof name === 'object') {\r\n\t\t\t// Handle event maps.\r\n\t\t\tif (callback !== void 0 && 'context' in opts && opts.context === void 0) opts.context = callback;\r\n\t\t\tfor (names = _.keys(name); i < names.length ; i++) {\r\n\t\t\t\tevents = this.eventsApi(iteratee, events, names[i], name[names[i]], opts);\r\n\t\t\t}\r\n\t\t} else if (name && this.eventSplitter.test(name)) {\r\n\t\t\t// Handle space-separated event names by delegating them individually.\r\n\t\t\tfor (names = name.split(this.eventSplitter); i < names.length; i++) {\r\n\t\t\t\tevents = iteratee(events, names[i], callback, opts);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\t// Finally, standard events.\r\n\t\t\tevents = iteratee(events, name, callback, opts);\r\n\t\t}\r\n\t\treturn events;\r\n\t}\r\n\r\n\ton(eventName: string, callback?: Function, context?: any): any;\r\n\ton(eventMap: EventsHash): any;\r\n\r\n\t// Bind an event to a `callback` function. Passing `\"all\"` will bind\r\n\t// the callback to all events fired.\r\n\ton(name: string | EventsHash, callback?: Function, context?: any) {\r\n\t\treturn this.internalOn(this, name, callback, context, null);\r\n\t}\r\n\r\n\t// Guard the `listening` argument from the public API.\r\n\tinternalOn(obj, name, callback, context, listening) {\r\n\t\tobj._events = this.eventsApi(this.onApi, obj._events || {}, name, callback, {\r\n\t\t\tcontext: context,\r\n\t\t\tctx: obj,\r\n\t\t\tlistening: listening\r\n\t\t});\r\n\r\n\t\tif (listening) {\r\n\t\t\tlet listeners = obj._listeners || (obj._listeners = {});\r\n\t\t\tlisteners[listening.id] = listening;\r\n\t\t}\r\n\r\n\t\treturn obj;\r\n\t}\r\n\r\n\t// Inversion-of-control versions of `on`. Tell *this* object to listen to\r\n\t// an event in another object... keeping track of what it's listening to\r\n\t// for easier unbinding later.\r\n\tlistenTo(obj, name, callback?) {\r\n\t\tif (!obj) return this;\r\n\t\tconst id = obj._listenId || (obj._listenId = _.uniqueId('l'));\r\n\t\tconst listeningTo = this._listeningTo || (this._listeningTo = {});\r\n\t\tlet listening = listeningTo[id];\r\n\r\n\t\t// This object is not listening to any other events on `obj` yet.\r\n\t\t// Setup the necessary references to track the listening callbacks.\r\n\t\tif (!listening) {\r\n\t\t\tconst thisId = this._listenId || (this._listenId = _.uniqueId('l'));\r\n\t\t\tlistening = listeningTo[id] = {obj: obj, objId: id, id: thisId, listeningTo: listeningTo, count: 0};\r\n\t\t}\r\n\r\n\t\t// Bind callbacks on obj, and keep track of them on listening.\r\n\t\tthis.internalOn(obj, name, callback, this, listening);\r\n\t\treturn this;\r\n\t}\r\n\r\n\t// The reducing API that adds a callback to the `events` object.\r\n\tonApi(events, name, callback, options) {\r\n\t\tif (callback) {\r\n\t\t\tvar handlers = events[name] || (events[name] = []);\r\n\t\t\tvar context = options.context, ctx = options.ctx, listening = options.listening;\r\n\t\t\tif (listening) listening.count++;\r\n\r\n\t\t\thandlers.push({callback: callback, context: context, ctx: context || ctx, listening: listening});\r\n\t\t}\r\n\t\treturn events;\r\n\t}\r\n\r\n\t// Remove one or many callbacks. If `context` is null, removes all\r\n\t// callbacks with that function. If `callback` is null, removes all\r\n\t// callbacks for the event. If `name` is null, removes all bound\r\n\t// callbacks for all events.\r\n\toff(name, callback, context) {\r\n\t\tif (!this._events) return this;\r\n\t\tthis._events = this.eventsApi(this.offApi, this._events, name, callback, {\r\n\t\t\tcontext: context,\r\n\t\t\tlisteners: this._listeners\r\n\t\t});\r\n\t\treturn this;\r\n\t}\r\n\r\n\t// Tell this object to stop listening to either specific events ... or\r\n\t// to every object it's currently listening to.\r\n\tstopListening(obj, name, callback) {\r\n\t\tconst listeningTo = this._listeningTo;\r\n\t\tif (!listeningTo) return this;\r\n\r\n\t\tlet ids = obj ? [obj._listenId] : _.keys(listeningTo);\r\n\r\n\t\tfor (let i = 0; i < ids.length; i++) {\r\n\t\t\tlet listening = listeningTo[ids[i]];\r\n\r\n\t\t\t// If listening doesn't exist, this object is not currently\r\n\t\t\t// listening to obj. Break out early.\r\n\t\t\tif (!listening) break;\r\n\r\n\t\t\tlistening.obj.off(name, callback, this);\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\t// The reducing API that removes a callback from the `events` object.\r\n\toffApi(events, name, callback, options) {\r\n\t\tif (!events) return;\r\n\r\n\t\tlet i = 0, listening;\r\n\t\tlet context = options.context, listeners = options.listeners;\r\n\r\n\t\t// Delete all events listeners and \"drop\" events.\r\n\t\tif (!name && !callback && !context) {\r\n\t\t\tlet ids = _.keys(listeners);\r\n\t\t\tfor (; i < ids.length; i++) {\r\n\t\t\t\tlistening = listeners[ids[i]];\r\n\t\t\t\tdelete listeners[listening.id];\r\n\t\t\t\tdelete listening.listeningTo[listening.objId];\r\n\t\t\t}\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tlet names = name ? [name] : _.keys(events);\r\n\t\tfor (; i < names.length; i++) {\r\n\t\t\tname = names[i];\r\n\t\t\tlet handlers = events[name];\r\n\r\n\t\t\t// Bail out if there are no events stored.\r\n\t\t\tif (!handlers) break;\r\n\r\n\t\t\t// Replace events if there are any remaining.  Otherwise, clean up.\r\n\t\t\tlet remaining = [];\r\n\t\t\tfor (let j = 0; j < handlers.length; j++) {\r\n\t\t\t\tlet handler = handlers[j];\r\n\t\t\t\tif (\r\n\t\t\t\t\tcallback && callback !== handler.callback &&\r\n\t\t\t\t\tcallback !== handler.callback._callback ||\r\n\t\t\t\t\tcontext && context !== handler.context\r\n\t\t\t\t) {\r\n\t\t\t\t\tremaining.push(handler);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tlistening = handler.listening;\r\n\t\t\t\t\tif (listening && --listening.count === 0) {\r\n\t\t\t\t\t\tdelete listeners[listening.id];\r\n\t\t\t\t\t\tdelete listening.listeningTo[listening.objId];\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Update tail event if the list has any events.  Otherwise, clean up.\r\n\t\t\tif (remaining.length) {\r\n\t\t\t\tevents[name] = remaining;\r\n\t\t\t} else {\r\n\t\t\t\tdelete events[name];\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn events;\r\n\t}\r\n\r\n\t// Bind an event to only be triggered a single time. After the first time\r\n\t// the callback is invoked, its listener will be removed. If multiple events\r\n\t// are passed in using the space-separated syntax, the handler will fire\r\n\t// once for each event, not once for a combination of all events.\r\n\tonce(name, callback, context) {\r\n\t\t// Map the event into a `{event: once}` object.\r\n\t\tlet events = this.eventsApi(this.onceMap, {}, name, callback, _.bind(this.off, this));\r\n\t\tif (typeof name === 'string' && context == null) callback = void 0;\r\n\t\treturn this.on(events, callback, context);\r\n\t}\r\n\r\n\t// Inversion-of-control versions of `once`.\r\n\tlistenToOnce(obj, name, callback) {\r\n\t\t// Map the event into a `{event: once}` object.\r\n\t\tlet events = this.eventsApi(this.onceMap, {}, name, callback, _.bind(this.stopListening, this, obj));\r\n\t\treturn this.listenTo(obj, events);\r\n\t}\r\n\r\n\t// Reduces the event callbacks into a map of `{event: onceWrapper}`.\r\n\t// `offer` unbinds the `onceWrapper` after it has been called.\r\n\tonceMap(map, name, callback, offer) {\r\n\t\tif (callback) {\r\n\t\t\tconst once = map[name] = _.once(function() {\r\n\t\t\t\toffer(name, once);\r\n\t\t\t\tcallback.apply(this, arguments);\r\n\t\t\t});\r\n\t\t\t//once._callback = callback;\r\n\t\t}\r\n\t\treturn map;\r\n\t}\r\n\r\n\t// Trigger one or many events, firing all bound callbacks. Callbacks are\r\n\t// passed the same arguments as `trigger` is, apart from the event name\r\n\t// (unless you're listening on `\"all\"`, which will cause your callback to\r\n\t// receive the true name of the event as the first argument).\r\n\ttrigger(name) {\r\n\t\tif (!this._events) return this;\r\n\r\n\t\tvar length = Math.max(0, arguments.length - 1);\r\n\t\tvar args = Array(length);\r\n\t\tfor (var i = 0; i < length; i++) args[i] = arguments[i + 1];\r\n\r\n\t\tthis.eventsApi(this.triggerApi, this._events, name, void 0, args);\r\n\t\treturn this;\r\n\t}\r\n\r\n\t// Handles triggering the appropriate event callbacks.\r\n\ttriggerApi(objEvents, name, callback, args) {\r\n\t\tif (objEvents) {\r\n\t\t\tvar events = objEvents[name];\r\n\t\t\tvar allEvents = objEvents.all;\r\n\t\t\tif (events && allEvents) allEvents = allEvents.slice();\r\n\t\t\tif (events) this.triggerEvents(events, args);\r\n\t\t\tif (allEvents) this.triggerEvents(allEvents, [name].concat(args));\r\n\t\t}\r\n\t\treturn objEvents;\r\n\t}\r\n\r\n\t// A difficult-to-believe, but optimized internal dispatch function for\r\n\t// triggering events. Tries to keep the usual cases speedy (most internal\r\n\t// Backbone events have 3 arguments).\r\n\ttriggerEvents(events, args) {\r\n\t\tvar ev, i = -1, l = events.length, a1 = args[0], a2 = args[1], a3 = args[2];\r\n\t\tswitch (args.length) {\r\n\t\t\tcase 0: while (++i < l) (ev = events[i]).callback.call(ev.ctx); return;\r\n\t\t\tcase 1: while (++i < l) (ev = events[i]).callback.call(ev.ctx, a1); return;\r\n\t\t\tcase 2: while (++i < l) (ev = events[i]).callback.call(ev.ctx, a1, a2); return;\r\n\t\t\tcase 3: while (++i < l) (ev = events[i]).callback.call(ev.ctx, a1, a2, a3); return;\r\n\t\t\tdefault: while (++i < l) (ev = events[i]).callback.apply(ev.ctx, args); return;\r\n\t\t}\r\n\t}\r\n\r\n\tbind(name: string | EventsHash, callback?: Function, context?: any) {\r\n\t\tconsole.error('bind is deprecated');\r\n\t\t// if ((typeof name) == 'string') {\r\n\t\t// \tthis.on(name, callback, context);\r\n\t\t// } else {\r\n\t\t// \tthis.on(name);\r\n\t\t// }\r\n\t}\r\n\r\n\tunbind(name, callback, context) {\r\n\t\tthis.off(name, callback, context);\r\n\t}\r\n\r\n\r\n\tcid;\r\n\tid: string;\r\n\tclassName: string;\r\n\tel: any;\r\n\t$el: JQuery;\r\n\tdelegateEventSplitter = /^(\\S+)\\s*(.*)$/;\r\n\tviewOptions = ['model', 'collection', 'el', 'id', 'attributes', 'className', 'tagName', 'events'];\r\n\tcollection: Expenses;\r\n\r\n\tconstructor(options?) {\r\n\t\t// applyMixins(this, [Events]);\r\n\t\t//su per(); // it has no constructor\r\n\t\tthis.cid = _.uniqueId('view');\r\n\t\t_.extend(this, _.pick(options, this.viewOptions));\r\n\t\tthis._ensureElement();\r\n\t}\r\n\r\n\t$(selector: string) {\r\n\t\treturn $(selector);\r\n\t}\r\n\r\n\t_ensureElement() {\r\n\t\tif (!this.el) {\r\n\t\t\tconst attrs = _.extend({}, _.result(this, 'attributes'));\r\n\t\t\tif (this.id) attrs.id = _.result(this, 'id');\r\n\t\t\tif (this.className) attrs['class'] = _.result(this, 'className');\r\n\t\t\tthis.setElement(this._createElement(_.result(this, 'tagName')));\r\n\t\t\tthis._setAttributes(attrs);\r\n\t\t} else {\r\n\t\t\tthis.setElement(_.result(this, 'el'));\r\n\t\t}\r\n\t}\r\n\r\n\t_createElement(tagName) {\r\n\t\treturn document.createElement(tagName);\r\n\t}\r\n\r\n\t_setAttributes(attributes) {\r\n\t\tthis.$el.attr(attributes);\r\n\t}\r\n\r\n\tsetElement(element) {\r\n\t\tthis.undelegateEvents();\r\n\t\tthis._setElement(element);\r\n\t\tthis.delegateEvents();\r\n\t\treturn this;\r\n\t}\r\n\r\n\t// Creates the `this.el` and `this.$el` references for this view using the\r\n\t// given `el`. `el` can be a CSS selector or an HTML string, a jQuery\r\n\t// context or an element. Subclasses can override this to utilize an\r\n\t// alternative DOM manipulation API and are only required to set the\r\n\t// `this.el` property.\r\n\t_setElement(el) {\r\n\t\tthis.$el = el instanceof Backbone.$ ? el : Backbone.$(el);\r\n\t\tthis.el = this.$el[0];\r\n\t}\r\n\r\n\tundelegateEvents() {\r\n\t\tif (this.$el) this.$el.off('.delegateEvents' + this.cid);\r\n\t\treturn this;\r\n\t}\r\n\r\n\tdelegateEvents(events?) {\r\n\t\tevents || (events = _.result(this, 'events'));\r\n\t\tif (!events) return this;\r\n\t\tthis.undelegateEvents();\r\n\t\tfor (let key in events) {\r\n\t\t\tlet method = events[key];\r\n\t\t\tif (!_.isFunction(method)) method = this[method];\r\n\t\t\tif (!method) continue;\r\n\t\t\tconst match = key.match(this.delegateEventSplitter);\r\n\t\t\tthis.delegate(match[1], match[2], _.bind(method, this));\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n\r\n\tdelegate(eventName, selector, listener) {\r\n\t\tthis.$el.on(eventName + '.delegateEvents' + this.cid, selector, listener);\r\n\t\treturn this;\r\n\t}\r\n\r\n\thide() {\r\n\t\tthis.$el.hide();\r\n\t}\r\n\r\n}\r\n\r\nfunction applyMixins(derivedCtor: any, baseCtors: any[]) {\r\n\tbaseCtors.forEach(baseCtor => {\r\n\t\tObject.getOwnPropertyNames(baseCtor.prototype).forEach(name => {\r\n\t\t\tderivedCtor.prototype[name] = baseCtor.prototype[name];\r\n\t\t});\r\n\t});\r\n}\r\n\r\n// applyMixins(CollectionController, [Events]);\r\n","import Expenses from \"./Expenses/Expenses\";\r\nimport ExpenseTable from \"./Expenses/ExpenseTable\";\r\nimport CategoryCollection from \"./Category/CategoryCollection\";\r\nimport CategoryView from \"./Category/CategoryView\";\r\nimport MonthSelect from \"./MonthSelect\";\r\nimport Transaction from \"./Expenses/Transaction\";\r\nimport {debug} from \"./umsaetze\";\r\nimport {CollectionController} from \"./CollectionController\";\r\nimport {ViewOptionsExpenses} from \"./ViewOptionsExpenses\";\r\n// import Backbone from 'backbone';\r\nlet elapse = require('elapse');\r\nelapse.configure({\r\n\tdebug: true\r\n});\r\nconst $ = require('jquery');\r\nconst _ = require('underscore');\r\n\r\nexport default class AppView extends CollectionController<Expenses> {\r\n\r\n\tmodel: typeof Transaction;\r\n\r\n\tcollection: Expenses;\r\n\r\n\ttable: ExpenseTable;\r\n\r\n\tcategoryList: CategoryCollection;\r\n\r\n\tcategories: CategoryView;\r\n\r\n\tms: MonthSelect;\r\n\r\n\tq: string = '';\r\n\r\n\t/**\r\n\t * Make sure to provide collection: Expenses in options\r\n\t * and this.categoryList as well\r\n\t * @param options\r\n\t * @param categoryList\r\n\t */\r\n\tconstructor(options: ViewOptionsExpenses<Transaction>, categoryList: CategoryCollection) {\r\n\t\tsuper(options);\r\n\t\tconsole.log('construct AppView');\r\n\t\tthis.collection = options.collection;\r\n\t\tthis.setElement($('#app'));\r\n\t\tthis.setTemplate();\r\n\r\n\t\tthis.categoryList = categoryList;\r\n\r\n\t\tthis.table = new ExpenseTable({\r\n\t\t\tmodel: this.collection,\r\n\t\t\tel: $('#expenseTable')\r\n\t\t});\r\n\t\tthis.table.setCategoryList(this.categoryList);\r\n\r\n\t\tthis.categories = new CategoryView({\r\n\t\t\tmodel: this.categoryList,\r\n\t\t});\r\n\t\tthis.categories.setExpenses(this.collection);\r\n\t\t//console.log('category view collection', this.categories.model);\r\n\r\n\t\tthis.ms = MonthSelect.getInstance();\r\n\t\tthis.ms.earliest = this.collection.getEarliest();\r\n\t\tthis.ms.latest = this.collection.getLatest();\r\n\t\tthis.ms.render();\r\n\t\tthis.listenTo(this.ms, 'MonthSelect:change', this.monthChange.bind(this));\r\n\r\n\t\tthis.collection.selectedMonth = this.ms.getSelected();\t// for filtering to know which month we're in\r\n\r\n\t\tthis.listenTo(this.collection, \"change\", this.render);\r\n\t\t//this.listenTo(this.collection, \"change\", this.table.render);\r\n\t\t//this.listenTo(this.collection, \"change\", this.categories.change); // wrong collection inside ? wft?!\r\n\t\t$('.custom-search-form input').on('keyup',\r\n\t\t\t_.debounce(this.onSearch.bind(this), 300));\r\n\t\tthis.on(\"all\", debug(\"AppView\"));\r\n\t}\r\n\r\n\trender() {\r\n\t\t//if (!['', '#'].includes(window.location.hash)) return;\r\n\t\tconsole.log('AppView.render()', this.collection.size());\r\n\t\tthis.setTemplate();\r\n\r\n\t\t// should not be done as any outside filter stop working\r\n\t\t// this.collection.setAllVisible();\r\n\t\t// this.collection.filterByMonth();\r\n\r\n\t\tthis.table.render();\r\n\t\tthis.categories.render();\r\n\t\tthis.$('#applyKeywords').on('click', this.applyKeywords.bind(this));\r\n\t\t// let popover = $('[data-toggle=\"popover\"]').popover();\r\n\t\t// console.log(popover);\r\n\t\treturn this;\r\n\t}\r\n\r\n\tsetTemplate() {\r\n\t\t// if no table in DOM, reset it\r\n\t\tif (!this.$('#expenseTable').length) {\r\n\t\t\tlet template = _.template($('#AppView').html());\r\n\t\t\tthis.$el.html(template());\r\n\r\n\t\t\t// not created by constructor yet (already yes in render())\r\n\t\t\tif (this.table) {\r\n\t\t\t\tthis.table.$el = $('#expenseTable');\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tmonthChange() {\r\n\t\telapse.time('AppView.monthChange');\r\n\t\tthis.collection.setAllVisible();\t\t\t\t\t\t// silent\r\n\t\tthis.collection.filterByMonth(this.ms.getSelected());\t// silent\r\n\t\tthis.collection.filterVisible(this.q);\t\t\t\t\t// silent\r\n\t\t//this.render();\t// will be called by getCategoriesFromExpenses()\r\n\r\n\t\t// not needed due to the line in the constructor\r\n\t\t// @see this.categoryList.setExpenses()\r\n\t\t// wrong. this is called by this.render()\r\n\r\n\t\tthis.categoryList.getCategoriesFromExpenses();\r\n\t\telapse.timeEnd('AppView.monthChange');\r\n\t}\r\n\r\n\tonSearch(event) {\r\n\t\tthis.q = $(event.target).val();\r\n\t\tconsole.log('Searching: ', this.q);\r\n\t\tthis.monthChange();\t// reuse\r\n\t\t// trigger manually since filterVisible is silent\r\n\t\t//this.collection.trigger('change');\r\n\t}\r\n\r\n\tshow() {\r\n\t\telapse.time('AppView.show');\r\n\r\n\t\tthis.ms.earliest = this.collection.getEarliest();\r\n\t\tthis.ms.latest = this.collection.getLatest();\r\n\t\tconsole.log('MonthSelect range',\r\n\t\t\tthis.ms.earliest.toString('yyyy-MM-dd'),\r\n\t\t\tthis.ms.latest.toString('yyyy-MM-dd'), this.collection.size());\r\n\t\tthis.ms.show();\r\n\r\n\t\tthis.render();\r\n\t\tthis.categories.show();\r\n\t\telapse.timeEnd('AppView.show');\r\n\t}\r\n\r\n\thide() {\r\n\t\telapse.time('AppView.hide');\r\n\t\t//this.ms.hide();\t// this may be needed for History\r\n\t\tif (this.$('#expenseTable').length\r\n\t\t\t&& this.$('#expenseTable').is(':visible')) {\r\n\t\t}\r\n\t\tthis.categories.hide();\r\n\t\telapse.timeEnd('AppView.hide');\r\n\t}\r\n\r\n\tapplyKeywords(event: MouseEvent) {\r\n\t\tevent.preventDefault();\r\n\t\tconsole.log('applyKeywords');\r\n\t\tthis.table.model.setCategories(this.table.keywords);\r\n\t}\r\n\r\n}\r\n","const Backbone = require('backbone');\r\nlet md5 = require('md5');\r\nlet bb = require('backbone');\r\n\r\n/*\r\n {\"account\":\"SpardaSlawa\",\r\n \"category\":\"Einkauf\",\r\n \"currency\":\"EUR\",\r\n \"amount\":-23.99,\r\n \"payment_type\":\"DEBIT_CARD\",\r\n \"date\": \"\",\r\n \"note\": \"\",\r\n \"id\": \"\",\r\n \"visible\": false,\r\n \"sign\": \"\"\r\n */\r\n\r\nexport default class Transaction extends Backbone.Model {\r\n\r\n\tdate: Date;\r\n\tcategory: String;\r\n\tamount: Number;\r\n\tnote: String;\r\n\r\n\tconstructor(attributes: Object, options?: Object) {\r\n\t\tsuper(attributes, options);\r\n\t\tthis.defaults = <any>{\r\n\t\t\tvisible: true,\r\n\t\t};\r\n\r\n\t\tlet dDate;\r\n\t\tlet sDate = this.get('date');\r\n\t\tif (sDate instanceof Date) {\t// convert back\r\n\t\t\tdDate = sDate.clone();\r\n\t\t\tsDate = dDate.toString('d.M.yyyy');\r\n\t\t} else {\r\n\t\t\tdDate = new Date(sDate);\t// to parse from JSON\r\n\t\t\tlet dDateValid = !isNaN( dDate.getTime() );\r\n\t\t\tif (!dDate || !dDateValid) {\r\n\t\t\t\tdDate = Date.parseExact(sDate, \"d.M.yyyy\");\r\n\t\t\t}\r\n\t\t\tthis.set('date', dDate);\r\n\t\t}\r\n\t\t//console.log(sDate, dDate);\r\n\r\n\t\t// this prevents duplicates\r\n\t\tif (!this.get('id')) {\r\n\t\t\tthis.set('id', md5(sDate + this.get('amount')));\r\n\t\t}\r\n\t\t// number\r\n\t\tthis.set('amount', parseFloat(this.get('amount')));\r\n\t\tif (!this.has('visible')) {\r\n\t\t\tthis.set('visible', true);\r\n\t\t}\r\n\r\n\t\t// make sure it's defined\r\n\t\tthis.set('category', this.get('category') || 'Default');\r\n\r\n\t\t// should be set\r\n\t\tthis.set('note', this.get('note'));\r\n\r\n\t\tthis.set('done', this.get('done'));\r\n\t}\r\n\r\n\tsign() {\r\n\t\treturn this.get('amount') >= 0 ? 'positive' : 'negative';\r\n\t}\r\n\r\n\ttoJSON() {\r\n\t\tlet json = super.toJSON();\r\n\t\tjson.sign = this.sign();\r\n\t\tjson.id = this.id;\r\n\t\treturn json;\r\n\t}\r\n\r\n\tsetCategory(category) {\r\n\t\tthis.set('category', category);\r\n\t\tthis.collection.localStorage.update(this);\r\n\t}\r\n\r\n\t/**\r\n\t * This will return Date object any time\r\n\t */\r\n\tgetDate() {\r\n\t\tlet date = this.get('date');\r\n\t\tif (!(date instanceof Date)) {\r\n\t\t\tdate = new Date(date);\r\n\t\t}\r\n\t\treturn date;\r\n\t}\r\n\r\n\tisVisible() {\r\n\t\treturn this.get('visible');\r\n\t}\r\n\r\n\tgetAmount() {\r\n\t\treturn this.get('amount');\r\n\t}\r\n\r\n}\r\n","/// <reference path=\"../../typings/index.d.ts\" />\r\n\r\n// import {start} from \"repl\";\r\nimport {detectFloat} from '../Util/Number';\r\nconst Papa = require('papaparse');\r\nimport Table from './Table';\r\nimport Row from './Row';\r\nrequire('datejs');\r\n\r\n/**\r\n * http://stackoverflow.com/questions/3115982/how-to-check-if-two-arrays-are-equal-with-javascript\r\n * @param array\r\n * @returns {boolean}\r\n */\r\n/*Array.prototype.equals = function( array ) {\r\n\treturn this.length == array.length &&\r\n\t\tthis.every( function(this_i,i) { return this_i == array[i] } )\r\n};\r\n*/\r\n\r\nexport default class ParseCSV {\r\n\r\n\tdata: string;\r\n\r\n\tconstructor(data?: string) {\r\n\t\tthis.data = data;\r\n\t}\r\n\r\n\tparseAndNormalize() {\r\n\t\tlet csv;\r\n\t\tif (typeof document == \"this code is commented\") {\r\n\t\t\tlet csvObj = Papa.parse(this.data, {\r\n\t\t\t\theader: true,\r\n\t\t\t\tdynamicTyping: true,\r\n\t\t\t\tskipEmptyLines: true,\r\n\t\t\t\tcomments: \"#\",\r\n\t\t\t});\r\n\t\t\tcsv = csvObj.data;\r\n\t\t} else {\r\n\t\t\tcsv = Table.fromText(this.data);\r\n\t\t}\r\n\t\tthis.data = null;\t// save RAM\r\n\t\tconsole.log('rows after parse', csv.length);\r\n\t\tcsv = csv.trim();\r\n\t\t// csv = csv.trimAll(); // prevents analyzeCSV from working\r\n\t\tconsole.log('rows after trim', csv.length);\r\n\t\tcsv = this.analyzeCSV(csv);\r\n\t\tconsole.log('rows after analyze', csv.length);\r\n\t\tcsv = this.normalizeCSV(csv);\r\n\t\tconsole.log('rows after normalize', csv.length);\r\n\t\tcsv = this.convertDataTypes(csv);\r\n\t\tconsole.log('rows after convertDataTypes', csv.length);\r\n\t\treturn csv;\r\n\t}\r\n\r\n\t/**\r\n\t * Some CSV files contain random data in the header\r\n\t * @public for tests\r\n\t */\r\n\tpublic analyzeCSV(data: Table) {\r\n\t\t// console.log('last row', data[data.length-1]);\r\n\t\tlet startIndex = 0;\r\n\t\tdata.forEach((row, i) => {\r\n\t\t\tif (!row.length || (row.length == 1 && row[0] == '')) {\r\n\t\t\t\tstartIndex = i+1;\r\n\t\t\t}\r\n\t\t});\r\n\t\tconsole.log('slicing ', startIndex, 'first rows');\r\n\t\tlet sliced = data.slice(startIndex);\r\n\t\treturn new Table(sliced);\r\n\t}\r\n\r\n\t/**\r\n\t * We got pure data with headers here\r\n\t */\r\n\tprivate normalizeCSV(data: Table) {\r\n\t\t//console.log(data);\r\n\t\tlet typeSet = data.getRowTypesForSomeRows();\r\n\t\ttypeSet = typeSet.filterMostlyNull();\r\n\t\t// console.log(typeSet, 'typeSet');\r\n\t\tlet aCommon = typeSet.mode();\r\n\t\tlet common = new Row(aCommon);\r\n\t\tconsole.log(JSON.stringify(common), 'common');\r\n\t\tdata = common.filterByCommon(data);\r\n\t\tconsole.log('rows after filterByCommon', data.length);\r\n\r\n\t\tlet dataWithHeader = new Table();\r\n\t\tdata.forEach((row, i) => {\r\n\t\t\tlet header = common.getHeaderFromTypes(row, i);\r\n\t\t\tif (i == 0) {\r\n\t\t\t\tRow.peek(row, common);\r\n\t\t\t\tconsole.log(JSON.stringify(header), 'header');\r\n\t\t\t}\r\n\t\t\tdataWithHeader.push(header);\r\n\t\t});\r\n\r\n\t\t//console.log(dataWithHeader[0], 'dataWithHeader line 0');\r\n\t\treturn dataWithHeader;\r\n\t}\r\n\r\n\t/**\r\n\t * http://stackoverflow.com/questions/1117916/merge-keys-array-and-values-array-into-an-object-in-javascript\r\n\t * @param names\r\n\t * @param values\r\n\t * @returns Row\r\n\t */\r\n\tzip(names: Array<string>, values: Array<any>) {\r\n\t\tlet result = new Row();\r\n\t\tfor (let i = 0; i < names.length; i++) {\r\n\t\t\tresult[names[i]] = values[i];\r\n\t\t}\r\n\t\treturn result;\r\n\t}\r\n\r\n\tprivate convertDataTypes(csv: Table) {\r\n\t\tcsv.forEach((row, i) => {\r\n\t\t\tif (row.amount) {\r\n\t\t\t\trow.amount = detectFloat(row.amount);\r\n\r\n\t\t\t\tlet date = Date.parseExact(row.date, 'dd.MM.yyyy');\r\n\t\t\t\tif (!date) {\r\n\t\t\t\t\tdate = Date.parseExact(row.date, 'dd.MM.yy');\r\n\t\t\t\t\tif (!date) {\r\n\t\t\t\t\t\tconsole.warn('Date parse error', row.date, date);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (date) {\r\n\t\t\t\t\trow.date = date;\r\n\t\t\t\t}\r\n\r\n\t\t\t} else {\r\n\t\t\t\t//console.warn('convertDataTypes', row);\r\n\t\t\t\tdelete csv[i];\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn csv;\r\n\t}\r\n}\r\n","import Expenses from \"../Expenses/Expenses\";\r\nimport Transaction from \"../Expenses/Transaction\";\r\nimport {asyncLoop, debug} from \"../umsaetze\";\r\nimport PersistenceOptions = Backbone.PersistenceOptions;\r\nimport Workspace from \"../Workspace\";\r\nimport ParseCSV from './ParseCSV';\r\nimport Table from \"./Table\";\r\nimport MonthSelect from '../MonthSelect';\r\nimport {detectFloat} from '../Util/Number';\r\nimport {CollectionController} from '../CollectionController';\r\n\r\nconsole.log(detectFloat('3.141528'));\r\nconsole.debug(detectFloat('3.141528'));\r\n//debug(detectFloat('3.141528'));\r\n\r\nrequire('file-saver');\r\ndeclare function saveAs(a: any, b: any);\r\n\r\nlet elapse = require('elapse');\r\nelapse.configure({\r\n\tdebug: true\r\n});\r\nconst toastr = require('toastr');\r\nconst chance = require('chance').Chance();\r\nconst Backbone = require('backbone');\r\nrequire('backbone.localstorage');\r\nconst $ = require('jquery');\r\nconst _ = require('underscore');\r\n\r\nexport default class Sync extends CollectionController<Expenses> {\r\n\r\n\t$el = $('#app');\r\n\r\n\ttemplate;\r\n\r\n\tmodel: Expenses;\r\n\r\n\tslowUpdateLoadingBar: Function;\r\n\r\n\tlocalStorage = new Backbone.LocalStorage(\"Expenses\");\r\n\r\n\tprevPercent: number;\r\n\r\n\trouter: Workspace;\r\n\r\n\tconstructor(expenses: Expenses) {\r\n\t\tsuper();\r\n\t\tthis.model = expenses;\r\n\t\tthis.listenTo(this.model, 'change', this.render);\r\n\t\tthis.slowUpdateLoadingBar = _.throttle(this.updateLoadingBar, 128);\r\n\r\n\t\tlet $SyncPage = $('#SyncPage');\r\n\t\t$SyncPage.load($SyncPage.attr('src'), (html) => {\r\n\t\t\tthis.template = _.template(html);\r\n\t\t\tthis.render();\r\n\t\t});\r\n\t}\r\n\r\n\trender() {\r\n\t\tif (this.template) {\r\n\t\t\tthis.$el.html(this.template({\r\n\t\t\t\tmemoryRows: this.model.size(),\r\n\t\t\t\tlsRows: this.localStorage.findAll().length,\r\n\t\t\t}));\r\n\t\t\tthis.$('#Refresh').on('click', this.refresh.bind(this));\r\n\t\t\tthis.$('#Generate').on('click', this.generate.bind(this));\r\n\r\n\t\t\t//this.$('#Load').on('click', this.load.bind(this));\r\n\t\t\tFileReaderJS.setupInput(document.getElementById('file-input-csv'), {\r\n\t\t\t\treadAsDefault: 'Text',\r\n\t\t\t\ton: {\r\n\t\t\t\t\tload: this.load.bind(this),\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\t// this.$('#LoadJSON').on('click', this.loadJSON.bind(this));\r\n\t\t\tFileReaderJS.setupInput(document.getElementById('file-input-json'), {\r\n\t\t\t\treadAsDefault: 'Text',\r\n\t\t\t\ton: {\r\n\t\t\t\t\tload: this.loadJSON.bind(this),\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tthis.$('#Save').on('click', this.save.bind(this));\r\n\t\t\tthis.$('#Clear').on('click', this.clear.bind(this));\r\n\t\t\tthis.$('#saveToLS').on('click', this.saveToLS.bind(this));\r\n\t\t} else {\r\n\t\t\tthis.$el.html('Loading ...');\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n\r\n\trefresh() {\r\n\t\ttoastr.success('Refreshing...');\r\n\t\tthis.render();\r\n\t}\r\n\r\n\tload(e, file) {\r\n\t\tconsole.log(e, file);\r\n\t\t//console.log(e.target.result);\r\n\t\tthis.loadSelectedFile(e.target.result);\r\n\t}\r\n\r\n\tloadSelectedFile(data: string) {\r\n\t\tthis.startLoading();\r\n\r\n\t\tlet parser = new ParseCSV(data);\r\n\t\tlet csv = parser.parseAndNormalize();\r\n\r\n\t\treturn this.fetchCSV(csv, {\r\n\t\t\tsuccess: () => {\r\n\t\t\t\telapse.time('Expense.saveModels2LS');\r\n\t\t\t\tconsole.log('models loaded, saving to LS');\r\n\t\t\t\tthis.model.each((model: Transaction) => {\r\n\t\t\t\t\tthis.localStorage.create(model);\r\n\t\t\t\t});\r\n\t\t\t\telapse.timeEnd('Expense.saveModels2LS');\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tfetchCSV(csv: Table, options: PersistenceOptions) {\r\n\t\tlet processWithoutVisualFeedback = false;\r\n\t\tif (processWithoutVisualFeedback) {\r\n\t\t\t_.each(csv, this.processRow.bind(this));\r\n\t\t\tthis.processDone(csv.length, options);\r\n\t\t} else {\r\n\t\t\tasyncLoop(csv,\r\n\t\t\t\tthis.processRow.bind(this),\r\n\t\t\t\tthis.processDone.bind(this, csv.length, options));\r\n\t\t}\r\n\t}\r\n\r\n\tstartLoading() {\r\n\t\tconsole.log('startLoading');\r\n\t\tthis.prevPercent = 0;\r\n\t\tlet template = _.template($('#loadingBarTemplate').html());\r\n\t\tthis.$('.panel-footer').html(template());\r\n\t}\r\n\r\n\tprocessRow(row: any, i: number, length: number) {\r\n\t\tthis.slowUpdateLoadingBar(i, length);\r\n\t\tif (row && row.amount) {\r\n\t\t\tthis.model.add(new Transaction(row), { silent: true });\r\n\t\t}\r\n\t}\r\n\r\n\tupdateLoadingBar(i: number, length: number) {\r\n\t\tlet percent = Math.round(100 * i / length);\r\n\t\t//console.log('updateLoadingBar', i, percent);\r\n\t\tif (percent != this.prevPercent) {\r\n\t\t\t//console.log(percent);\r\n\t\t\t$('.progress#loadingBar .progress-bar').width(percent + '%');\r\n\t\t\tthis.prevPercent = percent;\r\n\t\t}\r\n\t}\r\n\r\n\tprocessDone(count, options?: PersistenceOptions) {\r\n\t\tconsole.log('asyncLoop finished', count, options);\r\n\t\tif (options && options.success) {\r\n\t\t\toptions.success();\r\n\t\t}\r\n\r\n\t\t// this makes all months visible at once\r\n\t\t// this.model.setAllVisible();\r\n\r\n\t\tconsole.log('Trigger change on Expenses');\r\n\t\tthis.model.trigger('change');\r\n\r\n\t\tlet ms = MonthSelect.getInstance();\r\n\t\tms.update(this.model);\r\n\r\n\t\tBackbone.history.navigate('#', {\r\n\t\t\ttrigger: true,\r\n\t\t});\r\n\t}\r\n\r\n\tloadJSON(e, file) {\r\n\t\t// console.log('loadJSON', e);\r\n\t\t// console.log(file);\r\n\t\t// console.log(e.target.result);\r\n\t\ttry {\r\n\t\t\tlet data = JSON.parse(e.target.result);\r\n\t\t\ttoastr.info('Importing '+data.length+' entries');\r\n\t\t\t_.each(data, (row) => {\r\n\t\t\t\tthis.model.add(new Transaction(row));\r\n\t\t\t});\r\n\t\t\ttoastr.success('Imported');\r\n\t\t\tthis.model.trigger('change');\r\n\t\t\tBackbone.history.navigate('#', {\r\n\t\t\t\ttrigger: true,\r\n\t\t\t});\r\n\t\t} catch (e) {\r\n\t\t\talert(e);\r\n\t\t}\r\n\t}\r\n\r\n\tsave() {\r\n\t\tlet data = this.model.localStorage.findAll();\r\n\t\t//console.log(data);\r\n\t\tlet json = JSON.stringify(data, null, '\\t');\r\n\t\tlet blob = new Blob([json], {\r\n\t\t\ttype: \"application/json;charset=utf-8\"\r\n\t\t});\r\n\t\tlet filename = \"umsaetze-\"+Date.today().toString('yyyy-MM-dd')+'.json';\r\n\t\t//console.log(filename);\r\n\t\tsaveAs(blob, filename);\r\n\t}\r\n\r\n\tclear() {\r\n\t\tconsole.log('clear');\r\n\t\tif (confirm('Delete *ALL* entries from Local Storage? Make sure you have exported data first.')) {\r\n\t\t\tlet localStorage = new Backbone.LocalStorage(\"Expenses\");\r\n\t\t\tlocalStorage._clear();\r\n\t\t\tif (this.model) {\r\n\t\t\t\tthis.model.clear();\r\n\t\t\t}\r\n\t\t\tthis.render();\r\n\t\t}\r\n\t}\r\n\r\n\tgenerate() {\r\n\t\ttoastr.info('Generating...');\r\n\t\tlet amount = 100;\r\n\t\tlet account = chance.word();\r\n\t\tlet categories = this.router.categoryList;\r\n\t\tfor (let i of _.range(amount)) {\r\n\t\t\tlet category = categories.random();\r\n\t\t\tthis.model.add(new Transaction({\r\n\t\t\t\taccount: account,\r\n\t\t\t\tcategory: category.get('catName') || \"Default\",\r\n\t\t\t\tcurrency: \"EUR\",\r\n\t\t\t\tamount: chance.floating({fixed: 2, min: -1000, max: 1000}),\r\n\t\t\t\tpayment_type: \"DEBIT_CARD\",\r\n\t\t\t\tdate: chance.date({year: new Date().getFullYear()}),\r\n\t\t\t\tnote: chance.sentence(),\r\n\t\t\t}));\r\n\t\t}\r\n\t\ttoastr.success('Generated '+amount+' records.');\r\n\t\tthis.model.trigger('change');\r\n\t\tBackbone.history.navigate('#', {\r\n\t\t\ttrigger: true,\r\n\t\t});\r\n\t}\r\n\r\n\tsaveToLS() {\r\n\t\ttoastr.success('Saving...');\r\n\t\tthis.model.saveAll();\r\n\t\tthis.render();\r\n\t}\r\n\r\n\t/**\r\n\t * Required by Workspace\r\n\t */\r\n\thide() {\r\n\r\n\t}\r\n\r\n}\r\n","export default class FakeJQueryXHR implements JQueryXHR {\r\n\t[Symbol.toStringTag];\r\n\tonreadystatechange: (ev: Event) => any;\r\n\treadyState: number;\r\n\tresponse: any;\r\n\tresponseText: string;\r\n\tresponseType: XMLHttpRequestResponseType;\r\n\tresponseURL: string;\r\n\tresponseXML: Document | any;\r\n\tstatus: number;\r\n\tstatusText: string;\r\n\ttimeout: number;\r\n\tupload: XMLHttpRequestUpload;\r\n\twithCredentials: boolean;\r\n\tDONE: number;\r\n\tHEADERS_RECEIVED: number;\r\n\tLOADING: number;\r\n\tOPENED: number;\r\n\tUNSENT: number;\r\n\tonabort: (ev: Event) => any;\r\n\tonerror: (ev: ErrorEvent) => any;\r\n\tonload: (ev: Event) => any;\r\n\tonloadend: (ev: ProgressEvent) => any;\r\n\tonloadstart: (ev: Event) => any;\r\n\tonprogress: (ev: ProgressEvent) => any;\r\n\tontimeout: (ev: ProgressEvent) => any;\r\n\r\n\tstate();\r\n\tstate(): string;\r\n\tstate() {\r\n\t\treturn undefined;\r\n\t}\r\n\r\n\tstatusCode(map: JQuery.Ajax.StatusCodeCallbacks<any>): void {\r\n\t}\r\n\r\n\talways(alwaysCallback: JQuery.TypeOrArray<JQuery.Deferred.CallbackBase<JQuery.jqXHR<TResolve> | TResolve, JQuery.Ajax.ErrorTextStatus | JQuery.Ajax.SuccessTextStatus, string | JQuery.jqXHR<TResolve>, never | never>>, ...alwaysCallbacks: Array<JQuery.TypeOrArray<JQuery.Deferred.CallbackBase<JQuery.jqXHR<TResolve> | TResolve, JQuery.Ajax.ErrorTextStatus | JQuery.Ajax.SuccessTextStatus, string | JQuery.jqXHR<TResolve>, never | never>>>): this;\r\n\talways(alwaysCallback1?: JQueryPromiseCallback<any> | JQueryPromiseCallback<any>[], ...alwaysCallbacksN: Array<JQueryPromiseCallback<any> | JQueryPromiseCallback<any>[]>): JQueryPromise<any>;\r\n\talways(alwaysCallback?, ...alwaysCallbacks): any {\r\n\t}\r\n\r\n\tdone(doneCallback: JQuery.TypeOrArray<JQuery.Deferred.CallbackBase<TResolve, JQuery.Ajax.SuccessTextStatus, JQuery.jqXHR<TResolve>, never>>, ...doneCallbacks: Array<JQuery.TypeOrArray<JQuery.Deferred.CallbackBase<TResolve, JQuery.Ajax.SuccessTextStatus, JQuery.jqXHR<TResolve>, never>>>): this;\r\n\tdone(doneCallback1?: JQueryPromiseCallback<any> | JQueryPromiseCallback<any>[], ...doneCallbackN: Array<JQueryPromiseCallback<any> | JQueryPromiseCallback<any>[]>): JQueryPromise<any>;\r\n\tdone(doneCallback?, ...doneCallbacks): any {\r\n\t}\r\n\r\n\tfail(failCallback: JQuery.TypeOrArray<JQuery.Deferred.CallbackBase<JQuery.jqXHR<TResolve>, JQuery.Ajax.ErrorTextStatus, string, never>>, ...failCallbacks: Array<JQuery.TypeOrArray<JQuery.Deferred.CallbackBase<JQuery.jqXHR<TResolve>, JQuery.Ajax.ErrorTextStatus, string, never>>>): this;\r\n\tfail(failCallback1?: JQueryPromiseCallback<any> | JQueryPromiseCallback<any>[], ...failCallbacksN: Array<JQueryPromiseCallback<any> | JQueryPromiseCallback<any>[]>): JQueryPromise<any>;\r\n\tfail(failCallback?, ...failCallbacks): any {\r\n\t}\r\n\r\n\tprogress(progressCallback: JQuery.TypeOrArray<JQuery.Deferred.CallbackBase<never, never, never, never>>, ...progressCallbacks: Array<JQuery.TypeOrArray<JQuery.Deferred.CallbackBase<never, never, never, never>>>): this;\r\n\tprogress(progressCallback1?: JQueryPromiseCallback<any> | JQueryPromiseCallback<any>[], ...progressCallbackN: Array<JQueryPromiseCallback<any> | JQueryPromiseCallback<any>[]>): JQueryPromise<any>;\r\n\tprogress(progressCallback?, ...progressCallbacks): any {\r\n\t}\r\n\r\n\tpromise<TTarget extends Object>(target: TTarget): this & TTarget;\r\n\tpromise(): this;\r\n\tpromise(target?: any): JQueryPromise<any>;\r\n\tpromise(target?): any {\r\n\t}\r\n\r\n\tpipe<ARD, AJD, AND, BRD, BJD, BND, CRD, CJD, CND, RRD, RJD, RND, ARF, AJF, ANF, BRF, BJF, BNF, CRF, CJF, CNF, RRF, RJF, RNF, ARP, AJP, ANP, BRP, BJP, BNP, CRP, CJP, CNP, RRP, RJP, RNP>(doneFilter: (t: TResolve, u: JQuery.Ajax.SuccessTextStatus, v: JQuery.jqXHR<TResolve>, ...s: never[]) => (JQuery.PromiseBase<ARD, AJD, AND, BRD, BJD, BND, CRD, CJD, CND, RRD, RJD, RND> | JQuery.Thenable<ARD> | ARD), failFilter: (t: JQuery.jqXHR<TResolve>, u: JQuery.Ajax.ErrorTextStatus, v: string, ...s: never[]) => (JQuery.PromiseBase<ARF, AJF, ANF, BRF, BJF, BNF, CRF, CJF, CNF, RRF, RJF, RNF> | JQuery.Thenable<AJF> | AJF), progressFilter: (t: never, u: never, v: never, ...s: never[]) => (JQuery.PromiseBase<ARP, AJP, ANP, BRP, BJP, BNP, CRP, CJP, CNP, RRP, RJP, RNP> | JQuery.Thenable<ANP> | ANP)): JQuery.PromiseBase<ARD | ARF | ARP, AJD | AJF | AJP, AND | ANF | ANP, BRD | BRF | BRP, BJD | BJF | BJP, BND | BNF | BNP, CRD | CRF | CRP, CJD | CJF | CJP, CND | CNF | CNP, RRD | RRF | RRP, RJD | RJF | RJP, RND | RNF | RNP>;\r\n\tpipe<ARF, AJF, ANF, BRF, BJF, BNF, CRF, CJF, CNF, RRF, RJF, RNF, ARP, AJP, ANP, BRP, BJP, BNP, CRP, CJP, CNP, RRP, RJP, RNP>(doneFilter: any, failFilter: (t: JQuery.jqXHR<TResolve>, u: JQuery.Ajax.ErrorTextStatus, v: string, ...s: never[]) => (JQuery.PromiseBase<ARF, AJF, ANF, BRF, BJF, BNF, CRF, CJF, CNF, RRF, RJF, RNF> | JQuery.Thenable<AJF> | AJF), progressFilter: (t: never, u: never, v: never, ...s: never[]) => (JQuery.PromiseBase<ARP, AJP, ANP, BRP, BJP, BNP, CRP, CJP, CNP, RRP, RJP, RNP> | JQuery.Thenable<ANP> | ANP)): JQuery.PromiseBase<ARP | ARF, AJP | AJF, ANP | ANF, BRP | BRF, BJP | BJF, BNP | BNF, CRP | CRF, CJP | CJF, CNP | CNF, RRP | RRF, RJP | RJF, RNP | RNF>;\r\n\tpipe<ARD, AJD, AND, BRD, BJD, BND, CRD, CJD, CND, RRD, RJD, RND, ARP, AJP, ANP, BRP, BJP, BNP, CRP, CJP, CNP, RRP, RJP, RNP>(doneFilter: (t: TResolve, u: JQuery.Ajax.SuccessTextStatus, v: JQuery.jqXHR<TResolve>, ...s: never[]) => (JQuery.PromiseBase<ARD, AJD, AND, BRD, BJD, BND, CRD, CJD, CND, RRD, RJD, RND> | JQuery.Thenable<ARD> | ARD), failFilter: any, progressFilter: (t: never, u: never, v: never, ...s: never[]) => (JQuery.PromiseBase<ARP, AJP, ANP, BRP, BJP, BNP, CRP, CJP, CNP, RRP, RJP, RNP> | JQuery.Thenable<ANP> | ANP)): JQuery.PromiseBase<ARP | ARD, AJP | AJD, ANP | AND, BRP | BRD, BJP | BJD, BNP | BND, CRP | CRD, CJP | CJD, CNP | CND, RRP | RRD, RJP | RJD, RNP | RND>;\r\n\tpipe<ARP, AJP, ANP, BRP, BJP, BNP, CRP, CJP, CNP, RRP, RJP, RNP>(doneFilter: any, failFilter: any, progressFilter?: (t: never, u: never, v: never, ...s: never[]) => (JQuery.PromiseBase<ARP, AJP, ANP, BRP, BJP, BNP, CRP, CJP, CNP, RRP, RJP, RNP> | JQuery.Thenable<ANP> | ANP)): JQuery.PromiseBase<ARP, AJP, ANP, BRP, BJP, BNP, CRP, CJP, CNP, RRP, RJP, RNP>;\r\n\tpipe<ARD, AJD, AND, BRD, BJD, BND, CRD, CJD, CND, RRD, RJD, RND, ARF, AJF, ANF, BRF, BJF, BNF, CRF, CJF, CNF, RRF, RJF, RNF>(doneFilter: (t: TResolve, u: JQuery.Ajax.SuccessTextStatus, v: JQuery.jqXHR<TResolve>, ...s: never[]) => (JQuery.PromiseBase<ARD, AJD, AND, BRD, BJD, BND, CRD, CJD, CND, RRD, RJD, RND> | JQuery.Thenable<ARD> | ARD), failFilter: (t: JQuery.jqXHR<TResolve>, u: JQuery.Ajax.ErrorTextStatus, v: string, ...s: never[]) => (JQuery.PromiseBase<ARF, AJF, ANF, BRF, BJF, BNF, CRF, CJF, CNF, RRF, RJF, RNF> | JQuery.Thenable<AJF> | AJF), progressFilter?: any): JQuery.PromiseBase<ARF | ARD, AJF | AJD, ANF | AND, BRF | BRD, BJF | BJD, BNF | BND, CRF | CRD, CJF | CJD, CNF | CND, RRF | RRD, RJF | RJD, RNF | RND>;\r\n\tpipe<ARF, AJF, ANF, BRF, BJF, BNF, CRF, CJF, CNF, RRF, RJF, RNF>(doneFilter: any, failFilter: (t: JQuery.jqXHR<TResolve>, u: JQuery.Ajax.ErrorTextStatus, v: string, ...s: never[]) => (JQuery.PromiseBase<ARF, AJF, ANF, BRF, BJF, BNF, CRF, CJF, CNF, RRF, RJF, RNF> | JQuery.Thenable<AJF> | AJF), progressFilter?: any): JQuery.PromiseBase<ARF, AJF, ANF, BRF, BJF, BNF, CRF, CJF, CNF, RRF, RJF, RNF>;\r\n\tpipe<ARD, AJD, AND, BRD, BJD, BND, CRD, CJD, CND, RRD, RJD, RND>(doneFilter: (t: TResolve, u: JQuery.Ajax.SuccessTextStatus, v: JQuery.jqXHR<TResolve>, ...s: never[]) => (JQuery.PromiseBase<ARD, AJD, AND, BRD, BJD, BND, CRD, CJD, CND, RRD, RJD, RND> | JQuery.Thenable<ARD> | ARD), failFilter?: any, progressFilter?: any): JQuery.PromiseBase<ARD, AJD, AND, BRD, BJD, BND, CRD, CJD, CND, RRD, RJD, RND>;\r\n\tpipe(doneFilter?: (x: any) => any, failFilter?: (x: any) => any, progressFilter?: (x: any) => any): JQueryPromise<any>;\r\n\tpipe(doneFilter?, failFilter?, progressFilter?): any {\r\n\t}\r\n\r\n\tthen<ARD, AJD, AND, BRD, BJD, BND, CRD, CJD, CND, RRD, RJD, RND, ARF, AJF, ANF, BRF, BJF, BNF, CRF, CJF, CNF, RRF, RJF, RNF, ARP, AJP, ANP, BRP, BJP, BNP, CRP, CJP, CNP, RRP, RJP, RNP>(doneFilter: (t: TResolve, u: JQuery.Ajax.SuccessTextStatus, v: JQuery.jqXHR<TResolve>, ...s: never[]) => (JQuery.PromiseBase<ARD, AJD, AND, BRD, BJD, BND, CRD, CJD, CND, RRD, RJD, RND> | JQuery.Thenable<ARD> | ARD), failFilter: (t: JQuery.jqXHR<TResolve>, u: JQuery.Ajax.ErrorTextStatus, v: string, ...s: never[]) => (JQuery.PromiseBase<ARF, AJF, ANF, BRF, BJF, BNF, CRF, CJF, CNF, RRF, RJF, RNF> | JQuery.Thenable<ARF> | ARF), progressFilter: (t: never, u: never, v: never, ...s: never[]) => (JQuery.PromiseBase<ARP, AJP, ANP, BRP, BJP, BNP, CRP, CJP, CNP, RRP, RJP, RNP> | JQuery.Thenable<ANP> | ANP)): JQuery.PromiseBase<ARD | ARF | ARP, AJD | AJF | AJP, AND | ANF | ANP, BRD | BRF | BRP, BJD | BJF | BJP, BND | BNF | BNP, CRD | CRF | CRP, CJD | CJF | CJP, CND | CNF | CNP, RRD | RRF | RRP, RJD | RJF | RJP, RND | RNF | RNP>;\r\n\tthen<ARF, AJF, ANF, BRF, BJF, BNF, CRF, CJF, CNF, RRF, RJF, RNF, ARP, AJP, ANP, BRP, BJP, BNP, CRP, CJP, CNP, RRP, RJP, RNP>(doneFilter: any, failFilter: (t: JQuery.jqXHR<TResolve>, u: JQuery.Ajax.ErrorTextStatus, v: string, ...s: never[]) => (JQuery.PromiseBase<ARF, AJF, ANF, BRF, BJF, BNF, CRF, CJF, CNF, RRF, RJF, RNF> | JQuery.Thenable<ARF> | ARF), progressFilter: (t: never, u: never, v: never, ...s: never[]) => (JQuery.PromiseBase<ARP, AJP, ANP, BRP, BJP, BNP, CRP, CJP, CNP, RRP, RJP, RNP> | JQuery.Thenable<ANP> | ANP)): JQuery.PromiseBase<ARP | ARF, AJP | AJF, ANP | ANF, BRP | BRF, BJP | BJF, BNP | BNF, CRP | CRF, CJP | CJF, CNP | CNF, RRP | RRF, RJP | RJF, RNP | RNF>;\r\n\tthen<ARD, AJD, AND, BRD, BJD, BND, CRD, CJD, CND, RRD, RJD, RND, ARP, AJP, ANP, BRP, BJP, BNP, CRP, CJP, CNP, RRP, RJP, RNP>(doneFilter: (t: TResolve, u: JQuery.Ajax.SuccessTextStatus, v: JQuery.jqXHR<TResolve>, ...s: never[]) => (JQuery.PromiseBase<ARD, AJD, AND, BRD, BJD, BND, CRD, CJD, CND, RRD, RJD, RND> | JQuery.Thenable<ARD> | ARD), failFilter: any, progressFilter: (t: never, u: never, v: never, ...s: never[]) => (JQuery.PromiseBase<ARP, AJP, ANP, BRP, BJP, BNP, CRP, CJP, CNP, RRP, RJP, RNP> | JQuery.Thenable<ANP> | ANP)): JQuery.PromiseBase<ARP | ARD, AJP | AJD, ANP | AND, BRP | BRD, BJP | BJD, BNP | BND, CRP | CRD, CJP | CJD, CNP | CND, RRP | RRD, RJP | RJD, RNP | RND>;\r\n\tthen<ARP, AJP, ANP, BRP, BJP, BNP, CRP, CJP, CNP, RRP, RJP, RNP>(doneFilter: any, failFilter: any, progressFilter?: (t: never, u: never, v: never, ...s: never[]) => (JQuery.PromiseBase<ARP, AJP, ANP, BRP, BJP, BNP, CRP, CJP, CNP, RRP, RJP, RNP> | JQuery.Thenable<ANP> | ANP)): JQuery.PromiseBase<ARP, AJP, ANP, BRP, BJP, BNP, CRP, CJP, CNP, RRP, RJP, RNP>;\r\n\tthen<ARD, AJD, AND, BRD, BJD, BND, CRD, CJD, CND, RRD, RJD, RND, ARF, AJF, ANF, BRF, BJF, BNF, CRF, CJF, CNF, RRF, RJF, RNF>(doneFilter: (t: TResolve, u: JQuery.Ajax.SuccessTextStatus, v: JQuery.jqXHR<TResolve>, ...s: never[]) => (JQuery.PromiseBase<ARD, AJD, AND, BRD, BJD, BND, CRD, CJD, CND, RRD, RJD, RND> | JQuery.Thenable<ARD> | ARD), failFilter: (t: JQuery.jqXHR<TResolve>, u: JQuery.Ajax.ErrorTextStatus, v: string, ...s: never[]) => (JQuery.PromiseBase<ARF, AJF, ANF, BRF, BJF, BNF, CRF, CJF, CNF, RRF, RJF, RNF> | JQuery.Thenable<ARF> | ARF), progressFilter?: any): JQuery.PromiseBase<ARF | ARD, AJF | AJD, ANF | AND, BRF | BRD, BJF | BJD, BNF | BND, CRF | CRD, CJF | CJD, CNF | CND, RRF | RRD, RJF | RJD, RNF | RND>;\r\n\tthen<ARF, AJF, ANF, BRF, BJF, BNF, CRF, CJF, CNF, RRF, RJF, RNF>(doneFilter: any, failFilter: (t: JQuery.jqXHR<TResolve>, u: JQuery.Ajax.ErrorTextStatus, v: string, ...s: never[]) => (JQuery.PromiseBase<ARF, AJF, ANF, BRF, BJF, BNF, CRF, CJF, CNF, RRF, RJF, RNF> | JQuery.Thenable<ARF> | ARF), progressFilter?: any): JQuery.PromiseBase<ARF, AJF, ANF, BRF, BJF, BNF, CRF, CJF, CNF, RRF, RJF, RNF>;\r\n\tthen<ARD, AJD, AND, BRD, BJD, BND, CRD, CJD, CND, RRD, RJD, RND>(doneFilter: (t: TResolve, u: JQuery.Ajax.SuccessTextStatus, v: JQuery.jqXHR<TResolve>, ...s: never[]) => (JQuery.PromiseBase<ARD, AJD, AND, BRD, BJD, BND, CRD, CJD, CND, RRD, RJD, RND> | JQuery.Thenable<ARD> | ARD), failFilter?: any, progressFilter?: any): JQuery.PromiseBase<ARD, AJD, AND, BRD, BJD, BND, CRD, CJD, CND, RRD, RJD, RND>;\r\n\tthen<TResult1, TResult2>(onfulfilled?: ((value: T) => (PromiseLike<TResult1> | TResult1)) | any | any, onrejected?: ((reason: any) => (PromiseLike<TResult2> | TResult2)) | any | any): Promise<TResult2 | TResult1>;\r\n\tthen<TResult1, TResult2>(onfulfilled?: ((value: TResolve) => (PromiseLike<TResult1> | TResult1)) | any | any, onrejected?: ((reason: any) => (PromiseLike<TResult2> | TResult2)) | any | any): PromiseLike<TResult2 | TResult1>;\r\n\tthen<R>(doneCallback: (data: any, textStatus: string, jqXHR: JQueryXHR) => R, failCallback?: (jqXHR: JQueryXHR, textStatus: string, errorThrown: any) => void): JQueryPromise<R>;\r\n\tthen<U>(doneFilter: (value?: any, ...values: any[]) => (JQueryPromise<U> | U), failFilter?: (...reasons: any[]) => any, progressFilter?: (...progression: any[]) => any): JQueryPromise<U>;\r\n\tthen(doneFilter: (value?: any, ...values: any[]) => void, failFilter?: (...reasons: any[]) => any, progressFilter?: (...progression: any[]) => any): JQueryPromise<void>;\r\n\tthen(doneFilter?, failFilter?, progressFilter?): any {\r\n\t}\r\n\r\n\tcatch<ARF, AJF, ANF, BRF, BJF, BNF, CRF, CJF, CNF, RRF, RJF, RNF>(failFilter?: ((t: JQuery.jqXHR<TResolve>, u: JQuery.Ajax.ErrorTextStatus, v: string, ...s: never[]) => (JQuery.PromiseBase<ARF, AJF, ANF, BRF, BJF, BNF, CRF, CJF, CNF, RRF, RJF, RNF> | JQuery.Thenable<ARF> | ARF)) | any | any): JQuery.PromiseBase<ARF, AJF, ANF, BRF, BJF, BNF, CRF, CJF, CNF, RRF, RJF, RNF>;\r\n\tcatch<TResult>(onrejected?: ((reason: any) => (PromiseLike<TResult> | TResult)) | any | any): Promise<TResult | T>;\r\n\tcatch(failFilter?): any {\r\n\t}\r\n\r\n\toverrideMimeType(mimeType: string): any;\r\n\toverrideMimeType(mime: string): void;\r\n\toverrideMimeType(mimeType: string): any {\r\n\t\treturn undefined;\r\n\t}\r\n\r\n\tabort(statusText?: string): void;\r\n\tabort(): void;\r\n\tabort(statusText?: string): void {\r\n\t}\r\n\r\n\terror(xhr: JQueryXHR, textStatus: string, errorThrown: string): void {\r\n\t}\r\n\r\n\tgetAllResponseHeaders(): string {\r\n\t\treturn undefined;\r\n\t}\r\n\r\n\tgetResponseHeader(header: string): string | any {\r\n\t\treturn undefined;\r\n\t}\r\n\r\n\tmsCachingEnabled(): boolean {\r\n\t\treturn undefined;\r\n\t}\r\n\r\n\topen(method: string, url: string, async?: boolean, user?: string, password?: string): void {\r\n\t}\r\n\r\n\tsend(data?: Document): void;\r\n\tsend(data?: string): void;\r\n\tsend(data?: any): void;\r\n\tsend(data?): void {\r\n\t}\r\n\r\n\tsetRequestHeader(header: string, value: string): void {\r\n\t}\r\n\r\n\taddEventListener<K extends keyof XMLHttpRequestEventMap>(type: K, listener: (ev: XMLHttpRequestEventMap[K]) => any, useCapture?: boolean): void;\r\n\taddEventListener(type: string, listener: EventListenerOrEventListenerObject, useCapture?: boolean): void;\r\n\taddEventListener(type: string, listener?: EventListenerOrEventListenerObject, options?: boolean | AddEventListenerOptions): void;\r\n\taddEventListener<K extends keyof XMLHttpRequestEventTargetEventMap>(type: K, listener: (ev: XMLHttpRequestEventTargetEventMap[K]) => any, useCapture?: boolean): void;\r\n\taddEventListener(type, listener?, useCapture?): void {\r\n\t}\r\n\r\n\tdispatchEvent(evt: Event): boolean {\r\n\t\treturn undefined;\r\n\t}\r\n\r\n\tremoveEventListener(type: string, listener?: EventListenerOrEventListenerObject, options?: boolean | EventListenerOptions): void {\r\n\t}\r\n\r\n}\r\n","import Transaction from './Transaction';\r\nimport CollectionFetchOptions = Backbone.CollectionFetchOptions;\r\nimport PersistenceOptions = Backbone.PersistenceOptions;\r\nimport KeywordCollection from '../Keyword/KeywordCollection';\r\nimport Keyword from '../Keyword/Keyword';\r\nimport CategoryCount from '../Category/CategoryCount';\r\nimport {debug} from '../umsaetze';\r\nimport MonthSelect from '../MonthSelect';\r\nconst Backbone = require('backbone');\r\nimport FakeJQueryXHR from \"../FakeJQueryXHR\";\r\n\r\nconst Backbone = require('backbone');\r\n//let BackboneLocalStorage = require('backbone.localstorage');\r\nrequire('backbone.localstorage');\r\n// import {LocalStorage} from 'backbone.localstorage';\r\nrequire('datejs');\r\nlet elapse = require('elapse');\r\nelapse.configure({\r\n\tdebug: true\r\n});\r\nlet _ = require('underscore');\r\n\r\nexport default class Expenses extends Backbone.Collection<Transaction> {\r\n\r\n\tmodel: typeof Transaction;\r\n\r\n\tlocalStorage: Backbone.LocalStorage;\r\n\r\n\tselectedMonth: Date;\r\n\r\n\tcomparator(compare: Transaction, to?: Transaction) {\r\n\t\treturn compare.date == to.date\r\n\t\t\t? 0 : (compare.date > to.date ? 1 : -1);\r\n\t}\r\n\r\n\tconstructor(models?: Transaction[] | Object[], options?: any) {\r\n\t\tsuper(models, options);\r\n\t\tthis.localStorage = new Backbone.LocalStorage(\"Expenses\");\r\n\t\tthis.listenTo(this, 'change', () => {\r\n\t\t\tconsole.log('Expenses changed event');\r\n\t\t\tthis.saveAll();\r\n\t\t});\r\n\t\tthis.on(\"all\", debug(\"Expenses\"));\r\n\t}\r\n\r\n\t/**\r\n\t * Should be called after constructor to read data from LS\r\n\t * @param options\r\n\t * @return JQueryXHR\r\n\t */\r\n\tfetch(options: CollectionFetchOptions = {}) {\r\n\t\tlet models = this.localStorage.findAll();\r\n\t\tconsole.log('models from LS', models.length);\r\n\t\tif (models.length) {\r\n\t\t\t_.each(models, (el) => {\r\n\t\t\t\tthis.add(new Transaction(el));\r\n\t\t\t});\r\n\t\t\t//this.unserializeDate();\r\n\t\t\tthis.trigger('change');\r\n\t\t}\r\n\t\tconsole.log('read', this.length);\r\n\t\treturn new FakeJQueryXHR();\r\n\t}\r\n\r\n\t/**\r\n\t * Only visible\r\n\t * @returns {Date}\r\n\t */\r\n\tgetDateFrom() {\r\n\t\tlet visible = this.getVisible();\r\n\t\tlet min = new Date().addYears(10).valueOf();\r\n\t\t_.each(visible, (row: Transaction) => {\r\n\t\t\tlet date: number = row.getDate().valueOf();\r\n\t\t\tif (date < min) {\r\n\t\t\t\tmin = date;\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn new Date(min);\r\n\t}\r\n\r\n\t/**\r\n\t * Only visible\r\n\t * @returns {Date}\r\n\t */\r\n\tgetDateTill() {\r\n\t\tlet visible = this.getVisible();\r\n\t\tlet min = new Date('1970-01-01').valueOf();\r\n\t\t_.each(visible, (row: Transaction) => {\r\n\t\t\tlet date: number = row.getDate().valueOf();\r\n\t\t\tif (date > min) {\r\n\t\t\t\tmin = date;\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn new Date(min);\r\n\t}\r\n\r\n\tgetEarliest() {\r\n\t\tif (!this.size()) {\r\n\t\t\treturn new Date();\r\n\t\t}\r\n\t\tlet min = new Date().addYears(10).valueOf();\r\n\t\tthis.each((row: Transaction) => {\r\n\t\t\tlet dDate = row.getDate();\r\n\t\t\tlet date: number = dDate.valueOf();\r\n\t\t\tif (date < min) {\r\n\t\t\t\tmin = date;\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn new Date(min);\r\n\t}\r\n\r\n\tgetLatest() {\r\n\t\tif (!this.size()) {\r\n\t\t\treturn new Date();\r\n\t\t}\r\n\t\tlet min = new Date('1970-01-01').valueOf();\r\n\t\tthis.each((row: Transaction) => {\r\n\t\t\tlet date: number = row.getDate().valueOf();\r\n\t\t\tif (date > min) {\r\n\t\t\t\tmin = date;\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn new Date(min);\r\n\t}\r\n\r\n\t/**\r\n\t * show everything by default, then filters will hide\r\n\t */\r\n\tpublic setAllVisible() {\r\n\t\tthis.each((model: Transaction) => {\r\n\t\t\tmodel.set('visible', true, { silent: true });\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * Will hide some visible\r\n\t * @param q\r\n\t */\r\n\tfilterVisible(q: string) {\r\n\t\tif (!q.length) return;\r\n\t\telapse.time('Expense.filterVisible');\r\n\t\tlet lowQ = q.toLowerCase();\r\n\t\tthis.each((row: Transaction) => {\r\n\t\t\tif (row.get('note').toLowerCase().indexOf(lowQ) == -1) {\r\n\t\t\t\trow.set('visible', false, { silent: true });\r\n\t\t\t}\r\n\t\t});\r\n\t\telapse.timeEnd('Expense.filterVisible');\r\n\t\tthis.saveAll();\r\n\t}\r\n\r\n\t/**\r\n\t * Will hide some visible\r\n\t * @param selectedMonth\r\n\t */\r\n\tfilterByMonth(selectedMonth?: Date) {\r\n\t\telapse.time('Expense.filterByMonth');\r\n\t\tif (selectedMonth) {\r\n\t\t\tthis.selectedMonth = selectedMonth;\r\n\t\t} else if (this.selectedMonth) {\r\n\t\t\tselectedMonth = this.selectedMonth;\r\n\t\t} else {\r\n\t\t\t//throw new Error('filterByMonth no month defined');\r\n\t\t\tlet ms = MonthSelect.getInstance();\r\n\t\t\tselectedMonth = ms.getSelected();\r\n\t\t}\r\n\r\n\t\tconsole.log('filterMyMonth', selectedMonth);\r\n\t\tif (selectedMonth) {\r\n\t\t\tlet inThisMonth = this.whereMonth(selectedMonth);\r\n\t\t\tlet allOthers = _.difference(this.models, inThisMonth);\r\n\t\t\tallOthers.forEach((row: Transaction) => {\r\n\t\t\t\trow.set('visible', false, {silent: true});\r\n\t\t\t});\r\n\t\t\tthis.saveAll();\r\n\t\t}\r\n\t\telapse.timeEnd('Expense.filterByMonth');\r\n\t}\r\n\r\n\twhereMonth(selectedMonth: Date) {\r\n\t\tlet filtered = [];\r\n\t\tthis.each((row: Transaction) => {\r\n\t\t\tlet tDate: Date = row.get('date');\r\n\t\t\tlet sameYear = tDate.getFullYear() == selectedMonth.getFullYear();\r\n\t\t\tlet sameMonth = tDate.getMonth() == selectedMonth.getMonth();\r\n\t\t\tif (sameYear && sameMonth) {\r\n\t\t\t\tfiltered.push(row);\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn filtered;\r\n\t}\r\n\r\n\tfilterByCategory(category: CategoryCount) {\r\n\t\telapse.time('Expense.filterByCategory');\r\n\t\tthis.each((row: Transaction) => {\r\n\t\t\tif (row.isVisible()) {\r\n\t\t\t\tlet rowCat: string = row.get('category');\r\n\t\t\t\tlet isVisible = category.getName() == rowCat;\r\n\t\t\t\t//console.log('set visible', isVisible);\r\n\t\t\t\trow.set('visible', isVisible, {silent: true});\r\n\t\t\t}\r\n\t\t});\r\n\t\tthis.saveAll();\r\n\t\telapse.timeEnd('Expense.filterByCategory');\r\n\t}\r\n\r\n\tsaveAll() {\r\n\t\telapse.time('Expense.saveAll');\r\n\t\tthis.localStorage._clear();\r\n\t\tthis.each((model: Transaction) => {\r\n\t\t\tthis.localStorage.update(model);\r\n\t\t});\r\n\t\telapse.timeEnd('Expense.saveAll');\r\n\t}\r\n\r\n\t/**\r\n\t * @deprecated\r\n\t */\r\n\tunserializeDate() {\r\n\t\telapse.time('Expense.unserializeDate');\r\n\t\tthis.each((model: Transaction) => {\r\n\t\t\tlet sDate = model.get('date');\r\n\t\t\tlet dateObject = new Date(sDate);\r\n\t\t\tconsole.log(sDate, dateObject);\r\n\t\t\tmodel.set('date', dateObject);\r\n\t\t});\r\n\t\telapse.timeEnd('Expense.unserializeDate');\r\n\t}\r\n\r\n\tgetVisible() {\r\n\t\treturn this.where({visible: true});\r\n\t}\r\n\r\n\tgetVisibleCount() {\r\n\t\treturn this.getVisible().length;\r\n\t}\r\n\r\n\tgetSorted() {\r\n\t\tthis.sort();\r\n\t\tlet visible = this.getVisible();\r\n\t\t// return _.sortBy(visible, 'attributes.date');\r\n\t\treturn visible;\r\n\t}\r\n\r\n\tsetCategories(keywords: KeywordCollection) {\r\n\t\tthis.each((row: Transaction) => {\r\n\t\t\tif (row.get('category') == 'Default') {\r\n\t\t\t\tkeywords.each((key: Keyword) => {\r\n\t\t\t\t\t//console.log(key);\r\n\t\t\t\t\tlet note = row.get('note');\r\n\t\t\t\t\tif (note.indexOf(key.word) > -1) {\r\n\t\t\t\t\t\tconsole.log(note, 'contains', key.word, 'gets', key.category);\r\n\t\t\t\t\t\trow.set('category', key.category, { silent: true });\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\t\tthis.trigger('change');\r\n\t}\r\n\r\n\t/**\r\n\t * TODO: generate matrix separately and then return only the value in a grid.\r\n\t * JavaScript is so fast it's tempting to ignore this\r\n\t * @param category\r\n\t * @returns {{}}\r\n\t */\r\n\tgetMonthlyTotalsFor(category: CategoryCount) {\r\n\t\tlet sparks = {};\r\n\t\tlet from = this.getEarliest().moveToFirstDayOfMonth();\r\n\t\tlet till = this.getLatest().moveToLastDayOfMonth();\r\n\t\t// console.log({\r\n\t\t// \tfrom: from.toString('yyyy-MM-dd HH:mm'),\r\n\t\t// \ttill: till.toString('yyyy-MM-dd HH:mm'),\r\n\t\t// });\r\n\t\tlet count = 0;\r\n\t\tfor (let month = from; month.compareTo(till) == -1; month.addMonths(1)) {\r\n\t\t\tlet month1 = month.clone();\r\n\t\t\tmonth1.addMonths(1).add(<IDateJSLiteral>{minutes: -1});\r\n\t\t\t// console.log({\r\n\t\t\t// \tmonth: month.toString('yyyy-MM-dd HH:mm'),\r\n\t\t\t// \tmonth1: month1.toString('yyyy-MM-dd HH:mm'),\r\n\t\t\t// \ttoday_is_between: Date.today().between(month, month1)\r\n\t\t\t// });\r\n\t\t\tlet sum = 0;\r\n\t\t\tthis.each((transaction: Transaction) => {\r\n\t\t\t\tlet sameCategory = transaction.get('category') == category.getName();\r\n\t\t\t\tlet sameMonth = transaction.getDate().between(month, month1);\r\n\t\t\t\tif (sameCategory && sameMonth) {\r\n\t\t\t\t\t// if (category.getName() == 'Darlehen' && month.toString('yyyy-MM-dd') == '2014-09-01') {\r\n\t\t\t\t\t// \tconsole.log({\r\n\t\t\t\t\t// \t\ttransDate: transaction.getDate().toString('yyyy-MM-dd HH:mm'),\r\n\t\t\t\t\t// \t\ttransAmount: transaction.getAmount(),\r\n\t\t\t\t\t// \t\tmonth: month.toString('yyyy-MM-dd HH:mm'),\r\n\t\t\t\t\t// \t\tmonth1: month1.toString('yyyy-MM-dd HH:mm'),\r\n\t\t\t\t\t// \t});\r\n\t\t\t\t\t// }\r\n\t\t\t\t\tsum += transaction.getAmount();\r\n\t\t\t\t\tcount++;\r\n\t\t\t\t\tcategory.incrementCount();\r\n\t\t\t\t\t//category.incrementAmountBy(transaction.getAmount());\t// spoils CategoryView\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tsparks[month.toString('yyyy-MM')] = Math.abs(sum).toFixed(2);\r\n\t\t}\r\n\t\t//console.log(category.getName(), count);\r\n\t\tcategory.set('count', count, { silent: true });\r\n\t\treturn sparks;\r\n\t}\r\n\r\n\treplaceCategory(oldName, newName) {\r\n\t\tthis.each((transaction: Transaction) => {\r\n\t\t\tif (transaction.get('category') == oldName) {\r\n\t\t\t\ttransaction.set('category', newName, {silent: true});\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tclear() {\r\n\t\tthis.reset(null);\r\n\t}\r\n\r\n\tmap(fn: Function) {\r\n\t\treturn _.map(this.models, fn);\r\n\t}\r\n\r\n\t/**\r\n\t * This is supposed to be used after this.filterByMonth()\r\n\t */\r\n\tstepBackTillSalary(ms: MonthSelect) {\r\n\t\tlet selectedMonth = ms.getSelected();\r\n\t\tif (selectedMonth) {\r\n\t\t\tlet selectedMonthMinus1 = selectedMonth.clone().addMonths(-1);\r\n\t\t\tlet prevMonth = this.whereMonth(selectedMonthMinus1);\r\n\t\t\tlet max = _.reduce(prevMonth, (acc, row: Transaction) => {\r\n\t\t\t\treturn Math.max(acc, row.get('amount'));\r\n\t\t\t}, 0);\r\n\t\t\t//console.log(selectedMonthMinus1.toString('yyyy-MM-dd'), prevMonth.length, max);\r\n\r\n\t\t\tlet doAppend = false;\r\n\t\t\tprevMonth.forEach((row: Transaction) => {\r\n\t\t\t\tif (row.get('amount') == max) {\r\n\t\t\t\t\tdoAppend = true;\r\n\t\t\t\t}\r\n\t\t\t\tif (doAppend) {\r\n\t\t\t\t\trow.set('visible', true, {silent: true});\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t}\r\n\t}\r\n\r\n}\r\n","import Expenses from \"../Expenses/Expenses\";\r\nconst Backbone = require('backbone');\r\n// const bbls = require('backbone.localstorage');\r\nconst object = require('../Util/Object');\r\n\r\nexport default class CategoryCount extends Backbone.Model {\r\n\r\n\tcatName: string;\r\n\r\n\tcount: number;\r\n\r\n\tamount: number;\r\n\r\n\tcolor: string;\r\n\r\n\tconstructor(...args: any[]) {\r\n\t\tsuper();\r\n\t\tthis.set('catName', args[0].catName);\t// this should not be necessary but it is\r\n\t\tthis.set('color', args[0].color);\t// this should not be necessary but it is\r\n\t\tthis.set('count', args[0].count);\t// this should not be necessary but it is\r\n\t\tthis.set('amount', args[0].amount);\t// this should not be necessary but it is\r\n\t\tthis.set('id', args[0].id);\t// this should not be necessary but it is\r\n\t\t//this.listenTo(this, 'change', this.saveToLS);\r\n\t\tlet color = this.get('color');\r\n\t\tif (!color) {\r\n\t\t\tthis.set('color', this.pastelColor());\r\n\t\t}\r\n\r\n\t\tlet count = this.get('count');\r\n\t\tif (!count) {\r\n\t\t\tthis.set('count', 0);\r\n\t\t}\r\n\r\n\t\tlet amount = this.get('amount');\r\n\t\tif (!amount) {\r\n\t\t\tthis.set('amount', 0);\r\n\t\t}\r\n\t}\r\n\r\n\tsetColor(color) {\r\n\t\tthis.set('color', color);\r\n\t}\r\n\r\n\tpastelColor(){\r\n\t\tlet r = (Math.round(Math.random() * 55) + 200).toString(16);\r\n\t\tlet g = (Math.round(Math.random() * 55) + 200).toString(16);\r\n\t\tlet b = (Math.round(Math.random() * 55) + 200).toString(16);\r\n\t\treturn '#' + r + g + b;\r\n\t}\r\n\r\n\tgetName() {\r\n\t\treturn this.get('catName');\r\n\t}\r\n\r\n\tgetAmount() {\r\n\t\treturn this.get('amount').toFixed(2);\r\n\t}\r\n\r\n\tresetCounters() {\r\n\t\tthis.set('count', 0, { silent: true });\r\n\t\t// this.set('amount', 0, { silent: true });\r\n\t}\r\n\r\n\tincrementCount() {\r\n\t\tthis.set('count', this.get('count')+1, { silent: true });\r\n\t}\r\n\r\n\t/**\r\n\t * @deprecated - spoils CategoryView\r\n\t * @param by\r\n\t */\r\n\tincrementAmountBy(by: number) {\r\n\t\tthis.set('amount', this.get('amount') + by, { silent: true });\r\n\t}\r\n\r\n\tgetAverageAmountPerMonth(totalsPerMonth: Object) {\r\n\t\tlet totals = object.values(totalsPerMonth);\r\n\t\tlet sum = totals.reduce(function(a, b) { return parseFloat(a) + parseFloat(b); });\r\n\t\tlet avg = sum / totals.length;\r\n\t\t//console.log(totals, sum, avg);\r\n\t\treturn avg.toFixed(2);\r\n\t}\r\n\r\n}\r\n","/// <reference path=\"../node_modules/backbone-typings/backbone.d.ts\" />\r\n\r\nimport Expenses from './Expenses/Expenses';\r\nimport Transaction from './Expenses/Transaction';\r\nimport CategoryCollection from './Category/CategoryCollection';\r\nimport CategoryCount from './Category/CategoryCount';\r\nimport {CollectionController} from \"./CollectionController\";\r\nconst Handlebars = require('handlebars');\r\nconst Backbone = require('backbone');\r\nconst $ = require('jquery');\r\nconst _ = require('underscore');\r\nconst Chart = require('chart.js');\r\nconst toastr = require('toastr');\r\nconst object = require('./Util/Object');\r\n\r\nexport class CatPage extends CollectionController<Expenses> {\r\n\r\n\t$el = $('#app');\r\n\r\n\tmodel: Transaction;\r\n\r\n\tcollection: Expenses;\r\n\r\n\tcategoryList: CategoryCollection;\r\n\r\n\ttemplate;\r\n\r\n\tconstructor(expenses: Expenses, categoryList: CategoryCollection) {\r\n\t\tsuper();\r\n\t\tconsole.log('CatPage.constructor');\r\n\t\tthis.collection = expenses;\r\n\t\tthis.categoryList = categoryList;\r\n\t\tlet importTag = $('#CatPage');\r\n\t\tlet href = importTag.prop('href');\r\n\t\tconsole.log(importTag, href);\r\n\t\t$.get(href).then((result) => {\r\n\t\t\t//console.log(result);\r\n\t\t\tthis.setTemplate(\r\n\t\t\t\t//_.template( result )\r\n\t\t\t\tHandlebars.compile(result)\r\n\t\t\t);\r\n\t\t});\r\n\t\tconsole.log(this);\r\n\t\tthis.listenTo(this.categoryList, 'change', this.render);\r\n\t\tthis.listenTo(this.categoryList, 'add', this.render);\r\n\t\tthis.listenTo(this.categoryList, 'update', this.render);\r\n\t}\r\n\r\n\tsetTemplate(html) {\r\n\t\tthis.template = html;\r\n\t\tthis.render();\r\n\t}\r\n\r\n\trender() {\r\n\t\tif (window.location.hash != '#CatPage') return;\r\n\t\tconsole.log('CatPage.render');\r\n\t\tif (this.template) {\r\n\t\t\tlet categoryOptions = [];\r\n\t\t\tthis.categoryList.each((category: CategoryCount) => {\r\n\t\t\t\t//console.log(category);\r\n\t\t\t\tlet monthlyTotals = this.collection.getMonthlyTotalsFor(category);\r\n\t\t\t\tcategory.resetCounters();\r\n\t\t\t\tlet averageAmountPerMonth = category.getAverageAmountPerMonth(monthlyTotals);\r\n\t\t\t\tcategoryOptions.push({\r\n\t\t\t\t\tcatName: category.get('catName'),\r\n\t\t\t\t\tbackground: category.get('color'),\r\n\t\t\t\t\tid: category.cid,\r\n\t\t\t\t\tused: category.get('count'),\r\n\t\t\t\t\tamount: averageAmountPerMonth,\r\n\t\t\t\t\taverage: averageAmountPerMonth,\r\n\t\t\t\t\tsparkline: JSON.stringify(monthlyTotals),\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t\tcategoryOptions = _.sortBy(categoryOptions, 'catName');\r\n\t\t\tthis.$el.html(this.template({\r\n\t\t\t\tcategoryOptions: categoryOptions,\r\n\t\t\t}));\r\n\t\t\tthis.$('#addCategoryForm').on('submit', this.addCategory.bind(this));\r\n\t\t\tif ($(document).scrollTop() < 1) {\r\n\t\t\t\tthis.$('input[name=\"newName\"]').focus();\r\n\t\t\t}\r\n\t\t\tthis.$el.on('change', 'input[type=\"color\"]', this.selectColor.bind(this));\r\n\t\t\tthis.$('button.close').on('click', this.deleteCategory.bind(this));\r\n\t\t\tthis.$('#categoryCount').html(this.categoryList.size().toString());\r\n\t\t\tthis.$('.inlineEdit').data('callback', this.renameCategory.bind(this));\r\n\t\t\tsetTimeout(() => {\r\n\t\t\t\tthis.renderSparkLines();\r\n\t\t\t}, 5000);\r\n\t\t} else {\r\n\t\t\tthis.$el.html('Loading...');\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n\r\n\taddCategory(event: Event) {\r\n\t\tevent.preventDefault();\r\n\t\tlet $form = $(event.target);\r\n\t\tlet newName = $form.find('input').val();\r\n\t\tconsole.log('newName', newName);\r\n\t\tlet categoryObject = new CategoryCount({\r\n\t\t\tcatName: newName,\r\n\t\t});\r\n\t\tconsole.log('get', categoryObject.get('catName'));\r\n\t\tconsole.log('get', categoryObject.get('color'));\r\n\t\tthis.categoryList.add(categoryObject);\r\n\t}\r\n\r\n\tselectColor(event) {\r\n\t\tconsole.log(event);\r\n\t\tlet $input = $(event.target);\r\n\t\tlet id = $input.closest('tr').attr('data-id');\r\n\t\tconsole.log('id', id);\r\n\t\tlet category = this.categoryList.get(id);\r\n\t\tconsole.log('category by id', category);\r\n\t\tif (category) {\r\n\t\t\t//console.log('color', event.target.value);\r\n\t\t\tcategory.set('color', event.target.value);\r\n\t\t}\r\n\t}\r\n\r\n\tdeleteCategory(event: MouseEvent) {\r\n\t\tlet button = event.target;\r\n\t\tlet tr = $(button).closest('tr');\r\n\t\tlet id = tr.attr('data-id');\r\n\t\tconsole.log('deleteCategory', id);\r\n\t\tthis.categoryList.remove(id);\r\n\t}\r\n\r\n\t/**\r\n\t * https://codepen.io/ojame/pen/HpKvx\r\n\t */\r\n\tprivate renderSparkLines() {\r\n\t\tlet $sparkline = $('.sparkline');\r\n\t\t$sparkline.each((index, self) => {\r\n\t\t\t//console.log(self);\r\n\t\t\tself = $(self);\r\n\t\t\t//Get context with jQuery - using jQuery's .get() method.\r\n\t\t\tlet ctx = self.get(0).getContext(\"2d\");\r\n\r\n\t\t\t// Get the chart data and convert it to an array\r\n\t\t\tlet chartData = JSON.parse(self.attr('data-chart_values'));\r\n\t\t\tlet average = self.attr('data-average');\r\n\r\n\t\t\t// Build the data object\r\n\t\t\tlet data = object.values(chartData);\r\n\t\t\tlet labels = Object.keys(chartData);\r\n\t\t\t//console.log(data, labels);\r\n\t\t\tlet datasets = {};\r\n\r\n\t\t\t// Create the dataset\r\n\t\t\tdatasets['strokeColor'] = self.attr('data-chart_StrokeColor');\r\n\t\t\tdatasets['data'] = data;\r\n\r\n\t\t\tlet lineSet = {\r\n\t\t\t\ttype: 'line',\r\n\t\t\t\tlabel: 'Average per month',\r\n\t\t\t\tdata: [].fill(average, 0, data.length),\r\n\t\t\t\tborderColor: '#FF0000',\r\n\t\t\t\tborderWidth: 1,\r\n\t\t\t\tfill: false,\r\n\t\t\t};\r\n\r\n\t\t\t// Add to data object\r\n\t\t\tlet dataDesc = {};\r\n\t\t\tdataDesc['labels'] = labels;\r\n\t\t\tdataDesc['datasets'] = Array(datasets, lineSet);\r\n\r\n\t\t\tlet catPage = this;\r\n\t\t\tlet chart = new Chart.Line(ctx, {\r\n\t\t\t\tdata: dataDesc,\r\n\t\t\t\toptions: {\r\n\t\t\t\t\tresponsive: true,\r\n\t\t\t\t\tscaleLineColor: \"rgba(0,0,0,0)\",\r\n\t\t\t\t\tscaleShowLabels: false,\r\n\t\t\t\t\tscaleShowGridLines: false,\r\n\t\t\t\t\tpointDot: false,\r\n\t\t\t\t\tdatasetFill: false,\r\n\t\t\t\t\t// Sadly if you set scaleFontSize to 0, chartjs crashes\r\n\t\t\t\t\t// Instead we'll set it as small as possible and make it transparent\r\n\t\t\t\t\tscaleFontSize: 1,\r\n\t\t\t\t\tscaleFontColor: \"rgba(0,0,0,0)\",\r\n\t\t\t\t\tlegend: {\r\n\t\t\t\t\t\tdisplay: false,\r\n\t\t\t\t\t},\r\n\t\t\t\t\tmaintainAspectRatio: false,\r\n\t\t\t\t\tscales: {\r\n\t\t\t\t\t\tyAxes: [{\r\n\t\t\t\t\t\t\tticks: {\r\n\t\t\t\t\t\t\t\tpadding: 0,\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}]\r\n\t\t\t\t\t},\r\n\t\t\t\t\tonClick: function (event: MouseEvent, aChartElement) {\r\n\t\t\t\t\t\tcatPage.clickOnChart(labels, event, aChartElement, this);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tself.prop('chart', chart);\r\n\t\t});\r\n\t}\r\n\r\n\tprivate clickOnChart(labels, event: MouseEvent, aChartElement, chart) {\r\n\t\tlet catPage = this;\r\n\t\tlet first = aChartElement.length ? aChartElement[0] : null;\r\n\t\tif (first) {\r\n\t\t\tconsole.log(labels, aChartElement);\r\n\t\t\tlet yearMonth = labels[first._index];\r\n\t\t\tlet [year, month] = yearMonth.split('-');\r\n\t\t\tlet categoryID = $(event.target).closest('tr').attr('data-id');\r\n\t\t\tlet category: CategoryCount = catPage.categoryList.get(categoryID);\r\n\t\t\tconsole.log(yearMonth, year, month, category);\r\n\t\t\tBackbone.history.navigate('#/'+year+'/'+month+'/'+category.get('catName'));\r\n\t\t} else {\r\n\t\t\tconsole.log(this, event, event.target);\r\n\t\t\tlet $canvas = $(event.target);\r\n\t\t\tif ($canvas.height() == 100) {\r\n\t\t\t\t$canvas.height(300);\r\n\t\t\t} else {\r\n\t\t\t\t$canvas.height(100);\r\n\t\t\t}\r\n\t\t\tsetTimeout(() => {\r\n\t\t\t\tchart.resize();\r\n\t\t\t}, 1000);\r\n\t\t}\r\n\t}\r\n\r\n\trenameCategory(event, container, newName) {\r\n\t\tconsole.log('Rename', newName);\r\n\t\tlet id = container.closest('tr').attr('data-id');\r\n\t\tlet category: CategoryCount = this.categoryList.get(id);\r\n\t\tconsole.log(id, category);\r\n\t\tif (category) {\r\n\t\t\tlet oldName = category.getName();\r\n\t\t\tif (this.categoryList.exists(newName)) {\r\n\t\t\t\ttoastr.error('This category name is duplicate');\r\n\t\t\t\tcontainer.find('span').text(oldName);\r\n\t\t\t} else {\r\n\t\t\t\tcategory.set('catName', newName);\r\n\t\t\t\tthis.collection.replaceCategory(oldName, newName);\r\n\t\t\t\tthis.categoryList.saveToLS();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n}\r\n","\r\ntype ArrayOfStrings = Array<ArrayOfStrings>|string;\r\n\r\nexport default class RecursiveArrayOfStrings extends Array {\r\n\r\n\tstatic merge(content: ArrayOfStrings): string {\r\n\t\tlet output = [];\r\n\t\tcontent.forEach(sub => {\r\n\t\t\tif (Array.isArray(sub)) {\r\n\t\t\t\toutput.push(this.merge(sub));\r\n\t\t\t} else {\r\n\t\t\t\toutput.push(sub);\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn output.join('');\r\n\t}\r\n\r\n}\r\n","import $ = require('jquery');\r\nconst _ = require('underscore');\r\nimport KeywordCollection from './KeywordCollection';\r\nimport RecursiveArrayOfStrings from '../RecursiveArrayOfStrings'\r\nimport Keyword from './Keyword';\r\nimport toastr = require('toastr');\r\nimport {CollectionController} from '../CollectionController';\r\n\r\nexport class KeywordsView extends CollectionController<KeywordCollection> {\r\n\r\n\t$el = $('#app');\r\n\r\n\t/**\r\n\t * Will be injected by Workspace\r\n\t */\r\n\tkeywords: KeywordCollection;\r\n\r\n\tconstructor(options?) {\r\n\t\tsuper(options);\r\n\t\tconsole.log(this);\r\n\t\t//console.log(super);\r\n\t\tconsole.log('new KeywordsView()', this.cid);\r\n\t}\r\n\r\n\trender() {\r\n\t\tconsole.time('KeywordsView::render');\r\n\t\tlet content: string[] = ['<table class=\"table\">',\r\n\t\t\t'<thead>',\r\n\t\t\t'<tr>',\r\n\t\t\t\t'<th>Keyword</th>',\r\n\t\t\t\t'<th>Category</th>',\r\n\t\t\t\t'<th></th>',\r\n\t\t\t'</tr>',\r\n\t\t\t'</thead>',\r\n\t\t];\r\n\t\tcontent.push('<tbody>');\r\n\t\tthis.keywords.each((el: Keyword) => {\r\n\t\t\tcontent.push(`\r\n\t\t\t\t<tr data-id=\"${el.word}\">\r\n\t\t\t\t<td>${el.word}</td>\r\n\t\t\t\t<td>${el.category}</td>\r\n\t\t\t\t<td class=\"hover-btn\">\r\n\t\t\t\t\t<button type=\"button\" class=\"close btn-sm\" data-dismiss=\"alert\">\r\n\t\t\t\t\t\t<span aria-hidden=\"true\"></span>\r\n\t\t\t\t\t\t<span class=\"sr-only\">Delete</span>\r\n\t\t\t\t\t</button>\r\n\t\t\t\t</td>\r\n\t\t\t\t</tr>`\r\n\t\t\t);\r\n\t\t});\r\n\t\tcontent.push('</tbody>');\r\n\t\tcontent.push('</table>');\r\n\t\t// console.log(content);\r\n\r\n\t\tcontent = [\r\n\t\t\t`<div class=\"panel panel-default\">\r\n\t\t\t\t<div class=\"panel-heading\">\r\n\t\t\t\t\t<div class=\"pull-right\">\r\n\t\t\t\t\t\t<button class=\"btn btn-default btn-xs\" id=\"removeDuplicates\">\r\n\t\t\t\t\t\t\t<span class=\"glyphicon glyphicon-filter\"></span>\r\n\t\t\t\t\t\t</button>\r\n\t\t\t\t</div>\r\n\t\t\t\tKeywords \r\n\t\t\t\t<span class=\"badge\">${this.keywords.size()}</span>\r\n\t\t\t</div>\r\n\t\t\t<div class=\"panel-body\">`,\r\n\t\t\t...content,\r\n\t\t\t'</div>',\r\n\t\t\t'</div>',\r\n\t\t];\r\n\r\n\t\tthis.$el.html(RecursiveArrayOfStrings.merge(content));\r\n\t\tthis.$('#removeDuplicates').off().on('click', this.removeDuplicates.bind(this));\r\n\t\tthis.$el.off('click', 'button.close').on('click', 'button.close', this.deleteRow.bind(this));\r\n\t\tconsole.timeEnd('KeywordsView::render');\r\n\t}\r\n\r\n\tremoveDuplicates(event: MouseEvent) {\r\n\t\tlet original = this.keywords.size();\r\n\t\tconsole.log('removeDuplicates', original);\r\n\t\tthis.keywords.models = _.uniq(this.keywords.models, false, (el: Keyword) => {\r\n\t\t\treturn el.word;\r\n\t\t});\r\n\t\tconsole.log(this.keywords.size());\r\n\t\tlet x = this.keywords.size() - original;\r\n\t\tif (x) {\r\n\t\t\ttoastr.success(`Removed ${x} duplicates`);\r\n\t\t} else {\r\n\t\t\ttoastr.error(`No duplicates to remove`);\r\n\t\t}\r\n\t\tthis.keywords.save();\r\n\t\tthis.render();\r\n\t}\r\n\r\n\tdeleteRow(event: MouseEvent) {\r\n\t\tlet button = $(event.target);\r\n\t\tlet dataID = button.closest('tr').attr('data-id');\r\n\t\tconsole.log(dataID);\r\n\t\tthis.keywords.remove(dataID, 'word');\r\n\t\tthis.keywords.save();\r\n\t\tthis.render();\r\n\t}\r\n\r\n\thide() {\r\n\r\n\t}\r\n\r\n}\r\n","import Transaction from \"../Expenses/Transaction\";\r\nimport CategoryCount from \"./CategoryCount\";\r\nimport Expenses from \"../Expenses/Expenses\";\r\nconst Backbone = require('backbone');\r\n\r\nconst elapse = require('elapse');\r\nelapse.configure({\r\n\tdebug: true\r\n});\r\nrequire('backbone.localstorage');\r\nconst _ = require('underscore');\r\n\r\n/**\r\n * Depends on Expenses to parse them\r\n * and retrieve the total values for each category\r\n */\r\nexport default class CategoryCollection extends Backbone.Collection<CategoryCount> {\r\n\r\n\tmodel: CategoryCount|any;\r\n\r\n\t//collection: Backbone.Collection<CategoryCount>;\r\n\r\n\texpenses: Expenses;\r\n\r\n\tconstructor(options?) {\r\n\t\tsuper(options);\r\n\t\tlet ls = new Backbone.LocalStorage('Categories');\r\n\t\t//this.colors = simpleStorage.get('CategoryColors');\r\n\t\tlet models = ls.findAll();\r\n\t\tmodels = _.uniq(models, false, (e1) => {\r\n\t\t\treturn e1.catName;\r\n\t\t});\r\n\t\t//console.log('categories in LS', models);\r\n\r\n\t\t//this.add(models);\t// makes Backbone.Model instances\r\n\t\t_.each(models, m => {\r\n\t\t\tthis.add(new CategoryCount(m));\r\n\t\t});\r\n\r\n\t\t// sort\r\n\t\tthis.models = _.uniq(this.models, (el) => {\r\n\t\t\treturn el.getName();\r\n\t\t});\r\n\r\n\t\tif (!this.size()) {\r\n\t\t\t//this.getCategoriesFromExpenses();\r\n\t\t\t// this is not available yet\r\n\t\t}\r\n\r\n\t\tthis.listenTo(this, 'change', this.saveToLS);\r\n\t}\r\n\r\n\tsetExpenses(ex: Expenses) {\r\n\t\tthis.expenses = ex;\r\n\t\tthis.getCategoriesFromExpenses();\r\n\r\n\t\t// when expenses change, we recalculate our data\r\n\t\t// visibility changes are too often - commented\r\n\t\t//this.listenTo(this.expenses, \"change\", this.getCategoriesFromExpenses);\r\n\r\n\t\t// this is how AppView triggers recalculation\r\n\t\t// this makes an infinite loop of triggers\r\n\t\t//this.listenTo(this, \"change\", this.getCategoriesFromExpenses);\r\n\t\t//this.listenTo(this, 'add', this.addToOptions);\r\n\t}\r\n\r\n\tsaveToLS() {\r\n\t\tlet ls = new Backbone.LocalStorage('Categories');\r\n\t\tlet deleteMe = ls.findAll();\r\n\t\t// console.log('saveToLS', deleteMe.length);\r\n\t\tthis.each((model: CategoryCount) => {\r\n\t\t\tif (model.get('id')) {\r\n\t\t\t\tls.update(model);\r\n\t\t\t\t//deleteMe = _.without(deleteMe, _.findWhere(deleteMe, { id: model.get('id') }))\r\n\t\t\t\tlet findIndex = _.findIndex(deleteMe, { id: model.get('id') });\r\n\t\t\t\tif (findIndex > -1) {\r\n\t\t\t\t\tdeleteMe.splice(findIndex, 1);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tls.create(model);\r\n\t\t\t}\r\n\t\t});\r\n\t\tif (deleteMe.length) {\r\n\t\t\t//console.log(deleteMe.length, _.pluck(deleteMe, 'id'), _.pluck(deleteMe, 'catName'));\r\n\t\t\t_.each(deleteMe, (el) => {\r\n\t\t\t\tls.destroy(el);\r\n\t\t\t})\r\n\t\t}\r\n\t}\r\n\r\n\tresetCounters() {\r\n\t\tthis.each((row: CategoryCount) => {\r\n\t\t\trow.set('amount', 0, { silent: true });\r\n\t\t\trow.set('count', 0, { silent: true });\r\n\t\t});\r\n\t}\r\n\r\n\tgetCategoriesFromExpenses() {\r\n\t\telapse.time('getCategoriesFromExpenses');\r\n\t\t// this.reset();\t// don't reset - loosing colors\r\n\t\tthis.resetCounters();\r\n\t\tlet visible = this.expenses.getVisible();\r\n\t\t//console.log(visible.length);\r\n\t\t_.each(visible, (transaction: Transaction) => {\r\n\t\t\tlet categoryName = transaction.get('category');\r\n\t\t\tif (categoryName) {\r\n\t\t\t\tthis.incrementCategoryData(categoryName, transaction);\r\n\t\t\t}\r\n\t\t});\r\n\t\t//console.log(this.categoryCount);\r\n\t\tthis.sortBy('amount');\r\n\t\telapse.timeEnd('getCategoriesFromExpenses');\r\n\r\n\t\t// when we recalculated the data we trigger the view render\r\n\t\tthis.trigger('change'); // commented because of infinite loop\r\n\t}\r\n\r\n\tprivate incrementCategoryData(categoryName: any, transaction: Transaction) {\r\n\t\tlet exists = this.findWhere({catName: categoryName});\r\n\t\tif (exists) {\r\n\t\t\texists.set('count',  exists.get('count') + 1, { silent: true });\r\n\t\t\tlet amountBefore = exists.get('amount');\r\n\t\t\tlet amountAfter = transaction.get('amount');\r\n\t\t\tif (categoryName == 'Income') {\r\n\t\t\t\t//console.log(amountBefore, amountAfter, amountBefore + amountAfter);\r\n\t\t\t}\r\n\t\t\texists.set('amount', amountBefore + amountAfter, { silent: true });\r\n\t\t} else {\r\n\t\t\tthis.add(new CategoryCount({\r\n\t\t\t\tcatName: categoryName,\r\n\t\t\t\tcount: 1,\r\n\t\t\t\tamount: transaction.get('amount'),\r\n\t\t\t}), { silent: true });\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @deprecated - attempt #2 - not finished\r\n\t * @returns {Array}\r\n\t */\r\n\tgetCategoriesFromExpenses2() {\r\n\t\tlet options = [];\r\n\t\tlet categories = this.expenses.groupBy('category');\r\n\t\t//console.log('categories', categories);\r\n\t\t_.each(categories, (value, index) => {\r\n\t\t\toptions.push(index);\r\n\t\t});\r\n\t\treturn options;\r\n\t}\r\n\r\n\t/**\r\n\t * Run once and cache forever.\r\n\t * Not using this.models because they are filtered only visible\r\n\t * but we need all categories\r\n\t * @returns {Array}\r\n\t */\r\n\tgetOptions() {\r\n\t\tlet options = this.pluck('catName');\r\n\t\t//console.log('getOptions', options);\r\n\t\toptions = _.unique(options);\r\n\t\toptions = _.sortBy(options);\r\n\t\treturn options;\r\n\t}\r\n\r\n\tgetColorFor(value) {\r\n\t\t// console.log('colors', this.colors);\r\n\t\t// let index = _.find(this.allOptions, (catName, index) => {\r\n\t\t// \tif (value == catName) {\r\n\t\t// \t\treturn index;\r\n\t\t// \t}\r\n\t\t// });\r\n\t\tlet color;\r\n\t\tlet category = this.findWhere({catName: value});\r\n\t\tif (category) {\r\n\t\t\tcolor = category.get('color');\r\n\t\t\t//console.log('color for', value, 'is', color);\r\n\t\t} else {\r\n\t\t\tcolor = '#AAAAAA';\r\n\t\t}\r\n\t\treturn color;\r\n\t}\r\n\r\n\texists(newName) {\r\n\t\treturn !!this.findWhere({\r\n\t\t\tcatName: newName,\r\n\t\t});\r\n\t}\r\n\r\n\trandom() {\r\n\t\treturn _.sample(this.models);\r\n\t}\r\n\r\n}\r\n","/// <reference path=\"../../typings/index.d.ts\"/>\r\nconst simpleStorage = require('simpleStorage.js');\r\nconst _ = require('underscore');\r\n\r\nexport default class CollectionArray extends Array {\r\n\r\n\tname: string;\r\n\r\n\tmodels = [];\r\n\r\n\tmodelClass: any;\r\n\r\n\tconstructor(...arguments2) {\r\n\t\t//super(...arguments2);\r\n\r\n\t\tthis.name = this.constructor.prototype.name;\r\n\t}\r\n\r\n\t/**\r\n\t * Call this after setting this.modelClass\r\n\t */\r\n\tfetch() {\r\n\t\tlet models = simpleStorage.get(this.name) || [];\r\n\t\tmodels.forEach((row) => {\r\n\t\t\tif (row) {\r\n\t\t\t\tlet model = new this.modelClass(row);\r\n\t\t\t\tthis.add(model);\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tadd(model) {\r\n\t\tthis.models.push(model);\r\n\t\tthis.save();\r\n\t}\r\n\r\n\tsave() {\r\n\t\tsimpleStorage.set(this.name, this.models);\r\n\t\t//console.log(this.name+' saved '+this.size()+' records');\r\n\t}\r\n\r\n\teach(callback: Function) {\r\n\t\tthis.models.forEach((el) => {\r\n\t\t\t//console.log('each', el);\r\n\t\t\tcallback(el);\r\n\t\t});\r\n\t}\r\n\r\n\tgetJSON() {\r\n\t\treturn JSON.stringify(this.models, null, '\\t');\r\n\t}\r\n\r\n\tsize() {\r\n\t\treturn this.models.length;\r\n\t}\r\n\r\n\trandom() {\r\n\t\treturn _.sample(this.models);\r\n\t}\r\n\r\n\tremove(id, idField = 'id') {\r\n\t\tlet index = _.findIndex(this.models, el => {\r\n\t\t\treturn el[idField] == id;\r\n\t\t});\r\n\t\tconsole.log(index, id, idField);\r\n\t\tif (index > -1) {\r\n\t\t\tdelete this.models[index];\r\n\t\t}\r\n\t}\r\n\r\n}\r\n","///<reference path=\"../../typings/index.d.ts\"/>\r\n\r\nimport CollectionArray from './CollectionArray';\r\nimport Keyword from './Keyword';\r\n\r\nexport default class KeywordCollection extends CollectionArray {\r\n\r\n\tconstructor(...arguments2) {\r\n\t\tsuper(...arguments2);\r\n\t\tthis.modelClass = Keyword;\r\n\t\tthis.fetch();\r\n\t}\r\n\r\n}\r\n","/// <reference path=\"../../typings/index.d.ts\" />\r\n\r\nconst _ = require('underscore');\r\n\r\nexport default class SummaryLine {\r\n\r\n\tcatName: string;\r\n\r\n\taverage: number|string = 0;\r\n\r\n\tperCent: number|string = 0;\r\n\r\n\tbackground: string;\r\n\r\n\tid: string;\r\n\r\n\tperMonth: Array<any> = [];\r\n\r\n\tconstructor(params?: Object) {\r\n\t\tif (params) {\r\n\t\t\t_.extend(this, params);\r\n\t\t}\r\n\t}\r\n\r\n\tcombine(sl2: SummaryLine) {\r\n\t\tthis.average += parseFloat(<any>sl2.average);\r\n\t\tthis.perCent = parseFloat(<any>this.perCent) + parseFloat(<any>sl2.perCent);\r\n\t\tif (this.perMonth.length) {\r\n\t\t\tthis.perMonth = _.map(this.perMonth, (el, index) => {\r\n\t\t\t\t// if (this.catName == 'Auto') console.log(el, sl2.perMonth[index]);\r\n\t\t\t\tel.value = parseFloat(el.value) + parseFloat(sl2.perMonth[index].value);\r\n\t\t\t\t// if (this.catName == 'Auto') console.log(el.value);\r\n\t\t\t\tel.value = el.value.toFixed(2);\r\n\t\t\t\treturn el;\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\t// http://stackoverflow.com/questions/21003059/how-do-you-clone-an-array-of-objects-using-underscore\r\n\t\t\tthis.perMonth = _.map(sl2.perMonth, _.clone);\t// deep clone\r\n\t\t}\r\n\t}\r\n\r\n}\r\n","///<reference path=\"../../typings/index.d.ts\"/>\r\n///<reference path=\"../../node_modules/backbone-typings/backbone.d.ts\"/>\r\n\r\nimport CategoryCollection from \"../Category/CategoryCollection\";\r\nimport CategoryCount from \"../Category/CategoryCount\";\r\nimport Expenses from \"../Expenses/Expenses\";\r\nimport SummaryLine from \"./SummaryLine\";\r\nimport CategoryCollectionModel from \"../Category/CategoryCollectionModel\";\r\nimport {ViewOptions} from \"backbone\";\r\n\r\nconst Handlebars = require('handlebars');\r\nconst Backbone = require('backbone');\r\nconst _ = require('underscore');\r\n\r\nexport default class SummaryView extends Backbone.View<CategoryCollectionModel> {\r\n\r\n\tcollection: CategoryCollection;\r\n\r\n\texpenses: Expenses;\r\n\r\n\ttemplate: any;\r\n\r\n\tconstructor(options: ViewOptions<CategoryCollectionModel>, expenses: Expenses) {\r\n\t\tsuper(options);\r\n\t\tthis.expenses = expenses;\r\n\t\tthis.setElement($('#app'));\r\n\t\tlet importTag = $('#SummaryPage');\t// <import>\r\n\t\tlet href = importTag.prop('href');\r\n\t\t//console.log(importTag, href);\r\n\t\t$.get(href).then((result) => {\r\n\t\t\t//console.log(result);\r\n\t\t\tthis.template = Handlebars.compile(result);\r\n\t\t\t//console.log(this.template);\r\n\t\t\tthis.render();\r\n\t\t});\r\n\t}\r\n\r\n\tinitialize() {\r\n\r\n\t}\r\n\r\n\trender() {\r\n\t\tif (!this.template) {\r\n\t\t\tthis.$el.html('Loading...');\r\n\t\t\treturn this;\r\n\t\t}\r\n\t\tlet categoryOptions = this.getCategoriesWithTotals();\r\n\t\tlet months = _.pluck(categoryOptions[0].perMonth, 'year-month');\r\n\t\tcategoryOptions = this.setPerCent(categoryOptions);\r\n\t\tcategoryOptions = _.sortBy(categoryOptions, 'catName');\r\n\t\tcategoryOptions = this.addCategoryTotals(categoryOptions);\r\n\t\tlet content = this.template({\r\n\t\t\tcategoryOptions: categoryOptions,\r\n\t\t\tcount: this.collection.size(),\r\n\t\t\tmonths: months,\r\n\t\t});\r\n\t\tthis.$el.html(content);\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\tprivate getCategoriesWithTotals() {\r\n\t\tlet categoryOptions = [];\r\n\t\tthis.collection.each((category: CategoryCount) => {\r\n\t\t\tlet monthlyTotals = this.expenses.getMonthlyTotalsFor(category);\r\n\t\t\tlet averageAmountPerMonth = category.getAverageAmountPerMonth(monthlyTotals);\r\n\t\t\tmonthlyTotals = _.map(monthlyTotals, (el, key) => {\r\n\t\t\t\tlet [year, month] = key.split('-');\r\n\t\t\t\t// console.log(key, year, month);\r\n\t\t\t\treturn {\r\n\t\t\t\t\t'year-month': year+'-'+month,\r\n\t\t\t\t\tyear: year,\r\n\t\t\t\t\tmonth: month,\r\n\t\t\t\t\tcategoryName: category.getName(),\r\n\t\t\t\t\tvalue: el,\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tcategoryOptions.push(new SummaryLine({\r\n\t\t\t\tcatName: category.getName(),\r\n\t\t\t\tbackground: category.get('color'),\r\n\t\t\t\tid: category.cid,\r\n\t\t\t\taverage: averageAmountPerMonth,\r\n\t\t\t\tperMonth: monthlyTotals,\r\n\t\t\t}));\r\n\t\t});\r\n\t\treturn categoryOptions;\r\n\t}\r\n\r\n\tprivate setPerCent(categoryOptions: SummaryLine[]) {\r\n\t\tlet sumAverages = categoryOptions.reduce(function (current, b) {\r\n\t\t\t//console.log(current, b);\r\n\t\t\treturn current + (typeof b.average == 'number'\r\n\t\t\t\t? b.average : parseFloat(b.average));\r\n\t\t}, 0);\r\n\t\tconsole.log('sumAverages', sumAverages);\r\n\t\t_.each(categoryOptions, (el) => {\r\n\t\t\tel.perCent = (el.average / sumAverages * 100).toFixed(2);\r\n\t\t\t//console.log(el.catName, el.perCent);\r\n\t\t});\r\n\t\treturn categoryOptions;\r\n\t}\r\n\r\n\tprivate addCategoryTotals(categoryOptions: SummaryLine[]) {\r\n\t\tlet groupByCategory = {};\r\n\t\t_.each(categoryOptions, el => {\r\n\t\t\tif (!el.catName) {\r\n\t\t\t\tconsole.log(el);\r\n\t\t\t\t//throw new Error('addCategoryTotals has element without catName');\r\n\t\t\t\treturn;\t// ignore\r\n\t\t\t}\r\n\t\t\tlet [category, specifics] = el.catName.split(':');\r\n\t\t\tcategory = category.trim();\r\n\t\t\tif (!groupByCategory[category]) {\r\n\t\t\t\tgroupByCategory[category] = [];\r\n\t\t\t}\r\n\t\t\tgroupByCategory[category].push(el);\r\n\t\t});\r\n\t\tconsole.log(groupByCategory);\r\n\r\n\t\t// step 2\r\n\t\t_.each(groupByCategory, (set, setName) => {\r\n\t\t\tif (set.length > 1) {\r\n\t\t\t\tlet newCat = new SummaryLine({\r\n\t\t\t\t\tcatName: setName + ' [' + set.length + ']',\r\n\t\t\t\t\tbackground: '#FF8800',\r\n\t\t\t\t});\r\n\t\t\t\t_.each(set, (el) => {\r\n\t\t\t\t\tnewCat.combine(el);\r\n\t\t\t\t});\r\n\t\t\t\tnewCat.average = typeof newCat.average == 'number'\r\n\t\t\t\t\t? newCat.average.toFixed(2) : newCat.average;\r\n\t\t\t\tnewCat.perCent = typeof newCat.perCent == 'number'\r\n\t\t\t\t\t? newCat.perCent.toFixed(2) : newCat.perCent;\r\n\t\t\t\tcategoryOptions.push(newCat);\r\n\t\t\t}\r\n\t\t});\r\n\t\tcategoryOptions = _.sortBy(categoryOptions, 'catName');\r\n\t\treturn categoryOptions;\r\n\t}\r\n\r\n\t/**\r\n\t * For Workspace\r\n\t */\r\n\thide() {\r\n\r\n\t}\r\n\r\n}\r\n","const _ = require('underscore');\r\n\r\nexport default class SLTable {\r\n\r\n\tdata: Array<any>;\r\n\r\n\tconstructor(data: Array<any> = []) {\r\n\t\tthis.data = data;\r\n\t\tconsole.log('SLTable', this.data.length);\r\n\t}\r\n\r\n\ttoString() {\r\n\t\tlet content = [];\r\n\t\tcontent.push('<table class=\"table\">');\r\n\t\tcontent.push('<thead><tr>');\r\n\t\tthis.getColumns().forEach(col => {\r\n\t\t\tcontent.push('<th>' + col.name + '</th>');\r\n\t\t});\r\n\t\tcontent.push('</tr></thead>');\r\n\t\tcontent.push('<tbody>');\r\n\t\tcontent.push(this.getRowsToString());\r\n\t\tcontent.push('</tbody>');\r\n\t\tcontent.push('</table>');\r\n\t\treturn content.join(\"\\n\");\r\n\t}\r\n\r\n\tgetColumns() {\r\n\t\tlet thes = [];\r\n\t\tthis.data.forEach(row => {\r\n\t\t\tthes = thes.concat(Object.keys(row));\r\n\t\t});\r\n\t\tthes = _.uniq(thes);\r\n\t\t//console.log(thes);\r\n\r\n\t\tlet cols = [];\r\n\t\tthes.forEach(name => {\r\n\t\t\tcols.push({name: name});\r\n\t\t});\r\n\t\treturn cols;\r\n\t}\r\n\r\n\tgetRowsToString() {\r\n\t\tlet content = [];\r\n\t\tconst columns = this.getColumns();\r\n\t\tthis.data.forEach(row => {\r\n\t\t\tcontent.push('<tr>');\r\n\t\t\tcolumns.forEach(col => {\r\n\t\t\t\tcontent.push('<td>' + row[col.name] + '</td>');\r\n\t\t\t});\r\n\t\t\tcontent.push('</tr>');\r\n\t\t});\r\n\t\treturn content.join(\"\\n\");\r\n\t}\r\n\r\n}\r\n","///<reference path=\"../../typings/index.d.ts\"/>\r\n///<reference path=\"../../node_modules/backbone-typings/backbone.d.ts\"/>\r\n\r\nimport MyView from \"./MyView\";\r\nimport Expenses from \"../Expenses/Expenses\";\r\nimport MonthSelect from \"../MonthSelect\";\r\nimport Transaction from \"../Expenses/Transaction\";\r\nimport {default as SLTable} from \"../Util/SLTable\";\r\nconst Handlebars = require('handlebars');\r\nconst Backbone: any = require('backbone');\r\nconst _ = require('underscore');\r\nconst Chart = require('chart.js');\r\nrequire('datejs');\r\nrequire('../Util/Array');\r\n\r\nexport default class HistoryView extends Backbone.View<Backbone.Model> {\r\n\r\n\tcollection: Expenses;\r\n\r\n\tms: MonthSelect;\r\n\r\n\ttemplate: Function;\r\n\r\n\tconstructor(options) {\r\n\t\tsuper(options);\r\n\t\tthis.collection = options.collection;\r\n\t\tthis.setElement($('#app'));\r\n\r\n\t\tthis.ms = MonthSelect.getInstance();\r\n\t\tthis.ms.update(this.collection);\r\n\t\tthis.listenTo(this.ms, 'MonthSelect:change', this.monthChange.bind(this));\r\n\r\n\t\tthis.template = _.template('<canvas width=\"1500\" height=\"512\" ' +\r\n\t\t\t'class=\"sparkline\" ' +\r\n\t\t\t'style=\"width: 1500px; height: 512px\" '+\r\n\t\t\t'data-chart_StrokeColor=\"rgba(151,187,0,1)\" '+\r\n\t\t\t'data-average=\"<%= average %>\" '+\r\n\t\t\t'></canvas>');\r\n\r\n\t\t// let nintendo = this.collection.findWhere({id: '6137a425c770c89cfd55d60f91448749'});\r\n\t\t// if (nintendo) {\r\n\t\t// \tnintendo.set('amount', 3714.69);\r\n\t\t// \tconsole.log(nintendo);\r\n\t\t// }\r\n\t}\r\n\r\n\tinitialize() {\r\n\r\n\t}\r\n\r\n\trender() {\r\n\t\tthis.collection.setAllVisible();\r\n\t\tconst yearMonth = this.ms.getSelected();\r\n\t\tconsole.log('yearMonth', yearMonth);\r\n\t\tthis.collection.filterByMonth(yearMonth);\r\n\t\tthis.collection.stepBackTillSalary(this.ms);\r\n\t\tconst dataThisMonth = this.collection.getSorted();\r\n\r\n\t\tlet onlyAmounts: Array<number> = dataThisMonth.map((set: Transaction) => {\r\n\t\t\treturn set.get('amount');\r\n\t\t});\r\n\r\n\t\tlet accumulator = 0;\r\n\t\tlet cumulative = dataThisMonth.map((set: Transaction) => {\r\n\t\t\taccumulator += set.get('amount');\r\n\t\t\t//console.log(set.get('amount'), accumulator);\r\n\t\t\treturn accumulator;\r\n\t\t});\r\n\r\n\t\tlet labels = dataThisMonth.map((set: Transaction) => {\r\n\t\t\tlet date: IDateJS = set.get('date');\r\n\t\t\treturn date.toString('yyyy.MM.dd');\r\n\t\t});\r\n\r\n\t\tlet content = '';\r\n\t\tcontent += this.template({\r\n\t\t\taverage: onlyAmounts.average(),\r\n\t\t});\r\n\r\n\t\tcontent += new SLTable(JSON.parse(JSON.stringify(dataThisMonth)));\r\n\r\n\t\t//content += '<pre>' + JSON.stringify(dataThisMonth, null, 4) + '</pre>';\r\n\t\tthis.$el.html(content);\r\n\r\n\t\tthis.renderSparkLines(labels, onlyAmounts, cumulative);\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\thide() {\r\n\t\tthis.stopListening(this.ms);\r\n\t}\r\n\r\n\tmonthChange() {\r\n\t\t//console.error('monthChange event');\r\n\t\tthis.render();\r\n\t}\r\n\r\n\tprivate renderSparkLines(labels: Array<string>, data: Array<number>, data2: Array<number>) {\r\n\t\tlet $sparkLine = $('.sparkline');\r\n\t\t$sparkLine.each((index, self) => {\r\n\t\t\t//console.log($self);\r\n\t\t\tlet $self = $(self);\r\n\t\t\t//Get context with jQuery - using jQuery's .get() method.\r\n\t\t\tlet ctx = (<HTMLCanvasElement>$self.get(0)).getContext(\"2d\");\r\n\r\n\t\t\tlet datasets = {};\r\n\r\n\t\t\t// Create the dataset\r\n\t\t\tdatasets['strokeColor'] = $self.attr('data-chart_StrokeColor');\r\n\t\t\tdatasets['data'] = data2;\r\n\r\n\t\t\tlet lineSet = {\r\n\t\t\t\ttype: 'line',\r\n\t\t\t\tlabel: 'Transaction',\r\n\t\t\t\tdata: data,\r\n\t\t\t\tborderColor: '#FF0000',\r\n\t\t\t\tborderWidth: 1,\r\n\t\t\t\tfill: false,\r\n\t\t\t};\r\n\r\n\t\t\t// Add to data object\r\n\t\t\tlet dataDesc = {};\r\n\t\t\tdataDesc['labels'] = labels;\r\n\t\t\tdataDesc['datasets'] = Array(datasets, lineSet);\r\n\r\n\t\t\tlet chart = new Chart.Line(ctx, {\r\n\t\t\t\tdata: dataDesc,\r\n\t\t\t\toptions: {\r\n\t\t\t\t\tresponsive: false,\r\n\t\t\t\t\tresponsiveAnimationDuration: 0,\r\n\t\t\t\t\tscaleLineColor: \"rgba(0,0,0,0)\",\r\n\t\t\t\t\tscaleShowLabels: false,\r\n\t\t\t\t\tscaleShowGridLines: false,\r\n\t\t\t\t\tpointDot: false,\r\n\t\t\t\t\tdatasetFill: false,\r\n\t\t\t\t\t// Sadly if you set scaleFontSize to 0, chartjs crashes\r\n\t\t\t\t\t// Instead we'll set it as small as possible and make it transparent\r\n\t\t\t\t\tscaleFontSize: 1,\r\n\t\t\t\t\tscaleFontColor: \"rgba(0,0,0,0)\",\r\n\t\t\t\t\tlegend: {\r\n\t\t\t\t\t\tdisplay: false,\r\n\t\t\t\t\t},\r\n\t\t\t\t\tmaintainAspectRatio: true,\r\n\t\t\t\t\tscales: {\r\n\t\t\t\t\t\tyAxes: [{\r\n\t\t\t\t\t\t\tticks: {\r\n\t\t\t\t\t\t\t\tpadding: 0,\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}]\r\n\t\t\t\t\t},\r\n\t\t\t\t\tonClick: (event: MouseEvent, aChartElement) => {\r\n\t\t\t\t\t\tthis.clickOnChart(labels, event, aChartElement, this);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\t$self.prop('chart', chart);\r\n\r\n\t\t\t// $self.width('100%');\r\n\t\t\t// $self.height(256);\r\n\t\t});\r\n\t}\r\n\r\n\tclickOnChart(labels, event, aChart, context) {\r\n\t\t// console.log(labels);\r\n\t\t// console.log(event);\r\n\t\t// console.log(aChart);\r\n\t\t// console.log(context);\r\n\t\tlet any = aChart[0];\r\n\t\tlet index = any._index;\r\n\t\t// console.log(index);\r\n\t\tlet model = this.collection.getSorted()[index];\r\n\t\tlet id = model.get('id');\r\n\t\t// console.log(id);\r\n\t\t$(window).scrollTop($(\"*:contains('\" + id + \"'):last\").offset().top);\r\n\t\tdocument.location.hash = '#History/' + id;\r\n\t}\r\n\r\n}\r\n","import AppView from './AppView';\r\nimport Sync from './Sync/Sync';\r\nimport Expenses from \"./Expenses/Expenses\";\r\nimport {CatPage} from \"./CatPage\";\r\nimport {KeywordsView} from \"./Keyword/KeywordsView\";\r\nimport CategoryCollection from \"./Category/CategoryCollection\";\r\nimport RouterOptions = Backbone.RouterOptions;\r\nimport KeywordCollection from \"./Keyword/KeywordCollection\";\r\nimport SummaryView from \"./Summary/SummaryView\";\r\nimport HistoryView from \"./History/HistoryView\";\r\n// import Backbone from 'backbone';\r\n// const Router = Backbone.Router;\r\nconst Backbone = require('backbone');\r\nimport Controller from \"./Controller\";\r\nimport {CollectionController} from \"./CollectionController\";\r\nconst $ = require('jquery');\r\nconst _ = require('underscore');\r\n\r\nexport default class Workspace extends Backbone.Router {\r\n\r\n\troutes = {\r\n\t\t\"\":             \t\t\t\"AppView\",\r\n\t\t\":year/:month\":\t\t\t\t\"MonthSelect\",\r\n\t\t\":year/:month/:category\":\t\"MonthSelectCategory\",\r\n\t\t\"CatPage\":\t\t\t\t\t\"CatPage\",\r\n\t\t\"Sync\":         \t\t\t\"Sync\",\r\n\t\t\"Keywords\":     \t\t\t\"Keywords\",\r\n\t\t\"Summary\": \t    \t\t\t\"Summary\",\r\n\t\t\"History\": \t    \t\t\t\"History\",\r\n\t};\r\n\r\n\tmodel: Expenses;\r\n\tcategoryList: CategoryCollection;\r\n\tkeywords = new KeywordCollection();\r\n\r\n\tappPage: AppView;\r\n\tsyncPage: Sync;\r\n\tcatPage: CatPage;\r\n\tkeywordsPage: KeywordsView;\r\n\tsummaryPage: SummaryView;\r\n\thistoryPage: HistoryView;\r\n\r\n\tcurrentPage: Controller<any> | CollectionController<Expenses>;\r\n\r\n\tconstructor(options?: RouterOptions) {\r\n\t\tsuper(options);\r\n\t\t(<any>this)._bindRoutes();\r\n\t\tthis.model = new Expenses();\r\n\t\tthis.model.fetch();\r\n\t\tthis.categoryList = new CategoryCollection();\r\n\t\tthis.categoryList.setExpenses(this.model);\r\n\t}\r\n\r\n\tactivateMenu() {\r\n\t\tlet url = window.location;\r\n\t\t// var element = $('ul.nav a').filter(function() {\r\n\t\t//     return this.href == url;\r\n\t\t// }).addClass('active').parent().parent().addClass('in').parent();\r\n\t\tlet element = $('ul.nav#side-menu a')\r\n\t\t\t.removeClass('active')\r\n\t\t\t.filter(function() {\r\n\t\t\t\treturn this.href == url;\r\n\t\t\t})\r\n\t\t\t.addClass('active')\r\n\t\t\t.parent()\r\n\t\t\t.removeClass('in');\r\n\r\n\t\twhile (true) {\r\n\t\t\tif (element.is('li')) {\r\n\t\t\t\telement = element.parent().addClass('in').parent();\r\n\t\t\t} else {\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\thideCurrentPage() {\r\n\t\tif (this.currentPage) {\r\n\t\t\tthis.currentPage.hide();\r\n\t\t}\r\n\t}\r\n\r\n\tAppView() {\r\n\t\tconsole.warn('AppView');\r\n\t\tthis.activateMenu();\r\n\t\tthis.hideCurrentPage();\r\n\t\tif (!this.appPage) {\r\n\t\t\tthis.appPage = new AppView({\r\n\t\t\t\tcollection: this.model,\r\n\t\t\t}, this.categoryList);\r\n\t\t\tthis.appPage.table.keywords = this.keywords;\r\n\t\t}\r\n\t\tthis.appPage.show();\r\n\t\tthis.currentPage = this.appPage;\r\n\t}\r\n\r\n\tSync() {\r\n\t\tconsole.warn('Sync');\r\n\t\tthis.activateMenu();\r\n\t\tthis.hideCurrentPage();\r\n\t\tif (this.appPage) {\r\n\t\t\tthis.appPage.hide();\r\n\t\t} else {\r\n\t\t\t$('#MonthSelect').hide();\t// for consistency\r\n\t\t}\r\n\t\tif (!this.syncPage) {\r\n\t\t\tthis.syncPage = new Sync(this.model);\r\n\t\t\tthis.syncPage.router = this;\r\n\t\t}\r\n\t\tthis.syncPage.render();\r\n\t\tthis.currentPage = this.syncPage;\r\n\t}\r\n\r\n\tCatPage() {\r\n\t\tconsole.warn('CatPage');\r\n\t\tthis.activateMenu();\r\n\t\tthis.hideCurrentPage();\r\n\t\tif (!this.catPage) {\r\n\t\t\tthis.catPage = new CatPage(this.model, this.categoryList);\r\n\t\t}\r\n\t\tthis.catPage.render();\r\n\t\tthis.currentPage = this.catPage;\r\n\t}\r\n\r\n\tKeywords() {\r\n\t\tconsole.warn('Keywords');\r\n\t\tthis.activateMenu();\r\n\t\tthis.hideCurrentPage();\r\n\t\tif (!this.keywordsPage) {\r\n\t\t\tthis.keywordsPage = new KeywordsView();\r\n\t\t\tthis.keywordsPage.keywords = this.keywords;\r\n\t\t}\r\n\t\tthis.keywordsPage.render();\r\n\t\tthis.currentPage = this.keywordsPage;\r\n\t}\r\n\r\n\tMonthSelect(year, month) {\r\n\t\tconsole.warn('MonthSelect', year, month);\r\n\t\tif (parseInt(year) && parseInt(month)) {\r\n\t\t\tthis.AppView();\r\n\t\t\tthis.appPage.ms.setYearMonth(year, month);\r\n\t\t}\r\n\t}\r\n\r\n\tMonthSelectCategory(year, month, category) {\r\n\t\tconsole.warn('MonthSelectCategory', year, month, category);\r\n\t\tif (parseInt(year) && parseInt(month)) {\r\n\t\t\tthis.AppView();\r\n\t\t\tthis.appPage.ms.setYearMonth(year, month);\r\n\t\t\tlet cat = this.categoryList.findWhere({catName: category});\r\n\t\t\tconsole.log('MonthSelectCategory cat', cat);\r\n\t\t\tthis.appPage.collection.filterByCategory(cat);\r\n\t\t\tthis.appPage.collection.trigger('change');\t// slow!\r\n\t\t}\r\n\t}\r\n\r\n\tSummary() {\r\n\t\tconsole.log('Summary');\r\n\t\tthis.activateMenu();\r\n\t\tthis.hideCurrentPage();\r\n\t\tif (!this.summaryPage) {\r\n\t\t\tthis.summaryPage = new SummaryView({\r\n\t\t\t\tcollection: this.categoryList\r\n\t\t\t}, this.model);\r\n\t\t}\r\n\t\t$('#pieChart').hide();\r\n\t\t$('#categories').hide();\r\n\t\tthis.summaryPage.render();\r\n\t\tthis.currentPage = this.summaryPage;\r\n\t}\r\n\r\n\tHistory() {\r\n\t\tconsole.log('History');\r\n\t\tthis.activateMenu();\r\n\t\tthis.hideCurrentPage();\r\n\t\tif (!this.historyPage) {\r\n\t\t\tthis.historyPage = new HistoryView({\r\n\t\t\t\tcollection: this.model\r\n\t\t\t});\r\n\t\t}\r\n\t\t$('#pieChart').hide();\r\n\t\t$('#categories').hide();\r\n\t\tthis.historyPage.render();\r\n\t\tthis.currentPage = this.historyPage;\r\n\t}\r\n\r\n}\r\n","import Workspace from \"./Workspace\";\r\nconst _ = require('underscore');\r\nconst Backbone = require('backbone');\r\n\r\ninterface Window {\r\n\t__backboneAgent: any;\r\n}\r\ndeclare let window: Window;\r\n\r\nif (window.__backboneAgent) {\r\n\twindow.__backboneAgent.handleBackbone(Backbone);\r\n}\r\nconst $ = require('jquery');\r\n// const _ = require('underscore');\r\n\r\nexport function asyncLoop(arr: Array<any>, callback: Function, done?: Function) {\r\n\t(function loop(i) {\r\n\t\t//callback when the loop goes on\r\n\t\tcallback(arr[i], i, arr.length);\r\n\r\n\t\t//the condition\r\n\t\tif (i < arr.length) {\r\n\t\t\tsetTimeout(function() {\r\n\t\t\t\tloop(++i)\r\n\t\t\t}, 0); //rerun when condition is true\r\n\t\t} else {\r\n\t\t\tif (done) {\r\n\t\t\t\t//callback when the loop ends\r\n\t\t\t\tdone();\r\n\t\t\t}\r\n\t\t}\r\n\t}(0));                                         //start with 0\r\n}\r\n\r\nexport function debug(name, ...args) {\r\n\tconsole.warn(typeof name, \":\", ...args);\r\n}\r\n\r\nclass Umsaetze {\r\n\r\n\trouter: Workspace;\r\n\r\n\tconstructor() {\r\n\t\tthis.router = new Workspace();\r\n\t\t// console.log(ws);\r\n\r\n\t\tconst ok = Backbone.history.start({\r\n\t\t\troot: '/umsaetze/docs/web/'\r\n\t\t});\r\n\t\tconsole.log('history.start', ok);\r\n\t\tif (!ok) {\r\n\t\t\tconsole.log(Backbone.history.routes);\r\n\t\t}\r\n\r\n\t\tthis.inlineEdit();\r\n\t\tthis.tour();\r\n\t\tconsole.log('Umsaetze.constructor() done');\r\n\t}\r\n\r\n\tinlineEdit() {\r\n\t\t$(document).on('click', '.inlineEdit span', (event) => {\r\n\t\t\tlet span = $(event.target);\r\n\t\t\tlet container = span.parent();\r\n\t\t\tlet input = container.find('input').show();\r\n\t\t\tspan.hide();\r\n\t\t\tinput.focus().val(span.text().trim());\r\n\t\t\tinput.keyup((event) => {\r\n\t\t\t\tconsole.log(event.key);\r\n\t\t\t\tif (event.keyCode === 13) {\r\n\t\t\t\t\t$(event.target).blur();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tinput.blur((event) => {\r\n\t\t\t\tspan.html(input.val().trim());\r\n\t\t\t\tinput.hide();\r\n\t\t\t\tspan.show();\r\n\t\t\t\tlet callback = container.data('callback');\r\n\t\t\t\tif (typeof callback == 'function') {\r\n\t\t\t\t\tcallback(event, container, container.text().trim());\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n\ttour() {\r\n\t\tconst Tour = require('bootstrap-tour');\r\n\t\tlet tour = new Tour({\r\n\t\t\tsteps: [\r\n\t\t\t\t{\r\n\t\t\t\t\telement: \"#app\",\r\n\t\t\t\t\ttitle: \"Let me show you how it works\",\r\n\t\t\t\t\tcontent: \"Here you will see all your expenses in a selected month.\"\r\n\t\t\t\t},\r\n\t\t\t]});\r\n\r\n\t\tsetTimeout(() => {\r\n\t\t\t// Initialize the tour\r\n\t\t\t// tour.init();\r\n\t\t\t// Start the tour\r\n\t\t\t// tour.start();\r\n\t\t}, 5);\r\n\t}\r\n\r\n}\r\n\r\n$(function() {\r\n\tsetTimeout(() => {\r\n\t\tnew Umsaetze();\r\n\t}, 1*1000);\r\n});\r\n\r\n// only run this once\r\n// import ImportKeywords from './ImportKeywords';\r\n// let i = new ImportKeywords();\r\n"],"names":["_","Backbone","$","Umsaetze","accounting","elapse","debug","toastr","asyncLoop","object","Chart","Handlebars"],"mappings":";;;;;;;;;AACe;IAMd,iBAAY,UAAmB;QAC9B,IAAI,CAAC,UAAU,CAAC,IAAI,EAAE;YACrB,MAAM,IAAI,KAAK,CAAC,oBAAoB,CAAC,CAAC;SACtC;QACD,IAAI,CAAC,IAAI,GAAG,UAAU,CAAC,IAAI,CAAC;QAC5B,IAAI,CAAC,UAAU,CAAC,QAAQ,EAAE;YACzB,MAAM,IAAI,KAAK,CAAC,oBAAoB,CAAC,CAAC;SACtC;QACD,IAAI,CAAC,QAAQ,GAAG,UAAU,CAAC,QAAQ,CAAC;KACpC;IAEF,cAAC;CAAA;;ACjBD,IAAMA,GAAC,GAAG,OAAO,CAAC,YAAY,CAAC,CAAC;AAChC,IAAMC,UAAQ,GAAG,OAAO,CAAC,UAAU,CAAC,CAAC;AAOrC,IAAI,MAAM,CAAC,eAAe,EAAE;IAC3B,MAAM,CAAC,eAAe,CAAC,cAAc,CAACA,UAAQ,CAAC,CAAC;CAChD;AACD,IAAMC,GAAC,GAAG,OAAO,CAAC,QAAQ,CAAC,CAAC;AAG5B,qBAA0B,GAAe,EAAE,QAAkB,EAAE,IAAe;IAC7E,CAAC,cAAc,CAAC;QAEf,QAAQ,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,CAAC,EAAE,GAAG,CAAC,MAAM,CAAC,CAAC;QAGhC,IAAI,CAAC,GAAG,GAAG,CAAC,MAAM,EAAE;YACnB,UAAU,CAAC;gBACV,IAAI,CAAC,EAAE,CAAC,CAAC,CAAA;aACT,EAAE,CAAC,CAAC,CAAC;SACN;aAAM;YACN,IAAI,IAAI,EAAE;gBAET,IAAI,EAAE,CAAC;aACP;SACD;KACD,CAAC,CAAC,CAAC,EAAE;CACN;AAED,iBAAsB,IAAI;IAAE,cAAO;SAAP,UAAO,EAAP,qBAAO,EAAP,IAAO;QAAP,6BAAO;;IAClC,OAAO,CAAC,IAAI,OAAZ,OAAO,GAAM,OAAO,IAAI,EAAE,GAAG,SAAK,IAAI,GAAE;CACxC;AAED;IAIC;QACC,IAAI,CAAC,MAAM,GAAG,IAAI,SAAS,EAAE,CAAC;QAG9B,IAAM,EAAE,GAAGD,UAAQ,CAAC,OAAO,CAAC,KAAK,CAAC;YACjC,IAAI,EAAE,qBAAqB;SAC3B,CAAC,CAAC;QACH,OAAO,CAAC,GAAG,CAAC,eAAe,EAAE,EAAE,CAAC,CAAC;QACjC,IAAI,CAAC,EAAE,EAAE;YACR,OAAO,CAAC,GAAG,CAACA,UAAQ,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC;SACrC;QAED,IAAI,CAAC,UAAU,EAAE,CAAC;QAClB,IAAI,CAAC,IAAI,EAAE,CAAC;QACZ,OAAO,CAAC,GAAG,CAAC,6BAA6B,CAAC,CAAC;KAC3C;IAED,6BAAU,GAAV;QACCC,GAAC,CAAC,QAAQ,CAAC,CAAC,EAAE,CAAC,OAAO,EAAE,kBAAkB,EAAE,UAAC,KAAK;YACjD,IAAI,IAAI,GAAGA,GAAC,CAAC,KAAK,CAAC,MAAM,CAAC,CAAC;YAC3B,IAAI,SAAS,GAAG,IAAI,CAAC,MAAM,EAAE,CAAC;YAC9B,IAAI,KAAK,GAAG,SAAS,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC,IAAI,EAAE,CAAC;YAC3C,IAAI,CAAC,IAAI,EAAE,CAAC;YACZ,KAAK,CAAC,KAAK,EAAE,CAAC,GAAG,CAAC,IAAI,CAAC,IAAI,EAAE,CAAC,IAAI,EAAE,CAAC,CAAC;YACtC,KAAK,CAAC,KAAK,CAAC,UAAC,KAAK;gBACjB,OAAO,CAAC,GAAG,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;gBACvB,IAAI,KAAK,CAAC,OAAO,KAAK,EAAE,EAAE;oBACzBA,GAAC,CAAC,KAAK,CAAC,MAAM,CAAC,CAAC,IAAI,EAAE,CAAC;iBACvB;aACD,CAAC,CAAC;YACH,KAAK,CAAC,IAAI,CAAC,UAAC,KAAK;gBAChB,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,GAAG,EAAE,CAAC,IAAI,EAAE,CAAC,CAAC;gBAC9B,KAAK,CAAC,IAAI,EAAE,CAAC;gBACb,IAAI,CAAC,IAAI,EAAE,CAAC;gBACZ,IAAI,QAAQ,GAAG,SAAS,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;gBAC1C,IAAI,OAAO,QAAQ,IAAI,UAAU,EAAE;oBAClC,QAAQ,CAAC,KAAK,EAAE,SAAS,EAAE,SAAS,CAAC,IAAI,EAAE,CAAC,IAAI,EAAE,CAAC,CAAC;iBACpD;aACD,CAAC,CAAC;SACH,CAAC,CAAC;KACH;IAED,uBAAI,GAAJ;QACC,IAAM,IAAI,GAAG,OAAO,CAAC,gBAAgB,CAAC,CAAC;QACvC,IAAI,IAAI,GAAG,IAAI,IAAI,CAAC;YACnB,KAAK,EAAE;gBACN;oBACC,OAAO,EAAE,MAAM;oBACf,KAAK,EAAE,8BAA8B;oBACrC,OAAO,EAAE,0DAA0D;iBACnE;aACD;SAAC,CAAC,CAAC;QAEL,UAAU,CAAC;SAKV,EAAE,CAAC,CAAC,CAAC;KACN;IAEF,eAAC;CAAA,IAAA;AAEDA,GAAC,CAAC;IACD,UAAU,CAAC;QACV,IAAIC,UAAQ,EAAE,CAAC;KACf,EAAE,CAAC,GAAC,IAAI,CAAC,CAAC;CACX,CAAC,CAAC;;AC3GH,IAAMH,GAAC,GAAG,OAAO,CAAC,YAAY,CAAC,CAAC;AAChC,IAAM,WAAW,GAAG,OAAO,CAAC,yBAAyB,CAAC,CAAC;AAExC;IAAwB,6BAAU;IAIhD,mBAAY,IAAiB;QAA7B,YACC,iBAAO,SAOP;QANA,IAAI,IAAI,EAAE;YAET,IAAI,CAAC,OAAO,CAAC,UAAC,EAAE,EAAE,CAAC;gBAClB,KAAI,CAAC,CAAC,CAAC,GAAG,EAAE,CAAC;aACb,CAAC,CAAC;SACH;;KACD;IAID,2BAAO,GAAP,UAAQ,QAAQ;QAEf,IAAI,WAAW,GAAG,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC;QACtD,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,WAAW,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;YAC5C,IAAI,GAAG,GAAG,WAAW,CAAC,CAAC,CAAC,CAAC;YACzB,IAAI,GAAG,GAAG,IAAI,CAAC,GAAG,CAAC,CAAC;YACpB,IAAI,IAAI,CAAC,SAAS,CAAC,GAAG,CAAC,EAAE;gBACxB,IAAI,EAAE,GAAG,QAAQ,CAAC,GAAG,EAAE,QAAQ,CAAC,GAAG,CAAC,CAAC,CAAC;gBACtC,IAAI,EAAE,KAAK,KAAK,EAAE;oBACjB,MAAM;iBACN;aACD;SACD;KACD;IAED,6BAAS,GAAT,UAAU,MAAM;QACf,IAAI,YAAY,GAAG,MAAM,IAAI,MAAM,CAAC,QAAQ,EAAE,CAAC;QAC/C,OAAO,CAACA,GAAC,CAAC,OAAO,CAAC,MAAM,CAAC,IAAI,CAAC,YAAY,GAAG,UAAU,CAAC,YAAY,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC;KAChF;IAED,0BAAM,GAAN,UAAQ,KAAK;QACZ,OAAO,IAAI,CAAC,MAAM,IAAI,KAAK,CAAC,MAAM;YACjC,IAAI,CAAC,KAAK,CAAE,UAAS,MAAM,EAAC,CAAC,IAAI,OAAO,MAAM,IAAI,KAAK,CAAC,CAAC,CAAC,CAAA,EAAE,CAAE,CAAA;KAC/D;IAED,sBAAI,6BAAM;aAAV;YACC,IAAI,GAAG,GAAG,CAAC,CAAC;YACZ,KAAK,IAAI,CAAC,IAAI,IAAI,EAAE;gBACnB,IAAI,IAAI,CAAC,SAAS,CAAC,CAAC,CAAC,EAAE;oBACtB,GAAG,EAAE,CAAC;iBACN;aACD;YACD,OAAO,GAAG,CAAC;SACX;aAED,UAAW,GAAG;YACb,IAAI,CAAC,GAAG,GAAG,GAAG,CAAC;SACf;;;OAJA;IAWD,wBAAI,GAAJ;QAAA,iBAKC;QAJA,OAAO,IAAI,CAAC,IAAI,CAAC,UAAC,CAAC,EAAC,CAAC;YACpB,OAAA,KAAI,CAAC,MAAM,CAAC,UAAA,CAAC,IAAI,OAAA,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,GAAA,CAAC,CAAC,MAAM;kBAClC,KAAI,CAAC,MAAM,CAAC,UAAA,CAAC,IAAI,OAAA,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,GAAA,CAAC,CAAC,MAAM;SAAA,CACtC,CAAC,GAAG,EAAE,CAAC;KACR;IAEF,gBAAC;CAAA,CAnEsC,KAAK;;ACL5C,IAAMI,YAAU,GAAG,OAAO,CAAC,eAAe,CAAC,CAAC;AAC5C,IAAMJ,GAAC,GAAG,OAAO,CAAC,YAAY,CAAC,CAAC;AAEhC,qBAA4B,MAAc;IACzC,IAAIA,GAAC,CAAC,WAAW,CAAC,MAAM,CAAC;QAAE,OAAO,GAAG,CAAC;IACtC,IAAI,KAAK,GAAGI,YAAU,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC;IACxC,IAAI,QAAQ,GAAG,MAAM,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC;IACnC,IAAI,QAAQ,GAAG,CAAC,CAAC,EAAE;QAClB,IAAI,MAAM,GAAG,MAAM,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC;QACjC,IAAI,MAAM,GAAG,CAAC,CAAC,IAAI,QAAQ,GAAG,MAAM,EAAE;YACrC,IAAI,WAAW,GAAGA,YAAU,CAAC,QAAQ,CAAC,MAAM,EAAE,GAAG,CAAC,CAAC;YACnD,IAAI,IAAI,CAAC,GAAG,CAAC,WAAW,CAAC,GAAG,IAAI,CAAC,GAAG,CAAC,KAAK,CAAC,EAAE;gBAC5C,KAAK,GAAG,WAAW,CAAC;aACpB;SACD;aAAM;YAEN,KAAK,GAAGA,YAAU,CAAC,QAAQ,CAAC,MAAM,EAAE,GAAG,CAAC,CAAC;SACzC;KACD;IACD,OAAO,KAAK,CAAC;CACb;AAMD,MAAM,CAAC,SAAS,CAAC,KAAK,GAAG,UAAS,GAAW,EAAE,GAAW;IACzD,OAAO,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,GAAG,CAAC,IAAI,EAAE,GAAG,CAAC,EAAE,GAAG,CAAC,CAAC;CAC1C,CAAC;;ACxBF,IAAMJ,GAAC,GAAG,OAAO,CAAC,YAAY,CAAC,CAAC;AAChC,IAAM,UAAU,GAAG,OAAO,CAAC,eAAe,CAAC,CAAC;AAE5C,OAAO,CAAC,gBAAgB,CAAC,CAAC;AAC1B,AAEe;IAAkB,uBAAS;IAKzC,aAAY,OAAQ;eACnB,kBAAM,OAAO,CAAC;KACd;IAED,kBAAI,GAAJ;QACC,IAAI,IAAI,GAAG,IAAI,GAAG,EAAE,CAAC;QACrB,IAAI,CAAC,OAAO,CAAC,UAAC,EAAE,EAAE,CAAC;YAClB,EAAE,GAAG,CAAC,EAAE,IAAI,EAAE,EAAE,IAAI,EAAE,CAAC;YACvB,IAAI,EAAE,CAAC,MAAM,EAAE;gBACd,IAAI,CAAC,CAAC,CAAC,GAAG,EAAE,CAAC;aACb;SACD,CAAC,CAAC;QACH,OAAO,IAAI,CAAC;KACZ;IAED,yBAAW,GAAX;QACC,IAAI,KAAK,GAAG,EAAE,CAAC;QACf,IAAI,CAAC,OAAO,CAAC,UAAC,EAAO;YAGpB,IAAI,KAAK,GAAG,WAAW,CAAC,EAAE,CAAC,CAAC;YAE5B,IAAI,IAAI,GAAG,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,CAAC;YAC1B,IAAI,MAAM,GAAG,CAAC,CAAC,IAAI,IAAI,EAAE,CAAC,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC,CAAC;YAC7C,IAAI,OAAO,GAAGA,GAAC,CAAC,MAAM,CAAC,EAAE,CAAC;mBACtBA,GAAC,CAAC,WAAW,CAAC,EAAE,CAAC;mBACjB,EAAE,IAAI,EAAE,CAAC;YACb,IAAI,MAAM,GAAG,CAAC,CAAC;YACf,IAAIA,GAAC,CAAC,QAAQ,CAAC,EAAE,CAAC,EAAE;gBACnB,MAAM,GAAG,EAAE,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,MAAM,GAAG,CAAC,CAAC;aAClC;YACD,IAAI,YAAY,GAAG,CAAC,EAAE,IAAI,EAAE,EAAE,OAAO,CAAC,KAAK,EAAE,EAAE,CAAC,CAAC,IAAI,EAAE,CAAC;YACxD,IAAI,WAAW,GAAG,cAAc,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC;YACpD,IAAI,KAAK,IAAI,CAAC,MAAM,IAAI,MAAM,IAAI,CAAC,IAAI,WAAW,EAAE;gBACnD,KAAK,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;aACrB;iBAAM,IAAI,MAAM,EAAE;gBAClB,KAAK,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;aACnB;iBAAM,IAAI,OAAO,EAAE;gBACnB,KAAK,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;aACnB;iBAAM;gBACN,KAAK,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;aACrB;SACD,CAAC,CAAC;QAEH,OAAO,IAAI,GAAG,CAAC,KAAK,CAAC,CAAC;KACtB;IAEM,QAAI,GAAX,UAAY,CAAC,EAAE,CAAC,EAAE,CAAE;QACnB,OAAO,CAAC,GAAG,CAAC,KAAK,EAAE,CAAC,CAAC,MAAM,EAAE,CAAC,CAAC,MAAM,EAAE,CAAC,GAAG,CAAC,CAAC,MAAM,GAAG,EAAE,CAAC,CAAC;QAC1D,IAAI,MAAM,GAAG,EAAE,CAAC;QAChB,CAAC,CAAC,OAAO,CAAC,UAAC,EAAU,EAAE,CAAS;YAC/B,EAAE,GAAG,EAAE,IAAI,EAAE,CAAC;YACd,IAAI,EAAE,GAAG,CAAC,CAAC,CAAC,CAAC,IAAI,EAAE,CAAC;YACpB,IAAI,EAAE,GAAG,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,IAAI,EAAE,GAAG,EAAE,CAAC;YAC7B,EAAE,GAAG,GAAG,CAAC,KAAK,CAAC,EAAE,EAAE,MAAM,CAAC,CAAC;YAC3B,EAAE,GAAG,GAAG,CAAC,KAAK,CAAC,EAAE,EAAE,MAAM,CAAC,CAAC;YAC3B,EAAE,GAAG,GAAG,CAAC,KAAK,CAAC,EAAE,EAAE,MAAM,CAAC,CAAC;YAC3B,OAAO,CAAC,GAAG,CAAC,EAAE,EAAE,IAAI,EAAE,EAAE,EAAE,IAAI,EAAE,EAAE,CAAC,CAAC;SACpC,CAAC,CAAC;KACH;IAEM,SAAK,GAAZ,UAAa,EAAE,EAAE,MAAc;QAC9B,EAAE,GAAG,EAAE,CAAC,OAAO,CAAC,iBAAiB,EAAE,GAAG,CAAC,CAAC;QACxC,EAAE,GAAG,EAAE,CAAC,MAAM,CAAC,CAAC,EAAE,MAAM,CAAC,CAAC;QAC1B,IAAI,aAAa,GAAG,MAAM,GAAG,EAAE,CAAC,MAAM,CAAC;QACvC,IAAI,OAAO,GAAG,GAAG,CAAC,MAAM,CAAC,aAAa,CAAC,CAAC;QACxC,OAAO,EAAE,GAAG,OAAO,CAAC;KACpB;IAED,4BAAc,GAAd,UAAe,IAAW;QAA1B,iBAkBC;QAjBA,AACA,IAAI,QAAQ,GAAG,IAAI,CAAC,MAAM,CAAC,UAAC,GAAQ,EAAE,CAAS;YAC9C,IAAI,QAAQ,GAAG,GAAG,CAAC,WAAW,EAAE,CAAC;YACjC,IAAI,CAAC,GAAC,CAAC,IAAI,CAAC,EAAE;gBACb,GAAG,CAAC,IAAI,CAAC,GAAG,EAAE,QAAQ,EAAE,KAAI,CAAC,CAAC;aAC9B;YACD,IAAI,KAAK,GAAG,QAAQ,CAAC,OAAO,CAAC,KAAI,CAAC,CAAC;YACnC,IAAI,YAAY,GAAG,QAAQ,CAAC,cAAc,CAAC,KAAI,CAAC,CAAC;YACjD,OAAO,CAAC,GAAG,CAAC,CAAC,GAAC,CAAC,EAAE,KAAK,EAAE,GAAG,EAAE,KAAI,CAAC,MAAM,EAAE,GAAG,EAAE,YAAY,EAAE,GAAG,EAAE,GAAG,CAAC,MAAM,CAAC,CAAC;YAE9E,IAAI,WAAW,GAAsB,YAAY,IAAI,EAAE,CAAC;YACxD,IAAI,UAAU,GAAG,GAAG,CAAC,MAAM,IAAI,KAAI,CAAC,MAAM,CAAC;YAC3C,IAAI,OAAO,GAAwB,WAAW,IAAI,UAAU,CAAC;YAC7D,AACA,OAAO,OAAO,CAAC;SACf,CAAC,CAAC;QACH,OAAO,IAAI,KAAK,CAAC,QAAQ,CAAC,CAAC;KAC3B;IAED,gCAAkB,GAAlB,UAAmB,OAAY,EAAE,KAAa;QAC7C,IAAI,MAAM,GAAG,IAAI,GAAG,EAAE,CAAC;QAEvB,IAAI,OAAO,GAAG,EAAE,CAAC;QACjB,IAAI,CAAC,OAAO,CAAC,UAAC,EAAE,EAAE,CAAC;YAClB,IAAI,EAAE,IAAI,MAAM,IAAI,CAAC,MAAM,CAAC,IAAI,EAAE;gBACjC,MAAM,CAAC,IAAI,GAAG,OAAO,CAAC,CAAC,CAAC,CAAC;aACzB;iBAAM,IAAI,EAAE,IAAI,QAAQ,IAAI,CAAC,MAAM,CAAC,MAAM,EAAE;gBAC5C,MAAM,CAAC,MAAM,GAAG,OAAO,CAAC,CAAC,CAAC,CAAC;aAC3B;iBAAM,IAAI,EAAE,IAAI,QAAQ,EAAE;gBAC1B,OAAO,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,IAAI,EAAE,CAAC,CAAC;aAChC;SACD,CAAC,CAAC;QAKH,MAAM,CAAC,IAAI,GAAG,OAAO,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;QAEhC,AAOA,OAAO,MAAM,CAAC;KACd;IAED,qBAAO,GAAP,UAAQ,EAAiB;QACxB,IAAI,OAAO,GAAG,CAAC,CAAC;QAChB,IAAI,CAAC,OAAO,CAAC,UAAC,EAAE,EAAE,CAAC;YAClB,IAAI,EAAE,GAAG,EAAE,CAAC,CAAC,CAAC,CAAC;YACf,OAAO,IAAI,EAAE,IAAI,EAAE,GAAG,CAAC,GAAG,CAAC,CAAC;SAC5B,CAAC,CAAC;QACH,OAAO,OAAO,CAAC;KACf;IAED,4BAAc,GAAd,UAAe,EAAiB;QAC/B,IAAI,OAAO,GAAG,IAAI,CAAC,OAAO,CAAC,EAAE,CAAC,CAAC;QAC/B,OAAO,OAAO,GAAG,IAAI,CAAC,MAAM,GAAG,GAAG,CAAC;KACnC;IAED,uBAAS,GAAT;QACC,OAAO,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,CAAC,CAAC;KACxC;IAEF,UAAC;CAAA,CA7IgC,SAAS;;ACP1C,IAAMA,GAAC,GAAG,OAAO,CAAC,YAAY,CAAC,CAAC;AAEjB;IAAoB,yBAAS;IAE3C,eAAY,IAAiB;QAA7B,YACC,iBAAO,SAOP;QANA,IAAI,IAAI,EAAE;YAET,IAAI,CAAC,OAAO,CAAC,UAAC,EAAE,EAAE,CAAC;gBAClB,KAAI,CAAC,CAAC,CAAC,GAAG,IAAI,GAAG,CAAC,EAAE,CAAC,CAAC;aACtB,CAAC,CAAC;SACH;;KACD;IAEM,cAAQ,GAAf,UAAgB,IAAY;QAC3B,IAAI,IAAI,GAAG,IAAI,KAAK,EAAE,CAAC;QACvB,IAAI,KAAK,GAAG,IAAI,CAAC,gBAAgB,CAAC,IAAI,CAAC,CAAC;QACxC,KAAK,CAAC,OAAO,CAAC,UAAC,GAAG,EAAE,CAAC;YACpB,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;SACf,CAAC,CAAC;QACH,OAAO,IAAI,CAAC;KACZ;IAED,gCAAgB,GAAhB,UAAiB,IAAY;QAC5B,IAAI,MAAM,GAAG,KAAK,CAAC,UAAU,CAAC,IAAI,EAAE,GAAG,CAAC,CAAC;QACzC,IAAI,MAAM,GAAG,KAAK,CAAC,UAAU,CAAC,IAAI,EAAE,GAAG,CAAC,CAAC;QAEzC,IAAI,KAAK,GAAG,EAAE,CAAC;QACf,IAAI,KAAK,GAAG,EAAE,CAAC;QACf,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,GAAG,IAAI,CAAC,GAAG,MAAM,CAAC,MAAM,IAAI,CAAC,GAAG,MAAM,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;YACvE,KAAK,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC;YAC7B,KAAK,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC;SAC7B;QAED,IAAI,IAAI,GAAG,KAAK,CAAC,MAAM,CAAC,UAAU,CAAC,EAAE,CAAC,IAAI,OAAO,CAAC,GAAG,CAAC,CAAC,EAAE,CAAC,CAAC;QAC3D,IAAI,IAAI,GAAG,KAAK,CAAC,MAAM,CAAC,UAAU,CAAC,EAAE,CAAC,IAAI,OAAO,CAAC,GAAG,CAAC,CAAC,EAAE,CAAC,CAAC;QAC3D,OAAO,CAAC,GAAG,CAAC,OAAO,EAAE,IAAI,EAAE,OAAO,EAAE,IAAI,CAAC,CAAC;QAC1C,IAAI,KAAK,CAAC;QACV,IAAI,IAAI,GAAG,IAAI,EAAE;YAChB,KAAK,GAAG,MAAM,CAAC;SACf;aAAM;YACN,KAAK,GAAG,MAAM,CAAC;SACf;QACD,OAAO,KAAK,CAAC;KACb;IASM,gBAAU,GAAjB,UAAmB,OAAO,EAAE,YAAY;QAGvC,YAAY,IAAI,YAAY,IAAI,GAAG,CAAC,CAAC;QAGrC,IAAI,UAAU,GAAG,IAAI,MAAM,EAGzB,KAAK,GAAG,YAAY,GAAG,iBAAiB;YAGxC,iCAAiC;YAGjC,SAAS,GAAG,YAAY,GAAG,YAAY,GAExC,IAAI,CACJ,CAAC;QAKF,IAAI,OAAO,GAAG,CAAC,EAAE,CAAC,CAAC;QAInB,IAAI,UAAU,GAAG,IAAI,CAAC;QAKtB,OAAO,UAAU,GAAG,UAAU,CAAC,IAAI,CAAE,OAAO,CAAE,EAAC;YAG9C,IAAI,mBAAmB,GAAG,UAAU,CAAE,CAAC,CAAE,CAAC;YAM1C,IACC,mBAAmB,CAAC,MAAM;gBAC1B,mBAAmB,KAAK,YACzB,EAAC;gBAIA,OAAO,CAAC,IAAI,CAAE,EAAE,CAAE,CAAC;aAEnB;YAED,IAAI,eAAe,SAAA,CAAC;YAKpB,IAAI,UAAU,CAAE,CAAC,CAAE,EAAC;gBAInB,eAAe,GAAG,UAAU,CAAE,CAAC,CAAE,CAAC,OAAO,CACxC,IAAI,MAAM,CAAE,MAAM,EAAE,GAAG,CAAE,EACzB,IAAI,CACJ,CAAC;aAEF;iBAAM;gBAGN,eAAe,GAAG,UAAU,CAAE,CAAC,CAAE,CAAC;aAElC;YAKD,OAAO,CAAE,OAAO,CAAC,MAAM,GAAG,CAAC,CAAE,CAAC,IAAI,CAAE,eAAe,CAAE,CAAC;SACtD;QAGD,QAAQ,OAAO,EAAG;KAClB;IAOD,oBAAI,GAAJ;QACC,IAAI,GAAG,GAAG,IAAI,CAAC,OAAO,EAAE,CAAC;QACzB,IAAI,UAAU,GAAG,IAAI,CAAC;QACtB,GAAG,CAAC,OAAO,CAAC,UAAC,GAAG,EAAE,CAAC;YAElB,IAAI,UAAU,IAAI,IAAI;mBAClB,GAAG,CAAC,MAAM,IAAI,GAAG,CAAC,CAAC,CAAC,IAAI,EAAE,EAAE;gBAC/B,UAAU,GAAG,CAAC,CAAC;gBACf,OAAO,CAAC,GAAG,CAAC,QAAQ,EAAE,UAAU,CAAC,CAAC;aAClC;SACD,CAAC,CAAC;QACH,IAAI,IAAI,GAAG,GAAG,CAAC,KAAK,CAAC,UAAU,CAAC,CAAC;QAEjC,IAAI,GAAG,IAAI,CAAC,OAAO,EAAE,CAAC;QACtB,OAAO,IAAI,KAAK,CAAC,IAAI,CAAC,CAAC;KACvB;IAOD,uBAAO,GAAP;QACC,IAAI,IAAI,GAAG,IAAI,KAAK,EAAE,CAAC;QACvB,IAAI,CAAC,OAAO,CAAC,UAAC,GAAQ,EAAE,CAAC;YACxB,IAAI,MAAM,GAAG,IAAI,GAAG,CAAC,GAAG,CAAC,CAAC;YAC1B,IAAI,UAAU,GAAG,MAAM,CAAC,IAAI,EAAE,CAAC;YAC/B,IAAI,UAAU,CAAC,MAAM,EAAE;gBACtB,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;aAClB;SACD,CAAC,CAAC;QACH,OAAO,IAAI,CAAC;KACZ;IAED,sCAAsB,GAAtB;QACC,IAAI,OAAO,GAAG,IAAI,KAAK,EAAE,CAAC;QAC1B,OAAO,CAAC,GAAG,CAAC,wBAAwB,EAAE,IAAI,CAAC,MAAM,CAAC,CAAC;QACnD,IAAI,IAAI,GAAG,CAAC,CAAC;QACb,IAAI,CAAC,OAAO,CAAC,UAAC,IAAI,EAAE,CAAC;YACpB,IAAI,GAAG,GAAQ,IAAI,GAAG,CAAC,IAAI,CAAC,CAAC;YAC7B,IAAI,KAAK,GAAG,GAAG,CAAC,WAAW,EAAE,CAAC;YAE9B,OAAO,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;YACpB,IAAI,EAAE,CAAC;YACP,IAAI,IAAI,GAAG,GAAG,EAAE;gBACf,OAAO,KAAK,CAAC;aACb;SACD,CAAC,CAAC;QACH,OAAO,OAAO,CAAC;KACf;IAED,gCAAgB,GAAhB;QACC,IAAI,OAAO,GAAG,IAAI,CAAC,MAAM,CAAC,UAAC,GAAG;YAC7B,IAAI,SAAS,GAAG,GAAG,CAAC,MAAM,CAAC,UAAA,IAAI;gBAC9B,OAAO,IAAI,IAAI,MAAM,CAAC;aACtB,CAAC,CAAC,MAAM,CAAC;YAEV,OAAO,SAAS,GAAG,GAAG,CAAC,MAAM,GAAG,CAAC,CAAC;SAClC,CAAC,CAAC;QACH,OAAO,IAAI,KAAK,CAAC,OAAO,CAAC,CAAC;KAC1B;IAED,yBAAS,GAAT;QACC,IAAI,IAAI,GAAG,EAAE,CAAC;QACd,IAAI,CAAC,OAAO,CAAC,UAAA,GAAG;YACf,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,SAAS,EAAE,CAAC,CAAC;SAC3B,CAAC,CAAC;QACH,OAAO,IAAI,CAAC;KACZ;IAED,8BAAc,GAAd;QACC,IAAI,IAAI,GAAG,EAAE,CAAC;QACd,IAAI,CAAC,OAAO,CAAC,UAAA,GAAG;YACf,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,MAAM,CAAC,GAAG,CAAC,SAAS,EAAE,CAAC,CAAC,CAAC;SAC1C,CAAC,CAAC;QACH,OAAO,IAAI,CAAC;KACZ;IAEF,YAAC;CAAA,CAzNkC,SAAS;;ACI5C,IAAMK,QAAM,GAAG,OAAO,CAAC,QAAQ,CAAC,CAAC;AACjCA,QAAM,CAAC,SAAS,CAAC;IAChB,KAAK,EAAE,IAAI;CACX,CAAC,CAAC;AACH,IAAMJ,UAAQ,GAAG,OAAO,CAAC,UAAU,CAAC,CAAC;AACrC,IAAMC,GAAC,GAAG,OAAO,CAAC,QAAQ,CAAC,CAAC;AAC5B,IAAMF,GAAC,GAAG,OAAO,CAAC,YAAY,CAAC,CAAC;AAChC,IAAM,UAAU,GAAG,OAAO,CAAC,YAAY,CAAC,CAAC;AAE1B;IAA2B,gCAAkB;IAY3D,sBAAY,OAAQ;QAApB,YACC,kBAAM,OAAO,CAAC,SAcd;QAnBD,cAAQ,GAAGA,GAAC,CAAC,QAAQ,CAACE,GAAC,CAAC,cAAc,CAAC,CAAC,IAAI,EAAE,CAAC,CAAC;QAM/C,OAAO,CAAC,GAAG,CAAC,KAAI,CAAC,QAAQ,CAAC,CAAC;QAG3B,IAAI,CAACA,GAAC,CAAC,eAAe,CAAC,CAAC,MAAM,EAAE;YAC/B,IAAI,QAAQ,GAAGF,GAAC,CAAC,QAAQ,CAACE,GAAC,CAAC,UAAU,CAAC,CAAC,IAAI,EAAE,CAAC,CAAC;YAChDA,GAAC,CAAC,MAAM,CAAC,CAAC,IAAI,CAAC,QAAQ,EAAE,CAAC,CAAC;SAC3B;QAED,KAAI,CAAC,UAAU,CAACA,GAAC,CAAC,eAAe,CAAC,CAAC,CAAC;QAIpC,KAAI,CAAC,EAAE,CAAC,KAAK,EAAEI,OAAK,CAAC,cAAc,CAAC,CAAC,CAAC;;KACtC;IAED,sCAAe,GAAf,UAAgB,IAAwB;QACvC,IAAI,CAAC,YAAY,GAAG,IAAI,CAAC;QACzB,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,YAAY,EAAE,QAAQ,EAAE,IAAI,CAAC,MAAM,CAAC,CAAC;KACxD;IAED,6BAAM,GAAN,UAAO,OAAa;QAApB,iBA6BC;QA5BA,IAAI,OAAO,IAAI,OAAO,CAAC,QAAQ,EAAE;YAChC,OAAO,CAAC,GAAG,CAAC,uBAAuB,CAAC,CAAC;YACrC,OAAO;SACP;QACDD,QAAM,CAAC,IAAI,CAAC,qBAAqB,CAAC,CAAC;QACnC,OAAO,CAAC,GAAG,CAAC,uBAAuB,EAAE,IAAI,CAAC,KAAK,CAAC,IAAI,EAAE,CAAC,CAAC;QAExD,IAAI,KAAK,GAAG,IAAI,CAAC,6BAA6B,EAAE,CAAC;QACjD,IAAI,IAAI,GAAG,EAAE,CAAC;QACd,KAAK,CAAC,OAAO,CAAC,UAAC,UAAkB;YAChC,IAAI,CAAC,IAAI,CAAC,KAAI,CAAC,QAAQ,CAAC,UAAU,CAAC,CAAC,CAAC;SACrC,CAAC,CAAC;QAEH,OAAO,CAAC,GAAG,CAAC,WAAW,EAAE,IAAI,CAAC,MAAM,EAAE,MAAM,CAAC,CAAC;QAC9C,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;QAG/BH,GAAC,CAAC,WAAW,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,WAAW,EAAE,CAAC,QAAQ,CAAC,YAAY,CAAC,CAAC,CAAC;QACrEA,GAAC,CAAC,WAAW,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,WAAW,EAAE,CAAC,QAAQ,CAAC,YAAY,CAAC,CAAC,CAAC;QACrEA,GAAC,CAAC,UAAU,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,eAAe,EAAE,CAAC,QAAQ,EAAE,CAAC,CAAC;QAE5D,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,QAAQ,EAAE,QAAQ,EAAE,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;QAC7D,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,SAAS,EAAE,SAAS,EAAE,IAAI,CAAC,iBAAiB,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;QACrE,IAAI,CAAC,GAAG,CAAC,GAAG,CAAC,OAAO,EAAE,cAAc,CAAC,CAAC,EAAE,CAAC,OAAO,EAAE,cAAc,EAAE,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;QAC7F,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,OAAO,EAAE,mBAAmB,EAAE,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;QAEnEG,QAAM,CAAC,OAAO,CAAC,qBAAqB,CAAC,CAAC;QACtC,OAAO,IAAI,CAAC;KACZ;IAED,oDAA6B,GAA7B;QAAA,iBAkBC;QAjBA,IAAI,OAAO,GAAG,IAAI,CAAC,KAAK,CAAC,UAAU,EAAE,CAAC;QACtC,IAAI,KAAK,GAAG,IAAI,KAAK,EAAE,CAAC;QACxBL,GAAC,CAAC,IAAI,CAAC,OAAO,EAAE,UAAC,WAAwB;YACxC,IAAI,UAAU,GAAG,WAAW,CAAC,MAAM,EAAE,CAAC;YACtC,UAAU,CAAC,KAAK,GAAG,WAAW,CAAC,OAAO,EAAE,CAAC,QAAQ,CAAC,YAAY,CAAC,CAAC;YAChE,UAAU,CAAC,QAAQ,GAAG,UAAU,CAAC,QAAQ,IAAI,SAAS;kBACnD,YAAY,GAAG,EAAE,CAAC;YACrB,UAAU,CAAC,eAAe,GAAG,KAAI,CAAC,kBAAkB,CAAC,WAAW,CAAC,CAAC;YAClE,UAAU,CAAC,UAAU,GAAG,KAAI,CAAC,YAAY,CAAC,WAAW,CAAC,WAAW,CAAC,GAAG,CAAC,UAAU,CAAC,CAAC,CAAC;YACnF,UAAU,CAAC,WAAW,GAAG,WAAW,CAAC,GAAG,CAAC,MAAM,CAAC,GAAG,SAAS,GAAG,EAAE,CAAC;YAClE,UAAU,CAAC,MAAM,GAAG,UAAU,CAAC,MAAM,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC;YAEjD,KAAK,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;SACvB,CAAC,CAAC;QAEH,KAAK,GAAGA,GAAC,CAAC,MAAM,CAAC,KAAK,EAAE,MAAM,CAAC,CAAC;QAChC,OAAO,KAAK,CAAC;KACb;IAMD,iCAAU,GAAV,UAAW,KAAK;QAEf,IAAI,OAAO,GAAGE,GAAC,CAAC,KAAK,CAAC,MAAM,CAAC,CAAC;QAG9B;YACC,IAAI,QAAM,GAAG,OAAO,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC,IAAI,EAAE,CAAC;YAC3C,OAAO,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC,MAAM,EAAE,CAAC;YAChC,IAAI,OAAO,GAAG,IAAI,CAAC,YAAY,CAAC,UAAU,EAAE,CAAC;YAE7CA,GAAC,CAAC,IAAI,CAAC,OAAO,EAAE,UAAC,GAAG,EAAE,KAAK;gBAC1B,IAAI,KAAK,IAAI,QAAM,EAAE;oBACpB,OAAO;yBACL,MAAM,CAACA,GAAC,CAAC,mBAAmB,CAAC;yBAC5B,IAAI,CAAC,OAAO,EAAE,KAAK,CAAC;yBACpB,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC;iBAChB;aACD,CAAC,CAAC;YACH,OAAO,CAAC,EAAE,CAAC,QAAQ,EAAE,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;SAClD;KACD;IAED,yCAAkB,GAAlB,UAAmB,WAAwB;QAC1C,IAAI,QAAQ,GAAG,WAAW,CAAC,GAAG,CAAC,UAAU,CAAC,CAAC;QAC3C,IAAI,QAAQ,GAAG,EAAE,CAAC;QAClB,IAAI,OAAO,GAAG,IAAI,CAAC,YAAY,CAAC,UAAU,EAAE,CAAC;QAE7CA,GAAC,CAAC,IAAI,CAAC,OAAO,EAAE,UAAC,GAAG,EAAE,KAAK;YAC1B,IAAI,KAAK,IAAI,QAAQ,EAAE;gBACtB,QAAQ,CAAC,IAAI,CAAC,mBAAmB,GAAG,KAAK,GAAG,WAAW,CAAC,CAAC;aACzD;iBAAM;gBACN,QAAQ,CAAC,IAAI,CAAC,UAAU,GAAG,KAAK,GAAG,WAAW,CAAC,CAAC;aAChD;SACD,CAAC,CAAC;QAEH,OAAO,QAAQ,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;KAC3B;IAED,kCAAW,GAAX,UAAY,KAAK;QAChB,OAAO,CAAC,GAAG,CAAC,aAAa,CAAC,CAAC;QAC3B,IAAI,OAAO,GAAGA,GAAC,CAAC,KAAK,CAAC,MAAM,CAAC,CAAC;QAE9B,IAAI,EAAE,GAAG,OAAO,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;QAE/C,IAAI,WAAW,GAAgB,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,EAAE,CAAC,CAAC;QAElD,IAAI,WAAW,EAAE;YAEhB,WAAW,CAAC,WAAW,CAAC,OAAO,CAAC,GAAG,EAAE,CAAC,CAAC;SAGvC;aAAM;YACN,OAAO,CAAC,KAAK,CAAC,sBAAsB,EAAE,EAAE,EAAE,WAAW,CAAC,CAAC;SACvD;KACD;IAED,wCAAiB,GAAjB,UAAkB,KAAiB;QAElC,IAAI,IAAI,GAAG,YAAY,CAAC,eAAe,EAAE,CAAC,IAAI,EAAE,CAAC;QACjD,IAAI,IAAI,EAAE;YAET,IAAI,YAAY,GAAGA,GAAC,CAAC,cAAc,CAAC,CAAC;YACrC,IAAI,CAAC,YAAY,CAAC,MAAM,EAAE;gBACzB,IAAI,QAAQ,GAAG,UAAU,CAAC,OAAO,CAACA,GAAC,CAAC,eAAe,CAAC,CAAC,IAAI,EAAE,CAAC,CAAC;gBAC7D,IAAI,QAAQ,GAAG,QAAQ,CAAC;oBACvB,OAAO,EAAE,IAAI,CAAC,YAAY,CAAC,UAAU,EAAE;iBACvC,CAAC,CAAC;gBACHA,GAAC,CAAC,MAAM,CAAC,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC;gBAC3B,YAAY,GAAGA,GAAC,CAAC,cAAc,CAAC,CAAC;gBACjC,OAAO,CAAC,GAAG,CAAC,YAAY,EAAE,KAAK,CAAC,OAAO,EAAE,KAAK,CAAC,OAAO,CAAC,CAAC;aACxD;YACD,IAAI,CAAC,QAAQ,CAAC,YAAY,EAAE,KAAK,CAAC,OAAO,EAAE,KAAK,CAAC,OAAO,EAAE,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,IAAI,EAAE,IAAI,CAAC,CAAC,CAAC;SAC7F;KACD;IAEM,4BAAe,GAAtB;QACC,IAAI,MAAM,CAAC,YAAY,EAAE;YACxB,OAAO,MAAM,CAAC,YAAY,EAAE,CAAC,QAAQ,EAAE,CAAC;SACxC;aAAM,IAAI,QAAQ,CAAC,SAAS,EAAE;YAC9B,OAAO,QAAQ,CAAC,SAAS,CAAC,WAAW,EAAE,CAAC,IAAI,CAAC;SAC7C;QACD,OAAO,EAAE,CAAC;KACV;IASD,+BAAQ,GAAR,UAAS,YAAY,EAAE,OAAO,EAAE,OAAO,EAAE,QAAQ;QAChD,IAAI,KAAK,GAAGA,GAAC,CAAC,YAAY,CAAC;aACzB,IAAI,EAAE;aACN,GAAG,CAAC;YACJ,QAAQ,EAAE,UAAU;YACpB,IAAI,EAAE,IAAI,CAAC,eAAe,CAAC,OAAO,EAAE,OAAO,EAAE,YAAY,EAAE,YAAY,CAAC;YACxE,GAAG,EAAE,IAAI,CAAC,eAAe,CAAC,OAAO,EAAE,QAAQ,EAAE,WAAW,EAAE,YAAY,CAAC;SACvE,CAAC;aACD,GAAG,CAAC,OAAO,CAAC;aACZ,EAAE,CAAC,OAAO,EAAE,GAAG,EAAE,UAAU,CAAC;YAC5B,IAAI,aAAa,GAAGA,GAAC,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC;YAChC,IAAI,aAAa,CAAC,MAAM,EAAE;gBACzB,KAAK,CAAC,IAAI,EAAE,CAAC;gBACb,QAAQ,CAAC,IAAI,CAAC,IAAI,EAAE,aAAa,CAAC,CAAC;aACnC;SACD,CAAC,CAAC;QAKJ,UAAU,CAAC;YACVA,GAAC,CAAC,MAAM,CAAC,CAAC,KAAK,CAAC;gBACfA,GAAC,CAAC,YAAY,CAAC,CAAC,IAAI,EAAE,CAAC;gBACvBA,GAAC,CAAC,MAAM,CAAC,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC;aACvB,CAAC,CAAC;SACH,EAAE,CAAC,CAAC,CAAC;KACN;IAED,sCAAe,GAAf,UAAgB,KAAK,EAAE,SAAS,EAAE,SAAS,EAAE,YAAY;QACxD,IAAI,GAAG,GAAGA,GAAC,CAAC,MAAM,CAAC,CAAC,SAAS,CAAC,EAAE,EAC/B,MAAM,GAAGA,GAAC,CAAC,MAAM,CAAC,CAAC,SAAS,CAAC,EAAE,EAC/B,IAAI,GAAGA,GAAC,CAAC,YAAY,CAAC,CAAC,SAAS,CAAC,EAAE,EACnC,QAAQ,GAAG,KAAK,GAAG,MAAM,CAAC;QAG3B,IAAI,KAAK,GAAG,IAAI,GAAG,GAAG,IAAI,IAAI,GAAG,KAAK;YACrC,QAAQ,IAAI,IAAI,CAAC;QAElB,OAAO,QAAQ,CAAC;KAChB;IAOD,kCAAW,GAAX,UAAY,IAAI,EAAE,IAAI;QACrB,IAAI,SAAS,GAAG,QAAQ,CAAC,IAAI,CAAC,SAAS,CAAC;QACxC,OAAO,CAAC,GAAG,CAAC,WAAW,EAAE,SAAS,CAAC,CAAC;QAEpC,IAAI,YAAY,GAAG,IAAI,CAAC,IAAI,EAAE,CAAC,IAAI,EAAE,CAAC;QACtC,OAAO,CAAC,GAAG,CAAC,IAAI,EAAE,OAAO,EAAE,YAAY,CAAC,CAAC;QACzC,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,IAAI,OAAO,CAAC;YAC7B,IAAI,EAAE,IAAI;YACV,QAAQ,EAAE,YAAY;SACtB,CAAC,CAAC,CAAC;QACJ,IAAI,CAAC,KAAK,CAAC,aAAa,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;QACxC,IAAI,CAAC,MAAM,EAAE,CAAC;QAEd,UAAU,CAAC;YACV,OAAO,CAAC,GAAG,CAAC,WAAW,EAAE,SAAS,CAAC,CAAC;YACpCA,GAAC,CAAC,MAAM,CAAC,CAAC,SAAS,CAAC,SAAS,CAAC,CAAC;SAC/B,EAAE,CAAC,CAAC,CAAC;KACN;IAED,gCAAS,GAAT,UAAU,KAAK;QACd,IAAI,MAAM,GAAGA,GAAC,CAAC,KAAK,CAAC,MAAM,CAAC,CAAC;QAC7B,IAAI,MAAM,GAAG,MAAM,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;QAClD,OAAO,CAAC,GAAG,CAAC,WAAW,EAAE,MAAM,CAAC,CAAC;QACjC,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC;QAC1B,IAAI,CAAC,KAAK,CAAC,OAAO,EAAE,CAAC;QACrB,IAAI,CAAC,MAAM,EAAE,CAAC;KACd;IAED,8BAAO,GAAP,UAAQ,KAAiB;QACxB,IAAI,QAAQ,GAAGA,GAAC,CAAC,KAAK,CAAC,MAAM,CAAC,CAAC;QAC/B,IAAI,EAAE,GAAG,QAAQ,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;QAChD,IAAI,WAAW,GAAG,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,EAAE,CAAC,CAAC;QAErC,IAAI,WAAW,EAAE;YAChB,WAAW,CAAC,GAAG,CAAC,MAAM,EAAE,IAAI,CAAC,CAAC;SAC9B;KACD;IAEF,mBAAC;CAAA,CAxQyCD,UAAQ,CAAC,IAAI;;ACZvD,IAAII,QAAM,GAAG,OAAO,CAAC,QAAQ,CAAC,CAAC;AAC/BA,QAAM,CAAC,SAAS,CAAC;IAChB,KAAK,EAAE,IAAI;CACX,CAAC,CAAC;AACH,IAAMJ,UAAQ,GAAG,OAAO,CAAC,UAAU,CAAC,CAAC;AACrC,IAAMD,GAAC,GAAG,OAAO,CAAC,YAAY,CAAC,CAAC;AAChC,IAAME,GAAC,GAAG,OAAO,CAAC,QAAQ,CAAC,CAAC;AAC5B,IAAM,KAAK,GAAG,OAAO,CAAC,UAAU,CAAC,CAAC;AAClC,AAEe;IAA2B,gCAAiC;IAU1E,sBAAY,OAAO;QAAnB,YACC,kBAAM,OAAO,CAAC,SAKd;QAVD,cAAQ,GAAGF,GAAC,CAAC,QAAQ,CAACE,GAAC,CAAC,mBAAmB,CAAC,CAAC,IAAI,EAAE,CAAC,CAAC;QAMpD,KAAI,CAAC,UAAU,CAACA,GAAC,CAAC,aAAa,CAAC,CAAC,CAAC;QAClC,KAAI,CAAC,QAAQ,CAAC,KAAI,CAAC,KAAK,EAAE,QAAQ,EAAE,KAAI,CAAC,MAAM,CAAC,CAAC;QACjD,KAAI,CAAC,GAAG,CAAC,EAAE,CAAC,OAAO,EAAE,oBAAoB,EAAE,KAAI,CAAC,gBAAgB,CAAC,IAAI,CAAC,KAAI,CAAC,CAAC,CAAC;QAC7E,KAAI,CAAC,EAAE,CAAC,KAAK,EAAEI,OAAK,CAAC,cAAc,CAAC,CAAC,CAAC;;KACtC;IAED,kCAAW,GAAX,UAAY,QAAQ;QACnB,IAAI,CAAC,QAAQ,GAAG,QAAQ,CAAC;QACzB,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,QAAQ,EAAE,QAAQ,EAAE,IAAI,CAAC,WAAW,CAAC,CAAC;KACzD;IAED,kCAAW,GAAX;QACC,OAAO,CAAC,IAAI,CAAC,0BAA0B,CAAC,CAAC;QACzC,IAAI,CAAC,KAAK,CAAC,yBAAyB,EAAE,CAAC;KAEvC;IAED,6BAAM,GAAN;QAAA,iBA8CC;QA7CAD,QAAM,CAAC,IAAI,CAAC,qBAAqB,CAAC,CAAC;QACnC,IAAI,aAAa,GAAG,IAAI,CAAC,KAAK,CAAC,MAAM,EAAE,CAAC;QAGxC,IAAI,SAAS,GAAGL,GAAC,CAAC,SAAS,CAAC,aAAa,EAAE;YAC1C,OAAO,EAAE,QAAQ;SACjB,CAAC,CAAC;QACH,aAAa,GAAGA,GAAC,CAAC,OAAO,CAAC,aAAa,EAAE,SAAS,CAAC,CAAC;QAEpD,IAAI,GAAG,GAAmBA,GAAC,CAAC,MAAM,CAAC,aAAa,EAC/C,UAAC,IAAI,EAAE,IAAmB;YAEzB,OAAO,IAAI,GAAG,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;SACpC,EAAE,CAAC,CAAC,CAAC;QAGP,aAAa,GAAGA,GAAC,CAAC,MAAM,CAAC,aAAa,EAAE,UAAC,EAAiB;YACzD,OAAO,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,MAAM,CAAC,CAAC;SAC3B,CAAC,CAAC,OAAO,EAAE,CAAC;QAEb,IAAI,OAAO,GAAG,EAAE,CAAC;QACjBA,GAAC,CAAC,IAAI,CAAC,aAAa,EAAE,UAAC,QAAuB;YAC7C,IAAI,KAAK,GAAG,IAAI,CAAC,KAAK,CACrB,GAAG,GAAG,IAAI,CAAC,GAAG,CAAC,QAAQ,CAAC,MAAM,CAAC,GAAG,IAAI,CAAC,GAAG,CAAC,GAAG,CAAC,CAC9C,GAAG,GAAG,CAAC;YAET,OAAO,CAAC,IAAI,CAAC,KAAI,CAAC,QAAQ,CACzBA,GAAC,CAAC,MAAM,CAAC,QAAQ,EAAE;gBAClB,KAAK,EAAE,KAAK;gBACZ,MAAM,EAAE,IAAI,CAAC,KAAK,CAAC,QAAQ,CAAC,MAAM,CAAC;gBACnC,IAAI,EAAE,QAAQ,CAAC,MAAM,IAAI,CAAC,GAAG,UAAU,GAAG,UAAU;aACpD,CAAC,CACF,CAAC,CAAC;SACH,CAAC,CAAC;QACH,IAAI,CAAC,CAAC,CAAC,cAAc,CAAC,CAAC,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;QAChD,IAAI,CAAC,SAAS,EAAE;YACf,SAAS,GAAG,EAAE,MAAM,EAAE,CAAC,EAAE,CAAC;SAC1B;QACD,IAAI,CAAC,CAAC,CAAC,SAAS,CAAC,CAAC,IAAI,CAAC,SAAS,CAAC,MAAM,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,CAAC;QACpD,IAAI,CAAC,CAAC,CAAC,QAAQ,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,CAAC;QAEtC,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC,CAAC;QAEjCK,QAAM,CAAC,OAAO,CAAC,qBAAqB,CAAC,CAAC;QACtC,OAAO,IAAI,CAAC;KACZ;IAMD,8BAAO,GAAP;QACC,OAAO,CAAC,GAAG,CAAC,sBAAsB,EAAE,IAAI,CAAC,KAAK,CAAC,IAAI,EAAE,CAAC,CAAC;QACvD,IAAI,IAAI,CAAC,KAAK,EAAE;YAGf,IAAI,CAAC,MAAM,EAAE,CAAC;SACd;aAAM;YACN,OAAO,CAAC,KAAK,CAAC,6CAA6C,CAAC,CAAC;SAC7D;KACD;IAED,mCAAY,GAAZ,UAAa,GAAG;QACf,IAAI,MAAM,GAAG,EAAE,CAAC;QAChB,IAAI,MAAM,GAAG,EAAE,CAAC;QAChB,IAAI,QAAQ,GAAG,EAAE,CAAC;QAClB,IAAI,CAAC,KAAK,CAAC,UAAU,GAAG,UAAU,EAAiB;YAClD,OAAO,CAAC,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,SAAS,EAAE,CAAC,CAAC;SACjC,CAAC;QACF,IAAI,CAAC,KAAK,CAAC,IAAI,EAAE,CAAC;QAElB,IAAI,IAAI,GAAG,CAAC,CAAC;QACb,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,UAAC,GAAkB;YAClC,IAAI,GAAG,CAAC,OAAO,EAAE,IAAI,QAAQ,EAAE;gBAC9B,IAAI,MAAM,GAAG,IAAI,CAAC,GAAG,CAAC,GAAG,CAAC,SAAS,EAAE,CAAC,CAAC;gBACvC,IAAI,OAAO,GAAG,GAAG,GAAG,MAAM,GAAG,GAAG,CAAC;gBACjC,IAAI,OAAO,GAAG,CAAC,EAAE;oBAChB,MAAM,CAAC,IAAI,CAAC,GAAG,CAAC,GAAG,CAAC,SAAS,CAAC,CAAC,CAAC;oBAChC,QAAQ,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;oBACtB,MAAM,CAAC,IAAI,CAAC,GAAG,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC,CAAC;iBAC9B;qBAAM;oBACN,IAAI,IAAI,MAAM,CAAC;iBACf;aACD;SACD,CAAC,CAAC;QACH,MAAM,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;QACpB,QAAQ,CAAC,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,CAAC;QAE/B,IAAI,IAAI,GAAG;YACV,MAAM,EAAE,MAAM;YACd,QAAQ,EAAE;gBACT;oBACC,IAAI,EAAE,QAAQ;oBACd,eAAe,EAAE,MAAM;oBACvB,oBAAoB,EAAE,MAAM;iBAC5B;aACD;SACD,CAAC;QACF,IAAI,IAAI,CAAC,UAAU,EAAE;YACpB,IAAI,CAAC,UAAU,CAAC,OAAO,EAAE,CAAC;SAC1B;QACD,IAAI,CAAC,UAAU,GAAG,IAAI,KAAK,CAAC,QAAQ,CAAC,cAAc,CAAC,UAAU,CAAC,EAAE;YAChE,IAAI,EAAE,KAAK;YACX,IAAI,EAAE,IAAI;YACV,OAAO,EAAE;gBACR,MAAM,EAAE;oBACP,OAAO,EAAE,KAAK;iBACd;aACD;SACD,CAAC,CAAC;KACH;IAED,uCAAgB,GAAhB,UAAiB,KAAiB;QACjC,KAAK,CAAC,cAAc,EAAE,CAAC;QACvB,IAAI,IAAI,GAAGH,GAAC,CAAC,KAAK,CAAC,MAAM,CAAC,CAAC;QAC3B,IAAI,EAAE,GAAG,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;QAC9B,OAAO,CAAC,GAAG,CAAC,kBAAkB,EAAE,EAAE,CAAC,CAAC;QACpC,IAAI,GAAG,GAAG,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,EAAE,CAAC,CAAC;QAG7B,IAAI,GAAG,EAAE;YACR,IAAI,CAAC,QAAQ,CAAC,aAAa,EAAE,CAAC;YAC9B,IAAI,CAAC,QAAQ,CAAC,aAAa,EAAE,CAAC;YAC9B,IAAI,CAAC,QAAQ,CAAC,gBAAgB,CAAC,GAAG,CAAC,CAAC;SACpC;aAAM;YACN,IAAI,CAAC,QAAQ,CAAC,aAAa,EAAE,CAAC;YAC9B,IAAI,CAAC,QAAQ,CAAC,aAAa,EAAE,CAAC;SAC9B;QACD,IAAI,CAAC,QAAQ,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAC;KAChC;IAED,2BAAI,GAAJ;QACC,IAAI,CAAC,GAAG,CAAC,IAAI,EAAE,CAAC;QAChBA,GAAC,CAAC,WAAW,CAAC,CAAC,IAAI,EAAE,CAAC;KACtB;IAED,2BAAI,GAAJ;QACC,IAAI,CAAC,GAAG,CAAC,IAAI,EAAE,CAAC;QAChBA,GAAC,CAAC,WAAW,CAAC,CAAC,IAAI,EAAE,CAAC;KACtB;IAEF,mBAAC;CAAA,CA3KyCD,UAAQ,CAAC,IAAI;;ACTvD,IAAMC,GAAC,GAAG,OAAO,CAAC,QAAQ,CAAC,CAAC;AAC5B,OAAO,CAAC,QAAQ,CAAC,CAAC;AAClB,IAAMF,IAAC,GAAG,OAAO,CAAC,YAAY,CAAC,CAAC;AAIjB;IAA0B,+BAAkB;IAiC1D;QAAA,YACC,iBAAO,SAwBP;QAxDD,SAAG,GAAGE,GAAC,CAAC,cAAc,CAAC,CAAC;QAExB,gBAAU,GAAW,KAAI,CAAC,CAAC,CAAC,QAAQ,CAAC,CAAC;QAEtC,kBAAY,GAAW,KAAI,CAAC,CAAC,CAAC,QAAQ,CAAC,CAAC;QAExC,kBAAY,GAAG,QAAQ,CAAC,KAAI,CAAC,UAAU,CAAC,GAAG,EAAE,CAAC,IAAI,IAAI,IAAI,EAAE,CAAC,WAAW,EAAE,CAAC;QAE3E,mBAAa,GAAG,KAAK,CAAC;QAEtB,cAAQ,GAAG,IAAI,IAAI,EAAE,CAAC;QAEtB,YAAM,GAAG,IAAI,IAAI,EAAE,CAAC;QAYpB,gBAAU,GAAG;YACZ,SAAS,EAAE,UAAU,EAAE,OAAO;YAC9B,OAAO,EAAE,KAAK,EAAE,MAAM;YACtB,MAAM,EAAE,QAAQ,EAAE,WAAW;YAC7B,SAAS,EAAE,UAAU,EAAE,UAAU;SACjC,CAAC;QAKD,IAAI,CAAC,KAAI,CAAC,eAAe,EAAE;YAC1B,KAAI,CAAC,eAAe,GAAG,MAAM,CAAC,YAAY,CAAC;SAC3C;QAOD,KAAI,CAAC,YAAY,CAAC,EAAE,CAAC,OAAO,EAAE,KAAI,CAAC,YAAY,CAAC,IAAI,CAAC,KAAI,CAAC,CAAC,CAAC;QAE5D,KAAI,CAAC,UAAU,CAAC,EAAE,CAAC,QAAQ,EAAE,KAAI,CAAC,UAAU,CAAC,IAAI,CAAC,KAAI,CAAC,CAAC,CAAC;QAEzD,IAAI,IAAI,GAAG,KAAI,CAAC,eAAe,CAAC,OAAO,CAAC,kBAAkB,CAAC,CAAC;QAC5D,IAAI,IAAI,EAAE;YACT,KAAI,CAAC,YAAY,GAAG,QAAQ,CAAC,IAAI,CAAC,CAAC;SACnC;QACD,IAAI,KAAK,GAAG,KAAI,CAAC,eAAe,CAAC,OAAO,CAAC,mBAAmB,CAAC,CAAC;QAC9D,IAAI,KAAK,EAAE;YACV,KAAI,CAAC,aAAa,GAAG,KAAK,CAAC;SAC3B;;KAED;IAEM,uBAAW,GAAlB;QACC,IAAI,CAAC,WAAW,CAAC,QAAQ,EAAE;YAC1B,WAAW,CAAC,QAAQ,GAAG,IAAI,WAAW,EAAE,CAAC;SACzC;QACD,OAAO,WAAW,CAAC,QAAQ,CAAC;KAC5B;IAED,4BAAM,GAAN;QAAA,iBAwCC;QAtCA,IAAI,CAAC,QAAQ,CAAC,qBAAqB,EAAE,CAAC;QACtC,IAAI,YAAY,GAAG,IAAI,CAAC,WAAW,EAAE,CAAC;QAGtC,IAAI,OAAO,GAAG,EAAE,CAAC;QACjB,IAAI,OAAO,GAAG,IAAI,CAAC,QAAQ,CAAC,WAAW,EAAE,CAAC;QAC1C,IAAI,OAAO,GAAG,IAAI,CAAC,MAAM,CAAC,WAAW,EAAE,CAAC;QAExC,KAAK,IAAI,CAAC,GAAG,OAAO,EAAE,CAAC,IAAI,OAAO,EAAE,CAAC,EAAE,EAAE;YACxC,IAAI,QAAQ,GAAG,YAAY,CAAC,WAAW,EAAE,IAAI,CAAC,GAAG,UAAU,GAAG,EAAE,CAAC;YACjE,OAAO,CAAC,IAAI,CAAC,UAAU,GAAC,QAAQ,GAAC,GAAG,GAAC,CAAC,GAAC,WAAW,CAAC,CAAC;SACpD;QACD,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;QAGzC,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,UAAC,CAAC,EAAE,MAAM;YAChC,IAAI,WAAW,GAAG,CAAC,GAAC,CAAC,CAAC;YAEtB,IAAI,KAAK,GAAG,KAAI,CAAC,YAAY,GAAC,GAAG,GAAC,WAAW,GAAC,KAAK,CAAC;YACpD,IAAI,YAAY,GAAG,IAAI,IAAI,CAAC,KAAK,CAAC,CAAC;YACnC,IAAI,OAAO,GAAGA,GAAC,CAAC,MAAM,CAAC,CAAC;YACxB,IAAI,OAAO,GAAG,YAAY,CAAC,OAAO,CAAC,KAAI,CAAC,QAAQ,CAAC,CAAC;YAClD,IAAI,QAAQ,GAAG,YAAY,CAAC,QAAQ,CAAC,KAAI,CAAC,MAAM,CAAC,CAAC;YAClD,IAAI,OAAO,IAAI,QAAQ,EAAE;gBACxB,OAAO,CAAC,UAAU,CAAC,UAAU,CAAC,CAAC;aAC/B;iBAAM;gBACN,OAAO,CAAC,IAAI,CAAC,UAAU,EAAE,UAAU,CAAC,CAAC;aACrC;YACD,IAAI,MAAM,GAAG,YAAY,CAAC,MAAM,CAAC,YAAY,CAAC,CAAC;YAC/C,IAAI,MAAM,EAAE;gBACX,OAAO,CAAC,QAAQ,CAAC,aAAa,CAAC,CAAC,WAAW,CAAC,aAAa,CAAC,CAAC;aAC3D;iBAAM;gBACN,OAAO,CAAC,WAAW,CAAC,aAAa,CAAC,CAAC,QAAQ,CAAC,aAAa,CAAC,CAAC;aAC3D;SAED,CAAC,CAAC;QAEH,OAAO,IAAI,CAAC;KACZ;IAED,0BAAI,GAAJ;QAEC,IAAI,CAAC,GAAG,CAAC,IAAI,EAAE,CAAC;QAChB,IAAI,CAAC,MAAM,EAAE,CAAC;KACd;IAED,0BAAI,GAAJ;QACC,OAAO,CAAC,KAAK,CAAC,kBAAkB,CAAC,CAAC;QAClC,IAAI,CAAC,GAAG,CAAC,IAAI,EAAE,CAAC;KAChB;IAED,mCAAa,GAAb;QACC,IAAI,MAAM,GAAG,IAAI,CAAC,sBAAsB,CAAC,IAAI,CAAC,aAAa,CAAC,GAAG,CAAC,CAAC;QAEjE,OAAO,MAAM,CAAC;KACd;IAED,sCAAgB,GAAhB,UAAiB,SAAiB;QACjC,IAAI,MAAM,GAAG,IAAI,CAAC,sBAAsB,CAAC,SAAS,CAAC,GAAG,CAAC,CAAC;QAExD,OAAO,MAAM,CAAC;KACd;IAED,qCAAe,GAAf,UAAgB,KAAK;QACpB,OAAO,IAAI,CAAC,oBAAoB,CAAC,KAAK,CAAC,CAAC;KACxC;IAED,gCAAU,GAAV,UAAW,KAAK;QAEf,QAAQ,CAAC,OAAO,CAAC,QAAQ,CAAC,IAAI,GAAG,IAAI,CAAC,UAAU,CAAC,GAAG,EAAE,GAAG,GAAG,GAAG,IAAI,CAAC,aAAa,EAAE,CAAC,CAAC;KACrF;IAED,6CAAuB,GAAvB,UAAwB,KAAK;QAC5B,IAAI,CAAC,YAAY,CAAC,WAAW,CAAC,aAAa,CAAC,CAAC,QAAQ,CAAC,aAAa,CAAC,CAAC;QACrE,IAAI,OAAO,GAAGA,GAAC,CAAC,KAAK,CAAC,MAAM,CAAC,CAAC;QAC9B,OAAO,CAAC,WAAW,CAAC,aAAa,CAAC,CAAC;QACnC,OAAO,CAAC,QAAQ,CAAC,aAAa,CAAC,CAAC;QAEhC,IAAI,UAAU,GAAG,IAAI,CAAC,gBAAgB,CAAC,OAAO,CAAC,IAAI,EAAE,CAAC,CAAC;QACvD,QAAQ,CAAC,OAAO,CAAC,QAAQ,CAAC,IAAI,GAAG,IAAI,CAAC,YAAY,GAAG,GAAG,GAAG,UAAU,CAAC,CAAC;KACvE;IAED,kCAAY,GAAZ,UAAa,KAAK;QACjB,IAAI,CAAC,YAAY,CAAC,WAAW,CAAC,aAAa,CAAC,CAAC,QAAQ,CAAC,aAAa,CAAC,CAAC;QACrE,IAAI,OAAO,GAAGA,GAAC,CAAC,KAAK,CAAC,MAAM,CAAC,CAAC;QAC9B,OAAO,CAAC,WAAW,CAAC,aAAa,CAAC,CAAC;QACnC,OAAO,CAAC,QAAQ,CAAC,aAAa,CAAC,CAAC;QAChC,IAAI,CAAC,aAAa,GAAG,OAAO,CAAC,IAAI,EAAE,CAAC;QACpC,IAAI,CAAC,eAAe,CAAC,OAAO,CAAC,mBAAmB,EAAE,IAAI,CAAC,aAAa,CAAC,CAAC;QAEtE,IAAI,CAAC,OAAO,CAAC,oBAAoB,CAAC,CAAC;KACnC;IAED,6BAAO,GAAP,UAAQ,IAAI;QAEX,OAAO,CAAC,GAAG,CAAC,SAAS,EAAE,IAAI,CAAC,CAAC;QAC7B,IAAI,CAAC,YAAY,GAAG,IAAI,CAAC;QAEzB,IAAI,CAAC,eAAe,CAAC,OAAO,CAAC,kBAAkB,EAAE,IAAI,CAAC,YAAY,GAAC,EAAE,CAAC,CAAC;QACvE,IAAI,CAAC,MAAM,EAAE,CAAC;QACd,IAAI,CAAC,OAAO,CAAC,oBAAoB,CAAC,CAAC;KACnC;IAED,8BAAQ,GAAR,UAAS,KAAa;QACrB,IAAI,SAAS,GAAG,IAAI,CAAC,eAAe,CAAC,KAAK,CAAC,CAAC;QAK5C,OAAO,CAAC,GAAG,CAAC,UAAU,EAAE,KAAK,CAAC,CAAC;QAC/B,IAAI,CAAC,aAAa,GAAG,SAAS,CAAC;QAC/B,IAAI,CAAC,eAAe,CAAC,OAAO,CAAC,mBAAmB,EAAE,IAAI,CAAC,aAAa,CAAC,CAAC;QACtE,IAAI,CAAC,OAAO,CAAC,oBAAoB,CAAC,CAAC;KACnC;IAED,kCAAY,GAAZ,UAAa,IAAY,EAAE,KAAa;QACvC,OAAO,CAAC,GAAG,CAAC,cAAc,EAAE,IAAI,EAAE,KAAK,CAAC,CAAC;QAEzC,IAAI,CAAC,YAAY,GAAG,IAAI,CAAC;QAEzB,IAAI,CAAC,eAAe,CAAC,OAAO,CAAC,kBAAkB,EAAE,IAAI,CAAC,YAAY,CAAC,CAAC;QAEpE,IAAI,SAAS,GAAG,IAAI,CAAC,eAAe,CAAC,KAAK,CAAC,CAAC;QAC5C,IAAI,CAAC,aAAa,GAAG,SAAS,CAAC;QAC/B,IAAI,CAAC,eAAe,CAAC,OAAO,CAAC,mBAAmB,EAAE,IAAI,CAAC,aAAa,CAAC,CAAC;QAEtE,IAAI,CAAC,MAAM,EAAE,CAAC;QACd,IAAI,CAAC,OAAO,CAAC,oBAAoB,CAAC,CAAC;KACnC;IAED,6BAAO,GAAP,UAAQ,IAAI;QACX,OAAO,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QACnB,iBAAM,OAAO,YAAC,IAAI,CAAC,CAAC;KACpB;IAMD,iCAAW,GAAX;QACC,IAAI,aAAa,GAAG,IAAI,CAAC,YAAY,GAAC,GAAG,GAAC,IAAI,CAAC,aAAa,EAAE,GAAC,KAAK,CAAC;QACrE,IAAI,YAAY,GAAG,IAAI,IAAI,CAAC,aAAa,CAAC,CAAC;QAE3C,OAAO,YAAY,CAAC;KACpB;IAMD,kCAAY,GAAZ;QACC,MAAM,IAAI,KAAK,CAAC,4DAA4D,CAAC,CAAC;QAC9E,OAAO,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,aAAa,CAAC,CAAC;KAC3C;IAMD,uCAAiB,GAAjB;QACC,OAAO,IAAI,CAAC,YAAY,EAAE,CAAC,MAAM,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;KACxC;IAED,0CAAoB,GAApB,UAAqB,KAAK;QACzB,OAAO,IAAI,CAAC,UAAU,CAAC,KAAK,GAAC,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;KAC7C;IAED,4BAAM,GAAN,UAAO,UAAiC;QACvC,IAAI,CAAC,QAAQ,GAAG,UAAU,CAAC,WAAW,EAAE,CAAC;QACzC,IAAI,CAAC,MAAM,GAAG,UAAU,CAAC,SAAS,EAAE,CAAC;QAKrC,IAAI,CAAC,YAAY,GAAG,IAAI,CAAC,YAAY,CAAC,KAAK,CAC1C,IAAI,CAAC,QAAQ,CAAC,WAAW,EAAE,EAC3B,IAAI,CAAC,MAAM,CAAC,WAAW,EAAE,CACzB,CAAC;QACF,IAAI,kBAAkB,GAAG,IAAI,CAAC,aAAa,EAAE,CAAC,KAAK,CAClD,IAAI,CAAC,QAAQ,CAAC,QAAQ,EAAE,EACxB,IAAI,CAAC,MAAM,CAAC,QAAQ,EAAE,CACtB,CAAC;QACF,IAAI,CAAC,aAAa,GAAG,IAAI,CAAC,oBAAoB,CAAC,kBAAkB,CAAC,CAAC;QAEnE,IAAI,CAAC,IAAI,EAAE,CAAC;KACZ;IAEF,kBAAC;CAAA,CAhQwC,QAAQ,CAAC,IAAI;;ACbtD,IAAMD,UAAQ,GAAG,OAAO,CAAC,UAAU,CAAC,CAAC;AACrC,OAAO,CAAC,GAAG,CAACA,UAAQ,CAAC,CAAC;AAItB,IAAMD,IAAC,GAAG,OAAO,CAAC,YAAY,CAAC,CAAC;AAEzB;IAsRN,8BAAY,OAAQ;QAnRpB,kBAAa,GAAG,KAAK,CAAC;QAEtB,cAAS,GAAGA,IAAC,CAAC,QAAQ,CAAC,GAAG,CAAC,CAAC;QAE5B,iBAAY,GAAG,EAAE,CAAC;QAElB,YAAO,GAAG,EAAE,CAAC;QAEb,eAAU,GAAG,EAAE,CAAC;QAuQhB,0BAAqB,GAAG,gBAAgB,CAAC;QACzC,gBAAW,GAAG,CAAC,OAAO,EAAE,YAAY,EAAE,IAAI,EAAE,IAAI,EAAE,YAAY,EAAE,WAAW,EAAE,SAAS,EAAE,QAAQ,CAAC,CAAC;QAMjG,IAAI,CAAC,GAAG,GAAGA,IAAC,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC;QAC9BA,IAAC,CAAC,MAAM,CAAC,IAAI,EAAEA,IAAC,CAAC,IAAI,CAAC,OAAO,EAAE,IAAI,CAAC,WAAW,CAAC,CAAC,CAAC;QAClD,IAAI,CAAC,cAAc,EAAE,CAAC;KACtB;IA5QD,wCAAS,GAAT,UAAU,QAAQ,EAAE,MAAM,EAAE,IAAI,EAAE,QAAQ,EAAE,IAAI;QAC/C,IAAI,CAAC,GAAG,CAAC,EAAE,KAAK,CAAC;QACjB,IAAI,IAAI,IAAI,OAAO,IAAI,KAAK,QAAQ,EAAE;YAErC,IAAI,QAAQ,KAAK,KAAK,CAAC,IAAI,SAAS,IAAI,IAAI,IAAI,IAAI,CAAC,OAAO,KAAK,KAAK,CAAC;gBAAE,IAAI,CAAC,OAAO,GAAG,QAAQ,CAAC;YACjG,KAAK,KAAK,GAAGA,IAAC,CAAC,IAAI,CAAC,IAAI,CAAC,EAAE,CAAC,GAAG,KAAK,CAAC,MAAM,EAAG,CAAC,EAAE,EAAE;gBAClD,MAAM,GAAG,IAAI,CAAC,SAAS,CAAC,QAAQ,EAAE,MAAM,EAAE,KAAK,CAAC,CAAC,CAAC,EAAE,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,EAAE,IAAI,CAAC,CAAC;aAC1E;SACD;aAAM,IAAI,IAAI,IAAI,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,IAAI,CAAC,EAAE;YAEjD,KAAK,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,aAAa,CAAC,EAAE,CAAC,GAAG,KAAK,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;gBACnE,MAAM,GAAG,QAAQ,CAAC,MAAM,EAAE,KAAK,CAAC,CAAC,CAAC,EAAE,QAAQ,EAAE,IAAI,CAAC,CAAC;aACpD;SACD;aAAM;YAEN,MAAM,GAAG,QAAQ,CAAC,MAAM,EAAE,IAAI,EAAE,QAAQ,EAAE,IAAI,CAAC,CAAC;SAChD;QACD,OAAO,MAAM,CAAC;KACd;IAOD,iCAAE,GAAF,UAAG,IAAyB,EAAE,QAAmB,EAAE,OAAa;QAC/D,OAAO,IAAI,CAAC,UAAU,CAAC,IAAI,EAAE,IAAI,EAAE,QAAQ,EAAE,OAAO,EAAE,IAAI,CAAC,CAAC;KAC5D;IAGD,yCAAU,GAAV,UAAW,GAAG,EAAE,IAAI,EAAE,QAAQ,EAAE,OAAO,EAAE,SAAS;QACjD,GAAG,CAAC,OAAO,GAAG,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,KAAK,EAAE,GAAG,CAAC,OAAO,IAAI,EAAE,EAAE,IAAI,EAAE,QAAQ,EAAE;YAC3E,OAAO,EAAE,OAAO;YAChB,GAAG,EAAE,GAAG;YACR,SAAS,EAAE,SAAS;SACpB,CAAC,CAAC;QAEH,IAAI,SAAS,EAAE;YACd,IAAI,SAAS,GAAG,GAAG,CAAC,UAAU,KAAK,GAAG,CAAC,UAAU,GAAG,EAAE,CAAC,CAAC;YACxD,SAAS,CAAC,SAAS,CAAC,EAAE,CAAC,GAAG,SAAS,CAAC;SACpC;QAED,OAAO,GAAG,CAAC;KACX;IAKD,uCAAQ,GAAR,UAAS,GAAG,EAAE,IAAI,EAAE,QAAS;QAC5B,IAAI,CAAC,GAAG;YAAE,OAAO,IAAI,CAAC;QACtB,IAAM,EAAE,GAAG,GAAG,CAAC,SAAS,KAAK,GAAG,CAAC,SAAS,GAAGA,IAAC,CAAC,QAAQ,CAAC,GAAG,CAAC,CAAC,CAAC;QAC9D,IAAM,WAAW,GAAG,IAAI,CAAC,YAAY,KAAK,IAAI,CAAC,YAAY,GAAG,EAAE,CAAC,CAAC;QAClE,IAAI,SAAS,GAAG,WAAW,CAAC,EAAE,CAAC,CAAC;QAIhC,IAAI,CAAC,SAAS,EAAE;YACf,IAAM,MAAM,GAAG,IAAI,CAAC,SAAS,KAAK,IAAI,CAAC,SAAS,GAAGA,IAAC,CAAC,QAAQ,CAAC,GAAG,CAAC,CAAC,CAAC;YACpE,SAAS,GAAG,WAAW,CAAC,EAAE,CAAC,GAAG,EAAC,GAAG,EAAE,GAAG,EAAE,KAAK,EAAE,EAAE,EAAE,EAAE,EAAE,MAAM,EAAE,WAAW,EAAE,WAAW,EAAE,KAAK,EAAE,CAAC,EAAC,CAAC;SACpG;QAGD,IAAI,CAAC,UAAU,CAAC,GAAG,EAAE,IAAI,EAAE,QAAQ,EAAE,IAAI,EAAE,SAAS,CAAC,CAAC;QACtD,OAAO,IAAI,CAAC;KACZ;IAGD,oCAAK,GAAL,UAAM,MAAM,EAAE,IAAI,EAAE,QAAQ,EAAE,OAAO;QACpC,IAAI,QAAQ,EAAE;YACb,IAAI,QAAQ,GAAG,MAAM,CAAC,IAAI,CAAC,KAAK,MAAM,CAAC,IAAI,CAAC,GAAG,EAAE,CAAC,CAAC;YACnD,IAAI,OAAO,GAAG,OAAO,CAAC,OAAO,EAAE,GAAG,GAAG,OAAO,CAAC,GAAG,EAAE,SAAS,GAAG,OAAO,CAAC,SAAS,CAAC;YAChF,IAAI,SAAS;gBAAE,SAAS,CAAC,KAAK,EAAE,CAAC;YAEjC,QAAQ,CAAC,IAAI,CAAC,EAAC,QAAQ,EAAE,QAAQ,EAAE,OAAO,EAAE,OAAO,EAAE,GAAG,EAAE,OAAO,IAAI,GAAG,EAAE,SAAS,EAAE,SAAS,EAAC,CAAC,CAAC;SACjG;QACD,OAAO,MAAM,CAAC;KACd;IAMD,kCAAG,GAAH,UAAI,IAAI,EAAE,QAAQ,EAAE,OAAO;QAC1B,IAAI,CAAC,IAAI,CAAC,OAAO;YAAE,OAAO,IAAI,CAAC;QAC/B,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,MAAM,EAAE,IAAI,CAAC,OAAO,EAAE,IAAI,EAAE,QAAQ,EAAE;YACxE,OAAO,EAAE,OAAO;YAChB,SAAS,EAAE,IAAI,CAAC,UAAU;SAC1B,CAAC,CAAC;QACH,OAAO,IAAI,CAAC;KACZ;IAID,4CAAa,GAAb,UAAc,GAAG,EAAE,IAAI,EAAE,QAAQ;QAChC,IAAM,WAAW,GAAG,IAAI,CAAC,YAAY,CAAC;QACtC,IAAI,CAAC,WAAW;YAAE,OAAO,IAAI,CAAC;QAE9B,IAAI,GAAG,GAAG,GAAG,GAAG,CAAC,GAAG,CAAC,SAAS,CAAC,GAAGA,IAAC,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC;QAEtD,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,GAAG,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;YACpC,IAAI,SAAS,GAAG,WAAW,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC;YAIpC,IAAI,CAAC,SAAS;gBAAE,MAAM;YAEtB,SAAS,CAAC,GAAG,CAAC,GAAG,CAAC,IAAI,EAAE,QAAQ,EAAE,IAAI,CAAC,CAAC;SACxC;QAED,OAAO,IAAI,CAAC;KACZ;IAGD,qCAAM,GAAN,UAAO,MAAM,EAAE,IAAI,EAAE,QAAQ,EAAE,OAAO;QACrC,IAAI,CAAC,MAAM;YAAE,OAAO;QAEpB,IAAI,CAAC,GAAG,CAAC,EAAE,SAAS,CAAC;QACrB,IAAI,OAAO,GAAG,OAAO,CAAC,OAAO,EAAE,SAAS,GAAG,OAAO,CAAC,SAAS,CAAC;QAG7D,IAAI,CAAC,IAAI,IAAI,CAAC,QAAQ,IAAI,CAAC,OAAO,EAAE;YACnC,IAAI,GAAG,GAAGA,IAAC,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;YAC5B,OAAO,CAAC,GAAG,GAAG,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;gBAC3B,SAAS,GAAG,SAAS,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC;gBAC9B,OAAO,SAAS,CAAC,SAAS,CAAC,EAAE,CAAC,CAAC;gBAC/B,OAAO,SAAS,CAAC,WAAW,CAAC,SAAS,CAAC,KAAK,CAAC,CAAC;aAC9C;YACD,OAAO;SACP;QAED,IAAI,KAAK,GAAG,IAAI,GAAG,CAAC,IAAI,CAAC,GAAGA,IAAC,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;QAC3C,OAAO,CAAC,GAAG,KAAK,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;YAC7B,IAAI,GAAG,KAAK,CAAC,CAAC,CAAC,CAAC;YAChB,IAAI,QAAQ,GAAG,MAAM,CAAC,IAAI,CAAC,CAAC;YAG5B,IAAI,CAAC,QAAQ;gBAAE,MAAM;YAGrB,IAAI,SAAS,GAAG,EAAE,CAAC;YACnB,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,QAAQ,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;gBACzC,IAAI,OAAO,GAAG,QAAQ,CAAC,CAAC,CAAC,CAAC;gBAC1B,IACC,QAAQ,IAAI,QAAQ,KAAK,OAAO,CAAC,QAAQ;oBACzC,QAAQ,KAAK,OAAO,CAAC,QAAQ,CAAC,SAAS;oBACvC,OAAO,IAAI,OAAO,KAAK,OAAO,CAAC,OAChC,EAAE;oBACD,SAAS,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;iBACxB;qBAAM;oBACN,SAAS,GAAG,OAAO,CAAC,SAAS,CAAC;oBAC9B,IAAI,SAAS,IAAI,EAAE,SAAS,CAAC,KAAK,KAAK,CAAC,EAAE;wBACzC,OAAO,SAAS,CAAC,SAAS,CAAC,EAAE,CAAC,CAAC;wBAC/B,OAAO,SAAS,CAAC,WAAW,CAAC,SAAS,CAAC,KAAK,CAAC,CAAC;qBAC9C;iBACD;aACD;YAGD,IAAI,SAAS,CAAC,MAAM,EAAE;gBACrB,MAAM,CAAC,IAAI,CAAC,GAAG,SAAS,CAAC;aACzB;iBAAM;gBACN,OAAO,MAAM,CAAC,IAAI,CAAC,CAAC;aACpB;SACD;QACD,OAAO,MAAM,CAAC;KACd;IAMD,mCAAI,GAAJ,UAAK,IAAI,EAAE,QAAQ,EAAE,OAAO;QAE3B,IAAI,MAAM,GAAG,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,OAAO,EAAE,EAAE,EAAE,IAAI,EAAE,QAAQ,EAAEA,IAAC,CAAC,IAAI,CAAC,IAAI,CAAC,GAAG,EAAE,IAAI,CAAC,CAAC,CAAC;QACtF,IAAI,OAAO,IAAI,KAAK,QAAQ,IAAI,OAAO,IAAI,IAAI;YAAE,QAAQ,GAAG,KAAK,CAAC,CAAC;QACnE,OAAO,IAAI,CAAC,EAAE,CAAC,MAAM,EAAE,QAAQ,EAAE,OAAO,CAAC,CAAC;KAC1C;IAGD,2CAAY,GAAZ,UAAa,GAAG,EAAE,IAAI,EAAE,QAAQ;QAE/B,IAAI,MAAM,GAAG,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,OAAO,EAAE,EAAE,EAAE,IAAI,EAAE,QAAQ,EAAEA,IAAC,CAAC,IAAI,CAAC,IAAI,CAAC,aAAa,EAAE,IAAI,EAAE,GAAG,CAAC,CAAC,CAAC;QACrG,OAAO,IAAI,CAAC,QAAQ,CAAC,GAAG,EAAE,MAAM,CAAC,CAAC;KAClC;IAID,sCAAO,GAAP,UAAQ,GAAG,EAAE,IAAI,EAAE,QAAQ,EAAE,KAAK;QACjC,IAAI,QAAQ,EAAE;YACb,IAAM,MAAI,GAAG,GAAG,CAAC,IAAI,CAAC,GAAGA,IAAC,CAAC,IAAI,CAAC;gBAC/B,KAAK,CAAC,IAAI,EAAE,MAAI,CAAC,CAAC;gBAClB,QAAQ,CAAC,KAAK,CAAC,IAAI,EAAE,SAAS,CAAC,CAAC;aAChC,CAAC,CAAC;SAEH;QACD,OAAO,GAAG,CAAC;KACX;IAMD,sCAAO,GAAP,UAAQ,IAAI;QACX,IAAI,CAAC,IAAI,CAAC,OAAO;YAAE,OAAO,IAAI,CAAC;QAE/B,IAAI,MAAM,GAAG,IAAI,CAAC,GAAG,CAAC,CAAC,EAAE,SAAS,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC;QAC/C,IAAI,IAAI,GAAG,KAAK,CAAC,MAAM,CAAC,CAAC;QACzB,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,MAAM,EAAE,CAAC,EAAE;YAAE,IAAI,CAAC,CAAC,CAAC,GAAG,SAAS,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC;QAE5D,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,UAAU,EAAE,IAAI,CAAC,OAAO,EAAE,IAAI,EAAE,KAAK,CAAC,EAAE,IAAI,CAAC,CAAC;QAClE,OAAO,IAAI,CAAC;KACZ;IAGD,yCAAU,GAAV,UAAW,SAAS,EAAE,IAAI,EAAE,QAAQ,EAAE,IAAI;QACzC,IAAI,SAAS,EAAE;YACd,IAAI,MAAM,GAAG,SAAS,CAAC,IAAI,CAAC,CAAC;YAC7B,IAAI,SAAS,GAAG,SAAS,CAAC,GAAG,CAAC;YAC9B,IAAI,MAAM,IAAI,SAAS;gBAAE,SAAS,GAAG,SAAS,CAAC,KAAK,EAAE,CAAC;YACvD,IAAI,MAAM;gBAAE,IAAI,CAAC,aAAa,CAAC,MAAM,EAAE,IAAI,CAAC,CAAC;YAC7C,IAAI,SAAS;gBAAE,IAAI,CAAC,aAAa,CAAC,SAAS,EAAE,CAAC,IAAI,CAAC,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC,CAAC;SAClE;QACD,OAAO,SAAS,CAAC;KACjB;IAKD,4CAAa,GAAb,UAAc,MAAM,EAAE,IAAI;QACzB,IAAI,EAAE,EAAE,CAAC,GAAG,CAAC,CAAC,EAAE,CAAC,GAAG,MAAM,CAAC,MAAM,EAAE,EAAE,GAAG,IAAI,CAAC,CAAC,CAAC,EAAE,EAAE,GAAG,IAAI,CAAC,CAAC,CAAC,EAAE,EAAE,GAAG,IAAI,CAAC,CAAC,CAAC,CAAC;QAC5E,QAAQ,IAAI,CAAC,MAAM;YAClB,KAAK,CAAC;gBAAE,OAAO,EAAE,CAAC,GAAG,CAAC;oBAAE,CAAC,EAAE,GAAG,MAAM,CAAC,CAAC,CAAC,EAAE,QAAQ,CAAC,IAAI,CAAC,EAAE,CAAC,GAAG,CAAC,CAAC;gBAAC,OAAO;YACvE,KAAK,CAAC;gBAAE,OAAO,EAAE,CAAC,GAAG,CAAC;oBAAE,CAAC,EAAE,GAAG,MAAM,CAAC,CAAC,CAAC,EAAE,QAAQ,CAAC,IAAI,CAAC,EAAE,CAAC,GAAG,EAAE,EAAE,CAAC,CAAC;gBAAC,OAAO;YAC3E,KAAK,CAAC;gBAAE,OAAO,EAAE,CAAC,GAAG,CAAC;oBAAE,CAAC,EAAE,GAAG,MAAM,CAAC,CAAC,CAAC,EAAE,QAAQ,CAAC,IAAI,CAAC,EAAE,CAAC,GAAG,EAAE,EAAE,EAAE,EAAE,CAAC,CAAC;gBAAC,OAAO;YAC/E,KAAK,CAAC;gBAAE,OAAO,EAAE,CAAC,GAAG,CAAC;oBAAE,CAAC,EAAE,GAAG,MAAM,CAAC,CAAC,CAAC,EAAE,QAAQ,CAAC,IAAI,CAAC,EAAE,CAAC,GAAG,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,CAAC,CAAC;gBAAC,OAAO;YACnF;gBAAS,OAAO,EAAE,CAAC,GAAG,CAAC;oBAAE,CAAC,EAAE,GAAG,MAAM,CAAC,CAAC,CAAC,EAAE,QAAQ,CAAC,KAAK,CAAC,EAAE,CAAC,GAAG,EAAE,IAAI,CAAC,CAAC;gBAAC,OAAO;SAC/E;KACD;IAED,mCAAI,GAAJ,UAAK,IAAyB,EAAE,QAAmB,EAAE,OAAa;QACjE,OAAO,CAAC,KAAK,CAAC,oBAAoB,CAAC,CAAC;KAMpC;IAED,qCAAM,GAAN,UAAO,IAAI,EAAE,QAAQ,EAAE,OAAO;QAC7B,IAAI,CAAC,GAAG,CAAC,IAAI,EAAE,QAAQ,EAAE,OAAO,CAAC,CAAC;KAClC;IAoBD,gCAAC,GAAD,UAAE,QAAgB;QACjB,OAAO,CAAC,CAAC,QAAQ,CAAC,CAAC;KACnB;IAED,6CAAc,GAAd;QACC,IAAI,CAAC,IAAI,CAAC,EAAE,EAAE;YACb,IAAM,KAAK,GAAGA,IAAC,CAAC,MAAM,CAAC,EAAE,EAAEA,IAAC,CAAC,MAAM,CAAC,IAAI,EAAE,YAAY,CAAC,CAAC,CAAC;YACzD,IAAI,IAAI,CAAC,EAAE;gBAAE,KAAK,CAAC,EAAE,GAAGA,IAAC,CAAC,MAAM,CAAC,IAAI,EAAE,IAAI,CAAC,CAAC;YAC7C,IAAI,IAAI,CAAC,SAAS;gBAAE,KAAK,CAAC,OAAO,CAAC,GAAGA,IAAC,CAAC,MAAM,CAAC,IAAI,EAAE,WAAW,CAAC,CAAC;YACjE,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,cAAc,CAACA,IAAC,CAAC,MAAM,CAAC,IAAI,EAAE,SAAS,CAAC,CAAC,CAAC,CAAC;YAChE,IAAI,CAAC,cAAc,CAAC,KAAK,CAAC,CAAC;SAC3B;aAAM;YACN,IAAI,CAAC,UAAU,CAACA,IAAC,CAAC,MAAM,CAAC,IAAI,EAAE,IAAI,CAAC,CAAC,CAAC;SACtC;KACD;IAED,6CAAc,GAAd,UAAe,OAAO;QACrB,OAAO,QAAQ,CAAC,aAAa,CAAC,OAAO,CAAC,CAAC;KACvC;IAED,6CAAc,GAAd,UAAe,UAAU;QACxB,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;KAC1B;IAED,yCAAU,GAAV,UAAW,OAAO;QACjB,IAAI,CAAC,gBAAgB,EAAE,CAAC;QACxB,IAAI,CAAC,WAAW,CAAC,OAAO,CAAC,CAAC;QAC1B,IAAI,CAAC,cAAc,EAAE,CAAC;QACtB,OAAO,IAAI,CAAC;KACZ;IAOD,0CAAW,GAAX,UAAY,EAAE;QACb,IAAI,CAAC,GAAG,GAAG,EAAE,YAAYC,UAAQ,CAAC,CAAC,GAAG,EAAE,GAAGA,UAAQ,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC;QAC1D,IAAI,CAAC,EAAE,GAAG,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;KACtB;IAED,+CAAgB,GAAhB;QACC,IAAI,IAAI,CAAC,GAAG;YAAE,IAAI,CAAC,GAAG,CAAC,GAAG,CAAC,iBAAiB,GAAG,IAAI,CAAC,GAAG,CAAC,CAAC;QACzD,OAAO,IAAI,CAAC;KACZ;IAED,6CAAc,GAAd,UAAe,MAAO;QACrB,MAAM,KAAK,MAAM,GAAGD,IAAC,CAAC,MAAM,CAAC,IAAI,EAAE,QAAQ,CAAC,CAAC,CAAC;QAC9C,IAAI,CAAC,MAAM;YAAE,OAAO,IAAI,CAAC;QACzB,IAAI,CAAC,gBAAgB,EAAE,CAAC;QACxB,KAAK,IAAI,GAAG,IAAI,MAAM,EAAE;YACvB,IAAI,MAAM,GAAG,MAAM,CAAC,GAAG,CAAC,CAAC;YACzB,IAAI,CAACA,IAAC,CAAC,UAAU,CAAC,MAAM,CAAC;gBAAE,MAAM,GAAG,IAAI,CAAC,MAAM,CAAC,CAAC;YACjD,IAAI,CAAC,MAAM;gBAAE,SAAS;YACtB,IAAM,KAAK,GAAG,GAAG,CAAC,KAAK,CAAC,IAAI,CAAC,qBAAqB,CAAC,CAAC;YACpD,IAAI,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAC,CAAC,EAAE,KAAK,CAAC,CAAC,CAAC,EAAEA,IAAC,CAAC,IAAI,CAAC,MAAM,EAAE,IAAI,CAAC,CAAC,CAAC;SACxD;QACD,OAAO,IAAI,CAAC;KACZ;IAED,uCAAQ,GAAR,UAAS,SAAS,EAAE,QAAQ,EAAE,QAAQ;QACrC,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,SAAS,GAAG,iBAAiB,GAAG,IAAI,CAAC,GAAG,EAAE,QAAQ,EAAE,QAAQ,CAAC,CAAC;QAC1E,OAAO,IAAI,CAAC;KACZ;IAED,mCAAI,GAAJ;QACC,IAAI,CAAC,GAAG,CAAC,IAAI,EAAE,CAAC;KAChB;IAEF,2BAAC;CAAA;;AChWD,IAAI,MAAM,GAAG,OAAO,CAAC,QAAQ,CAAC,CAAC;AAC/B,MAAM,CAAC,SAAS,CAAC;IAChB,KAAK,EAAE,IAAI;CACX,CAAC,CAAC;AACH,IAAME,GAAC,GAAG,OAAO,CAAC,QAAQ,CAAC,CAAC;AAC5B,IAAMF,GAAC,GAAG,OAAO,CAAC,YAAY,CAAC,CAAC;AAEjB;IAAsB,2BAA8B;IAsBlE,iBAAY,OAAyC,EAAE,YAAgC;QAAvF,YACC,kBAAM,OAAO,CAAC,SAkCd;QA3CD,OAAC,GAAW,EAAE,CAAC;QAUd,OAAO,CAAC,GAAG,CAAC,mBAAmB,CAAC,CAAC;QACjC,KAAI,CAAC,UAAU,GAAG,OAAO,CAAC,UAAU,CAAC;QACrC,KAAI,CAAC,UAAU,CAACE,GAAC,CAAC,MAAM,CAAC,CAAC,CAAC;QAC3B,KAAI,CAAC,WAAW,EAAE,CAAC;QAEnB,KAAI,CAAC,YAAY,GAAG,YAAY,CAAC;QAEjC,KAAI,CAAC,KAAK,GAAG,IAAI,YAAY,CAAC;YAC7B,KAAK,EAAE,KAAI,CAAC,UAAU;YACtB,EAAE,EAAEA,GAAC,CAAC,eAAe,CAAC;SACtB,CAAC,CAAC;QACH,KAAI,CAAC,KAAK,CAAC,eAAe,CAAC,KAAI,CAAC,YAAY,CAAC,CAAC;QAE9C,KAAI,CAAC,UAAU,GAAG,IAAI,YAAY,CAAC;YAClC,KAAK,EAAE,KAAI,CAAC,YAAY;SACxB,CAAC,CAAC;QACH,KAAI,CAAC,UAAU,CAAC,WAAW,CAAC,KAAI,CAAC,UAAU,CAAC,CAAC;QAG7C,KAAI,CAAC,EAAE,GAAG,WAAW,CAAC,WAAW,EAAE,CAAC;QACpC,KAAI,CAAC,EAAE,CAAC,QAAQ,GAAG,KAAI,CAAC,UAAU,CAAC,WAAW,EAAE,CAAC;QACjD,KAAI,CAAC,EAAE,CAAC,MAAM,GAAG,KAAI,CAAC,UAAU,CAAC,SAAS,EAAE,CAAC;QAC7C,KAAI,CAAC,EAAE,CAAC,MAAM,EAAE,CAAC;QACjB,KAAI,CAAC,QAAQ,CAAC,KAAI,CAAC,EAAE,EAAE,oBAAoB,EAAE,KAAI,CAAC,WAAW,CAAC,IAAI,CAAC,KAAI,CAAC,CAAC,CAAC;QAE1E,KAAI,CAAC,UAAU,CAAC,aAAa,GAAG,KAAI,CAAC,EAAE,CAAC,WAAW,EAAE,CAAC;QAEtD,KAAI,CAAC,QAAQ,CAAC,KAAI,CAAC,UAAU,EAAE,QAAQ,EAAE,KAAI,CAAC,MAAM,CAAC,CAAC;QAGtDA,GAAC,CAAC,2BAA2B,CAAC,CAAC,EAAE,CAAC,OAAO,EACxCF,GAAC,CAAC,QAAQ,CAAC,KAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,KAAI,CAAC,EAAE,GAAG,CAAC,CAAC,CAAC;QAC5C,KAAI,CAAC,EAAE,CAAC,KAAK,EAAEM,OAAK,CAAC,SAAS,CAAC,CAAC,CAAC;;KACjC;IAED,wBAAM,GAAN;QAEC,OAAO,CAAC,GAAG,CAAC,kBAAkB,EAAE,IAAI,CAAC,UAAU,CAAC,IAAI,EAAE,CAAC,CAAC;QACxD,IAAI,CAAC,WAAW,EAAE,CAAC;QAMnB,IAAI,CAAC,KAAK,CAAC,MAAM,EAAE,CAAC;QACpB,IAAI,CAAC,UAAU,CAAC,MAAM,EAAE,CAAC;QACzB,IAAI,CAAC,CAAC,CAAC,gBAAgB,CAAC,CAAC,EAAE,CAAC,OAAO,EAAE,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;QAGpE,OAAO,IAAI,CAAC;KACZ;IAED,6BAAW,GAAX;QAEC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC,eAAe,CAAC,CAAC,MAAM,EAAE;YACpC,IAAI,QAAQ,GAAGN,GAAC,CAAC,QAAQ,CAACE,GAAC,CAAC,UAAU,CAAC,CAAC,IAAI,EAAE,CAAC,CAAC;YAChD,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,QAAQ,EAAE,CAAC,CAAC;YAG1B,IAAI,IAAI,CAAC,KAAK,EAAE;gBACf,IAAI,CAAC,KAAK,CAAC,GAAG,GAAGA,GAAC,CAAC,eAAe,CAAC,CAAC;aACpC;SACD;KACD;IAED,6BAAW,GAAX;QACC,MAAM,CAAC,IAAI,CAAC,qBAAqB,CAAC,CAAC;QACnC,IAAI,CAAC,UAAU,CAAC,aAAa,EAAE,CAAC;QAChC,IAAI,CAAC,UAAU,CAAC,aAAa,CAAC,IAAI,CAAC,EAAE,CAAC,WAAW,EAAE,CAAC,CAAC;QACrD,IAAI,CAAC,UAAU,CAAC,aAAa,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;QAOtC,IAAI,CAAC,YAAY,CAAC,yBAAyB,EAAE,CAAC;QAC9C,MAAM,CAAC,OAAO,CAAC,qBAAqB,CAAC,CAAC;KACtC;IAED,0BAAQ,GAAR,UAAS,KAAK;QACb,IAAI,CAAC,CAAC,GAAGA,GAAC,CAAC,KAAK,CAAC,MAAM,CAAC,CAAC,GAAG,EAAE,CAAC;QAC/B,OAAO,CAAC,GAAG,CAAC,aAAa,EAAE,IAAI,CAAC,CAAC,CAAC,CAAC;QACnC,IAAI,CAAC,WAAW,EAAE,CAAC;KAGnB;IAED,sBAAI,GAAJ;QACC,MAAM,CAAC,IAAI,CAAC,cAAc,CAAC,CAAC;QAE5B,IAAI,CAAC,EAAE,CAAC,QAAQ,GAAG,IAAI,CAAC,UAAU,CAAC,WAAW,EAAE,CAAC;QACjD,IAAI,CAAC,EAAE,CAAC,MAAM,GAAG,IAAI,CAAC,UAAU,CAAC,SAAS,EAAE,CAAC;QAC7C,OAAO,CAAC,GAAG,CAAC,mBAAmB,EAC9B,IAAI,CAAC,EAAE,CAAC,QAAQ,CAAC,QAAQ,CAAC,YAAY,CAAC,EACvC,IAAI,CAAC,EAAE,CAAC,MAAM,CAAC,QAAQ,CAAC,YAAY,CAAC,EAAE,IAAI,CAAC,UAAU,CAAC,IAAI,EAAE,CAAC,CAAC;QAChE,IAAI,CAAC,EAAE,CAAC,IAAI,EAAE,CAAC;QAEf,IAAI,CAAC,MAAM,EAAE,CAAC;QACd,IAAI,CAAC,UAAU,CAAC,IAAI,EAAE,CAAC;QACvB,MAAM,CAAC,OAAO,CAAC,cAAc,CAAC,CAAC;KAC/B;IAED,sBAAI,GAAJ;QACC,MAAM,CAAC,IAAI,CAAC,cAAc,CAAC,CAAC;QAE5B,IAAI,IAAI,CAAC,CAAC,CAAC,eAAe,CAAC,CAAC,MAAM;eAC9B,IAAI,CAAC,CAAC,CAAC,eAAe,CAAC,CAAC,EAAE,CAAC,UAAU,CAAC,EAAE;SAC3C;QACD,IAAI,CAAC,UAAU,CAAC,IAAI,EAAE,CAAC;QACvB,MAAM,CAAC,OAAO,CAAC,cAAc,CAAC,CAAC;KAC/B;IAED,+BAAa,GAAb,UAAc,KAAiB;QAC9B,KAAK,CAAC,cAAc,EAAE,CAAC;QACvB,OAAO,CAAC,GAAG,CAAC,eAAe,CAAC,CAAC;QAC7B,IAAI,CAAC,KAAK,CAAC,KAAK,CAAC,aAAa,CAAC,IAAI,CAAC,KAAK,CAAC,QAAQ,CAAC,CAAC;KACpD;IAEF,cAAC;CAAA,CA/IoC,oBAAoB;;ACjBzD,IAAMD,UAAQ,GAAG,OAAO,CAAC,UAAU,CAAC,CAAC;AACrC,IAAI,GAAG,GAAG,OAAO,CAAC,KAAK,CAAC,CAAC;AACzB,IAAI,EAAE,GAAG,OAAO,CAAC,UAAU,CAAC,CAAC;AAed;IAA0B,+BAAc;IAOtD,qBAAY,UAAkB,EAAE,OAAgB;QAAhD,YACC,kBAAM,UAAU,EAAE,OAAO,CAAC,SAqC1B;QApCA,KAAI,CAAC,QAAQ,GAAQ;YACpB,OAAO,EAAE,IAAI;SACb,CAAC;QAEF,IAAI,KAAK,CAAC;QACV,IAAI,KAAK,GAAG,KAAI,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC;QAC7B,IAAI,KAAK,YAAY,IAAI,EAAE;YAC1B,KAAK,GAAG,KAAK,CAAC,KAAK,EAAE,CAAC;YACtB,KAAK,GAAG,KAAK,CAAC,QAAQ,CAAC,UAAU,CAAC,CAAC;SACnC;aAAM;YACN,KAAK,GAAG,IAAI,IAAI,CAAC,KAAK,CAAC,CAAC;YACxB,IAAI,UAAU,GAAG,CAAC,KAAK,CAAE,KAAK,CAAC,OAAO,EAAE,CAAE,CAAC;YAC3C,IAAI,CAAC,KAAK,IAAI,CAAC,UAAU,EAAE;gBAC1B,KAAK,GAAG,IAAI,CAAC,UAAU,CAAC,KAAK,EAAE,UAAU,CAAC,CAAC;aAC3C;YACD,KAAI,CAAC,GAAG,CAAC,MAAM,EAAE,KAAK,CAAC,CAAC;SACxB;QAID,IAAI,CAAC,KAAI,CAAC,GAAG,CAAC,IAAI,CAAC,EAAE;YACpB,KAAI,CAAC,GAAG,CAAC,IAAI,EAAE,GAAG,CAAC,KAAK,GAAG,KAAI,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC;SAChD;QAED,KAAI,CAAC,GAAG,CAAC,QAAQ,EAAE,UAAU,CAAC,KAAI,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC;QACnD,IAAI,CAAC,KAAI,CAAC,GAAG,CAAC,SAAS,CAAC,EAAE;YACzB,KAAI,CAAC,GAAG,CAAC,SAAS,EAAE,IAAI,CAAC,CAAC;SAC1B;QAGD,KAAI,CAAC,GAAG,CAAC,UAAU,EAAE,KAAI,CAAC,GAAG,CAAC,UAAU,CAAC,IAAI,SAAS,CAAC,CAAC;QAGxD,KAAI,CAAC,GAAG,CAAC,MAAM,EAAE,KAAI,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC,CAAC;QAEnC,KAAI,CAAC,GAAG,CAAC,MAAM,EAAE,KAAI,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC,CAAC;;KACnC;IAED,0BAAI,GAAJ;QACC,OAAO,IAAI,CAAC,GAAG,CAAC,QAAQ,CAAC,IAAI,CAAC,GAAG,UAAU,GAAG,UAAU,CAAC;KACzD;IAED,4BAAM,GAAN;QACC,IAAI,IAAI,GAAG,iBAAM,MAAM,WAAE,CAAC;QAC1B,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC,IAAI,EAAE,CAAC;QACxB,IAAI,CAAC,EAAE,GAAG,IAAI,CAAC,EAAE,CAAC;QAClB,OAAO,IAAI,CAAC;KACZ;IAED,iCAAW,GAAX,UAAY,QAAQ;QACnB,IAAI,CAAC,GAAG,CAAC,UAAU,EAAE,QAAQ,CAAC,CAAC;QAC/B,IAAI,CAAC,UAAU,CAAC,YAAY,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC;KAC1C;IAKD,6BAAO,GAAP;QACC,IAAI,IAAI,GAAG,IAAI,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC;QAC5B,IAAI,EAAE,IAAI,YAAY,IAAI,CAAC,EAAE;YAC5B,IAAI,GAAG,IAAI,IAAI,CAAC,IAAI,CAAC,CAAC;SACtB;QACD,OAAO,IAAI,CAAC;KACZ;IAED,+BAAS,GAAT;QACC,OAAO,IAAI,CAAC,GAAG,CAAC,SAAS,CAAC,CAAC;KAC3B;IAED,+BAAS,GAAT;QACC,OAAO,IAAI,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC;KAC1B;IAEF,kBAAC;CAAA,CAlFwCA,UAAQ,CAAC,KAAK;;ACbvD,IAAM,IAAI,GAAG,OAAO,CAAC,WAAW,CAAC,CAAC;AAClC,AAEA,OAAO,CAAC,QAAQ,CAAC,CAAC;AAaH;IAId,kBAAY,IAAa;QACxB,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC;KACjB;IAED,oCAAiB,GAAjB;QACC,IAAI,GAAG,CAAC;QACR,IAAI,OAAO,QAAQ,IAAI,wBAAwB,EAAE;YAChD,IAAI,MAAM,GAAG,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,IAAI,EAAE;gBAClC,MAAM,EAAE,IAAI;gBACZ,aAAa,EAAE,IAAI;gBACnB,cAAc,EAAE,IAAI;gBACpB,QAAQ,EAAE,GAAG;aACb,CAAC,CAAC;YACH,GAAG,GAAG,MAAM,CAAC,IAAI,CAAC;SAClB;aAAM;YACN,GAAG,GAAG,KAAK,CAAC,QAAQ,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;SAChC;QACD,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC;QACjB,OAAO,CAAC,GAAG,CAAC,kBAAkB,EAAE,GAAG,CAAC,MAAM,CAAC,CAAC;QAC5C,GAAG,GAAG,GAAG,CAAC,IAAI,EAAE,CAAC;QAEjB,OAAO,CAAC,GAAG,CAAC,iBAAiB,EAAE,GAAG,CAAC,MAAM,CAAC,CAAC;QAC3C,GAAG,GAAG,IAAI,CAAC,UAAU,CAAC,GAAG,CAAC,CAAC;QAC3B,OAAO,CAAC,GAAG,CAAC,oBAAoB,EAAE,GAAG,CAAC,MAAM,CAAC,CAAC;QAC9C,GAAG,GAAG,IAAI,CAAC,YAAY,CAAC,GAAG,CAAC,CAAC;QAC7B,OAAO,CAAC,GAAG,CAAC,sBAAsB,EAAE,GAAG,CAAC,MAAM,CAAC,CAAC;QAChD,GAAG,GAAG,IAAI,CAAC,gBAAgB,CAAC,GAAG,CAAC,CAAC;QACjC,OAAO,CAAC,GAAG,CAAC,6BAA6B,EAAE,GAAG,CAAC,MAAM,CAAC,CAAC;QACvD,OAAO,GAAG,CAAC;KACX;IAMM,6BAAU,GAAjB,UAAkB,IAAW;QAE5B,IAAI,UAAU,GAAG,CAAC,CAAC;QACnB,IAAI,CAAC,OAAO,CAAC,UAAC,GAAG,EAAE,CAAC;YACnB,IAAI,CAAC,GAAG,CAAC,MAAM,KAAK,GAAG,CAAC,MAAM,IAAI,CAAC,IAAI,GAAG,CAAC,CAAC,CAAC,IAAI,EAAE,CAAC,EAAE;gBACrD,UAAU,GAAG,CAAC,GAAC,CAAC,CAAC;aACjB;SACD,CAAC,CAAC;QACH,OAAO,CAAC,GAAG,CAAC,UAAU,EAAE,UAAU,EAAE,YAAY,CAAC,CAAC;QAClD,IAAI,MAAM,GAAG,IAAI,CAAC,KAAK,CAAC,UAAU,CAAC,CAAC;QACpC,OAAO,IAAI,KAAK,CAAC,MAAM,CAAC,CAAC;KACzB;IAKO,+BAAY,GAApB,UAAqB,IAAW;QAE/B,IAAI,OAAO,GAAG,IAAI,CAAC,sBAAsB,EAAE,CAAC;QAC5C,OAAO,GAAG,OAAO,CAAC,gBAAgB,EAAE,CAAC;QAErC,IAAI,OAAO,GAAG,OAAO,CAAC,IAAI,EAAE,CAAC;QAC7B,IAAI,MAAM,GAAG,IAAI,GAAG,CAAC,OAAO,CAAC,CAAC;QAC9B,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,SAAS,CAAC,MAAM,CAAC,EAAE,QAAQ,CAAC,CAAC;QAC9C,IAAI,GAAG,MAAM,CAAC,cAAc,CAAC,IAAI,CAAC,CAAC;QACnC,OAAO,CAAC,GAAG,CAAC,2BAA2B,EAAE,IAAI,CAAC,MAAM,CAAC,CAAC;QAEtD,IAAI,cAAc,GAAG,IAAI,KAAK,EAAE,CAAC;QACjC,IAAI,CAAC,OAAO,CAAC,UAAC,GAAG,EAAE,CAAC;YACnB,IAAI,MAAM,GAAG,MAAM,CAAC,kBAAkB,CAAC,GAAG,EAAE,CAAC,CAAC,CAAC;YAC/C,IAAI,CAAC,IAAI,CAAC,EAAE;gBACX,GAAG,CAAC,IAAI,CAAC,GAAG,EAAE,MAAM,CAAC,CAAC;gBACtB,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,SAAS,CAAC,MAAM,CAAC,EAAE,QAAQ,CAAC,CAAC;aAC9C;YACD,cAAc,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;SAC5B,CAAC,CAAC;QAGH,OAAO,cAAc,CAAC;KACtB;IAQD,sBAAG,GAAH,UAAI,KAAoB,EAAE,MAAkB;QAC3C,IAAI,MAAM,GAAG,IAAI,GAAG,EAAE,CAAC;QACvB,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,KAAK,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;YACtC,MAAM,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,GAAG,MAAM,CAAC,CAAC,CAAC,CAAC;SAC7B;QACD,OAAO,MAAM,CAAC;KACd;IAEO,mCAAgB,GAAxB,UAAyB,GAAU;QAClC,GAAG,CAAC,OAAO,CAAC,UAAC,GAAG,EAAE,CAAC;YAClB,IAAI,GAAG,CAAC,MAAM,EAAE;gBACf,GAAG,CAAC,MAAM,GAAG,WAAW,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC;gBAErC,IAAI,IAAI,GAAG,IAAI,CAAC,UAAU,CAAC,GAAG,CAAC,IAAI,EAAE,YAAY,CAAC,CAAC;gBACnD,IAAI,CAAC,IAAI,EAAE;oBACV,IAAI,GAAG,IAAI,CAAC,UAAU,CAAC,GAAG,CAAC,IAAI,EAAE,UAAU,CAAC,CAAC;oBAC7C,IAAI,CAAC,IAAI,EAAE;wBACV,OAAO,CAAC,IAAI,CAAC,kBAAkB,EAAE,GAAG,CAAC,IAAI,EAAE,IAAI,CAAC,CAAC;qBACjD;iBACD;gBAED,IAAI,IAAI,EAAE;oBACT,GAAG,CAAC,IAAI,GAAG,IAAI,CAAC;iBAChB;aAED;iBAAM;gBAEN,OAAO,GAAG,CAAC,CAAC,CAAC,CAAC;aACd;SACD,CAAC,CAAC;QACH,OAAO,GAAG,CAAC;KACX;IACF,eAAC;CAAA;;AC/HD,OAAO,CAAC,GAAG,CAAC,WAAW,CAAC,UAAU,CAAC,CAAC,CAAC;AACrC,OAAO,CAAC,KAAK,CAAC,WAAW,CAAC,UAAU,CAAC,CAAC,CAAC;AAGvC,OAAO,CAAC,YAAY,CAAC,CAAC;AAGtB,IAAII,QAAM,GAAG,OAAO,CAAC,QAAQ,CAAC,CAAC;AAC/BA,QAAM,CAAC,SAAS,CAAC;IAChB,KAAK,EAAE,IAAI;CACX,CAAC,CAAC;AACH,IAAME,QAAM,GAAG,OAAO,CAAC,QAAQ,CAAC,CAAC;AACjC,IAAM,MAAM,GAAG,OAAO,CAAC,QAAQ,CAAC,CAAC,MAAM,EAAE,CAAC;AAC1C,IAAMN,UAAQ,GAAG,OAAO,CAAC,UAAU,CAAC,CAAC;AACrC,OAAO,CAAC,uBAAuB,CAAC,CAAC;AACjC,IAAMC,GAAC,GAAG,OAAO,CAAC,QAAQ,CAAC,CAAC;AAC5B,IAAMF,IAAC,GAAG,OAAO,CAAC,YAAY,CAAC,CAAC;AAEjB;IAAmB,wBAA8B;IAgB/D,cAAY,QAAkB;QAA9B,YACC,iBAAO,SAUP;QAzBD,SAAG,GAAGE,GAAC,CAAC,MAAM,CAAC,CAAC;QAQhB,kBAAY,GAAG,IAAID,UAAQ,CAAC,YAAY,CAAC,UAAU,CAAC,CAAC;QAQpD,KAAI,CAAC,KAAK,GAAG,QAAQ,CAAC;QACtB,KAAI,CAAC,QAAQ,CAAC,KAAI,CAAC,KAAK,EAAE,QAAQ,EAAE,KAAI,CAAC,MAAM,CAAC,CAAC;QACjD,KAAI,CAAC,oBAAoB,GAAGD,IAAC,CAAC,QAAQ,CAAC,KAAI,CAAC,gBAAgB,EAAE,GAAG,CAAC,CAAC;QAEnE,IAAI,SAAS,GAAGE,GAAC,CAAC,WAAW,CAAC,CAAC;QAC/B,SAAS,CAAC,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,KAAK,CAAC,EAAE,UAAC,IAAI;YAC1C,KAAI,CAAC,QAAQ,GAAGF,IAAC,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC;YACjC,KAAI,CAAC,MAAM,EAAE,CAAC;SACd,CAAC,CAAC;;KACH;IAED,qBAAM,GAAN;QACC,IAAI,IAAI,CAAC,QAAQ,EAAE;YAClB,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC;gBAC3B,UAAU,EAAE,IAAI,CAAC,KAAK,CAAC,IAAI,EAAE;gBAC7B,MAAM,EAAE,IAAI,CAAC,YAAY,CAAC,OAAO,EAAE,CAAC,MAAM;aAC1C,CAAC,CAAC,CAAC;YACJ,IAAI,CAAC,CAAC,CAAC,UAAU,CAAC,CAAC,EAAE,CAAC,OAAO,EAAE,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;YACxD,IAAI,CAAC,CAAC,CAAC,WAAW,CAAC,CAAC,EAAE,CAAC,OAAO,EAAE,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;YAG1D,YAAY,CAAC,UAAU,CAAC,QAAQ,CAAC,cAAc,CAAC,gBAAgB,CAAC,EAAE;gBAClE,aAAa,EAAE,MAAM;gBACrB,EAAE,EAAE;oBACH,IAAI,EAAE,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC;iBAC1B;aACD,CAAC,CAAC;YAGH,YAAY,CAAC,UAAU,CAAC,QAAQ,CAAC,cAAc,CAAC,iBAAiB,CAAC,EAAE;gBACnE,aAAa,EAAE,MAAM;gBACrB,EAAE,EAAE;oBACH,IAAI,EAAE,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,IAAI,CAAC;iBAC9B;aACD,CAAC,CAAC;YAEH,IAAI,CAAC,CAAC,CAAC,OAAO,CAAC,CAAC,EAAE,CAAC,OAAO,EAAE,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;YAClD,IAAI,CAAC,CAAC,CAAC,QAAQ,CAAC,CAAC,EAAE,CAAC,OAAO,EAAE,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;YACpD,IAAI,CAAC,CAAC,CAAC,WAAW,CAAC,CAAC,EAAE,CAAC,OAAO,EAAE,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;SAC1D;aAAM;YACN,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,aAAa,CAAC,CAAC;SAC7B;QACD,OAAO,IAAI,CAAC;KACZ;IAED,sBAAO,GAAP;QACCO,QAAM,CAAC,OAAO,CAAC,eAAe,CAAC,CAAC;QAChC,IAAI,CAAC,MAAM,EAAE,CAAC;KACd;IAED,mBAAI,GAAJ,UAAK,CAAC,EAAE,IAAI;QACX,OAAO,CAAC,GAAG,CAAC,CAAC,EAAE,IAAI,CAAC,CAAC;QAErB,IAAI,CAAC,gBAAgB,CAAC,CAAC,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC;KACvC;IAED,+BAAgB,GAAhB,UAAiB,IAAY;QAA7B,iBAgBC;QAfA,IAAI,CAAC,YAAY,EAAE,CAAC;QAEpB,IAAI,MAAM,GAAG,IAAI,QAAQ,CAAC,IAAI,CAAC,CAAC;QAChC,IAAI,GAAG,GAAG,MAAM,CAAC,iBAAiB,EAAE,CAAC;QAErC,OAAO,IAAI,CAAC,QAAQ,CAAC,GAAG,EAAE;YACzB,OAAO,EAAE;gBACRF,QAAM,CAAC,IAAI,CAAC,uBAAuB,CAAC,CAAC;gBACrC,OAAO,CAAC,GAAG,CAAC,6BAA6B,CAAC,CAAC;gBAC3C,KAAI,CAAC,KAAK,CAAC,IAAI,CAAC,UAAC,KAAkB;oBAClC,KAAI,CAAC,YAAY,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;iBAChC,CAAC,CAAC;gBACHA,QAAM,CAAC,OAAO,CAAC,uBAAuB,CAAC,CAAC;aACxC;SACD,CAAC,CAAC;KACH;IAED,uBAAQ,GAAR,UAAS,GAAU,EAAE,OAA2B;QAC/C,IAAI,4BAA4B,GAAG,KAAK,CAAC;QACzC,IAAI,4BAA4B,EAAE;YACjCL,IAAC,CAAC,IAAI,CAAC,GAAG,EAAE,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;YACxC,IAAI,CAAC,WAAW,CAAC,GAAG,CAAC,MAAM,EAAE,OAAO,CAAC,CAAC;SACtC;aAAM;YACNQ,WAAS,CAAC,GAAG,EACZ,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,IAAI,CAAC,EAC1B,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,IAAI,EAAE,GAAG,CAAC,MAAM,EAAE,OAAO,CAAC,CAAC,CAAC;SACnD;KACD;IAED,2BAAY,GAAZ;QACC,OAAO,CAAC,GAAG,CAAC,cAAc,CAAC,CAAC;QAC5B,IAAI,CAAC,WAAW,GAAG,CAAC,CAAC;QACrB,IAAI,QAAQ,GAAGR,IAAC,CAAC,QAAQ,CAACE,GAAC,CAAC,qBAAqB,CAAC,CAAC,IAAI,EAAE,CAAC,CAAC;QAC3D,IAAI,CAAC,CAAC,CAAC,eAAe,CAAC,CAAC,IAAI,CAAC,QAAQ,EAAE,CAAC,CAAC;KACzC;IAED,yBAAU,GAAV,UAAW,GAAQ,EAAE,CAAS,EAAE,MAAc;QAC7C,IAAI,CAAC,oBAAoB,CAAC,CAAC,EAAE,MAAM,CAAC,CAAC;QACrC,IAAI,GAAG,IAAI,GAAG,CAAC,MAAM,EAAE;YACtB,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,IAAI,WAAW,CAAC,GAAG,CAAC,EAAE,EAAE,MAAM,EAAE,IAAI,EAAE,CAAC,CAAC;SACvD;KACD;IAED,+BAAgB,GAAhB,UAAiB,CAAS,EAAE,MAAc;QACzC,IAAI,OAAO,GAAG,IAAI,CAAC,KAAK,CAAC,GAAG,GAAG,CAAC,GAAG,MAAM,CAAC,CAAC;QAE3C,IAAI,OAAO,IAAI,IAAI,CAAC,WAAW,EAAE;YAEhCA,GAAC,CAAC,oCAAoC,CAAC,CAAC,KAAK,CAAC,OAAO,GAAG,GAAG,CAAC,CAAC;YAC7D,IAAI,CAAC,WAAW,GAAG,OAAO,CAAC;SAC3B;KACD;IAED,0BAAW,GAAX,UAAY,KAAK,EAAE,OAA4B;QAC9C,OAAO,CAAC,GAAG,CAAC,oBAAoB,EAAE,KAAK,EAAE,OAAO,CAAC,CAAC;QAClD,IAAI,OAAO,IAAI,OAAO,CAAC,OAAO,EAAE;YAC/B,OAAO,CAAC,OAAO,EAAE,CAAC;SAClB;QAKD,OAAO,CAAC,GAAG,CAAC,4BAA4B,CAAC,CAAC;QAC1C,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAC;QAE7B,IAAI,EAAE,GAAG,WAAW,CAAC,WAAW,EAAE,CAAC;QACnC,EAAE,CAAC,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;QAEtBD,UAAQ,CAAC,OAAO,CAAC,QAAQ,CAAC,GAAG,EAAE;YAC9B,OAAO,EAAE,IAAI;SACb,CAAC,CAAC;KACH;IAED,uBAAQ,GAAR,UAAS,CAAC,EAAE,IAAI;QAAhB,iBAkBC;QAdA,IAAI;YACH,IAAI,IAAI,GAAG,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC;YACvCM,QAAM,CAAC,IAAI,CAAC,YAAY,GAAC,IAAI,CAAC,MAAM,GAAC,UAAU,CAAC,CAAC;YACjDP,IAAC,CAAC,IAAI,CAAC,IAAI,EAAE,UAAC,GAAG;gBAChB,KAAI,CAAC,KAAK,CAAC,GAAG,CAAC,IAAI,WAAW,CAAC,GAAG,CAAC,CAAC,CAAC;aACrC,CAAC,CAAC;YACHO,QAAM,CAAC,OAAO,CAAC,UAAU,CAAC,CAAC;YAC3B,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAC;YAC7BN,UAAQ,CAAC,OAAO,CAAC,QAAQ,CAAC,GAAG,EAAE;gBAC9B,OAAO,EAAE,IAAI;aACb,CAAC,CAAC;SACH;QAAC,OAAO,CAAC,EAAE;YACX,KAAK,CAAC,CAAC,CAAC,CAAC;SACT;KACD;IAED,mBAAI,GAAJ;QACC,IAAI,IAAI,GAAG,IAAI,CAAC,KAAK,CAAC,YAAY,CAAC,OAAO,EAAE,CAAC;QAE7C,IAAI,IAAI,GAAG,IAAI,CAAC,SAAS,CAAC,IAAI,EAAE,IAAI,EAAE,IAAI,CAAC,CAAC;QAC5C,IAAI,IAAI,GAAG,IAAI,IAAI,CAAC,CAAC,IAAI,CAAC,EAAE;YAC3B,IAAI,EAAE,gCAAgC;SACtC,CAAC,CAAC;QACH,IAAI,QAAQ,GAAG,WAAW,GAAC,IAAI,CAAC,KAAK,EAAE,CAAC,QAAQ,CAAC,YAAY,CAAC,GAAC,OAAO,CAAC;QAEvE,MAAM,CAAC,IAAI,EAAE,QAAQ,CAAC,CAAC;KACvB;IAED,oBAAK,GAAL;QACC,OAAO,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC;QACrB,IAAI,OAAO,CAAC,kFAAkF,CAAC,EAAE;YAChG,IAAI,YAAY,GAAG,IAAIA,UAAQ,CAAC,YAAY,CAAC,UAAU,CAAC,CAAC;YACzD,YAAY,CAAC,MAAM,EAAE,CAAC;YACtB,IAAI,IAAI,CAAC,KAAK,EAAE;gBACf,IAAI,CAAC,KAAK,CAAC,KAAK,EAAE,CAAC;aACnB;YACD,IAAI,CAAC,MAAM,EAAE,CAAC;SACd;KACD;IAED,uBAAQ,GAAR;QACCM,QAAM,CAAC,IAAI,CAAC,eAAe,CAAC,CAAC;QAC7B,IAAI,MAAM,GAAG,GAAG,CAAC;QACjB,IAAI,OAAO,GAAG,MAAM,CAAC,IAAI,EAAE,CAAC;QAC5B,IAAI,UAAU,GAAG,IAAI,CAAC,MAAM,CAAC,YAAY,CAAC;QAC1C,KAAc,UAAe,EAAf,KAAAP,IAAC,CAAC,KAAK,CAAC,MAAM,CAAC,EAAf,cAAe,EAAf,IAAe;YAAxB,AACJ,IAAI,QAAQ,GAAG,UAAU,CAAC,MAAM,EAAE,CAAC;YACnC,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,IAAI,WAAW,CAAC;gBAC9B,OAAO,EAAE,OAAO;gBAChB,QAAQ,EAAE,QAAQ,CAAC,GAAG,CAAC,SAAS,CAAC,IAAI,SAAS;gBAC9C,QAAQ,EAAE,KAAK;gBACf,MAAM,EAAE,MAAM,CAAC,QAAQ,CAAC,EAAC,KAAK,EAAE,CAAC,EAAE,GAAG,EAAE,CAAC,IAAI,EAAE,GAAG,EAAE,IAAI,EAAC,CAAC;gBAC1D,YAAY,EAAE,YAAY;gBAC1B,IAAI,EAAE,MAAM,CAAC,IAAI,CAAC,EAAC,IAAI,EAAE,IAAI,IAAI,EAAE,CAAC,WAAW,EAAE,EAAC,CAAC;gBACnD,IAAI,EAAE,MAAM,CAAC,QAAQ,EAAE;aACvB,CAAC,CAAC,CAAC;SACJ;QACDO,QAAM,CAAC,OAAO,CAAC,YAAY,GAAC,MAAM,GAAC,WAAW,CAAC,CAAC;QAChD,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAC;QAC7BN,UAAQ,CAAC,OAAO,CAAC,QAAQ,CAAC,GAAG,EAAE;YAC9B,OAAO,EAAE,IAAI;SACb,CAAC,CAAC;KACH;IAED,uBAAQ,GAAR;QACCM,QAAM,CAAC,OAAO,CAAC,WAAW,CAAC,CAAC;QAC5B,IAAI,CAAC,KAAK,CAAC,OAAO,EAAE,CAAC;QACrB,IAAI,CAAC,MAAM,EAAE,CAAC;KACd;IAKD,mBAAI,GAAJ;KAEC;IAEF,WAAC;CAAA,CArOiC,oBAAoB;;AC7BvC;IAAA;KAiJd;IApHA,6BAAK,GAAL;QACC,OAAO,SAAS,CAAC;KACjB;IAED,kCAAU,GAAV,UAAW,GAAyC;KACnD;IAID,8BAAM,GAAN,UAAO,cAAe;QAAE,yBAAkB;aAAlB,UAAkB,EAAlB,qBAAkB,EAAlB,IAAkB;YAAlB,wCAAkB;;KACzC;IAID,4BAAI,GAAJ,UAAK,YAAa;QAAE,uBAAgB;aAAhB,UAAgB,EAAhB,qBAAgB,EAAhB,IAAgB;YAAhB,sCAAgB;;KACnC;IAID,4BAAI,GAAJ,UAAK,YAAa;QAAE,uBAAgB;aAAhB,UAAgB,EAAhB,qBAAgB,EAAhB,IAAgB;YAAhB,sCAAgB;;KACnC;IAID,gCAAQ,GAAR,UAAS,gBAAiB;QAAE,2BAAoB;aAApB,UAAoB,EAApB,qBAAoB,EAApB,IAAoB;YAApB,0CAAoB;;KAC/C;IAKD,+BAAO,GAAP,UAAQ,MAAO;KACd;IAUD,4BAAI,GAAJ,UAAK,UAAW,EAAE,UAAW,EAAE,cAAe;KAC7C;IAcD,4BAAI,GAAJ,UAAK,UAAW,EAAE,UAAW,EAAE,cAAe;KAC7C;IAID,wBAAA,OAAK,CAAA,GAAL,UAAM,UAAW;KAChB;IAID,wCAAgB,GAAhB,UAAiB,QAAgB;QAChC,OAAO,SAAS,CAAC;KACjB;IAID,6BAAK,GAAL,UAAM,UAAmB;KACxB;IAED,6BAAK,GAAL,UAAM,GAAc,EAAE,UAAkB,EAAE,WAAmB;KAC5D;IAED,6CAAqB,GAArB;QACC,OAAO,SAAS,CAAC;KACjB;IAED,yCAAiB,GAAjB,UAAkB,MAAc;QAC/B,OAAO,SAAS,CAAC;KACjB;IAED,wCAAgB,GAAhB;QACC,OAAO,SAAS,CAAC;KACjB;IAED,4BAAI,GAAJ,UAAK,MAAc,EAAE,GAAW,EAAE,KAAe,EAAE,IAAa,EAAE,QAAiB;KAClF;IAKD,4BAAI,GAAJ,UAAK,IAAK;KACT;IAED,wCAAgB,GAAhB,UAAiB,MAAc,EAAE,KAAa;KAC7C;IAMD,wCAAgB,GAAhB,UAAiB,IAAI,EAAE,QAAS,EAAE,UAAW;KAC5C;IAED,qCAAa,GAAb,UAAc,GAAU;QACvB,OAAO,SAAS,CAAC;KACjB;IAED,2CAAmB,GAAnB,UAAoB,IAAY,EAAE,QAA6C,EAAE,OAAwC;KACxH;IAEF,oBAAC;CAAA;;ACzID,IAAMN,UAAQ,GAAG,OAAO,CAAC,UAAU,CAAC,CAAC;AACrC,AAEA,IAAMA,UAAQ,GAAG,OAAO,CAAC,UAAU,CAAC,CAAC;AAErC,OAAO,CAAC,uBAAuB,CAAC,CAAC;AAEjC,OAAO,CAAC,QAAQ,CAAC,CAAC;AAClB,IAAII,QAAM,GAAG,OAAO,CAAC,QAAQ,CAAC,CAAC;AAC/BA,QAAM,CAAC,SAAS,CAAC;IAChB,KAAK,EAAE,IAAI;CACX,CAAC,CAAC;AACH,IAAIL,IAAC,GAAG,OAAO,CAAC,YAAY,CAAC,CAAC;AAEf;IAAuB,4BAAgC;IAarE,kBAAY,MAAiC,EAAE,OAAa;QAA5D,YACC,kBAAM,MAAM,EAAE,OAAO,CAAC,SAOtB;QANA,KAAI,CAAC,YAAY,GAAG,IAAIC,UAAQ,CAAC,YAAY,CAAC,UAAU,CAAC,CAAC;QAC1D,KAAI,CAAC,QAAQ,CAAC,KAAI,EAAE,QAAQ,EAAE;YAC7B,OAAO,CAAC,GAAG,CAAC,wBAAwB,CAAC,CAAC;YACtC,KAAI,CAAC,OAAO,EAAE,CAAC;SACf,CAAC,CAAC;QACH,KAAI,CAAC,EAAE,CAAC,KAAK,EAAEK,OAAK,CAAC,UAAU,CAAC,CAAC,CAAC;;KAClC;IAbD,6BAAU,GAAV,UAAW,OAAoB,EAAE,EAAgB;QAChD,OAAO,OAAO,CAAC,IAAI,IAAI,EAAE,CAAC,IAAI;cAC3B,CAAC,IAAI,OAAO,CAAC,IAAI,GAAG,EAAE,CAAC,IAAI,GAAG,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;KACzC;IAiBD,wBAAK,GAAL,UAAM,OAAoC;QAA1C,iBAYC;QAZK,wBAAA,EAAA,YAAoC;QACzC,IAAI,MAAM,GAAG,IAAI,CAAC,YAAY,CAAC,OAAO,EAAE,CAAC;QACzC,OAAO,CAAC,GAAG,CAAC,gBAAgB,EAAE,MAAM,CAAC,MAAM,CAAC,CAAC;QAC7C,IAAI,MAAM,CAAC,MAAM,EAAE;YAClBN,IAAC,CAAC,IAAI,CAAC,MAAM,EAAE,UAAC,EAAE;gBACjB,KAAI,CAAC,GAAG,CAAC,IAAI,WAAW,CAAC,EAAE,CAAC,CAAC,CAAC;aAC9B,CAAC,CAAC;YAEH,IAAI,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAC;SACvB;QACD,OAAO,CAAC,GAAG,CAAC,MAAM,EAAE,IAAI,CAAC,MAAM,CAAC,CAAC;QACjC,OAAO,IAAI,aAAa,EAAE,CAAC;KAC3B;IAMD,8BAAW,GAAX;QACC,IAAI,OAAO,GAAG,IAAI,CAAC,UAAU,EAAE,CAAC;QAChC,IAAI,GAAG,GAAG,IAAI,IAAI,EAAE,CAAC,QAAQ,CAAC,EAAE,CAAC,CAAC,OAAO,EAAE,CAAC;QAC5CA,IAAC,CAAC,IAAI,CAAC,OAAO,EAAE,UAAC,GAAgB;YAChC,IAAI,IAAI,GAAW,GAAG,CAAC,OAAO,EAAE,CAAC,OAAO,EAAE,CAAC;YAC3C,IAAI,IAAI,GAAG,GAAG,EAAE;gBACf,GAAG,GAAG,IAAI,CAAC;aACX;SACD,CAAC,CAAC;QACH,OAAO,IAAI,IAAI,CAAC,GAAG,CAAC,CAAC;KACrB;IAMD,8BAAW,GAAX;QACC,IAAI,OAAO,GAAG,IAAI,CAAC,UAAU,EAAE,CAAC;QAChC,IAAI,GAAG,GAAG,IAAI,IAAI,CAAC,YAAY,CAAC,CAAC,OAAO,EAAE,CAAC;QAC3CA,IAAC,CAAC,IAAI,CAAC,OAAO,EAAE,UAAC,GAAgB;YAChC,IAAI,IAAI,GAAW,GAAG,CAAC,OAAO,EAAE,CAAC,OAAO,EAAE,CAAC;YAC3C,IAAI,IAAI,GAAG,GAAG,EAAE;gBACf,GAAG,GAAG,IAAI,CAAC;aACX;SACD,CAAC,CAAC;QACH,OAAO,IAAI,IAAI,CAAC,GAAG,CAAC,CAAC;KACrB;IAED,8BAAW,GAAX;QACC,IAAI,CAAC,IAAI,CAAC,IAAI,EAAE,EAAE;YACjB,OAAO,IAAI,IAAI,EAAE,CAAC;SAClB;QACD,IAAI,GAAG,GAAG,IAAI,IAAI,EAAE,CAAC,QAAQ,CAAC,EAAE,CAAC,CAAC,OAAO,EAAE,CAAC;QAC5C,IAAI,CAAC,IAAI,CAAC,UAAC,GAAgB;YAC1B,IAAI,KAAK,GAAG,GAAG,CAAC,OAAO,EAAE,CAAC;YAC1B,IAAI,IAAI,GAAW,KAAK,CAAC,OAAO,EAAE,CAAC;YACnC,IAAI,IAAI,GAAG,GAAG,EAAE;gBACf,GAAG,GAAG,IAAI,CAAC;aACX;SACD,CAAC,CAAC;QACH,OAAO,IAAI,IAAI,CAAC,GAAG,CAAC,CAAC;KACrB;IAED,4BAAS,GAAT;QACC,IAAI,CAAC,IAAI,CAAC,IAAI,EAAE,EAAE;YACjB,OAAO,IAAI,IAAI,EAAE,CAAC;SAClB;QACD,IAAI,GAAG,GAAG,IAAI,IAAI,CAAC,YAAY,CAAC,CAAC,OAAO,EAAE,CAAC;QAC3C,IAAI,CAAC,IAAI,CAAC,UAAC,GAAgB;YAC1B,IAAI,IAAI,GAAW,GAAG,CAAC,OAAO,EAAE,CAAC,OAAO,EAAE,CAAC;YAC3C,IAAI,IAAI,GAAG,GAAG,EAAE;gBACf,GAAG,GAAG,IAAI,CAAC;aACX;SACD,CAAC,CAAC;QACH,OAAO,IAAI,IAAI,CAAC,GAAG,CAAC,CAAC;KACrB;IAKM,gCAAa,GAApB;QACC,IAAI,CAAC,IAAI,CAAC,UAAC,KAAkB;YAC5B,KAAK,CAAC,GAAG,CAAC,SAAS,EAAE,IAAI,EAAE,EAAE,MAAM,EAAE,IAAI,EAAE,CAAC,CAAC;SAC7C,CAAC,CAAC;KACH;IAMD,gCAAa,GAAb,UAAc,CAAS;QACtB,IAAI,CAAC,CAAC,CAAC,MAAM;YAAE,OAAO;QACtBK,QAAM,CAAC,IAAI,CAAC,uBAAuB,CAAC,CAAC;QACrC,IAAI,IAAI,GAAG,CAAC,CAAC,WAAW,EAAE,CAAC;QAC3B,IAAI,CAAC,IAAI,CAAC,UAAC,GAAgB;YAC1B,IAAI,GAAG,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC,WAAW,EAAE,CAAC,OAAO,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,EAAE;gBACtD,GAAG,CAAC,GAAG,CAAC,SAAS,EAAE,KAAK,EAAE,EAAE,MAAM,EAAE,IAAI,EAAE,CAAC,CAAC;aAC5C;SACD,CAAC,CAAC;QACHA,QAAM,CAAC,OAAO,CAAC,uBAAuB,CAAC,CAAC;QACxC,IAAI,CAAC,OAAO,EAAE,CAAC;KACf;IAMD,gCAAa,GAAb,UAAc,aAAoB;QACjCA,QAAM,CAAC,IAAI,CAAC,uBAAuB,CAAC,CAAC;QACrC,IAAI,aAAa,EAAE;YAClB,IAAI,CAAC,aAAa,GAAG,aAAa,CAAC;SACnC;aAAM,IAAI,IAAI,CAAC,aAAa,EAAE;YAC9B,aAAa,GAAG,IAAI,CAAC,aAAa,CAAC;SACnC;aAAM;YAEN,IAAI,EAAE,GAAG,WAAW,CAAC,WAAW,EAAE,CAAC;YACnC,aAAa,GAAG,EAAE,CAAC,WAAW,EAAE,CAAC;SACjC;QAED,OAAO,CAAC,GAAG,CAAC,eAAe,EAAE,aAAa,CAAC,CAAC;QAC5C,IAAI,aAAa,EAAE;YAClB,IAAI,WAAW,GAAG,IAAI,CAAC,UAAU,CAAC,aAAa,CAAC,CAAC;YACjD,IAAI,SAAS,GAAGL,IAAC,CAAC,UAAU,CAAC,IAAI,CAAC,MAAM,EAAE,WAAW,CAAC,CAAC;YACvD,SAAS,CAAC,OAAO,CAAC,UAAC,GAAgB;gBAClC,GAAG,CAAC,GAAG,CAAC,SAAS,EAAE,KAAK,EAAE,EAAC,MAAM,EAAE,IAAI,EAAC,CAAC,CAAC;aAC1C,CAAC,CAAC;YACH,IAAI,CAAC,OAAO,EAAE,CAAC;SACf;QACDK,QAAM,CAAC,OAAO,CAAC,uBAAuB,CAAC,CAAC;KACxC;IAED,6BAAU,GAAV,UAAW,aAAmB;QAC7B,IAAI,QAAQ,GAAG,EAAE,CAAC;QAClB,IAAI,CAAC,IAAI,CAAC,UAAC,GAAgB;YAC1B,IAAI,KAAK,GAAS,GAAG,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC;YAClC,IAAI,QAAQ,GAAG,KAAK,CAAC,WAAW,EAAE,IAAI,aAAa,CAAC,WAAW,EAAE,CAAC;YAClE,IAAI,SAAS,GAAG,KAAK,CAAC,QAAQ,EAAE,IAAI,aAAa,CAAC,QAAQ,EAAE,CAAC;YAC7D,IAAI,QAAQ,IAAI,SAAS,EAAE;gBAC1B,QAAQ,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;aACnB;SACD,CAAC,CAAC;QACH,OAAO,QAAQ,CAAC;KAChB;IAED,mCAAgB,GAAhB,UAAiB,QAAuB;QACvCA,QAAM,CAAC,IAAI,CAAC,0BAA0B,CAAC,CAAC;QACxC,IAAI,CAAC,IAAI,CAAC,UAAC,GAAgB;YAC1B,IAAI,GAAG,CAAC,SAAS,EAAE,EAAE;gBACpB,IAAI,MAAM,GAAW,GAAG,CAAC,GAAG,CAAC,UAAU,CAAC,CAAC;gBACzC,IAAI,SAAS,GAAG,QAAQ,CAAC,OAAO,EAAE,IAAI,MAAM,CAAC;gBAE7C,GAAG,CAAC,GAAG,CAAC,SAAS,EAAE,SAAS,EAAE,EAAC,MAAM,EAAE,IAAI,EAAC,CAAC,CAAC;aAC9C;SACD,CAAC,CAAC;QACH,IAAI,CAAC,OAAO,EAAE,CAAC;QACfA,QAAM,CAAC,OAAO,CAAC,0BAA0B,CAAC,CAAC;KAC3C;IAED,0BAAO,GAAP;QAAA,iBAOC;QANAA,QAAM,CAAC,IAAI,CAAC,iBAAiB,CAAC,CAAC;QAC/B,IAAI,CAAC,YAAY,CAAC,MAAM,EAAE,CAAC;QAC3B,IAAI,CAAC,IAAI,CAAC,UAAC,KAAkB;YAC5B,KAAI,CAAC,YAAY,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;SAChC,CAAC,CAAC;QACHA,QAAM,CAAC,OAAO,CAAC,iBAAiB,CAAC,CAAC;KAClC;IAKD,kCAAe,GAAf;QACCA,QAAM,CAAC,IAAI,CAAC,yBAAyB,CAAC,CAAC;QACvC,IAAI,CAAC,IAAI,CAAC,UAAC,KAAkB;YAC5B,IAAI,KAAK,GAAG,KAAK,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC;YAC9B,IAAI,UAAU,GAAG,IAAI,IAAI,CAAC,KAAK,CAAC,CAAC;YACjC,OAAO,CAAC,GAAG,CAAC,KAAK,EAAE,UAAU,CAAC,CAAC;YAC/B,KAAK,CAAC,GAAG,CAAC,MAAM,EAAE,UAAU,CAAC,CAAC;SAC9B,CAAC,CAAC;QACHA,QAAM,CAAC,OAAO,CAAC,yBAAyB,CAAC,CAAC;KAC1C;IAED,6BAAU,GAAV;QACC,OAAO,IAAI,CAAC,KAAK,CAAC,EAAC,OAAO,EAAE,IAAI,EAAC,CAAC,CAAC;KACnC;IAED,kCAAe,GAAf;QACC,OAAO,IAAI,CAAC,UAAU,EAAE,CAAC,MAAM,CAAC;KAChC;IAED,4BAAS,GAAT;QACC,IAAI,CAAC,IAAI,EAAE,CAAC;QACZ,IAAI,OAAO,GAAG,IAAI,CAAC,UAAU,EAAE,CAAC;QAEhC,OAAO,OAAO,CAAC;KACf;IAED,gCAAa,GAAb,UAAc,QAA2B;QACxC,IAAI,CAAC,IAAI,CAAC,UAAC,GAAgB;YAC1B,IAAI,GAAG,CAAC,GAAG,CAAC,UAAU,CAAC,IAAI,SAAS,EAAE;gBACrC,QAAQ,CAAC,IAAI,CAAC,UAAC,GAAY;oBAE1B,IAAI,IAAI,GAAG,GAAG,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC;oBAC3B,IAAI,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,EAAE;wBAChC,OAAO,CAAC,GAAG,CAAC,IAAI,EAAE,UAAU,EAAE,GAAG,CAAC,IAAI,EAAE,MAAM,EAAE,GAAG,CAAC,QAAQ,CAAC,CAAC;wBAC9D,GAAG,CAAC,GAAG,CAAC,UAAU,EAAE,GAAG,CAAC,QAAQ,EAAE,EAAE,MAAM,EAAE,IAAI,EAAE,CAAC,CAAC;qBACpD;iBACD,CAAC,CAAC;aACH;SACD,CAAC,CAAC;QACH,IAAI,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAC;KACvB;IAQD,sCAAmB,GAAnB,UAAoB,QAAuB;QAC1C,IAAI,MAAM,GAAG,EAAE,CAAC;QAChB,IAAI,IAAI,GAAG,IAAI,CAAC,WAAW,EAAE,CAAC,qBAAqB,EAAE,CAAC;QACtD,IAAI,IAAI,GAAG,IAAI,CAAC,SAAS,EAAE,CAAC,oBAAoB,EAAE,CAAC;QAKnD,IAAI,KAAK,GAAG,CAAC,CAAC;gCACL,KAAK;YACb,IAAI,MAAM,GAAG,KAAK,CAAC,KAAK,EAAE,CAAC;YAC3B,MAAM,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC,GAAG,CAAiB,EAAC,OAAO,EAAE,CAAC,CAAC,EAAC,CAAC,CAAC;YAMvD,IAAI,GAAG,GAAG,CAAC,CAAC;YACZ,OAAK,IAAI,CAAC,UAAC,WAAwB;gBAClC,IAAI,YAAY,GAAG,WAAW,CAAC,GAAG,CAAC,UAAU,CAAC,IAAI,QAAQ,CAAC,OAAO,EAAE,CAAC;gBACrE,IAAI,SAAS,GAAG,WAAW,CAAC,OAAO,EAAE,CAAC,OAAO,CAAC,KAAK,EAAE,MAAM,CAAC,CAAC;gBAC7D,IAAI,YAAY,IAAI,SAAS,EAAE;oBAS9B,GAAG,IAAI,WAAW,CAAC,SAAS,EAAE,CAAC;oBAC/B,KAAK,EAAE,CAAC;oBACR,QAAQ,CAAC,cAAc,EAAE,CAAC;iBAE1B;aACD,CAAC,CAAC;YACH,MAAM,CAAC,KAAK,CAAC,QAAQ,CAAC,SAAS,CAAC,CAAC,GAAG,IAAI,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC;SAC7D;;QA5BD,KAAK,IAAI,KAAK,GAAG,IAAI,EAAE,KAAK,CAAC,SAAS,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,EAAE,KAAK,CAAC,SAAS,CAAC,CAAC,CAAC;oBAA7D,KAAK;SA4Bb;QAED,QAAQ,CAAC,GAAG,CAAC,OAAO,EAAE,KAAK,EAAE,EAAE,MAAM,EAAE,IAAI,EAAE,CAAC,CAAC;QAC/C,OAAO,MAAM,CAAC;KACd;IAED,kCAAe,GAAf,UAAgB,OAAO,EAAE,OAAO;QAC/B,IAAI,CAAC,IAAI,CAAC,UAAC,WAAwB;YAClC,IAAI,WAAW,CAAC,GAAG,CAAC,UAAU,CAAC,IAAI,OAAO,EAAE;gBAC3C,WAAW,CAAC,GAAG,CAAC,UAAU,EAAE,OAAO,EAAE,EAAC,MAAM,EAAE,IAAI,EAAC,CAAC,CAAC;aACrD;SACD,CAAC,CAAC;KACH;IAED,wBAAK,GAAL;QACC,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC;KACjB;IAED,sBAAG,GAAH,UAAI,EAAY;QACf,OAAOL,IAAC,CAAC,GAAG,CAAC,IAAI,CAAC,MAAM,EAAE,EAAE,CAAC,CAAC;KAC9B;IAKD,qCAAkB,GAAlB,UAAmB,EAAe;QACjC,IAAI,aAAa,GAAG,EAAE,CAAC,WAAW,EAAE,CAAC;QACrC,IAAI,aAAa,EAAE;YAClB,IAAI,mBAAmB,GAAG,aAAa,CAAC,KAAK,EAAE,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC,CAAC;YAC9D,IAAI,SAAS,GAAG,IAAI,CAAC,UAAU,CAAC,mBAAmB,CAAC,CAAC;YACrD,IAAI,KAAG,GAAGA,IAAC,CAAC,MAAM,CAAC,SAAS,EAAE,UAAC,GAAG,EAAE,GAAgB;gBACnD,OAAO,IAAI,CAAC,GAAG,CAAC,GAAG,EAAE,GAAG,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC,CAAC;aACxC,EAAE,CAAC,CAAC,CAAC;YAGN,IAAI,UAAQ,GAAG,KAAK,CAAC;YACrB,SAAS,CAAC,OAAO,CAAC,UAAC,GAAgB;gBAClC,IAAI,GAAG,CAAC,GAAG,CAAC,QAAQ,CAAC,IAAI,KAAG,EAAE;oBAC7B,UAAQ,GAAG,IAAI,CAAC;iBAChB;gBACD,IAAI,UAAQ,EAAE;oBACb,GAAG,CAAC,GAAG,CAAC,SAAS,EAAE,IAAI,EAAE,EAAC,MAAM,EAAE,IAAI,EAAC,CAAC,CAAC;iBACzC;aACD,CAAC,CAAA;SACF;KACD;IAEF,eAAC;CAAA,CAxUqCC,UAAQ,CAAC,UAAU;;ACrBzD,IAAMA,WAAQ,GAAG,OAAO,CAAC,UAAU,CAAC,CAAC;AAErC,IAAMQ,QAAM,GAAG,OAAO,CAAC,gBAAgB,CAAC,CAAC;AAE1B;IAA4B,iCAAc;IAUxD;QAAY,cAAc;aAAd,UAAc,EAAd,qBAAc,EAAd,IAAc;YAAd,yBAAc;;QAA1B,YACC,iBAAO,SAqBP;QApBA,KAAI,CAAC,GAAG,CAAC,SAAS,EAAE,IAAI,CAAC,CAAC,CAAC,CAAC,OAAO,CAAC,CAAC;QACrC,KAAI,CAAC,GAAG,CAAC,OAAO,EAAE,IAAI,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC;QACjC,KAAI,CAAC,GAAG,CAAC,OAAO,EAAE,IAAI,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC;QACjC,KAAI,CAAC,GAAG,CAAC,QAAQ,EAAE,IAAI,CAAC,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC;QACnC,KAAI,CAAC,GAAG,CAAC,IAAI,EAAE,IAAI,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC;QAE3B,IAAI,KAAK,GAAG,KAAI,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC;QAC9B,IAAI,CAAC,KAAK,EAAE;YACX,KAAI,CAAC,GAAG,CAAC,OAAO,EAAE,KAAI,CAAC,WAAW,EAAE,CAAC,CAAC;SACtC;QAED,IAAI,KAAK,GAAG,KAAI,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC;QAC9B,IAAI,CAAC,KAAK,EAAE;YACX,KAAI,CAAC,GAAG,CAAC,OAAO,EAAE,CAAC,CAAC,CAAC;SACrB;QAED,IAAI,MAAM,GAAG,KAAI,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC;QAChC,IAAI,CAAC,MAAM,EAAE;YACZ,KAAI,CAAC,GAAG,CAAC,QAAQ,EAAE,CAAC,CAAC,CAAC;SACtB;;KACD;IAED,gCAAQ,GAAR,UAAS,KAAK;QACb,IAAI,CAAC,GAAG,CAAC,OAAO,EAAE,KAAK,CAAC,CAAC;KACzB;IAED,mCAAW,GAAX;QACC,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,MAAM,EAAE,GAAG,EAAE,CAAC,GAAG,GAAG,EAAE,QAAQ,CAAC,EAAE,CAAC,CAAC;QAC5D,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,MAAM,EAAE,GAAG,EAAE,CAAC,GAAG,GAAG,EAAE,QAAQ,CAAC,EAAE,CAAC,CAAC;QAC5D,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,MAAM,EAAE,GAAG,EAAE,CAAC,GAAG,GAAG,EAAE,QAAQ,CAAC,EAAE,CAAC,CAAC;QAC5D,OAAO,GAAG,GAAG,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;KACvB;IAED,+BAAO,GAAP;QACC,OAAO,IAAI,CAAC,GAAG,CAAC,SAAS,CAAC,CAAC;KAC3B;IAED,iCAAS,GAAT;QACC,OAAO,IAAI,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC;KACrC;IAED,qCAAa,GAAb;QACC,IAAI,CAAC,GAAG,CAAC,OAAO,EAAE,CAAC,EAAE,EAAE,MAAM,EAAE,IAAI,EAAE,CAAC,CAAC;KAEvC;IAED,sCAAc,GAAd;QACC,IAAI,CAAC,GAAG,CAAC,OAAO,EAAE,IAAI,CAAC,GAAG,CAAC,OAAO,CAAC,GAAC,CAAC,EAAE,EAAE,MAAM,EAAE,IAAI,EAAE,CAAC,CAAC;KACzD;IAMD,yCAAiB,GAAjB,UAAkB,EAAU;QAC3B,IAAI,CAAC,GAAG,CAAC,QAAQ,EAAE,IAAI,CAAC,GAAG,CAAC,QAAQ,CAAC,GAAG,EAAE,EAAE,EAAE,MAAM,EAAE,IAAI,EAAE,CAAC,CAAC;KAC9D;IAED,gDAAwB,GAAxB,UAAyB,cAAsB;QAC9C,IAAI,MAAM,GAAGA,QAAM,CAAC,MAAM,CAAC,cAAc,CAAC,CAAC;QAC3C,IAAI,GAAG,GAAG,MAAM,CAAC,MAAM,CAAC,UAAS,CAAC,EAAE,CAAC,IAAI,OAAO,UAAU,CAAC,CAAC,CAAC,GAAG,UAAU,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC;QAClF,IAAI,GAAG,GAAG,GAAG,GAAG,MAAM,CAAC,MAAM,CAAC;QAE9B,OAAO,GAAG,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC;KACtB;IAEF,oBAAC;CAAA,CA9E0CR,WAAQ,CAAC,KAAK;;ACEzD,IAAM,UAAU,GAAG,OAAO,CAAC,YAAY,CAAC,CAAC;AACzC,IAAMA,WAAQ,GAAG,OAAO,CAAC,UAAU,CAAC,CAAC;AACrC,IAAMC,GAAC,GAAG,OAAO,CAAC,QAAQ,CAAC,CAAC;AAC5B,IAAMF,IAAC,GAAG,OAAO,CAAC,YAAY,CAAC,CAAC;AAChC,IAAMU,OAAK,GAAG,OAAO,CAAC,UAAU,CAAC,CAAC;AAClC,IAAMH,QAAM,GAAG,OAAO,CAAC,QAAQ,CAAC,CAAC;AACjC,IAAM,MAAM,GAAG,OAAO,CAAC,eAAe,CAAC,CAAC;AAEjC;IAAsB,2BAA8B;IAY1D,iBAAY,QAAkB,EAAE,YAAgC;QAAhE,YACC,iBAAO,SAkBP;QA7BD,SAAG,GAAGL,GAAC,CAAC,MAAM,CAAC,CAAC;QAYf,OAAO,CAAC,GAAG,CAAC,qBAAqB,CAAC,CAAC;QACnC,KAAI,CAAC,UAAU,GAAG,QAAQ,CAAC;QAC3B,KAAI,CAAC,YAAY,GAAG,YAAY,CAAC;QACjC,IAAI,SAAS,GAAGA,GAAC,CAAC,UAAU,CAAC,CAAC;QAC9B,IAAI,IAAI,GAAG,SAAS,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;QAClC,OAAO,CAAC,GAAG,CAAC,SAAS,EAAE,IAAI,CAAC,CAAC;QAC7BA,GAAC,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,UAAC,MAAM;YAEvB,KAAI,CAAC,WAAW,CAEf,UAAU,CAAC,OAAO,CAAC,MAAM,CAAC,CAC1B,CAAC;SACF,CAAC,CAAC;QACH,OAAO,CAAC,GAAG,CAAC,KAAI,CAAC,CAAC;QAClB,KAAI,CAAC,QAAQ,CAAC,KAAI,CAAC,YAAY,EAAE,QAAQ,EAAE,KAAI,CAAC,MAAM,CAAC,CAAC;QACxD,KAAI,CAAC,QAAQ,CAAC,KAAI,CAAC,YAAY,EAAE,KAAK,EAAE,KAAI,CAAC,MAAM,CAAC,CAAC;QACrD,KAAI,CAAC,QAAQ,CAAC,KAAI,CAAC,YAAY,EAAE,QAAQ,EAAE,KAAI,CAAC,MAAM,CAAC,CAAC;;KACxD;IAED,6BAAW,GAAX,UAAY,IAAI;QACf,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC;QACrB,IAAI,CAAC,MAAM,EAAE,CAAC;KACd;IAED,wBAAM,GAAN;QAAA,iBAuCC;QAtCA,IAAI,MAAM,CAAC,QAAQ,CAAC,IAAI,IAAI,UAAU;YAAE,OAAO;QAC/C,OAAO,CAAC,GAAG,CAAC,gBAAgB,CAAC,CAAC;QAC9B,IAAI,IAAI,CAAC,QAAQ,EAAE;YAClB,IAAI,iBAAe,GAAG,EAAE,CAAC;YACzB,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,UAAC,QAAuB;gBAE9C,IAAI,aAAa,GAAG,KAAI,CAAC,UAAU,CAAC,mBAAmB,CAAC,QAAQ,CAAC,CAAC;gBAClE,QAAQ,CAAC,aAAa,EAAE,CAAC;gBACzB,IAAI,qBAAqB,GAAG,QAAQ,CAAC,wBAAwB,CAAC,aAAa,CAAC,CAAC;gBAC7E,iBAAe,CAAC,IAAI,CAAC;oBACpB,OAAO,EAAE,QAAQ,CAAC,GAAG,CAAC,SAAS,CAAC;oBAChC,UAAU,EAAE,QAAQ,CAAC,GAAG,CAAC,OAAO,CAAC;oBACjC,EAAE,EAAE,QAAQ,CAAC,GAAG;oBAChB,IAAI,EAAE,QAAQ,CAAC,GAAG,CAAC,OAAO,CAAC;oBAC3B,MAAM,EAAE,qBAAqB;oBAC7B,OAAO,EAAE,qBAAqB;oBAC9B,SAAS,EAAE,IAAI,CAAC,SAAS,CAAC,aAAa,CAAC;iBACxC,CAAC,CAAC;aACH,CAAC,CAAC;YACH,iBAAe,GAAGF,IAAC,CAAC,MAAM,CAAC,iBAAe,EAAE,SAAS,CAAC,CAAC;YACvD,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC;gBAC3B,eAAe,EAAE,iBAAe;aAChC,CAAC,CAAC,CAAC;YACJ,IAAI,CAAC,CAAC,CAAC,kBAAkB,CAAC,CAAC,EAAE,CAAC,QAAQ,EAAE,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;YACrE,IAAIE,GAAC,CAAC,QAAQ,CAAC,CAAC,SAAS,EAAE,GAAG,CAAC,EAAE;gBAChC,IAAI,CAAC,CAAC,CAAC,uBAAuB,CAAC,CAAC,KAAK,EAAE,CAAC;aACxC;YACD,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,QAAQ,EAAE,qBAAqB,EAAE,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;YAC1E,IAAI,CAAC,CAAC,CAAC,cAAc,CAAC,CAAC,EAAE,CAAC,OAAO,EAAE,IAAI,CAAC,cAAc,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;YACnE,IAAI,CAAC,CAAC,CAAC,gBAAgB,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,YAAY,CAAC,IAAI,EAAE,CAAC,QAAQ,EAAE,CAAC,CAAC;YACnE,IAAI,CAAC,CAAC,CAAC,aAAa,CAAC,CAAC,IAAI,CAAC,UAAU,EAAE,IAAI,CAAC,cAAc,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;YACvE,UAAU,CAAC;gBACV,KAAI,CAAC,gBAAgB,EAAE,CAAC;aACxB,EAAE,IAAI,CAAC,CAAC;SACT;aAAM;YACN,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC;SAC5B;QACD,OAAO,IAAI,CAAC;KACZ;IAED,6BAAW,GAAX,UAAY,KAAY;QACvB,KAAK,CAAC,cAAc,EAAE,CAAC;QACvB,IAAI,KAAK,GAAGA,GAAC,CAAC,KAAK,CAAC,MAAM,CAAC,CAAC;QAC5B,IAAI,OAAO,GAAG,KAAK,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC,GAAG,EAAE,CAAC;QACxC,OAAO,CAAC,GAAG,CAAC,SAAS,EAAE,OAAO,CAAC,CAAC;QAChC,IAAI,cAAc,GAAG,IAAI,aAAa,CAAC;YACtC,OAAO,EAAE,OAAO;SAChB,CAAC,CAAC;QACH,OAAO,CAAC,GAAG,CAAC,KAAK,EAAE,cAAc,CAAC,GAAG,CAAC,SAAS,CAAC,CAAC,CAAC;QAClD,OAAO,CAAC,GAAG,CAAC,KAAK,EAAE,cAAc,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC,CAAC;QAChD,IAAI,CAAC,YAAY,CAAC,GAAG,CAAC,cAAc,CAAC,CAAC;KACtC;IAED,6BAAW,GAAX,UAAY,KAAK;QAChB,OAAO,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC;QACnB,IAAI,MAAM,GAAGA,GAAC,CAAC,KAAK,CAAC,MAAM,CAAC,CAAC;QAC7B,IAAI,EAAE,GAAG,MAAM,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;QAC9C,OAAO,CAAC,GAAG,CAAC,IAAI,EAAE,EAAE,CAAC,CAAC;QACtB,IAAI,QAAQ,GAAG,IAAI,CAAC,YAAY,CAAC,GAAG,CAAC,EAAE,CAAC,CAAC;QACzC,OAAO,CAAC,GAAG,CAAC,gBAAgB,EAAE,QAAQ,CAAC,CAAC;QACxC,IAAI,QAAQ,EAAE;YAEb,QAAQ,CAAC,GAAG,CAAC,OAAO,EAAE,KAAK,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;SAC1C;KACD;IAED,gCAAc,GAAd,UAAe,KAAiB;QAC/B,IAAI,MAAM,GAAG,KAAK,CAAC,MAAM,CAAC;QAC1B,IAAI,EAAE,GAAGA,GAAC,CAAC,MAAM,CAAC,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC;QACjC,IAAI,EAAE,GAAG,EAAE,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;QAC5B,OAAO,CAAC,GAAG,CAAC,gBAAgB,EAAE,EAAE,CAAC,CAAC;QAClC,IAAI,CAAC,YAAY,CAAC,MAAM,CAAC,EAAE,CAAC,CAAC;KAC7B;IAKO,kCAAgB,GAAxB;QAAA,iBAoEC;QAnEA,IAAI,UAAU,GAAGA,GAAC,CAAC,YAAY,CAAC,CAAC;QACjC,UAAU,CAAC,IAAI,CAAC,UAAC,KAAK,EAAE,IAAI;YAE3B,IAAI,GAAGA,GAAC,CAAC,IAAI,CAAC,CAAC;YAEf,IAAI,GAAG,GAAG,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,UAAU,CAAC,IAAI,CAAC,CAAC;YAGvC,IAAI,SAAS,GAAG,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,mBAAmB,CAAC,CAAC,CAAC;YAC3D,IAAI,OAAO,GAAG,IAAI,CAAC,IAAI,CAAC,cAAc,CAAC,CAAC;YAGxC,IAAI,IAAI,GAAG,MAAM,CAAC,MAAM,CAAC,SAAS,CAAC,CAAC;YACpC,IAAI,MAAM,GAAG,MAAM,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;YAEpC,IAAI,QAAQ,GAAG,EAAE,CAAC;YAGlB,QAAQ,CAAC,aAAa,CAAC,GAAG,IAAI,CAAC,IAAI,CAAC,wBAAwB,CAAC,CAAC;YAC9D,QAAQ,CAAC,MAAM,CAAC,GAAG,IAAI,CAAC;YAExB,IAAI,OAAO,GAAG;gBACb,IAAI,EAAE,MAAM;gBACZ,KAAK,EAAE,mBAAmB;gBAC1B,IAAI,EAAE,EAAE,CAAC,IAAI,CAAC,OAAO,EAAE,CAAC,EAAE,IAAI,CAAC,MAAM,CAAC;gBACtC,WAAW,EAAE,SAAS;gBACtB,WAAW,EAAE,CAAC;gBACd,IAAI,EAAE,KAAK;aACX,CAAC;YAGF,IAAI,QAAQ,GAAG,EAAE,CAAC;YAClB,QAAQ,CAAC,QAAQ,CAAC,GAAG,MAAM,CAAC;YAC5B,QAAQ,CAAC,UAAU,CAAC,GAAG,KAAK,CAAC,QAAQ,EAAE,OAAO,CAAC,CAAC;YAEhD,IAAI,OAAO,GAAG,KAAI,CAAC;YACnB,IAAI,KAAK,GAAG,IAAIQ,OAAK,CAAC,IAAI,CAAC,GAAG,EAAE;gBAC/B,IAAI,EAAE,QAAQ;gBACd,OAAO,EAAE;oBACR,UAAU,EAAE,IAAI;oBAChB,cAAc,EAAE,eAAe;oBAC/B,eAAe,EAAE,KAAK;oBACtB,kBAAkB,EAAE,KAAK;oBACzB,QAAQ,EAAE,KAAK;oBACf,WAAW,EAAE,KAAK;oBAGlB,aAAa,EAAE,CAAC;oBAChB,cAAc,EAAE,eAAe;oBAC/B,MAAM,EAAE;wBACP,OAAO,EAAE,KAAK;qBACd;oBACD,mBAAmB,EAAE,KAAK;oBAC1B,MAAM,EAAE;wBACP,KAAK,EAAE,CAAC;gCACP,KAAK,EAAE;oCACN,OAAO,EAAE,CAAC;iCACV;6BACD,CAAC;qBACF;oBACD,OAAO,EAAE,UAAU,KAAiB,EAAE,aAAa;wBAClD,OAAO,CAAC,YAAY,CAAC,MAAM,EAAE,KAAK,EAAE,aAAa,EAAE,IAAI,CAAC,CAAC;qBACzD;iBACD;aACD,CAAC,CAAC;YACH,IAAI,CAAC,IAAI,CAAC,OAAO,EAAE,KAAK,CAAC,CAAC;SAC1B,CAAC,CAAC;KACH;IAEO,8BAAY,GAApB,UAAqB,MAAM,EAAE,KAAiB,EAAE,aAAa,EAAE,KAAK;QACnE,IAAI,OAAO,GAAG,IAAI,CAAC;QACnB,IAAI,KAAK,GAAG,aAAa,CAAC,MAAM,GAAG,aAAa,CAAC,CAAC,CAAC,GAAG,IAAI,CAAC;QAC3D,IAAI,KAAK,EAAE;YACV,OAAO,CAAC,GAAG,CAAC,MAAM,EAAE,aAAa,CAAC,CAAC;YACnC,IAAI,SAAS,GAAG,MAAM,CAAC,KAAK,CAAC,MAAM,CAAC,CAAC;YACjC,IAAA,yBAAoC,EAAnC,YAAI,EAAE,aAAK,CAAyB;YACzC,IAAI,UAAU,GAAGR,GAAC,CAAC,KAAK,CAAC,MAAM,CAAC,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;YAC/D,IAAI,QAAQ,GAAkB,OAAO,CAAC,YAAY,CAAC,GAAG,CAAC,UAAU,CAAC,CAAC;YACnE,OAAO,CAAC,GAAG,CAAC,SAAS,EAAE,IAAI,EAAE,KAAK,EAAE,QAAQ,CAAC,CAAC;YAC9CD,WAAQ,CAAC,OAAO,CAAC,QAAQ,CAAC,IAAI,GAAC,IAAI,GAAC,GAAG,GAAC,KAAK,GAAC,GAAG,GAAC,QAAQ,CAAC,GAAG,CAAC,SAAS,CAAC,CAAC,CAAC;SAC3E;aAAM;YACN,OAAO,CAAC,GAAG,CAAC,IAAI,EAAE,KAAK,EAAE,KAAK,CAAC,MAAM,CAAC,CAAC;YACvC,IAAI,OAAO,GAAGC,GAAC,CAAC,KAAK,CAAC,MAAM,CAAC,CAAC;YAC9B,IAAI,OAAO,CAAC,MAAM,EAAE,IAAI,GAAG,EAAE;gBAC5B,OAAO,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC;aACpB;iBAAM;gBACN,OAAO,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC;aACpB;YACD,UAAU,CAAC;gBACV,KAAK,CAAC,MAAM,EAAE,CAAC;aACf,EAAE,IAAI,CAAC,CAAC;SACT;KACD;IAED,gCAAc,GAAd,UAAe,KAAK,EAAE,SAAS,EAAE,OAAO;QACvC,OAAO,CAAC,GAAG,CAAC,QAAQ,EAAE,OAAO,CAAC,CAAC;QAC/B,IAAI,EAAE,GAAG,SAAS,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;QACjD,IAAI,QAAQ,GAAkB,IAAI,CAAC,YAAY,CAAC,GAAG,CAAC,EAAE,CAAC,CAAC;QACxD,OAAO,CAAC,GAAG,CAAC,EAAE,EAAE,QAAQ,CAAC,CAAC;QAC1B,IAAI,QAAQ,EAAE;YACb,IAAI,OAAO,GAAG,QAAQ,CAAC,OAAO,EAAE,CAAC;YACjC,IAAI,IAAI,CAAC,YAAY,CAAC,MAAM,CAAC,OAAO,CAAC,EAAE;gBACtCK,QAAM,CAAC,KAAK,CAAC,iCAAiC,CAAC,CAAC;gBAChD,SAAS,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;aACrC;iBAAM;gBACN,QAAQ,CAAC,GAAG,CAAC,SAAS,EAAE,OAAO,CAAC,CAAC;gBACjC,IAAI,CAAC,UAAU,CAAC,eAAe,CAAC,OAAO,EAAE,OAAO,CAAC,CAAC;gBAClD,IAAI,CAAC,YAAY,CAAC,QAAQ,EAAE,CAAC;aAC7B;SACD;KACD;IAEF,cAAC;CAAA,CArO4B,oBAAoB;;ACZlC;IAAsC,2CAAK;IAA3C;;KAcd;IAZO,6BAAK,GAAZ,UAAa,OAAuB;QAApC,iBAUC;QATA,IAAI,MAAM,GAAG,EAAE,CAAC;QAChB,OAAO,CAAC,OAAO,CAAC,UAAA,GAAG;YAClB,IAAI,KAAK,CAAC,OAAO,CAAC,GAAG,CAAC,EAAE;gBACvB,MAAM,CAAC,IAAI,CAAC,KAAI,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC;aAC7B;iBAAM;gBACN,MAAM,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;aACjB;SACD,CAAC,CAAC;QACH,OAAO,MAAM,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC;KACvB;IAEF,8BAAC;CAAA,CAdoD,KAAK;;ACF1D,IAAMP,IAAC,GAAG,OAAO,CAAC,YAAY,CAAC,CAAC;AAEhC,AAKO;IAA2B,gCAAuC;IASxE,sBAAY,OAAQ;QAApB,YACC,kBAAM,OAAO,CAAC,SAId;QAZD,SAAG,GAAG,CAAC,CAAC,MAAM,CAAC,CAAC;QASf,OAAO,CAAC,GAAG,CAAC,KAAI,CAAC,CAAC;QAElB,OAAO,CAAC,GAAG,CAAC,oBAAoB,EAAE,KAAI,CAAC,GAAG,CAAC,CAAC;;KAC5C;IAED,6BAAM,GAAN;QACC,OAAO,CAAC,IAAI,CAAC,sBAAsB,CAAC,CAAC;QACrC,IAAI,OAAO,GAAa,CAAC,uBAAuB;YAC/C,SAAS;YACT,MAAM;YACL,kBAAkB;YAClB,mBAAmB;YACnB,WAAW;YACZ,OAAO;YACP,UAAU;SACV,CAAC;QACF,OAAO,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;QACxB,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,UAAC,EAAW;YAC9B,OAAO,CAAC,IAAI,CAAC,6BACG,EAAE,CAAC,IAAI,yBAChB,EAAE,CAAC,IAAI,2BACP,EAAE,CAAC,QAAQ,0RAOX,CACN,CAAC;SACF,CAAC,CAAC;QACH,OAAO,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;QACzB,OAAO,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;QAGzB,OAAO;YACN,gWAQuB,IAAI,CAAC,QAAQ,CAAC,IAAI,EAAE,4DAElB;iBACtB,OAAO;YACV,QAAQ;YACR,QAAQ;UACR,CAAC;QAEF,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,uBAAuB,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC,CAAC;QACtD,IAAI,CAAC,CAAC,CAAC,mBAAmB,CAAC,CAAC,GAAG,EAAE,CAAC,EAAE,CAAC,OAAO,EAAE,IAAI,CAAC,gBAAgB,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;QAChF,IAAI,CAAC,GAAG,CAAC,GAAG,CAAC,OAAO,EAAE,cAAc,CAAC,CAAC,EAAE,CAAC,OAAO,EAAE,cAAc,EAAE,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;QAC7F,OAAO,CAAC,OAAO,CAAC,sBAAsB,CAAC,CAAC;KACxC;IAED,uCAAgB,GAAhB,UAAiB,KAAiB;QACjC,IAAI,QAAQ,GAAG,IAAI,CAAC,QAAQ,CAAC,IAAI,EAAE,CAAC;QACpC,OAAO,CAAC,GAAG,CAAC,kBAAkB,EAAE,QAAQ,CAAC,CAAC;QAC1C,IAAI,CAAC,QAAQ,CAAC,MAAM,GAAGA,IAAC,CAAC,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,MAAM,EAAE,KAAK,EAAE,UAAC,EAAW;YACtE,OAAO,EAAE,CAAC,IAAI,CAAC;SACf,CAAC,CAAC;QACH,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,QAAQ,CAAC,IAAI,EAAE,CAAC,CAAC;QAClC,IAAI,CAAC,GAAG,IAAI,CAAC,QAAQ,CAAC,IAAI,EAAE,GAAG,QAAQ,CAAC;QACxC,IAAI,CAAC,EAAE;YACN,MAAM,CAAC,OAAO,CAAC,aAAW,CAAC,gBAAa,CAAC,CAAC;SAC1C;aAAM;YACN,MAAM,CAAC,KAAK,CAAC,yBAAyB,CAAC,CAAC;SACxC;QACD,IAAI,CAAC,QAAQ,CAAC,IAAI,EAAE,CAAC;QACrB,IAAI,CAAC,MAAM,EAAE,CAAC;KACd;IAED,gCAAS,GAAT,UAAU,KAAiB;QAC1B,IAAI,MAAM,GAAG,CAAC,CAAC,KAAK,CAAC,MAAM,CAAC,CAAC;QAC7B,IAAI,MAAM,GAAG,MAAM,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;QAClD,OAAO,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC;QACpB,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,MAAM,EAAE,MAAM,CAAC,CAAC;QACrC,IAAI,CAAC,QAAQ,CAAC,IAAI,EAAE,CAAC;QACrB,IAAI,CAAC,MAAM,EAAE,CAAC;KACd;IAED,2BAAI,GAAJ;KAEC;IAEF,mBAAC;CAAA,CAnGiC,oBAAoB;;ACLtD,IAAMC,WAAQ,GAAG,OAAO,CAAC,UAAU,CAAC,CAAC;AAErC,IAAMI,QAAM,GAAG,OAAO,CAAC,QAAQ,CAAC,CAAC;AACjCA,QAAM,CAAC,SAAS,CAAC;IAChB,KAAK,EAAE,IAAI;CACX,CAAC,CAAC;AACH,OAAO,CAAC,uBAAuB,CAAC,CAAC;AACjC,IAAML,IAAC,GAAG,OAAO,CAAC,YAAY,CAAC,CAAC;AAMjB;IAAiC,sCAAkC;IAQjF,4BAAY,OAAQ;QAApB,YACC,kBAAM,OAAO,CAAC,SAyBd;QAxBA,IAAI,EAAE,GAAG,IAAIC,WAAQ,CAAC,YAAY,CAAC,YAAY,CAAC,CAAC;QAEjD,IAAI,MAAM,GAAG,EAAE,CAAC,OAAO,EAAE,CAAC;QAC1B,MAAM,GAAGD,IAAC,CAAC,IAAI,CAAC,MAAM,EAAE,KAAK,EAAE,UAAC,EAAE;YACjC,OAAO,EAAE,CAAC,OAAO,CAAC;SAClB,CAAC,CAAC;QAIHA,IAAC,CAAC,IAAI,CAAC,MAAM,EAAE,UAAA,CAAC;YACf,KAAI,CAAC,GAAG,CAAC,IAAI,aAAa,CAAC,CAAC,CAAC,CAAC,CAAC;SAC/B,CAAC,CAAC;QAGH,KAAI,CAAC,MAAM,GAAGA,IAAC,CAAC,IAAI,CAAC,KAAI,CAAC,MAAM,EAAE,UAAC,EAAE;YACpC,OAAO,EAAE,CAAC,OAAO,EAAE,CAAC;SACpB,CAAC,CAAC;QAEH,IAAI,CAAC,KAAI,CAAC,IAAI,EAAE,EAAE;SAGjB;QAED,KAAI,CAAC,QAAQ,CAAC,KAAI,EAAE,QAAQ,EAAE,KAAI,CAAC,QAAQ,CAAC,CAAC;;KAC7C;IAED,wCAAW,GAAX,UAAY,EAAY;QACvB,IAAI,CAAC,QAAQ,GAAG,EAAE,CAAC;QACnB,IAAI,CAAC,yBAAyB,EAAE,CAAC;KAUjC;IAED,qCAAQ,GAAR;QACC,IAAI,EAAE,GAAG,IAAIC,WAAQ,CAAC,YAAY,CAAC,YAAY,CAAC,CAAC;QACjD,IAAI,QAAQ,GAAG,EAAE,CAAC,OAAO,EAAE,CAAC;QAE5B,IAAI,CAAC,IAAI,CAAC,UAAC,KAAoB;YAC9B,IAAI,KAAK,CAAC,GAAG,CAAC,IAAI,CAAC,EAAE;gBACpB,EAAE,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;gBAEjB,IAAI,SAAS,GAAGD,IAAC,CAAC,SAAS,CAAC,QAAQ,EAAE,EAAE,EAAE,EAAE,KAAK,CAAC,GAAG,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC;gBAC/D,IAAI,SAAS,GAAG,CAAC,CAAC,EAAE;oBACnB,QAAQ,CAAC,MAAM,CAAC,SAAS,EAAE,CAAC,CAAC,CAAC;iBAC9B;aACD;iBAAM;gBACN,EAAE,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;aACjB;SACD,CAAC,CAAC;QACH,IAAI,QAAQ,CAAC,MAAM,EAAE;YAEpBA,IAAC,CAAC,IAAI,CAAC,QAAQ,EAAE,UAAC,EAAE;gBACnB,EAAE,CAAC,OAAO,CAAC,EAAE,CAAC,CAAC;aACf,CAAC,CAAA;SACF;KACD;IAED,0CAAa,GAAb;QACC,IAAI,CAAC,IAAI,CAAC,UAAC,GAAkB;YAC5B,GAAG,CAAC,GAAG,CAAC,QAAQ,EAAE,CAAC,EAAE,EAAE,MAAM,EAAE,IAAI,EAAE,CAAC,CAAC;YACvC,GAAG,CAAC,GAAG,CAAC,OAAO,EAAE,CAAC,EAAE,EAAE,MAAM,EAAE,IAAI,EAAE,CAAC,CAAC;SACtC,CAAC,CAAC;KACH;IAED,sDAAyB,GAAzB;QAAA,iBAkBC;QAjBAK,QAAM,CAAC,IAAI,CAAC,2BAA2B,CAAC,CAAC;QAEzC,IAAI,CAAC,aAAa,EAAE,CAAC;QACrB,IAAI,OAAO,GAAG,IAAI,CAAC,QAAQ,CAAC,UAAU,EAAE,CAAC;QAEzCL,IAAC,CAAC,IAAI,CAAC,OAAO,EAAE,UAAC,WAAwB;YACxC,IAAI,YAAY,GAAG,WAAW,CAAC,GAAG,CAAC,UAAU,CAAC,CAAC;YAC/C,IAAI,YAAY,EAAE;gBACjB,KAAI,CAAC,qBAAqB,CAAC,YAAY,EAAE,WAAW,CAAC,CAAC;aACtD;SACD,CAAC,CAAC;QAEH,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC;QACtBK,QAAM,CAAC,OAAO,CAAC,2BAA2B,CAAC,CAAC;QAG5C,IAAI,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAC;KACvB;IAEO,kDAAqB,GAA7B,UAA8B,YAAiB,EAAE,WAAwB;QACxE,IAAI,MAAM,GAAG,IAAI,CAAC,SAAS,CAAC,EAAC,OAAO,EAAE,YAAY,EAAC,CAAC,CAAC;QACrD,IAAI,MAAM,EAAE;YACX,MAAM,CAAC,GAAG,CAAC,OAAO,EAAG,MAAM,CAAC,GAAG,CAAC,OAAO,CAAC,GAAG,CAAC,EAAE,EAAE,MAAM,EAAE,IAAI,EAAE,CAAC,CAAC;YAChE,IAAI,YAAY,GAAG,MAAM,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC;YACxC,IAAI,WAAW,GAAG,WAAW,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC;YAC5C,AAGA,MAAM,CAAC,GAAG,CAAC,QAAQ,EAAE,YAAY,GAAG,WAAW,EAAE,EAAE,MAAM,EAAE,IAAI,EAAE,CAAC,CAAC;SACnE;aAAM;YACN,IAAI,CAAC,GAAG,CAAC,IAAI,aAAa,CAAC;gBAC1B,OAAO,EAAE,YAAY;gBACrB,KAAK,EAAE,CAAC;gBACR,MAAM,EAAE,WAAW,CAAC,GAAG,CAAC,QAAQ,CAAC;aACjC,CAAC,EAAE,EAAE,MAAM,EAAE,IAAI,EAAE,CAAC,CAAC;SACtB;KACD;IAMD,uDAA0B,GAA1B;QACC,IAAI,OAAO,GAAG,EAAE,CAAC;QACjB,IAAI,UAAU,GAAG,IAAI,CAAC,QAAQ,CAAC,OAAO,CAAC,UAAU,CAAC,CAAC;QAEnDL,IAAC,CAAC,IAAI,CAAC,UAAU,EAAE,UAAC,KAAK,EAAE,KAAK;YAC/B,OAAO,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;SACpB,CAAC,CAAC;QACH,OAAO,OAAO,CAAC;KACf;IAQD,uCAAU,GAAV;QACC,IAAI,OAAO,GAAG,IAAI,CAAC,KAAK,CAAC,SAAS,CAAC,CAAC;QAEpC,OAAO,GAAGA,IAAC,CAAC,MAAM,CAAC,OAAO,CAAC,CAAC;QAC5B,OAAO,GAAGA,IAAC,CAAC,MAAM,CAAC,OAAO,CAAC,CAAC;QAC5B,OAAO,OAAO,CAAC;KACf;IAED,wCAAW,GAAX,UAAY,KAAK;QAOhB,IAAI,KAAK,CAAC;QACV,IAAI,QAAQ,GAAG,IAAI,CAAC,SAAS,CAAC,EAAC,OAAO,EAAE,KAAK,EAAC,CAAC,CAAC;QAChD,IAAI,QAAQ,EAAE;YACb,KAAK,GAAG,QAAQ,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC;SAE9B;aAAM;YACN,KAAK,GAAG,SAAS,CAAC;SAClB;QACD,OAAO,KAAK,CAAC;KACb;IAED,mCAAM,GAAN,UAAO,OAAO;QACb,OAAO,CAAC,CAAC,IAAI,CAAC,SAAS,CAAC;YACvB,OAAO,EAAE,OAAO;SAChB,CAAC,CAAC;KACH;IAED,mCAAM,GAAN;QACC,OAAOA,IAAC,CAAC,MAAM,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;KAC7B;IAEF,yBAAC;CAAA,CAhL+CC,WAAQ,CAAC,UAAU;;ACfnE,IAAM,aAAa,GAAG,OAAO,CAAC,kBAAkB,CAAC,CAAC;AAClD,IAAMD,IAAC,GAAG,OAAO,CAAC,YAAY,CAAC,CAAC;AAEjB;IAA8B,mCAAK;IAQjD;QAAY,oBAAa;aAAb,UAAa,EAAb,qBAAa,EAAb,IAAa;YAAb,+BAAa;;QAAzB,iBAIC;QARD,YAAM,GAAG,EAAE,CAAC;QAOX,KAAI,CAAC,IAAI,GAAG,KAAI,CAAC,WAAW,CAAC,SAAS,CAAC,IAAI,CAAC;;KAC5C;IAKD,+BAAK,GAAL;QAAA,iBAQC;QAPA,IAAI,MAAM,GAAG,aAAa,CAAC,GAAG,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,EAAE,CAAC;QAChD,MAAM,CAAC,OAAO,CAAC,UAAC,GAAG;YAClB,IAAI,GAAG,EAAE;gBACR,IAAI,KAAK,GAAG,IAAI,KAAI,CAAC,UAAU,CAAC,GAAG,CAAC,CAAC;gBACrC,KAAI,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC;aAChB;SACD,CAAC,CAAC;KACH;IAED,6BAAG,GAAH,UAAI,KAAK;QACR,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;QACxB,IAAI,CAAC,IAAI,EAAE,CAAC;KACZ;IAED,8BAAI,GAAJ;QACC,aAAa,CAAC,GAAG,CAAC,IAAI,CAAC,IAAI,EAAE,IAAI,CAAC,MAAM,CAAC,CAAC;KAE1C;IAED,8BAAI,GAAJ,UAAK,QAAkB;QACtB,IAAI,CAAC,MAAM,CAAC,OAAO,CAAC,UAAC,EAAE;YAEtB,QAAQ,CAAC,EAAE,CAAC,CAAC;SACb,CAAC,CAAC;KACH;IAED,iCAAO,GAAP;QACC,OAAO,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,MAAM,EAAE,IAAI,EAAE,IAAI,CAAC,CAAC;KAC/C;IAED,8BAAI,GAAJ;QACC,OAAO,IAAI,CAAC,MAAM,CAAC,MAAM,CAAC;KAC1B;IAED,gCAAM,GAAN;QACC,OAAOA,IAAC,CAAC,MAAM,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;KAC7B;IAED,gCAAM,GAAN,UAAO,EAAE,EAAE,OAAc;QAAd,wBAAA,EAAA,cAAc;QACxB,IAAI,KAAK,GAAGA,IAAC,CAAC,SAAS,CAAC,IAAI,CAAC,MAAM,EAAE,UAAA,EAAE;YACtC,OAAO,EAAE,CAAC,OAAO,CAAC,IAAI,EAAE,CAAC;SACzB,CAAC,CAAC;QACH,OAAO,CAAC,GAAG,CAAC,KAAK,EAAE,EAAE,EAAE,OAAO,CAAC,CAAC;QAChC,IAAI,KAAK,GAAG,CAAC,CAAC,EAAE;YACf,OAAO,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;SAC1B;KACD;IAEF,sBAAC;CAAA,CAlE4C,KAAK;;ACCnC;IAAgC,qCAAe;IAE7D;QAAY,oBAAa;aAAb,UAAa,EAAb,qBAAa,EAAb,IAAa;YAAb,+BAAa;;QAAzB,+BACU,UAAU,UAGnB;QAFA,KAAI,CAAC,UAAU,GAAG,OAAO,CAAC;QAC1B,KAAI,CAAC,KAAK,EAAE,CAAC;;KACb;IAEF,wBAAC;CAAA,CAR8C,eAAe;;ACH9D,IAAMA,IAAC,GAAG,OAAO,CAAC,YAAY,CAAC,CAAC;AAEjB;IAcd,qBAAY,MAAe;QAV3B,YAAO,GAAkB,CAAC,CAAC;QAE3B,YAAO,GAAkB,CAAC,CAAC;QAM3B,aAAQ,GAAe,EAAE,CAAC;QAGzB,IAAI,MAAM,EAAE;YACXA,IAAC,CAAC,MAAM,CAAC,IAAI,EAAE,MAAM,CAAC,CAAC;SACvB;KACD;IAED,6BAAO,GAAP,UAAQ,GAAgB;QACvB,IAAI,CAAC,OAAO,IAAI,UAAU,CAAM,GAAG,CAAC,OAAO,CAAC,CAAC;QAC7C,IAAI,CAAC,OAAO,GAAG,UAAU,CAAM,IAAI,CAAC,OAAO,CAAC,GAAG,UAAU,CAAM,GAAG,CAAC,OAAO,CAAC,CAAC;QAC5E,IAAI,IAAI,CAAC,QAAQ,CAAC,MAAM,EAAE;YACzB,IAAI,CAAC,QAAQ,GAAGA,IAAC,CAAC,GAAG,CAAC,IAAI,CAAC,QAAQ,EAAE,UAAC,EAAE,EAAE,KAAK;gBAE9C,EAAE,CAAC,KAAK,GAAG,UAAU,CAAC,EAAE,CAAC,KAAK,CAAC,GAAG,UAAU,CAAC,GAAG,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAC,KAAK,CAAC,CAAC;gBAExE,EAAE,CAAC,KAAK,GAAG,EAAE,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC;gBAC/B,OAAO,EAAE,CAAC;aACV,CAAC,CAAC;SACH;aAAM;YAEN,IAAI,CAAC,QAAQ,GAAGA,IAAC,CAAC,GAAG,CAAC,GAAG,CAAC,QAAQ,EAAEA,IAAC,CAAC,KAAK,CAAC,CAAC;SAC7C;KACD;IAEF,kBAAC;CAAA;;AC/BD,IAAMW,YAAU,GAAG,OAAO,CAAC,YAAY,CAAC,CAAC;AACzC,IAAMV,WAAQ,GAAG,OAAO,CAAC,UAAU,CAAC,CAAC;AACrC,IAAMD,IAAC,GAAG,OAAO,CAAC,YAAY,CAAC,CAAC;AAEjB;IAA0B,+BAAsC;IAQ9E,qBAAY,OAA6C,EAAE,QAAkB;QAA7E,YACC,kBAAM,OAAO,CAAC,SAYd;QAXA,KAAI,CAAC,QAAQ,GAAG,QAAQ,CAAC;QACzB,KAAI,CAAC,UAAU,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC;QAC3B,IAAI,SAAS,GAAG,CAAC,CAAC,cAAc,CAAC,CAAC;QAClC,IAAI,IAAI,GAAG,SAAS,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;QAElC,CAAC,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,UAAC,MAAM;YAEvB,KAAI,CAAC,QAAQ,GAAGW,YAAU,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC;YAE3C,KAAI,CAAC,MAAM,EAAE,CAAC;SACd,CAAC,CAAC;;KACH;IAED,gCAAU,GAAV;KAEC;IAED,4BAAM,GAAN;QACC,IAAI,CAAC,IAAI,CAAC,QAAQ,EAAE;YACnB,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC;YAC5B,OAAO,IAAI,CAAC;SACZ;QACD,IAAI,eAAe,GAAG,IAAI,CAAC,uBAAuB,EAAE,CAAC;QACrD,IAAI,MAAM,GAAGX,IAAC,CAAC,KAAK,CAAC,eAAe,CAAC,CAAC,CAAC,CAAC,QAAQ,EAAE,YAAY,CAAC,CAAC;QAChE,eAAe,GAAG,IAAI,CAAC,UAAU,CAAC,eAAe,CAAC,CAAC;QACnD,eAAe,GAAGA,IAAC,CAAC,MAAM,CAAC,eAAe,EAAE,SAAS,CAAC,CAAC;QACvD,eAAe,GAAG,IAAI,CAAC,iBAAiB,CAAC,eAAe,CAAC,CAAC;QAC1D,IAAI,OAAO,GAAG,IAAI,CAAC,QAAQ,CAAC;YAC3B,eAAe,EAAE,eAAe;YAChC,KAAK,EAAE,IAAI,CAAC,UAAU,CAAC,IAAI,EAAE;YAC7B,MAAM,EAAE,MAAM;SACd,CAAC,CAAC;QACH,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;QAEvB,OAAO,IAAI,CAAC;KACZ;IAEO,6CAAuB,GAA/B;QAAA,iBAyBC;QAxBA,IAAI,eAAe,GAAG,EAAE,CAAC;QACzB,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,UAAC,QAAuB;YAC5C,IAAI,aAAa,GAAG,KAAI,CAAC,QAAQ,CAAC,mBAAmB,CAAC,QAAQ,CAAC,CAAC;YAChE,IAAI,qBAAqB,GAAG,QAAQ,CAAC,wBAAwB,CAAC,aAAa,CAAC,CAAC;YAC7E,aAAa,GAAGA,IAAC,CAAC,GAAG,CAAC,aAAa,EAAE,UAAC,EAAE,EAAE,GAAG;gBACxC,IAAA,mBAA8B,EAA7B,YAAI,EAAE,aAAK,CAAmB;gBAEnC,OAAO;oBACN,YAAY,EAAE,IAAI,GAAC,GAAG,GAAC,KAAK;oBAC5B,IAAI,EAAE,IAAI;oBACV,KAAK,EAAE,KAAK;oBACZ,YAAY,EAAE,QAAQ,CAAC,OAAO,EAAE;oBAChC,KAAK,EAAE,EAAE;iBACT,CAAA;aACD,CAAC,CAAC;YACH,eAAe,CAAC,IAAI,CAAC,IAAI,WAAW,CAAC;gBACpC,OAAO,EAAE,QAAQ,CAAC,OAAO,EAAE;gBAC3B,UAAU,EAAE,QAAQ,CAAC,GAAG,CAAC,OAAO,CAAC;gBACjC,EAAE,EAAE,QAAQ,CAAC,GAAG;gBAChB,OAAO,EAAE,qBAAqB;gBAC9B,QAAQ,EAAE,aAAa;aACvB,CAAC,CAAC,CAAC;SACJ,CAAC,CAAC;QACH,OAAO,eAAe,CAAC;KACvB;IAEO,gCAAU,GAAlB,UAAmB,eAA8B;QAChD,IAAI,WAAW,GAAG,eAAe,CAAC,MAAM,CAAC,UAAU,OAAO,EAAE,CAAC;YAE5D,OAAO,OAAO,IAAI,OAAO,CAAC,CAAC,OAAO,IAAI,QAAQ;kBAC3C,CAAC,CAAC,OAAO,GAAG,UAAU,CAAC,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC;SACtC,EAAE,CAAC,CAAC,CAAC;QACN,OAAO,CAAC,GAAG,CAAC,aAAa,EAAE,WAAW,CAAC,CAAC;QACxCA,IAAC,CAAC,IAAI,CAAC,eAAe,EAAE,UAAC,EAAE;YAC1B,EAAE,CAAC,OAAO,GAAG,CAAC,EAAE,CAAC,OAAO,GAAG,WAAW,GAAG,GAAG,EAAE,OAAO,CAAC,CAAC,CAAC,CAAC;SAEzD,CAAC,CAAC;QACH,OAAO,eAAe,CAAC;KACvB;IAEO,uCAAiB,GAAzB,UAA0B,eAA8B;QACvD,IAAI,eAAe,GAAG,EAAE,CAAC;QACzBA,IAAC,CAAC,IAAI,CAAC,eAAe,EAAE,UAAA,EAAE;YACzB,IAAI,CAAC,EAAE,CAAC,OAAO,EAAE;gBAChB,OAAO,CAAC,GAAG,CAAC,EAAE,CAAC,CAAC;gBAEhB,OAAO;aACP;YACG,IAAA,0BAA6C,EAA5C,gBAAQ,CAAqC;YAClD,QAAQ,GAAG,QAAQ,CAAC,IAAI,EAAE,CAAC;YAC3B,IAAI,CAAC,eAAe,CAAC,QAAQ,CAAC,EAAE;gBAC/B,eAAe,CAAC,QAAQ,CAAC,GAAG,EAAE,CAAC;aAC/B;YACD,eAAe,CAAC,QAAQ,CAAC,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC;SACnC,CAAC,CAAC;QACH,OAAO,CAAC,GAAG,CAAC,eAAe,CAAC,CAAC;QAG7BA,IAAC,CAAC,IAAI,CAAC,eAAe,EAAE,UAAC,GAAG,EAAE,OAAO;YACpC,IAAI,GAAG,CAAC,MAAM,GAAG,CAAC,EAAE;gBACnB,IAAI,QAAM,GAAG,IAAI,WAAW,CAAC;oBAC5B,OAAO,EAAE,OAAO,GAAG,IAAI,GAAG,GAAG,CAAC,MAAM,GAAG,GAAG;oBAC1C,UAAU,EAAE,SAAS;iBACrB,CAAC,CAAC;gBACHA,IAAC,CAAC,IAAI,CAAC,GAAG,EAAE,UAAC,EAAE;oBACd,QAAM,CAAC,OAAO,CAAC,EAAE,CAAC,CAAC;iBACnB,CAAC,CAAC;gBACH,QAAM,CAAC,OAAO,GAAG,OAAO,QAAM,CAAC,OAAO,IAAI,QAAQ;sBAC/C,QAAM,CAAC,OAAO,CAAC,OAAO,CAAC,CAAC,CAAC,GAAG,QAAM,CAAC,OAAO,CAAC;gBAC9C,QAAM,CAAC,OAAO,GAAG,OAAO,QAAM,CAAC,OAAO,IAAI,QAAQ;sBAC/C,QAAM,CAAC,OAAO,CAAC,OAAO,CAAC,CAAC,CAAC,GAAG,QAAM,CAAC,OAAO,CAAC;gBAC9C,eAAe,CAAC,IAAI,CAAC,QAAM,CAAC,CAAC;aAC7B;SACD,CAAC,CAAC;QACH,eAAe,GAAGA,IAAC,CAAC,MAAM,CAAC,eAAe,EAAE,SAAS,CAAC,CAAC;QACvD,OAAO,eAAe,CAAC;KACvB;IAKD,0BAAI,GAAJ;KAEC;IAEF,kBAAC;CAAA,CArIwCC,WAAQ,CAAC,IAAI;;ACdtD,IAAMD,IAAC,GAAG,OAAO,CAAC,YAAY,CAAC,CAAC;AAEjB;IAId,iBAAY,IAAqB;QAArB,qBAAA,EAAA,SAAqB;QAChC,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC;QACjB,OAAO,CAAC,GAAG,CAAC,SAAS,EAAE,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;KACzC;IAED,0BAAQ,GAAR;QACC,IAAI,OAAO,GAAG,EAAE,CAAC;QACjB,OAAO,CAAC,IAAI,CAAC,uBAAuB,CAAC,CAAC;QACtC,OAAO,CAAC,IAAI,CAAC,aAAa,CAAC,CAAC;QAC5B,IAAI,CAAC,UAAU,EAAE,CAAC,OAAO,CAAC,UAAA,GAAG;YAC5B,OAAO,CAAC,IAAI,CAAC,MAAM,GAAG,GAAG,CAAC,IAAI,GAAG,OAAO,CAAC,CAAC;SAC1C,CAAC,CAAC;QACH,OAAO,CAAC,IAAI,CAAC,eAAe,CAAC,CAAC;QAC9B,OAAO,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;QACxB,OAAO,CAAC,IAAI,CAAC,IAAI,CAAC,eAAe,EAAE,CAAC,CAAC;QACrC,OAAO,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;QACzB,OAAO,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;QACzB,OAAO,OAAO,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;KAC1B;IAED,4BAAU,GAAV;QACC,IAAI,IAAI,GAAG,EAAE,CAAC;QACd,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,UAAA,GAAG;YACpB,IAAI,GAAG,IAAI,CAAC,MAAM,CAAC,MAAM,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC;SACrC,CAAC,CAAC;QACH,IAAI,GAAGA,IAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QAGpB,IAAI,IAAI,GAAG,EAAE,CAAC;QACd,IAAI,CAAC,OAAO,CAAC,UAAA,IAAI;YAChB,IAAI,CAAC,IAAI,CAAC,EAAC,IAAI,EAAE,IAAI,EAAC,CAAC,CAAC;SACxB,CAAC,CAAC;QACH,OAAO,IAAI,CAAC;KACZ;IAED,iCAAe,GAAf;QACC,IAAI,OAAO,GAAG,EAAE,CAAC;QACjB,IAAM,OAAO,GAAG,IAAI,CAAC,UAAU,EAAE,CAAC;QAClC,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,UAAA,GAAG;YACpB,OAAO,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;YACrB,OAAO,CAAC,OAAO,CAAC,UAAA,GAAG;gBAClB,OAAO,CAAC,IAAI,CAAC,MAAM,GAAG,GAAG,CAAC,GAAG,CAAC,IAAI,CAAC,GAAG,OAAO,CAAC,CAAC;aAC/C,CAAC,CAAC;YACH,OAAO,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;SACtB,CAAC,CAAC;QACH,OAAO,OAAO,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;KAC1B;IAEF,cAAC;CAAA;;AC9CD,IAAMW,YAAU,GAAG,OAAO,CAAC,YAAY,CAAC,CAAC;AACzC,IAAMV,WAAQ,GAAQ,OAAO,CAAC,UAAU,CAAC,CAAC;AAC1C,IAAMD,IAAC,GAAG,OAAO,CAAC,YAAY,CAAC,CAAC;AAChC,IAAMU,OAAK,GAAG,OAAO,CAAC,UAAU,CAAC,CAAC;AAClC,OAAO,CAAC,QAAQ,CAAC,CAAC;AAClB,OAAO,CAAC,eAAe,CAAC,CAAC;AAEV;IAA0B,+BAA6B;IAQrE,qBAAY,OAAO;QAAnB,YACC,kBAAM,OAAO,CAAC,SAoBd;QAnBA,KAAI,CAAC,UAAU,GAAG,OAAO,CAAC,UAAU,CAAC;QACrC,KAAI,CAAC,UAAU,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC;QAE3B,KAAI,CAAC,EAAE,GAAG,WAAW,CAAC,WAAW,EAAE,CAAC;QACpC,KAAI,CAAC,EAAE,CAAC,MAAM,CAAC,KAAI,CAAC,UAAU,CAAC,CAAC;QAChC,KAAI,CAAC,QAAQ,CAAC,KAAI,CAAC,EAAE,EAAE,oBAAoB,EAAE,KAAI,CAAC,WAAW,CAAC,IAAI,CAAC,KAAI,CAAC,CAAC,CAAC;QAE1E,KAAI,CAAC,QAAQ,GAAGV,IAAC,CAAC,QAAQ,CAAC,oCAAoC;YAC9D,oBAAoB;YACpB,uCAAuC;YACvC,6CAA6C;YAC7C,gCAAgC;YAChC,YAAY,CAAC,CAAC;;KAOf;IAED,gCAAU,GAAV;KAEC;IAED,4BAAM,GAAN;QACC,IAAI,CAAC,UAAU,CAAC,aAAa,EAAE,CAAC;QAChC,IAAM,SAAS,GAAG,IAAI,CAAC,EAAE,CAAC,WAAW,EAAE,CAAC;QACxC,OAAO,CAAC,GAAG,CAAC,WAAW,EAAE,SAAS,CAAC,CAAC;QACpC,IAAI,CAAC,UAAU,CAAC,aAAa,CAAC,SAAS,CAAC,CAAC;QACzC,IAAI,CAAC,UAAU,CAAC,kBAAkB,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC;QAC5C,IAAM,aAAa,GAAG,IAAI,CAAC,UAAU,CAAC,SAAS,EAAE,CAAC;QAElD,IAAI,WAAW,GAAkB,aAAa,CAAC,GAAG,CAAC,UAAC,GAAgB;YACnE,OAAO,GAAG,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC;SACzB,CAAC,CAAC;QAEH,IAAI,WAAW,GAAG,CAAC,CAAC;QACpB,IAAI,UAAU,GAAG,aAAa,CAAC,GAAG,CAAC,UAAC,GAAgB;YACnD,WAAW,IAAI,GAAG,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC;YAEjC,OAAO,WAAW,CAAC;SACnB,CAAC,CAAC;QAEH,IAAI,MAAM,GAAG,aAAa,CAAC,GAAG,CAAC,UAAC,GAAgB;YAC/C,IAAI,IAAI,GAAY,GAAG,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC;YACpC,OAAO,IAAI,CAAC,QAAQ,CAAC,YAAY,CAAC,CAAC;SACnC,CAAC,CAAC;QAEH,IAAI,OAAO,GAAG,EAAE,CAAC;QACjB,OAAO,IAAI,IAAI,CAAC,QAAQ,CAAC;YACxB,OAAO,EAAE,WAAW,CAAC,OAAO,EAAE;SAC9B,CAAC,CAAC;QAEH,OAAO,IAAI,IAAI,OAAO,CAAC,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,SAAS,CAAC,aAAa,CAAC,CAAC,CAAC,CAAC;QAGlE,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;QAEvB,IAAI,CAAC,gBAAgB,CAAC,MAAM,EAAE,WAAW,EAAE,UAAU,CAAC,CAAC;QAEvD,OAAO,IAAI,CAAC;KACZ;IAED,0BAAI,GAAJ;QACC,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC;KAC5B;IAED,iCAAW,GAAX;QAEC,IAAI,CAAC,MAAM,EAAE,CAAC;KACd;IAEO,sCAAgB,GAAxB,UAAyB,MAAqB,EAAE,IAAmB,EAAE,KAAoB;QAAzF,iBA+DC;QA9DA,IAAI,UAAU,GAAG,CAAC,CAAC,YAAY,CAAC,CAAC;QACjC,UAAU,CAAC,IAAI,CAAC,UAAC,KAAK,EAAE,IAAI;YAE3B,IAAI,KAAK,GAAG,CAAC,CAAC,IAAI,CAAC,CAAC;YAEpB,IAAI,GAAG,GAAuB,KAAK,CAAC,GAAG,CAAC,CAAC,CAAE,CAAC,UAAU,CAAC,IAAI,CAAC,CAAC;YAE7D,IAAI,QAAQ,GAAG,EAAE,CAAC;YAGlB,QAAQ,CAAC,aAAa,CAAC,GAAG,KAAK,CAAC,IAAI,CAAC,wBAAwB,CAAC,CAAC;YAC/D,QAAQ,CAAC,MAAM,CAAC,GAAG,KAAK,CAAC;YAEzB,IAAI,OAAO,GAAG;gBACb,IAAI,EAAE,MAAM;gBACZ,KAAK,EAAE,aAAa;gBACpB,IAAI,EAAE,IAAI;gBACV,WAAW,EAAE,SAAS;gBACtB,WAAW,EAAE,CAAC;gBACd,IAAI,EAAE,KAAK;aACX,CAAC;YAGF,IAAI,QAAQ,GAAG,EAAE,CAAC;YAClB,QAAQ,CAAC,QAAQ,CAAC,GAAG,MAAM,CAAC;YAC5B,QAAQ,CAAC,UAAU,CAAC,GAAG,KAAK,CAAC,QAAQ,EAAE,OAAO,CAAC,CAAC;YAEhD,IAAI,KAAK,GAAG,IAAIU,OAAK,CAAC,IAAI,CAAC,GAAG,EAAE;gBAC/B,IAAI,EAAE,QAAQ;gBACd,OAAO,EAAE;oBACR,UAAU,EAAE,KAAK;oBACjB,2BAA2B,EAAE,CAAC;oBAC9B,cAAc,EAAE,eAAe;oBAC/B,eAAe,EAAE,KAAK;oBACtB,kBAAkB,EAAE,KAAK;oBACzB,QAAQ,EAAE,KAAK;oBACf,WAAW,EAAE,KAAK;oBAGlB,aAAa,EAAE,CAAC;oBAChB,cAAc,EAAE,eAAe;oBAC/B,MAAM,EAAE;wBACP,OAAO,EAAE,KAAK;qBACd;oBACD,mBAAmB,EAAE,IAAI;oBACzB,MAAM,EAAE;wBACP,KAAK,EAAE,CAAC;gCACP,KAAK,EAAE;oCACN,OAAO,EAAE,CAAC;iCACV;6BACD,CAAC;qBACF;oBACD,OAAO,EAAE,UAAC,KAAiB,EAAE,aAAa;wBACzC,KAAI,CAAC,YAAY,CAAC,MAAM,EAAE,KAAK,EAAE,aAAa,EAAE,KAAI,CAAC,CAAC;qBACtD;iBACD;aACD,CAAC,CAAC;YACH,KAAK,CAAC,IAAI,CAAC,OAAO,EAAE,KAAK,CAAC,CAAC;SAI3B,CAAC,CAAC;KACH;IAED,kCAAY,GAAZ,UAAa,MAAM,EAAE,KAAK,EAAE,MAAM,EAAE,OAAO;QAK1C,IAAI,GAAG,GAAG,MAAM,CAAC,CAAC,CAAC,CAAC;QACpB,IAAI,KAAK,GAAG,GAAG,CAAC,MAAM,CAAC;QAEvB,IAAI,KAAK,GAAG,IAAI,CAAC,UAAU,CAAC,SAAS,EAAE,CAAC,KAAK,CAAC,CAAC;QAC/C,IAAI,EAAE,GAAG,KAAK,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC;QAEzB,CAAC,CAAC,MAAM,CAAC,CAAC,SAAS,CAAC,CAAC,CAAC,cAAc,GAAG,EAAE,GAAG,SAAS,CAAC,CAAC,MAAM,EAAE,CAAC,GAAG,CAAC,CAAC;QACrE,QAAQ,CAAC,QAAQ,CAAC,IAAI,GAAG,WAAW,GAAG,EAAE,CAAC;KAC1C;IAEF,kBAAC;CAAA,CAnKwCT,WAAQ,CAAC,IAAI;;ACHtD,IAAMA,UAAQ,GAAG,OAAO,CAAC,UAAU,CAAC,CAAC;AAGrC,IAAMC,GAAC,GAAG,OAAO,CAAC,QAAQ,CAAC,CAAC;AAC5B,IAAMF,GAAC,GAAG,OAAO,CAAC,YAAY,CAAC,CAAC;AAEjB;IAAwB,6BAAe;IA0BrD,mBAAY,OAAuB;QAAnC,YACC,kBAAM,OAAO,CAAC,SAMd;QA/BD,YAAM,GAAG;YACR,EAAE,EAAiB,SAAS;YAC5B,cAAc,EAAK,aAAa;YAChC,wBAAwB,EAAE,qBAAqB;YAC/C,SAAS,EAAM,SAAS;YACxB,MAAM,EAAa,MAAM;YACzB,UAAU,EAAS,UAAU;YAC7B,SAAS,EAAU,SAAS;YAC5B,SAAS,EAAU,SAAS;SAC5B,CAAC;QAIF,cAAQ,GAAG,IAAI,iBAAiB,EAAE,CAAC;QAa5B,KAAK,CAAC,WAAW,EAAE,CAAC;QAC1B,KAAI,CAAC,KAAK,GAAG,IAAI,QAAQ,EAAE,CAAC;QAC5B,KAAI,CAAC,KAAK,CAAC,KAAK,EAAE,CAAC;QACnB,KAAI,CAAC,YAAY,GAAG,IAAI,kBAAkB,EAAE,CAAC;QAC7C,KAAI,CAAC,YAAY,CAAC,WAAW,CAAC,KAAI,CAAC,KAAK,CAAC,CAAC;;KAC1C;IAED,gCAAY,GAAZ;QACC,IAAI,GAAG,GAAG,MAAM,CAAC,QAAQ,CAAC;QAI1B,IAAI,OAAO,GAAGE,GAAC,CAAC,oBAAoB,CAAC;aACnC,WAAW,CAAC,QAAQ,CAAC;aACrB,MAAM,CAAC;YACP,OAAO,IAAI,CAAC,IAAI,IAAI,GAAG,CAAC;SACxB,CAAC;aACD,QAAQ,CAAC,QAAQ,CAAC;aAClB,MAAM,EAAE;aACR,WAAW,CAAC,IAAI,CAAC,CAAC;QAEpB,OAAO,IAAI,EAAE;YACZ,IAAI,OAAO,CAAC,EAAE,CAAC,IAAI,CAAC,EAAE;gBACrB,OAAO,GAAG,OAAO,CAAC,MAAM,EAAE,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC,MAAM,EAAE,CAAC;aACnD;iBAAM;gBACN,MAAM;aACN;SACD;KACD;IAED,mCAAe,GAAf;QACC,IAAI,IAAI,CAAC,WAAW,EAAE;YACrB,IAAI,CAAC,WAAW,CAAC,IAAI,EAAE,CAAC;SACxB;KACD;IAED,2BAAO,GAAP;QACC,OAAO,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;QACxB,IAAI,CAAC,YAAY,EAAE,CAAC;QACpB,IAAI,CAAC,eAAe,EAAE,CAAC;QACvB,IAAI,CAAC,IAAI,CAAC,OAAO,EAAE;YAClB,IAAI,CAAC,OAAO,GAAG,IAAI,OAAO,CAAC;gBAC1B,UAAU,EAAE,IAAI,CAAC,KAAK;aACtB,EAAE,IAAI,CAAC,YAAY,CAAC,CAAC;YACtB,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC,QAAQ,GAAG,IAAI,CAAC,QAAQ,CAAC;SAC5C;QACD,IAAI,CAAC,OAAO,CAAC,IAAI,EAAE,CAAC;QACpB,IAAI,CAAC,WAAW,GAAG,IAAI,CAAC,OAAO,CAAC;KAChC;IAED,wBAAI,GAAJ;QACC,OAAO,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;QACrB,IAAI,CAAC,YAAY,EAAE,CAAC;QACpB,IAAI,CAAC,eAAe,EAAE,CAAC;QACvB,IAAI,IAAI,CAAC,OAAO,EAAE;YACjB,IAAI,CAAC,OAAO,CAAC,IAAI,EAAE,CAAC;SACpB;aAAM;YACNA,GAAC,CAAC,cAAc,CAAC,CAAC,IAAI,EAAE,CAAC;SACzB;QACD,IAAI,CAAC,IAAI,CAAC,QAAQ,EAAE;YACnB,IAAI,CAAC,QAAQ,GAAG,IAAI,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;YACrC,IAAI,CAAC,QAAQ,CAAC,MAAM,GAAG,IAAI,CAAC;SAC5B;QACD,IAAI,CAAC,QAAQ,CAAC,MAAM,EAAE,CAAC;QACvB,IAAI,CAAC,WAAW,GAAG,IAAI,CAAC,QAAQ,CAAC;KACjC;IAED,2BAAO,GAAP;QACC,OAAO,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;QACxB,IAAI,CAAC,YAAY,EAAE,CAAC;QACpB,IAAI,CAAC,eAAe,EAAE,CAAC;QACvB,IAAI,CAAC,IAAI,CAAC,OAAO,EAAE;YAClB,IAAI,CAAC,OAAO,GAAG,IAAI,OAAO,CAAC,IAAI,CAAC,KAAK,EAAE,IAAI,CAAC,YAAY,CAAC,CAAC;SAC1D;QACD,IAAI,CAAC,OAAO,CAAC,MAAM,EAAE,CAAC;QACtB,IAAI,CAAC,WAAW,GAAG,IAAI,CAAC,OAAO,CAAC;KAChC;IAED,4BAAQ,GAAR;QACC,OAAO,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;QACzB,IAAI,CAAC,YAAY,EAAE,CAAC;QACpB,IAAI,CAAC,eAAe,EAAE,CAAC;QACvB,IAAI,CAAC,IAAI,CAAC,YAAY,EAAE;YACvB,IAAI,CAAC,YAAY,GAAG,IAAI,YAAY,EAAE,CAAC;YACvC,IAAI,CAAC,YAAY,CAAC,QAAQ,GAAG,IAAI,CAAC,QAAQ,CAAC;SAC3C;QACD,IAAI,CAAC,YAAY,CAAC,MAAM,EAAE,CAAC;QAC3B,IAAI,CAAC,WAAW,GAAG,IAAI,CAAC,YAAY,CAAC;KACrC;IAED,+BAAW,GAAX,UAAY,IAAI,EAAE,KAAK;QACtB,OAAO,CAAC,IAAI,CAAC,aAAa,EAAE,IAAI,EAAE,KAAK,CAAC,CAAC;QACzC,IAAI,QAAQ,CAAC,IAAI,CAAC,IAAI,QAAQ,CAAC,KAAK,CAAC,EAAE;YACtC,IAAI,CAAC,OAAO,EAAE,CAAC;YACf,IAAI,CAAC,OAAO,CAAC,EAAE,CAAC,YAAY,CAAC,IAAI,EAAE,KAAK,CAAC,CAAC;SAC1C;KACD;IAED,uCAAmB,GAAnB,UAAoB,IAAI,EAAE,KAAK,EAAE,QAAQ;QACxC,OAAO,CAAC,IAAI,CAAC,qBAAqB,EAAE,IAAI,EAAE,KAAK,EAAE,QAAQ,CAAC,CAAC;QAC3D,IAAI,QAAQ,CAAC,IAAI,CAAC,IAAI,QAAQ,CAAC,KAAK,CAAC,EAAE;YACtC,IAAI,CAAC,OAAO,EAAE,CAAC;YACf,IAAI,CAAC,OAAO,CAAC,EAAE,CAAC,YAAY,CAAC,IAAI,EAAE,KAAK,CAAC,CAAC;YAC1C,IAAI,GAAG,GAAG,IAAI,CAAC,YAAY,CAAC,SAAS,CAAC,EAAC,OAAO,EAAE,QAAQ,EAAC,CAAC,CAAC;YAC3D,OAAO,CAAC,GAAG,CAAC,yBAAyB,EAAE,GAAG,CAAC,CAAC;YAC5C,IAAI,CAAC,OAAO,CAAC,UAAU,CAAC,gBAAgB,CAAC,GAAG,CAAC,CAAC;YAC9C,IAAI,CAAC,OAAO,CAAC,UAAU,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAC;SAC1C;KACD;IAED,2BAAO,GAAP;QACC,OAAO,CAAC,GAAG,CAAC,SAAS,CAAC,CAAC;QACvB,IAAI,CAAC,YAAY,EAAE,CAAC;QACpB,IAAI,CAAC,eAAe,EAAE,CAAC;QACvB,IAAI,CAAC,IAAI,CAAC,WAAW,EAAE;YACtB,IAAI,CAAC,WAAW,GAAG,IAAI,WAAW,CAAC;gBAClC,UAAU,EAAE,IAAI,CAAC,YAAY;aAC7B,EAAE,IAAI,CAAC,KAAK,CAAC,CAAC;SACf;QACDA,GAAC,CAAC,WAAW,CAAC,CAAC,IAAI,EAAE,CAAC;QACtBA,GAAC,CAAC,aAAa,CAAC,CAAC,IAAI,EAAE,CAAC;QACxB,IAAI,CAAC,WAAW,CAAC,MAAM,EAAE,CAAC;QAC1B,IAAI,CAAC,WAAW,GAAG,IAAI,CAAC,WAAW,CAAC;KACpC;IAED,2BAAO,GAAP;QACC,OAAO,CAAC,GAAG,CAAC,SAAS,CAAC,CAAC;QACvB,IAAI,CAAC,YAAY,EAAE,CAAC;QACpB,IAAI,CAAC,eAAe,EAAE,CAAC;QACvB,IAAI,CAAC,IAAI,CAAC,WAAW,EAAE;YACtB,IAAI,CAAC,WAAW,GAAG,IAAI,WAAW,CAAC;gBAClC,UAAU,EAAE,IAAI,CAAC,KAAK;aACtB,CAAC,CAAC;SACH;QACDA,GAAC,CAAC,WAAW,CAAC,CAAC,IAAI,EAAE,CAAC;QACtBA,GAAC,CAAC,aAAa,CAAC,CAAC,IAAI,EAAE,CAAC;QACxB,IAAI,CAAC,WAAW,CAAC,MAAM,EAAE,CAAC;QAC1B,IAAI,CAAC,WAAW,GAAG,IAAI,CAAC,WAAW,CAAC;KACpC;IAEF,gBAAC;CAAA,CAxKsCD,UAAQ,CAAC,MAAM;;ACjBtD,IAAM,CAAC,GAAG,OAAO,CAAC,YAAY,CAAC,CAAC;AAChC,IAAMA,UAAQ,GAAG,OAAO,CAAC,UAAU,CAAC,CAAC;AAOrC,IAAI,MAAM,CAAC,eAAe,EAAE;IAC3B,MAAM,CAAC,eAAe,CAAC,cAAc,CAACA,UAAQ,CAAC,CAAC;CAChD;AACD,IAAMC,GAAC,GAAG,OAAO,CAAC,QAAQ,CAAC,CAAC;AAG5B,mBAA0B,GAAe,EAAE,QAAkB,EAAE,IAAe;IAC7E,CAAC,cAAc,CAAC;QAEf,QAAQ,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,CAAC,EAAE,GAAG,CAAC,MAAM,CAAC,CAAC;QAGhC,IAAI,CAAC,GAAG,GAAG,CAAC,MAAM,EAAE;YACnB,UAAU,CAAC;gBACV,IAAI,CAAC,EAAE,CAAC,CAAC,CAAA;aACT,EAAE,CAAC,CAAC,CAAC;SACN;aAAM;YACN,IAAI,IAAI,EAAE;gBAET,IAAI,EAAE,CAAC;aACP;SACD;KACD,CAAC,CAAC,CAAC,EAAE;CACN;AAED,eAAsB,IAAI;IAAE,cAAO;SAAP,UAAO,EAAP,qBAAO,EAAP,IAAO;QAAP,6BAAO;;IAClC,OAAO,CAAC,IAAI,OAAZ,OAAO,GAAM,OAAO,IAAI,EAAE,GAAG,SAAK,IAAI,GAAE;CACxC;AAED;IAIC;QACC,IAAI,CAAC,MAAM,GAAG,IAAI,SAAS,EAAE,CAAC;QAG9B,IAAM,EAAE,GAAGD,UAAQ,CAAC,OAAO,CAAC,KAAK,CAAC;YACjC,IAAI,EAAE,qBAAqB;SAC3B,CAAC,CAAC;QACH,OAAO,CAAC,GAAG,CAAC,eAAe,EAAE,EAAE,CAAC,CAAC;QACjC,IAAI,CAAC,EAAE,EAAE;YACR,OAAO,CAAC,GAAG,CAACA,UAAQ,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC;SACrC;QAED,IAAI,CAAC,UAAU,EAAE,CAAC;QAClB,IAAI,CAAC,IAAI,EAAE,CAAC;QACZ,OAAO,CAAC,GAAG,CAAC,6BAA6B,CAAC,CAAC;KAC3C;IAED,6BAAU,GAAV;QACCC,GAAC,CAAC,QAAQ,CAAC,CAAC,EAAE,CAAC,OAAO,EAAE,kBAAkB,EAAE,UAAC,KAAK;YACjD,IAAI,IAAI,GAAGA,GAAC,CAAC,KAAK,CAAC,MAAM,CAAC,CAAC;YAC3B,IAAI,SAAS,GAAG,IAAI,CAAC,MAAM,EAAE,CAAC;YAC9B,IAAI,KAAK,GAAG,SAAS,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC,IAAI,EAAE,CAAC;YAC3C,IAAI,CAAC,IAAI,EAAE,CAAC;YACZ,KAAK,CAAC,KAAK,EAAE,CAAC,GAAG,CAAC,IAAI,CAAC,IAAI,EAAE,CAAC,IAAI,EAAE,CAAC,CAAC;YACtC,KAAK,CAAC,KAAK,CAAC,UAAC,KAAK;gBACjB,OAAO,CAAC,GAAG,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;gBACvB,IAAI,KAAK,CAAC,OAAO,KAAK,EAAE,EAAE;oBACzBA,GAAC,CAAC,KAAK,CAAC,MAAM,CAAC,CAAC,IAAI,EAAE,CAAC;iBACvB;aACD,CAAC,CAAC;YACH,KAAK,CAAC,IAAI,CAAC,UAAC,KAAK;gBAChB,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,GAAG,EAAE,CAAC,IAAI,EAAE,CAAC,CAAC;gBAC9B,KAAK,CAAC,IAAI,EAAE,CAAC;gBACb,IAAI,CAAC,IAAI,EAAE,CAAC;gBACZ,IAAI,QAAQ,GAAG,SAAS,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;gBAC1C,IAAI,OAAO,QAAQ,IAAI,UAAU,EAAE;oBAClC,QAAQ,CAAC,KAAK,EAAE,SAAS,EAAE,SAAS,CAAC,IAAI,EAAE,CAAC,IAAI,EAAE,CAAC,CAAC;iBACpD;aACD,CAAC,CAAC;SACH,CAAC,CAAC;KACH;IAED,uBAAI,GAAJ;QACC,IAAM,IAAI,GAAG,OAAO,CAAC,gBAAgB,CAAC,CAAC;QACvC,IAAI,IAAI,GAAG,IAAI,IAAI,CAAC;YACnB,KAAK,EAAE;gBACN;oBACC,OAAO,EAAE,MAAM;oBACf,KAAK,EAAE,8BAA8B;oBACrC,OAAO,EAAE,0DAA0D;iBACnE;aACD;SAAC,CAAC,CAAC;QAEL,UAAU,CAAC;SAKV,EAAE,CAAC,CAAC,CAAC;KACN;IAEF,eAAC;CAAA,IAAA;AAEDA,GAAC,CAAC;IACD,UAAU,CAAC;QACV,IAAI,QAAQ,EAAE,CAAC;KACf,EAAE,CAAC,GAAC,IAAI,CAAC,CAAC;CACX,CAAC,CAAC;;;;;;;;;;;"}